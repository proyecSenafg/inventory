(window.webpackJsonp=window.webpackJsonp||[]).push([["spark-core-wraper",14,19],{111:function(e,t,o){var n,r;n=[o(16),o(9),o(2),o(33),o(97),o(127),o(63),o(299),o(204),o(35)],void 0===(r=function(e,t,n,r,i,a,s,c,l,d){"use strict";var u,h,f,g=l.default,p=d.SparkPerformanceTracker;function m(){if(!u){var e=i.getAppByType("authoring-context"),t=n.defer();performance.now();u=n.defer(),e.lazyLoad(t),p.measurePromise("BrandKitWrapper.getController",u.promise),t.promise.then((function(){Promise.all([o.e("vendors~brand-kit-controller~create-template-project-picker"),o.e(8),o.e("vendors~brand-kit-controller"),o.e(3),o.e("brand-kit-controller")]).then(function(e){var t=o(862);o(866);u.resolve(t)}.bind(null,o)).catch(o.oe)}))}return u.promise}function v(e,t){e.on("authoring-context-theme-assigned",(function(o){t.app.setAuthoringContextThemeId(e,o)}))}function y(e,o){var r=[],i={};return o&&("function"==typeof o.belongsToUser&&o.belongsToUser()||!0===o.belongsToUser)?n.resolve([]):(t.each(e,(function(e){var n=o.getCustomFonts(!0),a=t.find(n,(function(t){var o=t.getMetrics();if(o){if(e.postScriptName&&o.postScriptName&&e.postScriptName.toLowerCase()===o.postScriptName.toLowerCase())return!0;if(e.lookupKey&&e.lookupKey===t.lookupKey())return!0}else window.marvel.logger.traceflow("brand-kit","verifyFonts no metrics found",t.friendlyName());return!1}));a&&!a.isInstallable()&&(i[a.getTOUAName()]=a,r.push(a.getTOUAName())),r=t.uniq(r)})),r.length>0?c.checkProvidedFonts(r).then((function(e){var o=[];return t.each(r,(function(t){e&&e[t]||(window.marvel.logger.traceflow("brand-kit",'verifyFonts found missing font: "'+t+'"'),o.push(i[t]))})),n.resolve(o)})):n.resolve([]))}return{IMAGES_PARENT:"images",LOGOS_PARENT:"logos",FONTS_PARENT:"fonts",COLORS_PARENT:"colors",F_SPLASH:"splash",MAX_LOGO_SIZE:1024,getSyncGroup:function(){return s.syncGroups["adobe-spark-authoring-contexts"]},getChooserView:function(){var e=n.defer();return Promise.all([o.e("m-react-spectrum"),o.e(0),o.e(1),o.e(2),o.e("brand-kit-chooser-view")]).then(function(t){var n=o(868);e.resolve(n)}.bind(null,o)).catch(o.oe),e.promise},loadEditorView:function(){var e=n.defer();return Promise.all([o.e("m-react-spectrum"),o.e(0),o.e(1),o.e(2),o.e("brand-kit-editor")]).then(function(t){var n=o(867);e.resolve(n)}.bind(null,o)).catch(o.oe),e.promise},getController:m,getDefaultBrand:function(){return m().then((function(e){return e.getDefaultContext("brand-kit")}))},getOrCreateDefaultBrand:function(){return m().then((function(e){return e.getDefaultContext("brand-kit").then((function(o){return o||(h||(h=n.defer(),e.getContextsByType("brand-kit","all").then(function(o){var n;if(!t.isEmpty(o)){o=t.sortBy(o,function(e){return e.getName()}.bind(this));for(var r=[],i=[],a=0;a<o.length;a+=1)o[a].activated()&&i.push(o[a]),o[a].belongsToUser()&&r.push(o[a]);n=i.length?i[0]:r.length?r[0]:null}n?h.resolve(n.upgrade()):h.resolve(e.createContext("","brand-kit"))}.bind(this))),h.promise)}))}))},setDefaultBrandIfNecessary:function(e){return m().then((function(t){return t.getDefaultContext("brand-kit").then((function(o){if(!o)return t.setDefaultContext(e)}))}))},getBrandById:function(e){return m().then((function(t){return t.getContextById(e)}))},setAssociatedBrand:function(e,t){return m().then((function(o){return o.setActiveContext(e,t)}))},getAssociatedBrand:function(e){return m().then((function(t){return t.getActiveContext(e)}))},getAllOwnedActivatedBrands:function(){return m().then((function(e){return e.getContextsByType("brand-kit","owned",!0).then((function(e){return t.filter(e,(function(e){return e.activated()}))}))}))},getAllSharedBrands:function(){return m().then((function(e){return e.getContextsByType("brand-kit","shared",!0).then((function(e){return t.filter(e,(function(e){return e.activated()}))}))}))},getAllActivatedBrands:function(){return m().then((function(e){return e.getContextsByType("brand-kit","all",!0).then((function(e){return t.filter(e,(function(e){return e.activated()}))}))}))},getAllBrands:function(){return m().then((function(e){return e.getContextsByType("brand-kit","all",!1)}))},getAllOwnedBrands:function(){return m().then((function(e){return e.getContextsByType("brand-kit","owned",!0)}))},loadContextualViews:function(){var e=n.defer();return Promise.all([o.e("m-react-spectrum"),o.e(0),o.e(1),o.e(2),o.e("brand-kit-context-views")]).then(function(t){var n={ChromePreview:o(870),ChromeEditorView:o(871),OutroEditorView:o(872),OutroPreviewView:o(863),StampEditorView:o(873),StampPreviewView:o(864)};e.resolve(n)}.bind(null,o)).catch(o.oe),e.promise},guideMe:function(t){if(window.sessionStorage)try{var n=window.sessionStorage.getItem("guide-me");n&&(window.sessionStorage.removeItem("guide-me"),e(t).addClass(n),f?(f.setElement(t),f.showOverlay()):o.e("custom-workspace-guide-me").then(function(e){var n=o(869);(f=new n).onHide=function(){},f.setElement(t),f.showOverlay()}.bind(null,o)).catch(o.oe))}catch(r){}},augmentSharePublishConfig:function(e,t){r.hasFeature("entitle-brand-kit")?t.supportsBrandedChrome?t.mrvlDoc.getMyApp().getAuthoringContextId(t.mrvlDoc)?(e.customBranding=!0,e.removeBranding=!1):(e.customBranding=!1,e.removeBranding=!0):e.removeBranding=!0:(e.removeBranding=!1,t.supportsBrandedChrome&&(e.customBranding=!1))},augmentAppConfig:function(e){return e.assetId||e.contextId?n.resolve(e):m().then((function(t){return t.getDefaultContext().then((function(t){return t&&(e.contextId=t.getId()),e}))}))},augmentNewDoc:function(e,t){return r.hasFeature("entitle-brand-kit")&&(v(e,t),t.contextId&&t.app.setAuthoringContextId(e,t.contextId,!0)),n.resolve(e)},augmentLoadDoc:function(e,t){r.hasFeature("entitle-brand-kit")&&v(e,t)},getExportAnalytics:function(e,t,o){var n=e.getMyApp(),r=function(e){var t="unknown";"slate-web"===e?t="page":"theo-web"===e?t="post":"ginger-snap"===e&&(t="video");return t}(n.registeredName);return m().then((function(i){return i.getActiveContext(e).then((function(i){if(i){var a,s=n.getAuthoringContextThemeId(e),c="exportedWithThemeName",l=i.getThemeletById(s);l&&(a=l.getValue("theme#data")),"theo-web"===n.registeredName&&(c="exportedWithTemplateName");var d=null;return i.isSharedWithUser()&&(d="collabType:sharedBrand"),n.isBranded(e).then((function(e){var n={workflow:t,contextData:["projectId","invokedShareFrom"],exportMethod:o,sparkFormat:r,exportedWithBranding:e,themeletId:s,contextualData16:d},i="unknown";return a?i=a.name:l&&(i=l.getValue("name")),n[c]=i,n}))}return{workflow:t,contextData:["projectId","invokedShareFrom"],exportedWithBranding:!1,exportMethod:o,sparkFormat:r}}))}))},getCreatedAnalytics:function(e){var t=e.getMyApp();return m().then((function(o){return o.getActiveContext(e).then((function(o){if(o){var n=t.getAuthoringContextThemeId(e),r="createdWithThemeName",i=o.getThemeletById(n),a=i.getValue("theme#data");return"theo-web"===t.registeredName&&(r="exportedWithTemplateName"),t.isBranded(e).then((function(e){var t,o={contextData:["projectId"],createdWithBranding:e,themeletId:n};return t=a?a.name:i.getValue("name"),o[r]=t,o.themeName=t,o}))}return{contextData:["projectId"],createdWithBranding:!1}}))}))},verifyBrandAccess:function(e,t,o){return t?(o||m()).then((function(t){var o=e.getMyApp(),r=o.getAuthoringContextId(e);return t.getContextById(r).then((function(i){var s=r&&i||!r&&!i,c="INCOMING"!==e.getCollaboration();return(s||c?n.resolve(i):function(e,t,o,r){return a.acceptBrandInvite(e,t,o).then((function(){return window.marvel.logger.info("BrandKitWrapper accepted pending invite",{doc:t.id,ctxId:o}),r.getContextById(o)})).catch((function(e){return window.marvel.logger.warn("BrandKitWrapper pending invite NOT found",{doc:t.id,ctxId:o,err:e}),n.resolve(null)}))}(o,e,r,t)).then((function(i){if(s=r&&i||!r&&!i)return n.resolve({accessOk:!0,brand:i});if(c){var l=o.getAuthoringContextUrn(e);return a.requestAccess(l,"brandkit",g.CONTEXT.PROJECT_OPEN_BRAND_MISSING).then((function(r){return r===g.REQUEST_ACCESS.CONTINUE_WITHOUT_BRAND||r===g.REQUEST_ACCESS.RESOURCE_NOT_FOUND?t.getDefaultContext().then((function(t){return t?o.rebrandProject(e,t,!0).then((function(){return n.resolve({accessOk:!0,brand:t,switchedToDefaultBrand:!0,requestAccessFlowStatus:r})})):n.resolve({accessOk:!0,brand:null,requestAccessFlowStatus:r})})):n.resolve({accessOk:!1,brand:null,requestAccessFlowStatus:r||g.REQUEST_ACCESS.UNDEFINED_STATUS})})).catch((function(e){return n.resolve({accessOk:!1,brand:null})}))}return n.resolve({accessOk:!1,brand:null})}))}))})):n.resolve({accessOk:!0,brand:null})},verifyFontAccess:function(e,o){var r=o&&("function"==typeof o.belongsToUser&&o.belongsToUser()||!0===o.belongsToUser);if(!o||r)return window.marvel.logger.traceflow("brand-kit","verifyFonts resolve because brand is owned"),n.resolve([]);if(!e.getMyApp().getFontsUsed)return window.marvel.logger.traceflow("brand-kit","verifyFonts resolve because getFontsUsed is not implemented by "+e.getMyApp().typeName),n.resolve([]);window.marvel.logger.traceflow("brand-kit","verifyFonts calling getFontsUsed");try{var i=e.getMyApp(),a=n.defer();return i.lazyLoad(a),a.promise.then((function(){return e.getMyApp().getFontsUsed(e).then((function(e){return window.marvel.logger.traceflow("brand-kit","verifyFonts getFontsUsed returned",e),y(t.uniqBy(e||[],(function(e){return e.postScriptName||e.lookupKey})),o)}))}))}catch(s){return window.marvel.logger.error("App failed in getFontsUsed",{doc:e,stack:s.stack,error:s}),n.resolve([])}},verifyFontsUsed:y}}.apply(t,n))||(e.exports=r)},1734:function(e,t,o){"use strict";var n=o(4),r=o.n(n),i=o(3),a=o.n(i),s=o(1747),c=o(2082),l="root",d=function(){function e(t,o){r()(this,e),this._controller=o;var n=t||{};n.discoverySpec?this.id=n.discoverySpec.getFolderId():this.id=n.id,this.isFolder=!0,this.parentFolder=n.parentFolder||null,this.name=n.name,this.id!==l||this.name||(this.name="Projects"),n.discoverySpec||(n.discoverySpec=new s.a(null,null,null,null,this.id)),this._discoveryContext=new c.a(n.discoverySpec,o),this._discoveryContext.getSpec().folder=this,void 0!==n.folderCount&&(this._discoveryContext.totalFolders=n.folderCount),void 0!==n.projectCount&&(this._discoveryContext.totalProjects=n.projectCount),this.isPlaceholder=!!n.isPlaceholder}return a()(e,[{key:"refreshInfo",value:function(e){return e.name!==this.name&&(this.name=e.name,!0)}},{key:"setName",value:function(e){this.name=e}},{key:"setSpec",value:function(e){this._discoveryContext.setSpec(e)}},{key:"getSpec",value:function(){return this._discoveryContext.getSpec()}},{key:"delete",value:function(){return this._controller.deleteSubfolder(this.parentFolder,this.id)}},{key:"rename",value:function(e){return this._controller.renameFolder(this,e)}},{key:"getDiscoveryContext",value:function(){return this._discoveryContext}},{key:"move",value:function(e){return this._controller.move([this],e)}},{key:"getDisplayName",value:function(){return this.name}}]),e}();d.COMPONENT_NAME="spark-folder",t.a=d},1747:function(e,t,o){"use strict";var n=o(4),r=o.n(n),i=o(3),a=o.n(i),s="root",c=function(){function e(t){r()(this,e);var o=t||{};this._filter=o.filter,this._incomingCollabOnly=o.incomingCollabOnly,this._sort=o.sort,this._sortDirection=o.sortDirection,this._folderId=o.folderId||s,this._useFlatApi=o.useFlatApi||!1}return a()(e,[{key:"getKey",value:function(){return this.getFolderId()+this.getFilter()+this.getIncomingCollabOnly()+this.getSort()+this.getSortDirection()}},{key:"getFolderId",value:function(){return this._folderId}},{key:"getFilter",value:function(){return this._filter||"all"}},{key:"setFilter",value:function(e){this._filter=e}},{key:"getIncomingCollabOnly",value:function(){return this._incomingCollabOnly||"none"}},{key:"setIncomingCollabOnly",value:function(e){this._incomingCollabOnly=e}},{key:"getSort",value:function(){return this._sort||"modified"}},{key:"setSort",value:function(e){this._sort=e}},{key:"getSortDirection",value:function(){return this._sortDirection||"desc"}},{key:"setSortDirection",value:function(e){this._sortDirection=e}},{key:"getBasePath",value:function(){return this._useFlatApi?"flat":"folders"}}]),e}();c.COMPONENT_NAME="spark-folder-discovery-spec",t.a=c},1800:function(e,t,o){"use strict";var n=o(4),r=o.n(n),i=o(3),a=o.n(i),s=o(29),c=o.n(s),l=o(28),d=o.n(l),u=o(30),h=o.n(u),f=o(2),g=o.n(f),p=o(97),m=o.n(p),v=o(63),y=o.n(v),C=o(680),b=o.n(C),_=o(1734),k=function(){function e(t,o){r()(this,e),this._controller=o,this.id=t?t.id:null,this.assetId=t?t.assetId:null,this.parentFolder=t&&t.parentFolder instanceof _.a?t.parentFolder:null,this.name=t?t.name:"",this.type=t?t.type:null,this.contentModified=t?t.modified:null,this.thumbnail=t?t.thumbnail:"",this.eTag=t?t.eTag:"",this.isPublished=!!t&&!!t.isPublished,this._collaboration=t?t.collaboration:null,this._isBranded=!!t&&t.isBranded,this._ccpath=t?t.ccpath:"",this._sg=t?t._sg:null,this.metaFolder=t?t.metaFolder:null,this.theoPageCount=t?t.theoPageCount:null}return a()(e,[{key:"isBranded",value:function(){return g.a.resolve(this._isBranded)}},{key:"isIncomingCollaboration",value:function(){return"INCOMING"===this.getCollaboration()}},{key:"isOutgoingCollaboration",value:function(){return"OUTGOING"===this.getCollaboration()}},{key:"getCollaborationForAnalytics",value:function(){var e=this.getCollaboration();return"INCOMING"===e?"collabRecipient":"OUTGOING"===e?"collabOwner":"collabNone"}},{key:"refreshInfo",value:function(e){var t=!1;return this.name===e.name&&this.contentModified===e.modified&&this.thumbnail===e.thumbnail&&this._isBranded===e.isBranded&&this._collaboration==e.collaboration||(t=!0),this.name=e.name,this.contentModified=e.modified,this.thumbnail=e.thumbnail,this._isBranded=e.isBranded,this._collaboration=e.collaboration,this.eTag=e.eTag,!this.parentFolder&&e.parentFolder&&e.parentFolder instanceof _.a&&(this.parentFolder=e.parentFolder),t}},{key:"getStorageURL",value:function(){return"https://"+window.marvel.settings.ss.replace("-creativesdk","")+"/id/"+this.assetId}},{key:"getStoragePath",value:function(){return this._ccpath}},{key:"getURN",value:function(){return g.a.resolve(this.assetId)}},{key:"getCompositeDoc",value:function(){var e=this;return this._controller.getCompositeDocWithMetadata(this.assetId,{collaboration:this.getCollaboration()}).then((function(t){return t.linkSparkAsset(e),t}))}},{key:"updateFromLinkedDoc",value:function(e){var t=this;if(e){this.name=e.getProjectName();var o=e.getImageRendition(400);o&&o.then((function(e){e.url&&(t.thumbnail=e.url)}))}}},{key:"getCollaboration",value:function(){return this._collaboration}},{key:"setCollaboration",value:function(e){this._collaboration!==e&&(this._collaboration=e)}},{key:"getMyApp",value:function(){var e=m.a.getAppByDocType(this.type);return e||"application/vnd.adobe.ginger.document+dcx"!==this.type||(e=m.a.getAppByDocType("application/vnd.adobe.ginger.project+dcx")),e}},{key:"getMyPrimaryApp",value:function(){return this.getMyApp()}},{key:"getProjectName",value:function(e){return this.name}},{key:"rename",value:function(e){var t=this;this.name=e,this.getCompositeDoc().then((function(o){t.getMyApp().setProjectName(o,e)}))}},{key:"move",value:function(e){return this._controller.move([this],e)}},{key:"duplicate",value:function(e,t,o){var n=this.getMyApp().getSetting("syncGroup");return this._duplicate(n,e,t,null,o)}},{key:"_duplicate",value:function(e,t,o,n,r){var i=this;return this.getCompositeDoc().then((function(a){var s=a.get("compositeObj");return a.downloadComponents().then((function(a){var c=y.a.newCompositeAsCopyOf(s,n);if(c){var l=new b.a({name:t,id:c.id,modified:!1,syncGroupName:e,compositeObj:c});l.clearUnneededDuplicationData(),l.getMyApp().usesContentModifiedEtags()&&l.setContentModifiedIfNeeded(),l.getDCXRoot().setValue("name",t);var d=y.a.AdobeDCXUtil.appendPathElements("assets",e,c.id),u=g.a.defer();y.a.dcx.compositeXfer.createComposite(c,d,!1,y.a.dcxSession,(function(e,t){e?u.reject(e):(l.set("assetId",t),i._controller.addCompositeDocLocal(t,l),u.resolve(t))}));return u.promise.then((function(){return y.a.pushComposite(c,e)})).then((function(){var e=l.getMyApp();return(e.postDuplicate?e.postDuplicate(l):g.a.resolve()).then((function(){return i._controller.createProject(l,o,r)}))}))}return g.a.reject(new Error("Failed to duplicate project"))}))}))}},{key:"getContentModifiedDate",value:function(){return this._unZpadDate(this.contentModified)}},{key:"_unZpadDate",value:function(e){var t=Date.parse(e),o=Number(t);if(o==o)return new Date(t);var n,r=e.split("T"),i=1*r[1].substring(0,2);if(i>23){var a=r[0]+"T23"+r[1].substring(2);return(n=new Date(a)).setUTCHours(n.getUTCHours()+(i-23)),n}return new Date}},{key:"belongsToUser",value:function(){return"INCOMING"!==this.getCollaboration()}}]),e}();k.COMPONENT_NAME="spark-asset";var w={voice:"video",theo:"post",slate:"page"},D=function(e){function t(){var e;r()(this,t);for(var o=arguments.length,n=new Array(o),i=0;i<o;i++)n[i]=arguments[i];return c()(this,(e=d()(t)).call.apply(e,[this].concat(n)))}return h()(t,e),a()(t,[{key:"get",value:function(e){return this[e]?this[e]:null}},{key:"getDisplayName",value:function(){var e=this.getMyApp();return e?e.getProjectName(this):""}},{key:"getItemTypeName",value:function(){var e=this.getMyApp(),t=e?e.getAppTypeID():null;return t?w[t]:"unknown"}},{key:"preflightDuplicateStockImages",value:function(){var e=this;return this.getCompositeDoc().then((function(t){return e.getMyPrimaryApp().batchCheckLicenses(t,{tryToLicense:!0})}))}},{key:"hasPremiumIngredients",value:function(){var e=this;return this.getCompositeDoc().then((function(t){return e.getMyPrimaryApp().hasPremiumIngredients(t)}))}}]),t}(k);D.COMPONENT_NAME="spark-project";t.a=D},2082:function(e,t,o){"use strict";var n=o(4),r=o.n(n),i=o(3),a=o.n(i),s=o(2048),c=o.n(s),l=o(2223),d=o.n(l),u=function(){function e(t,o){r()(this,e),this._controller=o,this._spec=t,this._sgLastTimestampMap={},this.folderName="",this.breadCrumbs=[],this.disableSorting=!1,this.reset()}return a()(e,[{key:"_makeItemHolder",value:function(){return{loaded:0,total:0,items:[]}}},{key:"reset",value:function(){this._etagBundle="",this._sgLastTimestampMap={},this.localProjects=this._makeItemHolder(),this.localFolders=this._makeItemHolder()}},{key:"_orderItems",value:function(e){var t=[],o=this._spec.getSort(),n=this._spec.getSortDirection();return"modified"===o?(t=e.sort((function(e,t){var o=e.getContentModifiedDate(),n=t.getContentModifiedDate();return o.getTime()<n.getTime()?-1:o.getTime()>n.getTime()?1:0})),"asc"!==n&&t.reverse()):t=d()(e,[function(e){return c()(e[o]).toLowerCase()},"id"],[n,"asc"]),t}},{key:"_sortItems",value:function(e){var t=this._spec.getSort(),o=this._spec.getSortDirection(),n=[];return n="modified"===t?e.sort((function(e,t){var o=e.getContentModifiedDate(),n=t.getContentModifiedDate();return o.getTime()<n.getTime()?-1:o.getTime()>n.getTime()?1:0})):e.sort((function(e,o){var n=e[t].toLowerCase(),r=o[t].toLowerCase();return n<r?-1:n>r?1:0})),"asc"!==o&&n.reverse(),n}},{key:"setSpec",value:function(e){this._spec&&e.getKey()===this._spec.getKey()||(this._spec=e,this.reset())}},{key:"getSpec",value:function(){return this._spec}},{key:"getPagingToken",value:function(){return this.projects.length>0?this.projects[this.projects.length-1].id:""}},{key:"getEtagBundle",value:function(){return this._etagBundle}},{key:"setEtagBundle",value:function(e){this._etagBundle=e}},{key:"getSgLastTimestampMap",value:function(){return this._sgLastTimestampMap}},{key:"setSgLastTimestampMap",value:function(e){this._sgLastTimestampMap=e||{}}},{key:"_findLocalItem",value:function(e,t){var o=-1;return e.items.forEach((function(e,n){e.id===t.id&&(o=n)})),o}},{key:"_addLocalItem",value:function(e,t){this._findLocalItem(e,t)<0&&(e.items[e.items.length]=t,e.loaded++,e.total++)}},{key:"_removeItemLocal",value:function(e,t){var o=this._findLocalItem(e,t);return o>-1&&(e.items.splice(o,1),e.loaded--,e.total--,!0)}},{key:"addProjectLocal",value:function(e,t){this._addLocalItem(this.localProjects,e),t&&this.sortProjects()}},{key:"addFolderLocal",value:function(e){this._addLocalItem(this.localFolders,e)}},{key:"removeFolderLocal",value:function(e){return this._removeItemLocal(this.localFolders,e)}},{key:"removeProjectLocal",value:function(e){return this._removeItemLocal(this.localProjects,e)}},{key:"sortProjects",value:function(){if(!this.disableSorting){var e=this._orderItems(this.localProjects.items);this.localProjects.items=e}}},{key:"loadMore",value:function(){return this._controller.loadMoreProjects(this)}},{key:"projects",get:function(){return this.localProjects.items}},{key:"folders",get:function(){return this.localFolders.items}},{key:"totalProjects",get:function(){return this.localProjects.total},set:function(e){this.localProjects.total=e}},{key:"totalFolders",get:function(){return this.localFolders.total},set:function(e){this.localFolders.total=e}}]),e}();u.COMPONENT_NAME="spark-folder-discovery-context",t.a=u},2405:function(e,t,o){"use strict";var n=o(2),r=o.n(n),i=o(13),a=o.n(i),s=o(35);t.a={authFetch:function(e){var t=(new Error).stack;return a.a.requiresAuth().then((function(){return a.a.getAccessToken().then((function(o){var n=r.a.defer();s.SparkPerformanceTracker.measurePromise("StorageLoader.fetch:".concat(e.uri),n.promise);var i=Object.assign({},e.headers);i=Object.assign(i,{"x-access-token":o});try{window.fetch(e.uri,{method:e.method||"GET",headers:new window.Headers(i),body:e.body}).then((function(o){200===o.status||204===o.status?n.resolve(o):401===o.status?(n.reject(new Error("Request auth failed; errorCode:"+o.status+"; errorText:"+o.statusText)),a.a.clearScope(),window.marvel.events.trigger("spark-auth-failed")):(window.marvel.logger.info("[Client:Storage] authFetch failed more info",{errorCode:o.status,outerStack:t,uri:e.uri}),o.json().then((function(e){var t=new Error("Request failed; errorCode:"+o.status+"; errorText:"+o.statusText);e.isQuotaIssue&&(t=new Error("Request failed due to Quota exceeded error; errorCode:"+o.status+"; errorText:"+o.statusText)),t.statusCode=o.status,n.reject(t)})))}),(function(t){window.marvel.logger.error("[Client:Storage] authFetch rejected promise during window.fetch call",{error:t,uri:e.uri}),n.reject(t)})).catch((function(t){window.marvel.logger.error("[Client:Storage] authFetch threw an exception during window.fetch call",{error:t,uri:e.uri}),n.reject(t)}))}catch(c){window.marvel.logger.info("[Client:Storage] authFetch window.fetch throws",{error:c}),n.reject(c)}return n.promise}))}))},authFetchJSON:function(e){var t;return e.body instanceof String?t=e:(t=Object.assign({},e),t=Object.assign(t,{body:JSON.stringify(e.body)})),t.headers?t.headers["content-type"]||(t.headers["content-type"]="application/json"):t.headers={"content-type":"application/json"},this.authFetch(t).then((function(e){var t=r.a.defer();return e.json().then((function(e){t.resolve(e)})).catch((function(e){t.reject(e)})),t.promise}))}}},299:function(e,t,o){var n,r;n=[o(16),o(9),o(2),o(22),o(1),o(13),o(686)],void 0===(r=function(e,t,n,r,i,a,s){"use strict";var c,l,d,u,h={},f=!1;function g(){window.TypekitPreview?(window.TypekitPreview.setup({auth_id:"slte",auth_token:"Hik3Pm6JnhEwLxQ0zehfgHbPDnVkFnfVeM5Dl15HLM9Nvtt1z6Zcx%2FCrp%2Ba6IPG%2F4rar1RfQpMk18PnaqVj5UR3JusyvaDexkb4zuYwE6edbEtYVoeY8I0RGujcBA982%2FgXgDjNyLWrd6f8i%2FsbDs1mQLbIorXyId0bC0yU2kZo%3D",default_subset:"all"}),c.resolve(window.TypekitPreview)):t.delay(g,1e3)}function p(){return d||(d=n.defer(),Promise.all([o.e("slate-app-ac-theme-editor~sparkfonts-registry"),o.e("sparkfonts-registry")]).then(function(e){var n=o(855),r=o(874);n.cards=r,t.each(t.filter(n.sparkfonts,(function(e){return!!e.typekitPreviewId})),(function(e){e.typekitVariations=t.map(e.faces,(function(e){return e.typekitKey}))})),n.facesByKey||(n.facesByKey={},t.each(n.sparkfonts,(function(e,o){t.each(e.faces,(function(r){n.facesByKey[r.lookupKey]={subgroup:t.extend({},e,{name:o}),face:r}}))}))),n.bodyFonts=[{subgroupName:"Acumin Pro Semi Condensed",cssName:n.sparkfonts["Acumin Pro Semi Condensed"].cssName,faces:[{secondaryRole:"is-body-font",role:"body-font",lookupKey:"258dc19d287f38402246a43ef7ee15db90408ab0d5e9ce6170e4797f99816d"},{secondaryRole:"is-body-font-italic",role:"body-font-italic",lookupKey:"258dc19d287f38402246a43ef7ee15db90408ab0d5e9ce6170e4797f99816d23b74c91cf9a8b"},{secondaryRole:"is-body-font-bold",role:"body-font-bold",lookupKey:"258dc19d287f38402246a43ef7ee15db90408ab0d5e9ce6170e4667393807b6c925c"},{secondaryRole:"is-body-font-bold-italic",role:"body-font-bold-italic",lookupKey:"258dc19d287f38402246a43ef7ee15db90408ab0d5e9ce6170e4667393807b6c925cd0ea87899a41d2"}]},{subgroupName:"Adobe Caslon Pro",cssName:n.sparkfonts["Adobe Caslon Pro"].cssName,faces:[{secondaryRole:"is-body-font",role:"body-font",lookupKey:"258adb9224315b712345eb03b2d30e94fe7d81b3c5ebdc76"},{secondaryRole:"is-body-font-italic",role:"body-font-italic",lookupKey:"258adb9224315b712345eb03b2d30e94fe6690b5dceede"},{secondaryRole:"is-body-font-bold",role:"body-font-bold",lookupKey:"258adb9224315b712345eb03b2d30e94fe6d8bb8d4"},{secondaryRole:"is-body-font-bold-italic",role:"body-font-bold-italic",lookupKey:"258adb9224315b712345eb03b2d30e94fe6d8bb8d4a7f47075a55c75"}]},{subgroupName:"Calluna",cssName:n.sparkfonts.Calluna.cssName,faces:[{secondaryRole:"is-body-font",role:"body-font",lookupKey:"278fd89c347f793d024ce318fee20e"},{secondaryRole:"is-body-font-italic",role:"body-font-italic",lookupKey:"278fd89c347f793d195de501fbe0"},{secondaryRole:"is-body-font-bold",role:"body-font-bold",lookupKey:"278fd89c347f793d1246e809"},{secondaryRole:"is-body-font-bold-italic",role:"body-font-bold-italic",lookupKey:"278fd89c347f793d1246e809b2ca089abf4687"}]},{subgroupName:"Lato",cssName:n.sparkfonts.Lato.cssName,faces:[{secondaryRole:"is-body-font",role:"body-font",lookupKey:"288fc09f6c437d772545e51f"},{secondaryRole:"is-body-font-italic",role:"body-font-italic",lookupKey:"288fc09f6c586c713c40e7"},{secondaryRole:"is-body-font-bold",role:"body-font-bold",lookupKey:"288fc09f6c53777c34"},{secondaryRole:"is-body-font-bold-italic",role:"body-font-bold-italic",lookupKey:"288fc09f6c5374713342a424e6e21092b0"}]},{subgroupName:"Museo Slab",cssName:n.sparkfonts["Museo Slab"].cssName,faces:[{secondaryRole:"is-body-font",role:"body-font",lookupKey:"299bc7952e314b7c314ba95ea2b3"},{secondaryRole:"is-body-font-italic",role:"body-font-italic",lookupKey:"299bc7952e314b7c314ba95ea2b35cb2a74e88bdd3"},{secondaryRole:"is-body-font-bold",role:"body-font-bold",lookupKey:"299bc7952e314b7c314ba95aa2b3"},{secondaryRole:"is-body-font-bold-italic",role:"body-font-bold-italic",lookupKey:"299bc7952e314b7c314ba95aa2b35cb2a74e88bdd3"}]},{subgroupName:"PT Sans",cssName:n.sparkfonts["PT Sans"].cssName,faces:[{secondaryRole:"is-body-font",role:"body-font",lookupKey:"34ba94a3207f6b3d024ce318fee20e"},{secondaryRole:"is-body-font-italic",role:"body-font-italic",lookupKey:"34ba94a3207f6b3d195de501fbe0"},{secondaryRole:"is-body-font-bold",role:"body-font-bold",lookupKey:"34ba94a3207f6b3d1246e809"},{secondaryRole:"is-body-font-bold-italic",role:"body-font-bold-italic",lookupKey:"34ba94a3207f6b3d1246e809b2ca089abf4687"}]},{subgroupName:"PT Serif",cssName:n.sparkfonts["PT Serif"].cssName,faces:[{secondaryRole:"is-body-font",role:"body-font",lookupKey:"34ba94a3246371767d7be10ae7ef1d89"},{secondaryRole:"is-body-font-italic",role:"body-font-italic",lookupKey:"34ba94a3246371767d60f00cfeea1f"},{secondaryRole:"is-body-font-bold",role:"body-font-bold",lookupKey:"34ba94a3246371767d6beb01f6"},{secondaryRole:"is-body-font-bold-italic",role:"body-font-bold-italic",lookupKey:"34ba94a3246371767d6beb01f6a3358fb2438db7"}]},{subgroupName:"Proxima Nova",cssName:n.sparkfonts["Proxima Nova"].cssName,faces:[{secondaryRole:"is-body-font",role:"body-font",lookupKey:"349cdb88287c79301e46f20cbfd1199ca64385a6"},{secondaryRole:"is-body-font-italic",role:"body-font-italic",lookupKey:"349cdb88287c79301e46f20cbfd1199ca64385a690cec96578a056"},{secondaryRole:"is-body-font-bold",role:"body-font-bold",lookupKey:"349cdb88287c79301e46f20cbfc11397b7"},{secondaryRole:"is-body-font-bold-italic",role:"body-font-bold-italic",lookupKey:"349cdb88287c79301e46f20cbfc11397b70fada0d1ebd467"}]}],d.resolve(n)}.bind(null,o)).catch(o.oe)),d.promise}function m(e){return{subgroup:{name:e.preferredFamilyName||e.familyName,cssName:e.family,typekitPreviewId:!1,paragraphRecommended:!1,serif:e.serif,calligraphic:e.calligraphic},face:{name:e.preferredSubfamilyName||e.subfamilyName,path:e.filename,metrics:e,lookupKey:e.postScriptName}}}function v(t){return h[t]||(h[t]=n.defer(),e.getScript("https://use.typekit.net/"+t+".js",(function(e,o,n){try{window.Typekit.load({async:!0})}catch(r){}h[t].resolve()}))),h[t].promise}return{ENABLE_UPLOADED_FONTS_RENDITIONS:!1,USE_SPARKFONTS_PREVIEW_API:f,inject:function(){return e("html").addClass("font-picker-wf-loading"),(c||(c=n.defer(),l=v(f?"eww8idl":"zqr1kjd"),window.TypekitPreview?c.resolve(window.TypekitPreview):(e.getScript("https://use.typekit.net/previewkits/pk-v1.js"),g())),n.allSettled([c.promise,l])).then((function(){return e("html").removeClass("font-picker-wf-loading"),window.TypekitPreview}))},getFontRegistry:p,loadFonts:function(e){p().then((function(o){var n=[];t.each(e,(function(e){var t=o.sparkfonts[e];if(t){if(t.typekitPreviewId){var r={id:t.typekitPreviewId,variations:t.typekitVariations,css_name:t.cssName,name:e};n.push(r)}}else console.warn("loadFont font not found: "+e)})),f&&window.TypekitPreview.load(n,{active:function(){},inactive:function(e,t){console.warn("font error "+e+" and "+t)},fontinactive:function(e,t){console.warn("font error2 "+e+" and "+t)}})}))},getFont:function(e){var o=e,n=e;return p().then((function(e){return e.sparkfonts[o]?{subgroup:e.sparkfonts[o]}:(u||(u={},t.each(e.sparkfonts,(function(e,o){t.each(e.faces,(function(n){u[n.lookupKey]={subgroup:t.extend({},e,{name:o}),face:n}}))}))),u[n])}))},fontArrayByFace:function(e){var o={};return t.each(e,(function(e){o[e.postScriptName]=m(e)})),o},injectKit:v,convertPostFaceToJSON:m,convertPostFaceToAC:function(e){var t=new s;return t.setFontDataFromSparkFontDefn(m(e),!0,!0),t},getFontNormalized:function(e,t){var o=0;if(t){var n=600/t.capHeight*(.85/t.ascentDescentRatio)/t.capRatio;if(o=10*t.descentRatio,t.nameHeight){var r=t.nameHeight/180;n<1&&r<1?n=Math.max(r,n):(n>3||n<.5&&r>1)&&(n=r)}e=Math.round(100*n*e)/100}return{size:e,vshift:o}},cssName:function(e){return e?(0===(e=e.replace(/ /g,"-")).charAt(0).search(/[0-9]/)&&(e="css-name-"+e),e=e.replace(/[^A-z\-\_0-9]/g,"").toLowerCase()):e=r.v4(),e},checkProvidedFonts:function(e){var t="/fonts/toua-check/"+window.encodeURIComponent(e.join(",")),o=n.defer();return a.ajax({type:"GET",url:t,headers:{"x-api-key":i.key}}).then((function(e){o.resolve(e)}),(function(e){o.reject(e)})),o.promise},providedFont:function(e){var t="/fonts/toua/"+window.encodeURIComponent(e),o=n.defer();return a.ajax({type:"GET",url:t,headers:{"x-api-key":i.key}}).then((function(e){o.resolve(e)}),(function(e){o.reject(e)})),o.promise}}}.apply(t,n))||(e.exports=r)},63:function(e,t,o){var n,r;n=[o(9),o(11),o(2),o(6),o(13),o(162),o(33),o(1),o(97),o(198)],void 0===(r=function(e,t,n,r,i,a,s,c,l,d){"use strict";var u=new r.default({color:"#0000ff",name:"storage"}),h=a.default;return new(t.Model.extend({WATCH_INTERVAL:12e4,MODE_SYNC_GROUP:"sync-group",MODE_EDITOR:"sync-editor",MODE_DISABLED:"sync-disabled",MODE_HOME:"sync-home",syncMode:"sync-group",syncDoc:null,dcx:null,dcxService:null,dcxSession:null,syncCount:0,syncGroups:{},storageEnabled:!1,enabledDefer:n.defer(),initialize:function(){this.logger=u,this._loadDefer=n.defer(),this.syncNow=this.syncNow.bind(this)},_listenForSyncMode:function(){this._listeningForSyncMode||(this._listeningForSyncMode=!0,window.marvel.events.on("set-sync-mode",this._onSyncModeSet.bind(this)))},syncEnter:function(){0==this.syncCount++&&marvel.events.trigger("sync-start",!0)},syncLeave:function(){0==--this.syncCount&&marvel.events.trigger("sync-stop",!0)},storageReady:function(){return this._loadDefer.promise},_mixin:function(t){e.each(t,function(e,t){this[t]=e.bind(this)}.bind(this))},ensureSyncGroup:function(e){return n.resolve({getComposite:function(t){return i.ajax({type:"HEAD",url:"https://"+c.ss+"/assets/"+e+"/"+t,headers:{"x-api-key":c.key},contentType:"application/json; charset=utf-8"}).then((function(e,t,o){var n=o.getResponseHeader("X-Resource-URN");return d.load().then((function(e){return e.ACPSparkController.getCompositeDoc(n)}))}))}})},enableStorage:function(e){this.storageServer=e,this._storageInit||(this._storageInit=!0,d.load(),this._listenForSyncMode(),this.syncEnter(),Promise.all([o.e("vendors~m-storage"),o.e(7),o.e("m-storage")]).then(function(e){const{AdobeCommunityPlatform:t,AdobeDCX:n,AdobeDCXBranch:r,AdobeDCXComponent:a,AdobeDCXComposite:s,AdobeDCXCompositeXfer:c,AdobeDCXElement:l,AdobeDCXError:u,AdobeDCXNode:f,AdobeDCXUtil:g,AdobeStorageSession:p,createUploadResults:m,createUploadRecord:v}=o(857);this.AdobeCommunityPlatform=t,this.AdobeDCX=n,this.AdobeDCXBranch=r,this.AdobeDCXComponent=a,this.AdobeDCXComposite=s,this.AdobeDCXCompositeXfer=c,this.AdobeDCXElement=l,this.AdobeDCXError=u,this.AdobeDCXNode=f,this.AdobeDCXUtil=g,this.AdobeStorageSession=p,this.createUploadResults=m,this.createUploadRecord=v,this._mixin(o(859)),this._mixin(o(860)),this._mixin(o(861)),this.installDCX3Shim(),this.getCompositeDoc=function(e,t,o){return d.load().then((function(o){return o.ACPSparkController.getCompositeDoc(e,!!t)}))}.bind(this),this.syncLeave(),i.isValid(!1).then(function(){this.initializeStorage().then(function(){this._loadDefer.resolve()}.bind(this)).done()}.bind(this),function(e){this.initializeStorage().then(function(){this._loadDefer.resolve()}.bind(this)),marvel.events.on(h.DELAYED_SUSI_LOGIN,function(e){this.initializeStorage().then(function(){this._loadDefer.resolve()}.bind(this)).done()}.bind(this))}.bind(this)),marvel.events.on("auth-token-set",this.resetAuthToken.bind(this))}.bind(this).bind(null,o)).catch(o.oe))},resetAuthToken:function(e,t){this.dcxService&&this.dcxService.setAuthToken(e)},newCompositeAsCopyOf:function(e,t){return this.dcx.newCompositeAsCopyOf(e,void 0,t)},_onSyncModeSet:function(t){var o=t.mode,n=t.doc,r=this.syncMode===this.MODE_EDITOR&&o===this.MODE_SYNC_GROUP;this.syncMode=o,this.syncDoc=n,r&&(s.hasFeature("enable-spark-storage-server")||s.hasFeature("enable-odb")||(window.marvel.events.trigger("left-editing-session",{}),e.defer(this.syncNow.bind(this))))},setSyncMode:function(e,t){window.marvel.events.trigger("set-sync-mode",{mode:e,doc:t})},syncNow:function(e){console.warn("WARNING: muiStorage.syncNow() is deprecated and doesn't do anything.",{stack:(new Error).stack})},onceEnabled:function(e){this.storageEnabled?e():this.enabledDefer.promise.done((function(){e()}))},getSharedCloudCollectionId:function(e){if(e.assetId)return n.resolve(e.assetId.replace(/^.*:([^:]*):([^:]*)$/,"$1/$2"));var t=e.href;-1===t.search(/^https\?\:\/\//)&&(t="https://"+t);var o=n.defer();return i.ajax(t+"?api_key="+c.key).then((function(e){o.resolve(e.id)})),o.promise},_parseLinkHeader:function(e){for(var t,o=new RegExp(/\s*<([^>]+)>\s*;\s*([^<]+)/,"g"),n={};null!==(t=o.exec(e));){var r=t[2],i=r.match(/rel=\"([^\"]+)\"/),a=i&&i[1]||"unknown-rel",s=r.match(/templated=\"([a-zA-Z]+)\"/),c=s&&s[1]||"";n[a]={uriReference:t[1],templated:"true"===c.toLowerCase()}}return n},urnToCCStoragePath:function(e){var t=n.defer();return i.ajax({url:"https://"+c.ss+"/id/"+e,type:"HEAD",headers:{"x-api-key":c.key},contentType:"application/json; charset=utf-8"}).then(function(e,o,n){var r=this._parseLinkHeader(n.getResponseHeader("Link"))["http://ns.adobe.com/ccapi/path"].uriReference.split("/"),i=r[r.length-2],a=l.getAppBySyncGroupName(i),s={guid:r[r.length-1],syncGroup:i,appType:a?a.typeName:void 0};t.resolve(s)}.bind(this)).fail(function(e){t.reject(e)}.bind(this)),t.promise}}))}.apply(t,n))||(e.exports=r)},680:function(e,t,o){var n,r;n=[o(9),o(11),o(2),o(712),o(198),o(63),o(715),o(37),o(97),o(33),o(1),o(13),o(111)],void 0===(r=function(e,t,n,r,i,a,s,c,l,d,u,h,f){"use strict";var g=a.logger,p=0;return t.Model.extend({defaults:{name:"",type:"private-collection",id:null,syncGroupName:"",components:null,compositeObj:null,publishProgress:null},_commitQueue:null,_commitInProgress:!1,_saveQueue:null,initialize:function(o){this._commitQueue=[],this._saveQueue=[],this._initDefer=n.defer(),this.iGUID=p++;var r=new t.Collection([],{model:s});this.set("components",r),this._doSaveChanges=this._doSaveChanges.bind(this),this._saveChangesDebounce=e.debounce(this._doSaveChanges,500)},linkSparkAsset:function(e){this._linkedSparkAsset=e},setName:function(e){this.getDCXComposite().current.name=e,this.set("name",e)},getEtag:function(){return this.getDCXComposite().current.manifestEtag},getDocData:function(e){var t=this.getDCXRoot(),o="";return t&&(o=t.getValue(e)),o},setIsMounted:function(e){this._isMounted=e},isMounted:function(){return!!this._isMounted},setCollaboration:function(e){this._collaboration=e},getCollaboration:function(){return this._collaboration||this.get("collaboration")||this.changed&&this.changed.collaboration||this.attributes&&this.attributes.collaboration},belongsToUser:function(){return"INCOMING"!==this.getCollaboration()},getCollaborationForAnalytics:function(){var e=this.getCollaboration();return"INCOMING"===e?"collabRecipient":"OUTGOING"===e?"collabOwner":"collabNone"},acquireNestedMap:function(e,t){return this._acquireNestedMap(e,t)},acquireNestedMapSync:function(e,t){return this._acquireNestedMap(e,!0,!0,t)},_acquireNestedMap:function(t,o,r,i){var a,s,c=this.getChildWithMap(t,i),l=!1;return c||(t=t.split("."),s="",e.each(t,function(e,t){s&&(s+="."),"{new}"!==e?(s+=e,(c=this.getChildWithMap(s,i))||(l=!0,c=this.addChildPath(void 0,e,a))):(l=!0,c=this.addChildPath(void 0,void 0,a),s+=c.getValue("path")),a=c}.bind(this)),!l||o)?r?c:n.resolve(c):this.saveChanges((function(){})).then((function(){return n.resolve(c)}))},acquireNestedChildren:function(e,t){return this.acquireNestedMap(e,t).then(function(e){return this.getChildrenOf(e)}.bind(this))},acquireNestedChildrenSync:function(e,t){if("all-fonts"===e&&!d.hasFeature("enable-custom-fonts"))return console.warn("Illegal custom fonts API call w/o feature flag",(new Error).stack),[];var o=this.acquireNestedMapSync(e,t);return this.getChildrenOf(o,t)},getChildWithMap:function(t,o){for(var n,r,i,a,s,c,l,d=o||this.getDCXComposite().current,u=d.getChildrenOf(),h=d.getComponentsOf(),f=function(e){if(e.getValue(c)==l)return r=e,a||(u=d.getChildrenOf(e),h=d.getComponentsOf(e)),!1},g=function(e){if(e.path==i)return r=e,a||(u=d.getChildrenOf(e),h=d.getComponentsOf(e)),!1},p=0,m=(t=t.split(".")).length;p<m;p++){if(i=t[p],s=/^\[([^\]\=]*)\=([^\]\=]*)\]$/.exec(i),-1!=i.search(/^\!/)?(a=!0,i=i.replace(/^\!/,"")):a=!1,!u)return;if(n=r,s?(c=s[1],l=s[2],e.find(a?h:u,f)):e.find(a?h:u,g),void 0!==r&&void 0!==n&&n==r)return}return r},getChildrenOf:function(e,t){return(t||this.getDCXComposite().current).getChildrenOf(e)},addChild:function(e,t){return this.getDCXComposite().current.addChild(e,void 0,-1,t)},addChildPath:function(e,t,o){var n=this.getDCXComposite().current.addChild(e,void 0,-1,o);return n.path=t||n.id,n},removeChild:function(e){return this.getDCXComposite().current.removeChild(e)},isNew:function(){return!this.getDCXComposite().current.manifestEtag},getDCXComposite:function(){return this.get("compositeObj")},getDCXRoot:function(){var e=this.get("compositeObj");return e?e.current.rootNode:null},setAndSaveDataToRoot:function(e,t){this.saveChanges((function(o){o.setValue(e,t)}))},getDataFromRoot:function(e){return this.getDCXRoot().getValue(e)},addComponent:function(e){e.composite=this.getDCXComposite();var t=this.get("components"),o=new s(e);return t.add(o),o},removeComponent:function(e){this.get("components").remove(e);var t=this.getDCXComposite().current,o=t.getComponentWithAbsolutePath("/"+e.get("path"));return t.removeComponent(o),e},getComponentWithAbsolutePath:function(e){return this.get("components").find((function(t){return t.get("path")==e.replace(/^\//,"")}))},getComponent:function(e,t){return a.getComponent(e,this.getDCXComposite(),t)},_privateResolveComponent:function(e){return e instanceof String||"string"==typeof e?this.getDCXComposite().current.getComponentWithAbsolutePath(e):e},getImageComponentHref:function(e,t,o){if(this.isMounted()&&!d.hasFeature("dcx-href-calc-enabled")){var r=this._privateResolveComponent(e);t=t||"full";var i="";o&&(i="&mime="+o);var s=(r.etag||"").replace(/['"]+/g,""),c="/image_assets/"+this.getMyApp().getSetting("syncGroup")+"/"+this.getDCXComposite().id+"/"+r.path+"?asset_id="+r.id+"&size="+t+"&img_etag="+s+i;return n.resolve(c)}return a.getComponentRenditionHref(this.getDCXComposite(),e,t,o)},_privateGetComponentHref:function(e,t){if(this.isMounted()&&!d.hasFeature("dcx-href-calc-enabled")){var o=(e.etag||"").replace(/['"]+/g,""),r="/image_assets/"+this.getURN()+"/"+e.path+"?asset_id="+e.id+"&img_etag="+o;return n.resolve(r)}return a._privateGetComponentHref(this.getDCXComposite(),e,t).then((function(e){return e}))},getFirstChildNode:function(){return this.getDCXComposite().current.getChildrenOf()[0]},findComponent:function(e,t){for(var o=this.getDCXComposite().current.getComponentsOf(e),n=0,r=o.length;n<r;n++){var i=o[n],a=!0;for(var s in t)if(t.hasOwnProperty(s)){var c=t[s];if(i[s]!=c){a=!1;break}}if(a)return i}},setProjectName:function(e){this.getMyApp().setProjectName(this,e)},getProjectName:function(e){return this.getMyApp().getProjectName(this,e)},preloadImageRendition:function(e){var t=n.defer();return this.getImageRendition(e).then(function(e){var o,n;e&&(o=e.url),o?((n=new Image).onload=function(){t.resolve(o)},n.onerror=function(){t.reject(new Error("Image rendition "+o+" came back with 404"))},n.src=o):t.resolve()}.bind(this)).catch((function(e){window.marvel.logger.error("failed to get image rendition",e),t.reject(e)})).done(),t.promise},getImageRendition:function(e){var t,o=this.getDCXComposite().current,r=this.getDCXRoot(),i=r.getValue("slate#coverpath");e=e||400;var a,s="center",c="center";if(r.type.match("luca")&&i){t=o.getComponentWithAbsolutePath("/"+i),s=r.getValue("slate#coverx"),c=r.getValue("slate#covery");var l=r.getValue("slate#data");a=l&&l.themeName&&"vintage"==l.themeName.toLowerCase()?"grayscale(1)":void 0}else t=this.getImageRenditionComponent();if(t){return e&&{size:e},this.getImageComponentHref(t,e).then(function(e){return{url:e,position:s+" "+c,filter:a}}.bind(this))}return n.reject(new Error("failed to find rendition component"))},getImageRenditionComponent:function(){if("function"==typeof this.getMyApp().getPreviewComponent)return this.getMyApp().getPreviewComponent(this);var t=this.getDCXComposite().current;return e.find(t.getComponentsOf(),(function(e){return e&&e.type.match(/^image/)&&"rendition"==e.relationship&&"shareImage"!=e.name&&"embed"!=e.name}))},getInfoForComponents:function(t,o){var r,i=this.getMyPrimaryApp(),a=i.getAppTypeID(),s={},c=(e.isArray(t),{GooglePhotosImagePickerContext:"google",DropboxImagePickerContext:"dropbox",DooploImagePickerContext:"dooplo",FacebookImagePickerContext:"facebook",AdobestockImagePickerContext:"stock",CCImagePickerContext:"creativeCloud",LightroomImagePickerContext:"lightroom",UploadedImagePickerContext:"uploaded",undefined:"uploaded"}),l={Google:"google",Dropbox:"dropbox",Dooplo:"dooplo",Facebook:"facebook",AdobeStock:"stock",CreativeCloud:"creativeCloud",Lightroom:"lightroom",Uploaded:"uploaded",undefined:"uploaded"};return"slate"===a?this.getComponent("/luca.json",o).then(function(t){return i.load().then(function(){var o,a;if(o=i.getStorageImpl().getData("imagePickerContexts",this),a={},e.each(o,(function(e){a[e.asset_id]=e})),t)try{r=JSON.parse(t)}catch(l){return n.reject(l)}return r&&r.pages&&r.pages.length&&e.each(r.pages[0].sections,(function(t){e.each(t.content_items,(function(e){if("img"===e.type&&e.image){s[e.image.image_url.split("?")[0]]=e.image;var t=a[e.image.id];e.image.pickerContext=a[t],e.image.srcName=c[t?t.class_name:void 0]}}))})),s}.bind(this))}.bind(this)).catch((function(e){return n.reject(e)})):"voice"==a?this.getComponent("/PageSequence.json",o).then(function(t){var o;try{o=JSON.parse(t)}catch(i){return n.reject(i)}var r=e.find(o,(function(e){return"PageSequence"==e.className}));return r&&r.data&&r.data.pages&&e.each(r.data.pages,(function(t){var o;t&&t.data&&t.data.layout&&t.data.layout.data&&(o=t.data.layout.data.items),o&&e.each(o,(function(e){if(e.data&&"Image"==e.data.contentType){var t,o=e.data.content,n=e.data.searchTerm;n&&(t=-1==n.search(/\//)?"Dooplo":n.replace(/^\s*/,"").replace(/\/.*$/,"")),s[o]={srcName:l[t]||"uploaded"}}}))})),s}.bind(this)).catch((function(e){return n.reject(e)})):n.resolve()},_lazyLoadPublishUtils:function(){return this._videoPublishLazyLoadDefer||(this._videoPublishLazyLoadDefer=n.defer(),Promise.all([o.e("m-react-spectrum"),o.e(0),o.e(1),o.e(2),o.e("gic-voice-publishUtils")]).then(function(e){var t=o(865);this._videoPublishLazyLoadDefer.resolve(t)}.bind(this).bind(null,o)).catch(o.oe)),this._videoPublishLazyLoadDefer.promise},getImageComponents:function(t,o){var r=this.getMyPrimaryApp().getAppTypeID(),i=this.getDCXComposite().current;return t=t||{},"voice"!==r||t.publishUtils?this.getInfoForComponents("images",o).then(function(o){var a,s=[];if("slate"===r?a=e.find(i.getChildrenOf(),(function(e){return"page"===e.name})):"voice"===r?a=e.find(i.getChildrenOf(),(function(e){return"Media"===e.name})):"theo"===r&&(a=e.find(i.getChildrenOf(),(function(e){return"application/vnd.adobe.theo.content+dcx"===e.type&&"/content"===e.absolutePath}))),a){var c,l,d=i.getComponentsOf(a);if("slate"===r)e.each(d,(function(e){(l=o[e.path])&&s.push({component:e,data:l})}));else if("theo"===r)(c=a._data.children)&&c.length&&(c=c[0].children)&&(s=[],e.each(c,(function(t){if("image"===t["theo#kind"]){var o=t.components?i.getComponentWithId(t.components[0].id):i.getComponentWithId(t.path);if(o){var n=t["theo#media-metadata"]||{};"adobestock"===n.source&&((n=e.assign({},n)).license=e.assign({},n)),s.push({component:o,data:n})}}})));else if("voice"===r){var u={};c=a._data.children,s=[],e.each(c,(function(t){var n;t.components&&e.each(t.components,(function(e){if(e&&e.type.match(/^image/)&&(n=i.getComponentWithId(e.id))&&o[e.id]){var r=t["ginger#data"],a={component:n,data:r};s.push(a),u[n.id]=a}}))}));var h=[];return e.each(s,function(e){h.push(t.publishUtils.makeMetadataPromise(this.id,e.component.id))}.bind(this)),n.allSettled(h).then((function(t){var n=[];return e.each(t,(function(t){if("fulfilled"==t.state){var r=t.value.contentID,i=u[r];if(i){var a=t.value,s=o[r];i.data=e.extend({},a,s)}}else n.push(t.reason)})),n.length&&window.marvel.logger.warn("errors fetching video metadatata in getImageComponents",n),s}))}}return s}.bind(this)):this._lazyLoadPublishUtils().then(function(e){return t.publishUtils=e,this.getImageComponents(t,o)}.bind(this))},pushComponent:function(e,t){return this._pushComponent(e,!1,t)},pushComponentWithRetry:function(e,t){return this._pushComponent(e,!0,t)},_pushComponent:function(t,o,n){var r=this.getDCXComposite(),i=this.get("syncGroupName"),s=t.isUpdate,c=e.pick(t,["id","name","relationship","type","path","absolutePath","file","parent","copyFrom","cover"]);return this.ensureCompositeIsSaved((function(){return o?a.pushComponent(c,r,i,s,n):a.pushComponentWithoutRetry(c,r,i,s,n)}),n)},isMidCommit:function(){return!!this._commitInProgress},pull:function(e){var t=n.defer(),o=this.getDCXComposite();return a.pullComposite(o,e).then((function(e){t.resolve(e)})),t.promise},_resolveOrganizerProjectRenameConflict:function(e,t,o,n,i){if(e.current.rootNode.name!==t.rootNode.name||o.rootNode.name!==t.rootNode.name){var a=o.copy();if(e.current.rootNode.name!==t.rootNode.name){for(var s=r(e.current._data,t._data)||[],c=!1,l=0,d=s.length;l<d;l++){var u=s[l].path[0];if("local"===u||"state"===u);else{if("name"!==u)return g.error("Unexpected property changed in Organizer view",{propName:u,diffResults:s}),void n.reject(i);a.rootNode.name=e.current.rootNode.name,c=!0}}if(!c)return g.error('_resolveOrganizerProjectRenameConflict "diff" reported no project name change?'),void n.reject(i)}else g.warn("_resolveOrganizerProjectRenameConflict: How'd we encounter a conflict and the local project name hasn't changed?");e.resolvePullWithBranch(a,function(e){e?n.reject(e):(n.resolve(),this.saveChanges((function(){}),!0))}.bind(this))}else n.reject(i)},_resolveConflict:function(t,o,r){var s=this.getDCXComposite();return a.pullCompositeManifestOnly(s,r).then(function(r){return n.all([a.loadBaseBranch(s),i.load()]).then(function(i){var a=i[0],c=i[1].ACPSparkController.isEditorOpen();e.each(o,function(e){if(c){var o=this.getMyApp();o.resolveConflict?o.resolveConflict(r,e.recoverData,e.commitDefer,this,s,a,t):e.commitDefer.reject(t)}else this._resolveOrganizerProjectRenameConflict(s,a,r,e.commitDefer,t)}.bind(this));var l=[];return e.each(o,(function(e){e.commitDefer&&l.push(e.commitDefer.promise)})),n.all(l)}.bind(this)).then((function(e){return n.resolve()})).catch((function(e){return g.error("CompositeDocModel._resolveConflict ignoring caught errors. Returning original UPDATE_CONFLICT error.",e),n.reject(t)}))}.bind(this)).catch((function(n){g.error("CompositeDocModel caught error during conflict resolution pullCompositeManifestOnly",{outerErr:t,caughtErr:n}),e.each(o,(function(e){e.commitDefer&&e.commitDefer.reject(t)}))}))},downloadComponents:function(e){var t=[],o=this.getDCXComposite(),r=o.current.allComponents();return r instanceof Array&&(t=r.map((function(t){return a.getComponent(t,o,e)}))),n.allSettled(t)},_doSaveChanges:function(t){var o;if(!this._commitInProgress){marvel.events.trigger("sync-start",!0),this._commitInProgress=!0,o=this.get("syncGroupName"),this.setModifiedDate(new Date((new Date).getTime()+864e5)),this.isNew()?!0:marvel.events.trigger("saved-composite-doc",this);var r,i=this.getDCXRoot(),s=this._commitQueue;this._commitQueue=[],e.each(s,(function(e){e.override&&(r=!0),e.fnSet(i)})),this.set("name",this.getDCXComposite().current.name),this.ensureCompositeIsSaved(function(){return this.pushModifiedComponents(t).then(function(){return this.getMyApp().usesContentModifiedEtags()&&this.setContentModifiedIfNeeded(),a.pushComposite(this.getDCXComposite(),o,r,t).then(function(){g.debug("[compositeDoc saved]"),marvel.events.trigger("saved-composite-doc",this),this._commitInProgress=!1,marvel.events.trigger("sync-stop",!0),e.each(s,(function(e){e.commitDefer.resolve()})),this._commitQueue.length&&this._saveChangesDebounce(t)}.bind(this))}.bind(this))}.bind(this)).catch(function(o){try{if(g.error("CompositeDocModel error while saving",{err:o}),this._commitInProgress=!1,o&&"UPDATE_CONFLICT"===o.code)return this._resolveConflict(o,s,t);if(o&&"EXCEEDS_QUOTA"===o.code)return console.warn("TBD: handle EXCEEDS_QUOTA"),n.reject(o);e.each(s,(function(e){return e.commitDefer.reject(o)}))}catch(r){return g.error("CompositeDocModel caught error during error handling",{outerErr:o,caughtErr:r}),n.reject(o)}}.bind(this)).done()}},triggerProjectCreatedAnalytics:function(e){(e=e||{}).contextData&&c.addContextData(e.contextData);var t=this.getMyApp(),o=this;if(t.isaProjectFormat()){var n=this.getMyApp().typeName;"theo"!==n&&"post"!==n||c.setProductName("theo"),c.setCurrentProjectId(this.get("id")),c.trackEvent("projectCreated",{contextData:["projectId","workflow","projectType","contextString","exampleId","remixableAssetId","createdFromId"]},e.env||this.getMyApp().typeName+":editor",function(){c.removeContextData(["type","contextString","exampleId","remixableAssetId","createdFromId"])}.bind(this)),t.isBranded(this).then((function(n){n&&f.getCreatedAnalytics(o).then((function(o){c.trackEvent("createdBrandedProject",o,e.env||t.typeName+":editor")}))}))}},ensureCompositeIsSaved:function(t,o){if(this.isNew()&&!this._isBeingCreatedPromise){var r=this.getDCXComposite(),s=this.get("syncGroupName"),c=a.AdobeDCXUtil.appendPathElements("assets",s,r.id),l=n.defer();g.traceflow("dcx-3","CREATING:: "+s+" and "+r.id);var d=a.createAbortHelper(o,l);return d.requestContext=a.dcx.compositeXfer.createComposite(r,c,!1,a.dcxSession,function(e,t){window.marvel.logger.info("[Client:Storage] created composite in the cloud.",{projectId:r.id,syncGroup:s}),d.reset(),e?(window.marvel.logger.error("[Client:Storage] failed to create project.",{projectId:r.id,error:e}),l.reject(e)):i.load().then(function(e){try{this.triggerProjectCreatedAnalytics()}catch(o){window.marvel.logger.error("[Client:Storage] triggerProjectCreatedAnalytics failed during create project.",{projectId:r.id,error:o})}e.ACPSparkController.addCompositeDocLocal(r.assetId,this),l.resolve(t)}.bind(this)).catch((function(e){window.marvel.logger.error("[Client:Storage] failed to add local CompositeDocModel",{projectId:r.id,error:e}),l.resolve(t)}))}.bind(this)),this._isBeingCreatedPromise=l.promise.then(function(){return window.marvel.logger.info("[Client:Storage] created promise resolved. Pushing composite...",{projectId:r.id,syncGroup:s}),a.pushComposite(this.getDCXComposite(),this.get("syncGroupName"),!1,o).then(function(){var o=t(),n=this._saveQueue;return this._saveQueue=[],this._isBeingCreatedPromise=null,window.marvel.logger.info("[Client:Storage] pushing composite was successfull.",{projectId:r.id,syncGroup:s}),e.each(n,(function(e){e.deferred.resolve(e.fn())})),o}.bind(this))}.bind(this)),this._isBeingCreatedPromise}return this.isNew()&&this._isBeingCreatedPromise?this._isBeingCreatedPromise.then(t):t()},pushModifiedComponents:function(e){var t=this.getDCXComposite();return n.all(this.get("components").reduce(function(o,n){var r=n.get("path");return n.isModified()&&o.push(a.pushComponent({path:r,name:n.get("name"),relationship:n.get("relationship"),type:n.get("type"),file:n.getFile(),parent:n.get("parent")},t,this.get("syncGroupName"),t.current.getComponentWithAbsolutePath("/"+r),e).then((function(){n.setUnmodified()})).catch(function(e){throw g.error("Failed to push modified components "+e,e),e.componentInfo={path:r,name:n.get("name"),type:n.get("type"),composite:{assetId:t.assetId,href:t.href}},e}.bind(this))),o}.bind(this),[]))},clearRootDataWithPrefix:function(t){var o=this.getDCXComposite().current._data;e.each(o,(function(e,n){0===n.indexOf(t)&&delete o[n]}))},clearUnneededDuplicationData:function(){this.getMyApp().clearDataForDocCreatedByDupe(this)},nextSave:function(){return this._nextSaveDefer||(this._nextSaveDefer=n.defer()),this._nextSaveDefer.promise},saveChanges:function(e,t,o,r){var i={override:t,commitDefer:this._nextSaveDefer||n.defer(),fnSet:e,recoverData:o};return this._nextSaveDefer=null,g.debug("[compositeDoc saving]"),this._commitQueue.push(i),this._saveChangesDebounce(r),i.commitDefer.promise},_patchCurrent:function(e,t){var o=this.getDCXComposite().current._data;if(o[e]=t,arguments.length>2)for(var n=2;n<arguments.length;n+=2)o[arguments[n]]=arguments[n+1]},setDocRootVals:function(e,t){var o=arguments;this.saveChanges((function(e){for(var t=o.length,n=0;n<t;n+=2)e.setValue(o[n],o[n+1])}))},getComponentEtag:function(e){var t=this.getDCXComposite().current.getComponentWithAbsolutePath(e);return t?t.etag:null},getAppRegistry:function(){return l},getMyApp:function(){return l.getAppForDoc(this)},getMyPrimaryApp:function(){var t=this.getMyApp(),o=t.getSetting("syncGroup");return e.endsWith(o,"-template")&&(t=l.getAppBySyncGroupName(t.getConfig().templateSyncGroup)),t},isTemplate:function(){var t=this.getMyApp().getSetting("syncGroup");return e.endsWith(t,"-template")},getMainContentEtag:function(){return this.getMyApp().getDocContentETag(this)},setContentModifiedIfNeeded:function(){var e=this.getMyApp().getDocContentETag(this)||"";e!=this.getContentModEtag()&&this._patchCurrent("cp#contentEtag",e,"cp#contentModified",this._getFutureModDate())},getContentModEtag:function(){return this.getDCXRoot().getValue("cp#contentEtag")},getContentModifiedDate:function(e){var t=this.get("modified");return e&&e.preferCpContentModified&&(t=this.getDCXRoot().getValue("cp#contentModified")||t),t?t.indexOf("Z")>-1?this._unZpadDate(t):new Date(t):new Date},_unZpadDate:function(e){var t=Date.parse(e);if(isNaN(t)){var o,n=e.split("T"),r=1*n[1].substring(0,2);return r>23?(e=n[0]+"T23"+n[1].substring(2),(o=new Date(e)).setUTCHours(o.getUTCHours()+(r-23)),o):new Date}return new Date(t)},_zpadDate:function(e,t){t&&(e=new Date(e)).setUTCHours(e.getUTCHours()+e.getTimezoneOffset()/60);var o=e.getHours();function n(e,t){for(var o=""+e;o.length<t;)o="0"+o;return o}return e.getFullYear()+"-"+n(e.getMonth()+1,2)+"-"+n(e.getDate(),2)+"T"+n(o,2)+":"+n(e.getMinutes(),2)+":"+n(e.getSeconds(),2)+"."+n(e.getMilliseconds(),2)+"Z"},_getFutureModDate:function(){return this._zpadDate(new Date((new Date).getTime()+3e4),!0)},setModifiedDate:function(e){this.set("modified",this._zpadDate(e))},isPublished:function(){return this.getMyApp().isDocPublished(this)},delete:function(e){return a.deleteCompositeDoc(this,e)},getStorageURL:function(){return("https://"+window.marvel.settings.ss+"/id/"+this.getDCXComposite().assetId).replace("-creativesdk","")},getStoragePath:function(){var e=this.getStorageURL();return e.substring(e.indexOf("/id/")+1)},getRoutableId:function(){return this.getURN()},getURN:function(){return n.resolve(this.getDCXComposite().assetId)},getSharedCloudCollectionId:function(){return a.getSharedCloudCollectionId(this.getDCXComposite())},discoverDocumentMetadata:function(){var e=n.defer(),t=this.getStoragePath();return h.ajax({type:"GET",url:"https://"+window.marvel.settings.ss+"/"+t+"/:metadata",headers:{"x-api-key":window.marvel.settings.key}}).then(function(t,o,n){e.resolve(t)}.bind(this)).fail((function(t){e.reject(t)})),e.promise},getDocDimensions:function(){var e,t={width:0,height:0};try{e=this.getDCXComposite().current.getChildrenOf()}catch(n){window.marvel.logger.error("Error from DCX attempting to page through manifest",n)}if(e){var o=e.find((function(e){return e.getValue("theo#size-id")}));o&&(t.width=o.getValue("theo#size")[0],t.height=o.getValue("theo#size")[1])}return t},hasCloudDocChanged:function(){var e=n.defer(),t=this.getStoragePath();return h.ajax({type:"HEAD",url:"https://"+window.marvel.settings.ss+"/"+t+"/:manifest",headers:{"x-api-key":window.marvel.settings.key}}).then(function(t,o,n){e.resolve(n.getResponseHeader("etag")!==this.getEtag())}.bind(this)).fail((function(t){e.reject(t)})),e.promise}})}.apply(t,n))||(e.exports=r)},686:function(e,t,o){var n,r;n=[o(16),o(9),o(2),o(11),o(299)],void 0===(r=function(e,t,o,n,r){"use strict";return n.Model.extend({setFontDataFromSparkFontDefn:function(e,t,o){this._fontData=this._fontData||{},this._fontData.source="spark-provided",e.subgroup||console.warn("unexpected fontDefn structure",e),this._fontData.lookupKey=e.face.lookupKey,this._fontData.faceName=e.face.name,this._fontData.subgroupName=e.subgroup.name,this._fontData.tkPreviewId=e.subgroup.typekitPreviewId,this._fontData.tkVariation=e.face.typekitKey,this._fontData.tkSubgroupKitId=e.subgroup.typekitSubgroupKitId,this._fontData.cssName=e.subgroup.cssName,this._fontData.weight=e.face.metrics.weight,this._fontData.style=e.face.metrics.style,this._fontData.noRendition=!!o,t&&(this._fontData.metrics=e.face.metrics),this._name=e.subgroup.name+" "+e.face.name},setFontDataFromTypekitSyncInfo:function(e){this._fontData=this._fontData||{},this._fontData.source="tk-synced",this._fontData.lookupKey="tk-"+e.id,this._fontData.subgroupName=e.family.name,this._fontData.tkPreviewId=e.family.web_id,this._fontData.tkVariation=[e.font.web.fvd],this._fontData.tkVariationId=e.id;var t=e.family.css_font_stack.split(",")[0].replace(/['"]/g,"").replace(/^\s*/,"").replace(/\s*$/,"");this._fontData.cssName=t,this._fontData.weight=e.font.web.weight,this._fontData.style=e.style,this._name=e.name},isDefn:function(){return!0},source:function(){return this.getValueProp("source")},isCustomFont:function(){return"user-uploaded"==this.source()},isSparkFont:function(){return"spark-provided"==this.source()},getValueProp:function(e,t){return this._fontData&&this._fontData[e]?this._fontData[e]:t||""},friendlyName:function(e){var t=this._name||"Undefined";return e?-1!=t.search(/^clarendon/i)||-1!=t.search(/^raleway/i)?t.split(" ")[0]:-1!=t.search(/local brewery four/i)?t.split(" ").slice(0,3).join(" "):t.split(" ").slice(0,2).join(" "):t},subgroupName:function(){return this.getValueProp("subgroupName")},faceName:function(){return this.getValueProp("faceName")},lookupKey:function(){return this.getValueProp("lookupKey")},uiKey:function(){return this.lookupKey()},getMetricsAsync:function(){return this.isCustomFont()?o.resolve(this.getMetrics()):this.getMetricsFromRegistry()},getMetrics:function(){return this.getValueProp("metrics")},getMetricsFromRegistry:function(){return r.getFontRegistry().then(function(e){return e.facesByKey[this.lookupKey()].face.metrics}.bind(this))},tkPreviewId:function(){return this.getValueProp("tkPreviewId")},tkVariation:function(){return this.getValueProp("tkVariation")},tkVariationId:function(){return this.getValueProp("tkVariationId")},tkSubgroupKitId:function(){return this.getValueProp("tkSubgroupKitId")},cssName:function(){return this.getValueProp("cssName")},cssNameForPreview:function(){return this.cssName()},fontStyle:function(){return this.getValueProp("style","normal")},fontWeight:function(){return this.getValueProp("weight","400")},fontStyleFromTkVariation:function(){return{n:"normal",i:"italic"}[this.tkVariation().split("")[0]]},fontWeightFromTkVariation:function(){var e=this.tkVariation().split(""),t=parseInt(e[1]);return t<1&&(t=1),t>9&&(t=9),100*t},$cssRendition:function(e,n,i,a){var s;if(this.isSparkFont()?this.getValueProp("noRendition")||(s=i?o.resolve("/spark-fonts/renditions/families/"+this.lookupKey()+".png"):a?o.resolve("/spark-fonts/renditions/"+this.lookupKey()+".png"):o.resolve("/spark-fonts/renditions/face/"+this.lookupKey()+".png")):this.isCustomFont()&&r.ENABLE_UPLOADED_FONTS_RENDITIONS&&(s=this.getRenditionHrefAsync(null,i,a)),s){var c=!1,l=!1,d=new Image;t.delay((function(){l||e.addClass("font-loading")}),50),s.then(function(o){d.onload=function(){c||(l=!0,e.css({"background-image":"url('"+o+"')"}),e.removeClass("font-loading"))},d.onerror=function(){c=!0,n(),e.removeClass("font-loading")}.bind(this),t.delay(function(){l||(c=!0,n(),e.removeClass("font-loading"))}.bind(this),2e3),d.src=o}.bind(this)).done()}else n()},$css:function(e){e.css({"font-family":this.cssNameForPreview(),"font-style":this.fontStyle(),"font-weight":this.fontWeight()})}})}.apply(t,n))||(e.exports=r)},715:function(e,t,o){var n,r;n=[o(9),o(11),o(2),o(63)],void 0===(r=function(e,t,o,n){"use strict";return t.Model.extend({defaults:{name:"",relationship:"",type:"",path:"",contents:"",composite:null,file:null,parent:null,modified:0},getFile:function(){var e=this.get("file");return e||(this.get("type").match("image")?void 0:new Blob([this.get("contents")],{type:"text/plain"}))},getActualComponent:function(){return this.get("composite").current.getComponentWithAbsolutePath("/"+this.get("path"))},isModified:function(){return this.get("modified")>0},setModified:function(){var e=this.get("modified");this.set("modified",e+1)},setUnmodified:function(){var e=this.get("modified");this.set("modified",e-1)}})}.apply(t,n))||(e.exports=r)},846:function(e,t,o){"use strict";o.r(t);var n=o(20),r=o.n(n),i=o(74),a=o.n(i),s=o(4),c=o.n(s),l=o(3),d=o.n(l),u=o(317),h=o.n(u),f=o(2),g=o.n(f),p=o(13),m=o.n(p),v=o(33),y=o.n(v),C=o(198),b=o.n(C),_=o(2405),k=o(116),w=o.n(k),D=o(285),P=o.n(D),S=o(63),I=o.n(S),x=o(97),F=o.n(x),j=o(680),N=o.n(j),A=o(35),T=o(2082),O=o(1747),M=o(1734),L=o(1800),E=new(function(){function e(){c()(this,e),this._handlePreloaderReadyEvent=this._handlePreloaderReadyEvent.bind(this),this.reset(),window.marvel.events.on("document-collaboration-changed",this._handleProjectCollabChange.bind(this)),window.marvel.events.off("remove-authoring-context"),window.marvel.events.on("remove-authoring-context",this._handleRemoveAuthoringContext.bind(this)),window.marvel.events.off("insert-authoring-context"),window.marvel.events.on("insert-authoring-context",this._handleInsertAuthoringContext.bind(this)),window.marvel.events.on("push-composite-start push-component-start",this._handlePushEvent.bind(this))}return d()(e,[{key:"reset",value:function(){this._folderPromises={},this._foldersLocal={},this._projectsLocal={},this._currentSpecKey="",this._authoringContextsLocal={},this._authoringContextsCache=null,this._compositeDocsLocal={},this._compositeDocPromises={},this._brandsCachePromise=null}},{key:"addCompositeDocLocal",value:function(e,t){this._compositeDocsLocal[e]&&window.marvel.logger.warn("SparkStorageLoader adding local doc that already exists"),this._compositeDocsLocal[e]=t}},{key:"removeCompositeDocLocal",value:function(e){this._compositeDocsLocal[e]&&delete this._compositeDocsLocal[e]}},{key:"getCompositeDoc",value:function(e){return this.getCompositeDocWithMetadata(e)}},{key:"getCompositeDocWithMetadata",value:function(e,t){var o=this;if(!this._compositeDocsLocal[e]){if(this._compositeDocPromises[e])return this._compositeDocPromises[e];var n;n=t?g.a.resolve(t):this.discoverDocumentMetadataById(e);var r=this.createComposite(e,null);return this._compositeDocPromises[e]=g.a.allSettled([r,n]).spread((function(t,n){var r=t.value,i=n.value,a=F.a.getAppByDocType(r.type);if(!a)return window.marvel.logger.warn("SparkStorageLoader failed to find app for document type",{type:r.type,id:r.id}),g.a.reject(new Error("SparkStorageLoader failed to find app for document type"));var s=new N.a({name:r.current.name,id:r.id,modified:void 0,syncGroupName:a.getSetting("syncGroup"),compositeObj:r});return s.setCollaboration(i.collaboration),delete o._compositeDocPromises[e],o._compositeDocsLocal[e]=s,s})).catch((function(t){delete o._compositeDocPromises[e],window.marvel.logger.warn("SparkStorageLoader failed to create composite within getCompositeDocWithMetadata",{error:t,compositeURN:e})})),this._compositeDocPromises[e]}return g.a.resolve(this._compositeDocsLocal[e])}},{key:"createComposite",value:function(e,t,o){var n=this;return I.a.storageReady().then((function(){var o=I.a.dcx.newCompositeWithAssetId(e);return A.SparkPerformanceTracker.measurePromise("Storage.pullComposite(".concat(e,")"),n._doPullComposite(o,t))}))}},{key:"_doPullComposite",value:function(e,t){return I.a.pullComposite(e).then((function(t){return e})).fail((function(e){if("NO_COMPOSITE"===e.code){var t=e.underlyingError&&e.underlyingError.response||{},o={responseStatusCode:t.statusCode,responseStatusText:t.statusText};window.marvel.logger.warn("AUDIT SyncGroup cleaning up deadend composite reference",o)}return g.a.reject(e)}))}},{key:"_doACCacheInvalidate",value:function(e){try{var t,o=m.a.getProfile().userId,n=window.localStorage.getItem(o+"aclistcache2");if(n){var r=JSON.parse(n);if(e)for(t=0;t<r.brands.length;t++)r.brands[t].urn===e&&r.brands.splice(t--,1);else r.etag=null;window.localStorage.setItem(o+"aclistcache2",JSON.stringify(r))}}catch(i){window.marvel.logger.warn("[Core:ClientStorage] exception invalidating brand cache",{error:i})}}},{key:"discoverDocumentMetadataById",value:function(e){var t=g.a.defer();return m.a.ajax({type:"GET",url:"https://"+window.marvel.settings.ss+"/id/"+e+"/:metadata",headers:{"x-api-key":window.marvel.settings.key}}).then((function(e,o,n){t.resolve(e)})).fail((function(e){t.reject(e)})),A.SparkPerformanceTracker.measurePromise("Storage.discoverDocumentMetadataById(".concat(e,")"),t.promise)}},{key:"invalidateAuthoringContextCache",value:function(e){var t=this;return this._brandsCachePromise?this._brandsCachePromise.then((function(){t._doACCacheInvalidate(e)})):(this._doACCacheInvalidate(e),g.a.resolve())}},{key:"flushLocalAuthoringContext",value:function(e){var t=this;return this.invalidateAuthoringContextCache(e).then((function(){t._authoringContextsLocal[e]&&delete t._authoringContextsLocal[e]}))}},{key:"_handleRemoveAuthoringContext",value:function(e){var t=this;this._authoringContextsLocal[e]&&delete this._authoringContextsLocal[e],this._authoringContextsCache&&this._authoringContextsCache.forEach((function(o,n){o.getURN()===e&&t._authoringContextsCache.splice(n,1)}))}},{key:"_handleInsertAuthoringContext",value:function(e){this._authoringContextsCache&&this._authoringContextsCache.push(e)}},{key:"_handlePushEvent",value:function(e){Object.values(this._foldersLocal).forEach((function(e){return e.getDiscoveryContext().setEtagBundle("")})),this._lastLatest&&(this._lastLatest.etagBundle="")}},{key:"fetchBrandsList",value:function(e,t,o){var n=this,r=window.marvel.features.userData&&window.marvel.features.userData.defaultBrandId,i=t||g.a.defer(),a=o?"&start=".concat(o):"",s="https://".concat(window.marvel.settings.ss,"/assets/").concat("adobe-spark-authoring-contexts","?orderby=modified&order=desc").concat(a),c={headers:{"x-api-key":window.marvel.settings.key}},l={brands:e||[]};return m.a.ajax(s,c).then((function(e){var t=e.children||[],o=t[t.length-1];l.etag=e.etag,l.total_children=e.total_children;var a=t.map((function(e){return Object.assign(e,{isDefault:e.name===r})}));l.brands=l.brands.concat(a),l.brands.length<l.total_children&&o?n.fetchBrandsList(l.brands,i,o.modified):i.resolve(l)})).fail((function(e){404===e.status?(window.marvel.logger.info("[Core:ClientStorage] fetch brands did not find sync group",{error:e}),i.resolve({brands:[],total_children:0,etag:""})):(window.marvel.logger.error("[Core:ClientStorage] error while fetching brands",{error:e}),i.reject(e))})),i.promise}},{key:"getLocalAuthoringContextList",value:function(e){var t=this;if(this._brandsCachePromise)return this._brandsCachePromise;if(this._brandCacheTime&&this._authoringContextsCache&&(new Date).getTime()-this._brandCacheTime<12e4)return g()(this._authoringContextsCache);try{return A.SparkPerformanceTracker.mark("Storage.getLocalAuthoringContextList"),this._brandsCachePromise=this.fetchBrandsList().then((function(o){var n={},r=[];return o.brands.forEach((function(o){if(n[o.urn]=!0,t._authoringContextsLocal[o.urn])r.push(t._authoringContextsLocal[o.urn].createPromise.then((function(){t._authoringContextsLocal[o.urn].compositeDoc.setCollaboration(o.collaboration)})));else{var i=g.a.defer(),a={info:o,createPromise:i.promise};t._authoringContextsLocal[o.urn]=a,r.push(t.createComposite(a.info.urn,a.info.modified).then((function(t){return a.composite=t,a.compositeDoc=new N.a({name:t.current.name,id:t.assetId,modified:a.info.modified,syncGroupName:"adobe-spark-authoring-contexts",compositeObj:t}),a.compositeDoc.setIsMounted(!0),a.compositeDoc.setCollaboration(a.info.collaboration),a.authoringContext=e(a.compositeDoc,o.isDefault),i.resolve(),!0})).catch((function(e){window.marvel.logger.error("[Core:ClientStorage] exception creating brand composite for cache",{error:e,compositeURN:a.info.urn,compositeModified:a.info.modified}),i.reject(e)})))}})),Object.keys(t._authoringContextsLocal).forEach((function(e){n[e]||delete t._authoringContextsLocal[e]})),A.SparkPerformanceTracker.measure("Storage.getLocalAuthoringContextList:end","Storage.getLocalAuthoringContextList"),g.a.allSettled(r).then((function(e){t._brandsCachePromise=null,t._brandCacheTime=(new Date).getTime();var o=[];return Object.entries(t._authoringContextsLocal).forEach((function(e){var t=w()(e,2),n=t[0],r=t[1];r.authoringContext?o.push(r.authoringContext):window.marvel.logger.warn("[Core:ClientStorage] authoringContext is missing while processing _authoringContextsLocal:acInfo",{urn:n})})),t._authoringContextsCache=o,o}))})),this._brandsCachePromise}catch(o){return window.marvel.logger.error("[Core:ClientStorage] unexpected exception listing brands",{error:o}),g.a.reject(o)}}},{key:"getOrganizerIndexingWorking",value:function(){return this._organizerIndexBackgroundWorking}},{key:"getOrganizerIndexingPromise",value:function(){return this._organizerIndexBackgroundPromise||g.a.resolve()}},{key:"addLocalProject",value:function(e){this._projectsLocal[e.id]=e}},{key:"getLocalProjectById",value:function(e){return this._projectsLocal[e]}},{key:"flushProjectWithId",value:function(e){var t=this._projectsLocal[e];Object.entries(this._foldersLocal).forEach((function(e){var o=w()(e,2),n=(o[0],o[1]);n&&n.getDiscoveryContext().removeProjectLocal(t)})),delete this._projectsLocal[e]}},{key:"getLocalFolderById",value:function(e){return this._foldersLocal[e]}},{key:"flushFolderWithId",value:function(e){var t=this._foldersLocal[e];Object.entries(this._foldersLocal).forEach((function(e){var o=w()(e,2),n=(o[0],o[1]);n&&n.getDiscoveryContext().removeFolderLocal(t)})),delete this._foldersLocal[e]}},{key:"folderFactory",value:function(e,t){var o;if(e.discoverySpec)o=e.discoverySpec.getFolderId();else{if(!e.id)throw new Error("Unkown folder model factory ",e);o=e.id}var n=this._foldersLocal[o];return n?e.discoverySpec&&n.setSpec(e.discoverySpec):(n=new M.a(e,this._controller),this._foldersLocal[n.id]=n),t&&(n.parentFolder=t),P()(n.name)&&"root"!==n.id&&(n.name=e.name),n}},{key:"loadFolder",value:function(e){var t=this,o=this.folderFactory({discoverySpec:e});if(!this._folderPromises[e.getKey()]){var n=o.getDiscoveryContext();this._folderPromises[e.getKey()]=this.loadMoreProjects(n).then((function(){if(o.name=n.folderName,"root"!==e.getFolderId()&&!o.parentFolder){if(!n.folderParentId)throw new Error("SparkStorageLoader requires parentFolderId to load folder");var r=t.folderFactory({name:n.folderParentName,discoverySpec:new O.a({filter:null,incomingCollabOnly:"none",sort:null,sortDirection:null,folderId:n.folderParentId})});o.parentFolder=r}return o}))}return this._folderPromises[e.getKey()]}},{key:"projectFactory",value:function(e){var t=new L.a(e,this._controller);return this._projectsLocal[e.id]=t,e.parentFolder&&e.parentFolder.getDiscoveryContext().addProjectLocal(t),t}},{key:"_reportEtagAnalytics",value:function(e,t,o){this._lastRequest=this._lastRequest||{};var n=this._lastRequest[e],r={context:e,category:"?",reqCount:n?n.reqCount+1:1},i=o&&o.etagBundle;if(o)if(o.noChanges)i=n&&n.etagBundle,r.category=o.optimized?"matched-on-server-optimized":"matched-on-server";else if(""===t)r.category="cache-invalidated";else if(n&&n.etagBundle&&t)if(o.etagBundle){var a=n.etagBundle.split("|"),s=o.etagBundle.split("|");if(a.length!==s.length)r.category="length-mismatch",r.len1=a.length,r.len2=s.length;else{var c=[];a.forEach((function(e,t){e!==s[t]&&c.push(t)})),0===c.length?r.category="match":(r.category="mismatch",r.indices=c.join(" "))}}else r.category="no-new";else r.category=i?"no-prev":"no-prev-or-new";else r.category="no-response";this._lastRequest[e]={etagBundle:i,reqCount:r.reqCount},window.marvel.logger.info("[Core:Folders] etagBundle",r)}},{key:"getLatestProjects",value:function(e){var t=this,o=4;e>0&&(o=Math.min(e,8));var n="/sp-storage/flat/root/all/all/modified/desc/";return this._lastLatest&&this._lastLatest.etagBundle&&(n="".concat(n,"?etagBundle=").concat(this._lastLatest.etagBundle)),m.a.isSignedInUser().then((function(e){return e?_.a.authFetchJSON({uri:n}).then((function(e){var n;if(t._reportEtagAnalytics("getLatestProjects",t._lastLatest&&t._lastLatest.etagBundle,e),e.noChanges)n=t._lastLatest.projects;else{n=e.folderProjects;var r=e.etagBundle;t._lastLatest=r?{etagBundle:r,projects:n}:null}return n.slice(0,o).map((function(e){var o=t._projectsLocal[e.id];return o?o.thumbnail!==e.thumbnail&&(o.thumbnail=e.thumbnail):o=t.projectFactory(e),o}))})):[]}))}},{key:"refreshOrganizer",value:function(e){var t=this;return m.a.isSignedInUser().then((function(o){return o?b.a.load().then((function(o){return o.ACPSparkController.discoverFolder(e).then((function(n){return o.ActionController.execAction({title:"Refresh organizer",do:function(r){if(!o.ACPSparkController.isSpecCurrent(e.getKey()))return g.a.resolve();var i=n.getDiscoveryContext(),a=i.getEtagBundle(),s=Math.max(i.projectsDesired||i.projectsFetchedCount,i.projects.length),c=e.getBasePath();y.a.hasFeature("enable-odb")||(c="flat");var l="/sp-storage/"+c+"/"+e.getFolderId()+"/"+e.getFilter()+"/"+e.getIncomingCollabOnly()+"/"+e.getSort()+"/"+e.getSortDirection()+"?stopCount="+s+"&etagBundle="+a;return _.a.authFetchJSON({uri:l}).then((function(r){if(t._reportEtagAnalytics("refreshOrganizer",a,r),!o.ACPSparkController.isSpecCurrent(e.getKey()))return g.a.resolve();if(!t._organizerIndexBackgroundWorking&&(r.rebuildIndexRequired||r.moreIndexingRequired))return t._handleOdbIndexingBackground(r.rebuildIndexRequired,i).then((function(){return t.refreshOrganizer(e)}));if(r.noChanges)return g.a.resolve();i.setEtagBundle(r.etagBundle);var s={},c={added:[],updated:[],removed:[]};r.folderProjects.forEach((function(e){var o=t._projectsLocal[e.id];s[e.id]=!0,o?o.refreshInfo(e)&&c.updated.push(o):(e.parentFolder=n,o=t.projectFactory(e),c.added.push(o))})),Object.entries(t._projectsLocal).forEach((function(e){var o=w()(e,2),r=o[0],i=o[1];i.parentFolder&&i.parentFolder.id===n.id&&(s[i.id]||(t.flushProjectWithId(r),c.removed.push(i)))})),i.totalProjects=r.totalProjects,c.removed.length&&i.setSgLastTimestampMap(r.sgLastTimestampMap),(c.added.length||c.removed.length||c.updated.length)&&(n.getDiscoveryContext().sortProjects(),window.marvel.events.trigger("odb-projects-changed",c),window.marvel.events.trigger("organizer-reload-datasource"));var l={added:[],removed:[],updated:[]},d={};return r.folders&&r.folders.forEach((function(e){d[e.id]=!0;var o=t._foldersLocal[e.id];o?o.refreshInfo(e)&&l.updated.push(o):(o=t.folderFactory(e,n),i.addFolderLocal(o),l.added.push(o))})),Object.entries(t._foldersLocal).forEach((function(e){var o=w()(e,2),r=o[0],i=o[1];i&&!d[r]&&"root"!==r&&n.id===i.parentFolder.id&&(t.flushFolderWithId(r),l.removed.push(i))})),(l.added.length||l.removed.length||l.updated.length)&&(window.marvel.events.trigger("odb-folders-changed",l),window.marvel.events.trigger("organizer-reload-datasource")),g.a.resolve()}))}})}))})):g.a.resolve()}))}},{key:"loadMoreProjects",value:function(e,t,o,n){var r=this;if(this._organizerIndexBackgroundWorking)return window.marvel.logger.info("[Core:Folders] loadMoreProjects while indexing a large account"),this._organizerIndexBackgroundPromise;var i=e.getSpec(),a=i.getBasePath();y.a.hasFeature("enable-odb")||(a="flat");var s="";if(e instanceof T.a){var c=e.getSgLastTimestampMap();s=this._getTimestampQueryParams(c)}"flat"===a||P()(t)||(s=this._getTimestampQueryParams(t)+"&processingMore=true");var l="/sp-storage/"+a+"/"+i.getFolderId()+"/"+i.getFilter()+"/"+i.getIncomingCollabOnly()+"/"+i.getSort()+"/"+i.getSortDirection()+"/"+e.getPagingToken()+s;return _.a.authFetchJSON({uri:l}).then((function(t){return r._reportEtagAnalytics("loadMoreProjects",null,t),r._initWithJSON(t,e,o||"loadMoreProjects",n)}))}},{key:"_getTimestampQueryParams",value:function(e){var t=e?Object.keys(e):[],o="";return t.forEach((function(t){o+="&".concat(t,"=").concat(e[t])})),o.replace("&","?")}},{key:"_rerequestPreloader",value:function(){return m.a.isSignedInUser().then((function(){var e=document.createElement("script");e.type="text/javascript",e.src="/sp-storage/organizer?u="+String(Math.round(1e3*Math.random())),document.getElementsByTagName("head")[0].appendChild(e)})).catch((function(e){window.marvel.logger.error("[Client:Storage] unexpected error awaiting auth before reloading preloader",e)}))}},{key:"_initWithPreloader",value:function(){var e=window._sgPreload||{};return e.folderProjects&&e.incomingCollabOnly&&(h()(e.folderProjects,(function(e){e.name=decodeURIComponent(e.name)})),e.incomingCollabOnly=decodeURIComponent(e.incomingCollabOnly)),this._initWithJSON(e,null,"preloader")}},{key:"_processAuthoringContextData",value:function(e){if(e.brands){if(window.localStorage){var t=m.a.getProfile().userId,o=JSON.parse(window.localStorage.getItem(t+"aclistcache2")||"{}");o&&o.etag&&o.etag===e.brandsEtag||(o.cacheTime=(new Date).getTime(),o.etag=e.brandsEtag,o.brands=e.brands,o.brandsToRetry=e.brandsToRetry,window.localStorage.setItem(t+"aclistcache2",JSON.stringify(o)))}}}},{key:"_initWithJSON",value:function(e,t,o,n){var r,i=this,a=t,s=n||[];if(e.noChanges)return g.a.resolve();if(this._processAuthoringContextData(e),void 0===e.folderProjects)return this._controller.setAllProjectsCount(e.allProjectsCount||0),this._controller.setSgProjectsCount(e.sgCounts||{}),g.a.resolve();if(a)r=this.folderFactory({discoverySpec:a.getSpec()});else{var c=new O.a({folderId:e.folderId||"root",incomingCollabOnly:e.incomingCollabOnly||"none",filter:e.filter||"all",sort:e.sort||"modified",sortDirection:e.sortDirection||"desc",useFlatApi:!1===e.foldersEnabled||e.useFlat});r=this.folderFactory({discoverySpec:c}),a=r.getDiscoveryContext(),this._folderPromises[c.getKey()]=g.a.resolve(r)}if(!this._organizerIndexBackgroundWorking&&(e.rebuildIndexRequired||e.moreIndexingRequired))return window.marvel.logger.info("[Core:Folders] initiate indexing in the background"),this._handleOdbIndexingBackground(e.rebuildIndexRequired,a).then((function(){return i.loadMoreProjects(a)}));var l="".concat(e.folderId).concat(e.filter).concat(e.incomingCollabOnly).concat(e.sort).concat(e.sortDirection);if("preloader"!==o&&this._currentSpecKey!==l)return g.a.resolve();if(a.folderName=e.folderName,a.folderParentId=e.folderParentId,a.folderParentName=e.folderParentName,a.projectsFetchedCount=e.projectsFetchedCount,a.firstTimeODBUser=e.firstTimeODBUser,a.indexCompletion=e.indexCompletion,a.projectsInAnyFolderTotal=e.projectsInAnyFolderTotal,a.hasMore=e.hasMore,a.setEtagBundle(e.etagBundle),s=s.concat(e.folderProjects),"preloader"!==o&&e.needsMoreProcessing){var d=Object.assign({},e.sgLastTimestampMap,e.moreSgTimeStamp);return window.marvel.logger.info("[Core:Folders] storage result needs more processing, loading more projects",{moreSgTimeStamp:e.moreSgTimeStamp,mergedTimestamps:d,initContext:o,discoveryCtxt:t,projectsWorkingList:s}),this.loadMoreProjects(a,d,"moreProcessing",s)}s.forEach((function(e,t){var o;e.parentFolder=r,i._projectsLocal[e.id]&&(o=i._projectsLocal[e.id]).refreshInfo(e),o?a.addProjectLocal(o):o=i.projectFactory(e)}));var u={};h()(this._projectsLocal,(function(e){u[e._sg]=e.contentModified})),a.totalProjects=e.totalProjects,a.setSgLastTimestampMap(u),this._controller.setAllProjectsCount(e.allProjectsCount),this._controller.setSgProjectsCount(e.sgCounts);var f=e.folders||[];return f.forEach((function(e){var t=i.folderFactory(e,r);a.addFolderLocal(t)})),a.totalFolders=f.length,e.breadCrumbs instanceof Array&&(a.breadCrumbs=e.breadCrumbs),a.sortProjects(),g.a.resolve()}},{key:"_handleOdbIndexingBackground",value:function(e,t){var o=this;if(this._organizerIndexBackgroundWorking)return window.marvel.logger.warn("[Core:Folders] unexpected duplicate request to index in the background",{stack:(new Error).stack}),this._organizerIndexBackgroundPromise||g.a.resolve();this._organizerIndexBackgroundWorking=!0;var n="pageIndex";e&&(n="rebuildIndex");var r=b.a.load().then((function(e){return e.ACPSparkController.organizerIndexNext(n).then((function(e){return o._organizerIndexBackgroundWorking=!1,e.indexCompletion<1&&e.indexProcessedCount>0?(window.marvel.logger.info("[Core:Folders] handleOdbIndexingBackground continues "+e.indexCompletion,e),o._handleOdbIndexingBackground(e.rebuildIndexRequired,t)):(window.marvel.logger.info("[Core:Folders] handleOdbIndexingBackground indexing complete",e),o._organizerIndexBackgroundPromise=null,g.a.resolve())}))})).catch((function(e){o._organizerIndexBackgroundWorking=!1,o._organizerIndexBackgroundPromise=null,window.marvel.logger.error("[Core:Folders] handleOdbIndexingBackground failed.",e)}));return this._organizerIndexBackgroundPromise||(this._organizerIndexBackgroundPromise=r),r}},{key:"_detach",value:function(){this._attachDefer=null,window.marvel.events.off("sg-preload-ready",this._handlePreloaderReadyEvent)}},{key:"_handlePreloaderReadyEvent",value:function(){var e=this;window._sgPreloadUnauth&&!window._sgPreloaderUnauthRetry?(window._sgPreloaderUnauthRetry=!0,window._sgPreloadUnauth=!1,this._rerequestPreloader()):this._initWithPreloader().then((function(){e._attachDefer.resolve()}),(function(t){e._attachDefer.reject(t)}))}},{key:"_handleProjectCollabChange",value:function(e){var t=e.composite,o=e.collab,n=this._projectsLocal[t.id];if(n){var r=n.getCollaboration();0===o.collaborators.length?n.setCollaboration(void 0):r||n.setCollaboration("OUTGOING")}}},{key:"attach",value:function(e){var t=this;return this._controller=e,this._attachDefer||(this._attachDefer=g.a.defer(),A.SparkPerformanceTracker.measurePromise("StorageLoader.attach",this._attachDefer.promise),window._sgPreloadUnauth&&(window._sgPreloadUnauth=!1,this._rerequestPreloader()),window._sgPreload?this._initWithPreloader().then((function(){t._attachDefer.resolve()}),(function(e){t._attachDefer.reject(e)})):window.marvel.events.on("sg-preload-ready",this._handlePreloaderReadyEvent)),this._attachDefer.promise}},{key:"setCurrentSpec",value:function(e){this._currentSpecKey=e.getKey()}}]),e}()),R=new(function(){function e(){c()(this,e),this._onSyncModeSet=this._onSyncModeSet.bind(this),this._onSyncTimer=this._onSyncTimer.bind(this),this._handleStorageSyncNow=this._handleStorageSyncNow.bind(this)}var t;return d()(e,[{key:"_handleSparkAssetUpdated",value:(t=a()(r.a.mark((function e(t,o){var n,i,a,s,c;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=this.getLocalProjectById(t.get("id")))){e.next=5;break}n.name=t.get("name"),e.next=18;break;case 5:if(i=this.getCurrentFolder(),a=o&&o.hostInfo?o.hostInfo.appName:null,s=o&&o.workflow?o.workflow:null,!a||!i||"root"!==i.id||"CREATE_DESIGN"!==s){e.next=17;break}if(!(c=i.getDiscoveryContext().folders.find((function(e){return e.name===a})))){e.next=14;break}i=c,e.next=17;break;case 14:return e.next=16,this.createFolder(a,i);case 16:i=e.sent;case 17:this.createProject(t,i).then((function(e){}));case 18:case"end":return e.stop()}}),e,this)}))),function(e,o){return t.apply(this,arguments)})},{key:"attach",value:function(){return this._isListening||(this._isListening=!0,window.marvel.events.on("set-sync-mode",this._onSyncModeSet),window.marvel.events.on("storage-sync-now",this._handleStorageSyncNow),this._handleSparkAssetUpdated=this._handleSparkAssetUpdated.bind(this),window.marvel.events.on("folder-document-updated",this._handleSparkAssetUpdated)),E.attach(this)}},{key:"_detach",value:function(){this._isListening&&(this._isListening=!1,this._syncInProgressKey=null,this._syncTimer=null,this._syncInProgress=null,this._currentFolderSpec=null,window.marvel.events.off("set-sync-mode",this._onSyncModeSet))}},{key:"isSpecCurrent",value:function(e){return e&&this._currentFolderSpec&&e===this._currentFolderSpec.getKey()}},{key:"_handleStorageSyncNow",value:function(){this._clearSyncTimer(),this._onSyncTimer()}},{key:"_onSyncTimer",value:function(e){var t=this,o=e||0;if(!this.isSpecCurrent(this._syncInProgressKey)){this._currentFolderSpec||(this._currentFolderSpec=new O.a);var n=this._currentFolderSpec.getKey();this._syncInProgressKey=n,this._syncInProgress=E.refreshOrganizer(this._currentFolderSpec).then((function(){t.isSpecCurrent(n)&&(t._syncInProgressKey=null,t._syncTimer=null,t._setSyncTimer())}),(function(e){t._syncInProgressKey=null;var n=0;o>1&&(n=500*Math.pow(2,o)),n>3e5?(window.marvel.logger.error("[Core:Folders] ACPSparkController abandoning refresh after "+o+" attempts, notifying user"),window.marvel.events.trigger("service-borked")):window.setTimeout((function(){t._onSyncTimer(o+1)}),n)})).done()}}},{key:"_setSyncTimer",value:function(){this._syncTimer||(this._syncTimer=window.setTimeout(this._onSyncTimer,12e4))}},{key:"_clearSyncTimer",value:function(){this._syncTimer&&(window.clearTimeout(this._syncTimer),this._syncTimer=null)}},{key:"isEditorOpen",value:function(){return"sync-editor"===this._syncMode}},{key:"_onSyncModeSet",value:function(e){e&&("sync-group"===e.mode&&"sync-group"!==this._syncMode&&(this._clearSyncTimer(),e.folderSpec&&(this._currentFolderSpec=e.folderSpec),this._onSyncTimer(),"sync-home"!==this._syncMode&&window.marvel.events.trigger("left-editing-session",{})),"sync-home"===e.mode?("sync-editor"===this._syncMode&&this._onSyncTimer(),this._clearSyncTimer(),e.previousFolderCallback&&e.previousFolderCallback(this._currentFolderSpec),e.folderSpec&&(this._currentFolderSpec=e.folderSpec)):"sync-group"===e.mode?(e.folderSpec&&(this._currentFolderSpec&&this._currentFolderSpec.getKey()===e.folderSpec.getKey()||this._clearSyncTimer(),this._currentFolderSpec=e.folderSpec),this._setSyncTimer()):"sync-editor"!==e.mode&&"sync-disabled"!==e.mode||this._clearSyncTimer(),this._syncMode=e.mode)}},{key:"_resetODB",value:function(){m.a.getAccessToken().then((function(e){window.fetch("/sp-storage/folders",{method:"DELETE",headers:new window.Headers({"x-access-token":e})}).then((function(e){marvel.navigate("/",{trigger:!0}),window.location.reload()})).catch((function(e){window.marvel.logger.warn("[Core:Folders] ACPSparkController failed to reset ODB",e)}))}))}},{key:"getCurrentFolder",value:function(){return this._currentFolderSpec?this.getLocalFolderById(this._currentFolderSpec.getFolderId()):null}},{key:"getLocalFolderById",value:function(e){return E.getLocalFolderById(e)}},{key:"getLocalProjectById",value:function(e){return E.getLocalProjectById(e)}},{key:"discoverFolder",value:function(e){return E.setCurrentSpec(e),E.attach(this).then((function(){return E.loadFolder(e)}))}},{key:"getLatestProjects",value:function(e){return E.attach(this).then((function(){return E.getLatestProjects(e)}))}},{key:"loadMoreProjects",value:function(e){return E.loadMoreProjects(e)}},{key:"getCompositeDocWithMetadata",value:function(e,t){return E.getCompositeDocWithMetadata(e,t)}},{key:"createFolderLocal",value:function(e,t){var o=t.getDiscoveryContext(),n=E.folderFactory(e,t);return o.addFolderLocal(n),n}},{key:"deleteFolderLocal",value:function(e){e.parentFolder.getDiscoveryContext().removeFolderLocal(e)}},{key:"createFolder",value:function(e,t){var o=this;return b.a.load().then((function(n){return n.ActionController.execAction({title:"Create Folder: "+e,do:function(n){return _.a.authFetchJSON({method:"POST",uri:"/sp-storage/folders",body:{parentFolderId:t.id,name:e}}).then((function(n){var r=o.createFolderLocal({id:n.id,name:e},t);return window.marvel.events.trigger("odb-folders-changed",{added:[r]}),window.marvel.logger.info('[Core:Folders] Created new folder "'+e+'" in folder id: '+t.id),r}))},retry:function(o,n){return window.marvel.logger.warn('[Core:Folders] Retrying to create new folder "'+e+'" in folder id: '+t.id),o.retryConflicts(n,1)}})}))}},{key:"deleteSubfolder",value:function(e,t){return b.a.load().then((function(o){return o.ActionController.execAction({title:"Delete Folder",do:function(o){return E.flushFolderWithId(t),window.marvel.logger.info("[Core:Folders] Deleting folder id: "+t+" from folder id: "+e.id),_.a.authFetch({method:"DELETE",uri:"/sp-storage/folders/"+e.id+"/"+t})},retry:function(o,n){return window.marvel.logger.warn("[Core:Folders] Retrying to delete folder id: "+t+" from folder id: "+e.id),o.retryConflicts(n,1)}})}))}},{key:"renameFolder",value:function(e,t){var o=e.name;return e.setName(t),b.a.load().then((function(n){return n.ActionController.execAction({title:"Rename folder to "+t,do:function(n){return _.a.authFetchJSON({method:"POST",uri:"/sp-storage/patch-folder/"+e.id,body:{name:t}}).then((function(n){window.marvel.logger.info("[Core:Folders] Folder "+e.id+' renamed from "'+o+'" to "'+t+'"')})).catch((function(t){e.setName(o),window.marvel.logger.warn("[Core:Folders] ACPSparkController failed to rename folder",t)}))},retry:function(n,r){return window.marvel.logger.warn("[Core:Folders] Retrying to rename folder id: "+e.id+' from "'+o+'" to "'+t+'"'),n.retryConflicts(r,1)}})}))}},{key:"removeProjectFromParentFolder",value:function(e){var t=e.parentFolder,o=t.name||"ROOT",n=[];return e.id?(n.push(e.id),b.a.load().then((function(r){return r.ActionController.execAction({title:"Remove project "+e.name+" from "+o,do:function(r){return _.a.authFetchJSON({method:"POST",uri:"/sp-storage/patch-folder-remove/"+t.id,body:{projects:n}}).then((function(n){window.marvel.logger.info("[Core:Folders] Removed project "+e.name+" from "+o),t.getDiscoveryContext().removeProjectLocal(e)}))},retry:function(t,n){return window.marvel.logger.warn("[Core:Folders] Retrying to remove project "+e.name+" from "+o),t.retryConflicts(n,1)}})}))):(window.marvl.logger.warn("[Core:Folders] removeProjectFromParentFolder received invalid object."),g.a.reject())}},{key:"removeProjectFromMetaParentFolder",value:function(e){var t=e.metaFolder,o=t&&t.name||"ROOT",n=t&&t.id||"root",r=[];return e.id?(r.push(e.id),b.a.load().then((function(t){return t.ActionController.execAction({title:"Remove project "+e.name+" from "+o,do:function(t){return _.a.authFetchJSON({method:"POST",uri:"/sp-storage/patch-folder-remove/"+n,body:{projects:r}}).then((function(t){window.marvel.logger.info("[Core:Folders] Removed project "+e.name+" via meta from "+o)}))},retry:function(t,n){return window.marvel.logger.warn("[Core:Folders] Retrying to remove project "+e.name+" via meta from "+o),t.retryConflicts(n,1)}})}))):(window.marvl.logger.warn("[Core:Folders] removeProjectFromMetaParentFolder received invalid object."),g.a.reject())}},{key:"deleteProjectLocal",value:function(e){e.parentFolder.getDiscoveryContext().removeProjectLocal(e)}},{key:"createProject",value:function(e,t,o){var n=this,r=[e.getMyPrimaryApp().isBranded(e),e.getURN(),e.getImageRendition()];return g.a.allSettled(r).spread((function(r,i,a){var s=E.projectFactory({id:e.id,assetId:i.value,parentFolder:t,metaFolder:o,name:e.getProjectName(),type:e.getDCXComposite().type,modified:e.getContentModifiedDate().toISOString(),thumbnail:a.value||"",eTag:e.getContentModEtag(),isPublished:e.isPublished(),collaboration:e.getCollaboration(),isBranded:r.value,ccpath:e.getStoragePath()});return t&&"root"===t.id?(t.getDiscoveryContext().addProjectLocal(s,!0),s):t?n.move([s],t).then((function(){return s})):s}))}},{key:"_applyMovesToModel",value:function(e,t){h()(e,(function(e){e instanceof M.a?(e.parentFolder&&e.parentFolder.getDiscoveryContext().removeFolderLocal(e),t.getDiscoveryContext().addFolderLocal(e)):(e.parentFolder&&e.parentFolder.getDiscoveryContext().removeProjectLocal(e),t.getDiscoveryContext().addProjectLocal(e,!0)),e.parentFolder=t,e.metaFolder={id:t.id,name:"root"!==t.id&&t.name||null}}))}},{key:"move",value:function(e,t){var o=this;return b.a.load().then((function(n){return n.ActionController.execAction({title:"Move item(s)",do:function(n){var r=[];return e.forEach((function(e){var o={};e.parentFolder?o.oldFolderId=e.parentFolder.id:o.oldFolderId="root",o.newFolderId=t.id,e instanceof M.a?o.folderId=e.id:o.projectId=e.id,r.push(o)})),_.a.authFetchJSON({method:"POST",uri:"/sp-storage/patch-folders",body:{updates:r}}).then((function(){o._applyMovesToModel(e,t);var n=t.name||"Root";return window.marvel.logger.info("[Core:Folders] Moved "+e.length+" project(s) to "+n),t}))},retry:function(o,n){return!(n&&String(n).indexOf("errorCode:412")>=0)&&(window.marvel.logger.warn("[Core:Folders] Retrying to move "+e.length+' items to folder "'+t.name+'"'),o.retryConflicts(n,1))}})}))}},{key:"reset",value:function(){E.reset()}},{key:"getCompositeDoc",value:function(e){return E.getCompositeDoc(e)}},{key:"addCompositeDocLocal",value:function(e,t){return E.addCompositeDocLocal(e,t)}},{key:"organizerIndexNext",value:function(e){var t,o;switch(e){case"rebuildIndex":o=!0;break;case"pageIndex":t=!0;break;default:window.marvel.logger.error("[Core:Folders] Unsupported indexMode "+e)}return b.a.load().then((function(e){var n={usePageToken:t,forceRebuild:o};return _.a.authFetchJSON({method:"POST",uri:"/sp-storage/index",body:{params:n}}).then((function(e){return window.marvel.logger.info("[Core:Folders] ODB Index Next request completed",e),e}))}))}},{key:"listAuthoringContexts",value:function(e,t){return this.attach().then((function(){return E.getLocalAuthoringContextList(e).then((function(e){return e}))}))}},{key:"setAllProjectsCount",value:function(e){this._allProjectsCountDefer&&(this._allProjectsCountDefer.resolve(e),this._allProjectsCountDefer=null),this._allProjectsCount=e}},{key:"getAllProjectsCount",value:function(){return this._allProjectsCountDefer||void 0!==this._allProjectsCount?g.a.resolve(this._allProjectsCount):(this._allProjectsCountDefer=g.a.defer(),this._allProjectsCountDefer.promise)}},{key:"getSgProjectsCount",value:function(){return this._sgProjectsCountDefer||void 0!==this._sgProjectsCount?g.a.resolve(this._sgProjectsCount):(this._sgProjectsCountDefer=g.a.defer(),this._sgProjectsCountDefer.promise)}},{key:"setSgProjectsCount",value:function(e){this._sgProjectsCountDefer&&(this._sgProjectsCountDefer.resolve(e),this._sgProjectsCountDefer=null),this._sgProjectsCount=e}},{key:"isOrganizerIndexing",value:function(){return E.getOrganizerIndexingWorking()}},{key:"getOrganizerIndexingPromise",value:function(){return E.getOrganizerIndexingPromise()}}]),e}()),B=function(){function e(t){c()(this,e),this.title=t.title,this.fnDo=t.do,this.fnRetry=t.retry,this.defer=g.a.defer(),this._tried=0}return d()(e,[{key:"do",value:function(){return this._tried++,this.fnDo(this)}},{key:"retry",value:function(e){return!!this.fnRetry&&this.fnRetry(this,e)}},{key:"retryDelay",value:function(){var e=this._tried-1;return e>0?500*Math.pow(e,2):0}},{key:"retryConflicts",value:function(e,t){return!!(e&&String(e).indexOf("errorCode:409")>=0&&this._tried<=t)}}]),e}();B.COMPONENT_NAME="spark-action";var U=B,K=function(){function e(){c()(this,e),this._actionQueue=[],this._currentIndex=0,this._actionOutstanding=null}return d()(e,[{key:"busy",value:function(){return!!this._actionOutstanding}},{key:"_nextAction",value:function(){this._actionOutstanding=null,this._currentIndex++,this._action()}},{key:"_handleOnlineError",value:function(e){var t=this;this._actionOutstanding.retry(e)?window.setTimeout((function(){window.marvel.logger.debug("retrying action "+t._actionOutstanding.title),t._actionOutstanding=null,t._action()}),this._actionOutstanding.retryDelay()):(this._actionOutstanding.defer.reject(e),this._nextAction())}},{key:"_action",value:function(){var e=this;!this._actionOutstanding&&this._actionQueue[this._currentIndex]&&(this._actionOutstanding=this._actionQueue[this._currentIndex],this._actionOutstanding.do().then((function(t){e._actionOutstanding.defer.resolve(t),e._nextAction()}),(function(t){m.a.checkIsOffline().then((function(o){o?window.marvel.logger.warn("suspending action processing due to being offline"):e._handleOnlineError(t)}))})).done())}},{key:"execAction",value:function(e){var t=new U(e);return this._actionQueue[this._actionQueue.length]=t,this._action(),t.defer.promise}}]),e}();K.COMPONENT_NAME="action-controller";var X=K;R.attach();t.default={ACPSparkController:R,ActionController:new X,SparkFolderDiscoverySpec:O.a,SparkStorageLoader:E}}}]);
//# sourceMappingURL=spark-core-wraper-7c21cb27.js.map