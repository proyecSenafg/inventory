(window.webpackJsonp=window.webpackJsonp||[]).push([["vendors~m-storage",20],{2785:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s={SERVICE_IS_INACTIVE:!0,ABORTED:!0,INSECURE_REDIRECT:!0,TOO_MANY_REDIRECTS:!0,NOT_IMPLEMENTED:!0,EXCEEDS_QUOTA:!0,RETRYABLE_SERVER_ERROR:!0,TIMED_OUT:!0,TERMINATED_INPUTSTREAM:!0,WRONG_ENDPOINT:!0,ENOSPC:!0,"":!0,INVALID_STATE:!0};class o extends Error{constructor(e,t,r,s,n){if(super(),this.code=e,this.underlyingError=r,this.response=s,this.name="AdobeDCXError",this._additionalData={},this._additionalData=n,this._message=t,this.message=("string"==typeof e&&""!==e?"["+e+"] ":"")+(this._message||""),Object.setPrototypeOf(this,o.prototype),Error.captureStackTrace)Error.captureStackTrace(this,o);else try{const e=new Error;if(e.name=this.name,e.stack){const t=e.stack.split("\n");t.length>0&&t.splice(1,1),this.stack=t.join("\n")}}catch(e){}}get additionalData(){return this._additionalData}set additionalData(e){this._additionalData=e}get failedComponents(){return this._additionalData.failedComponents}static wrapError(e,t,r,n){if(r&&s[r.code])return r;if(n&&"object"==typeof n){const s=n.statusCode;if(s>=500&&s<600)501===s?(e="NOT_IMPLEMENTED",t="Unimplemented request"):507===s?(e="EXCEEDS_QUOTA",t="Quota exceeded"):(e="RETRYABLE_SERVER_ERROR",t="Server error");else if(r instanceof o&&e===r.code&&r.code===this.UNEXPECTED_RESPONSE)return r}return new o(e,t,r,n)}toString(){return`${this.name}: ${this.message}`}static networkError(e,t,r){return o.wrapError("NETWORK_ERROR",e,t,r)}static unexpectedResponse(e,t,r){return o.wrapError("UNEXPECTED_RESPONSE",e,t,r)}}o.ABORTED="ABORTED",o.INSECURE_REDIRECT="INSECURE_REDIRECT",o.TOO_MANY_REDIRECTS="TOO_MANY_REDIRECTS",o.INVALID_JSON="INVALID_JSON",o.READ_ONLY="READ_ONLY",o.INVALID_PARAMS="",o.INVALID_DATA="INVALID_DATA",o.DUPLICATE_VALUE="DUPLICATE_VALUE",o.NO_BASE_BRANCH_DATA="NO_BASE_BRANCH_DATA",o.INVALID_STATE="INVALID_STATE",o.DELETED_COMPOSITE="DELETED_COMPOSITE",o.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",o.NETWORK_ERROR="NETWORK_ERROR",o.COMPONENT_DOWNLOAD_ERROR="COMPONENT_DOWNLOAD_ERROR",o.COMPONENT_UPLOAD_ERROR="COMPONENT_UPLOAD_ERROR",o.COMPONENT_MODIFIED_ERROR="COMPONENT_MODIFIED_ERROR",o.UPDATE_CONFLICT="UPDATE_CONFLICT",o.NO_COMPOSITE="NO_COMPOSITE",o.ALREADY_EXISTS="ALREADY_EXISTS",o.SERVICE_IS_INACTIVE="SERVICE_IS_INACTIVE",o.EXCEEDS_QUOTA="EXCEEDS_QUOTA",o.NOT_IMPLEMENTED="NOT_IMPLEMENTED",o.RETRYABLE_SERVER_ERROR="RETRYABLE_SERVER_ERROR",o.TIMED_OUT="TIMED_OUT",o.UNEXPECTED="UNEXPECTED",o.TERMINATED_INPUTSTREAM="TERMINATED_INPUTSTREAM",o.WRONG_ENDPOINT="WRONG_ENDPOINT",o.OUT_OF_SPACE="ENOSPC",o.FILE_EXISTS_IN_CLOUD="FILE_EXISTS_IN_CLOUD",o.ASSET_NOT_FOUND="ASSET_NOT_FOUND",o.COMPOSITE_NOT_FOUND="COMPOSITE_NOT_FOUND",o.NOT_FOUND="NOT_FOUND",o.UNAUTHORIZED="UNAUTHORIZED",o.FORBIDDEN="FORBIDDEN",o.PRECONDITION_FAILED="PRECONDITION_FAILED",t.AdobeDCXError=o,t.DCXError=o,t.default=o,t.isAdobeDCXError=function(e){return!(!e||"object"!=typeof e)&&"AdobeDCXError"===e.name},t.networkError=function(e,t,r){return o.networkError(e,t,r)},t.unexpectedResponse=function(e,t,r){return o.unexpectedResponse(e,t,r)}},2786:function(e,t,r){"use strict";(function(e,s,o,n){Object.defineProperty(t,"__esModule",{value:!0});var i=r(4602),a=r(2785);const d=e=>c(e)&&l(e.pipe),c=e=>null!=e&&"object"==typeof e,l=e=>"[object Function]"===toString.call(e),h=e=>Array.isArray(e),u=()=>{try{return"[object process]"===Object.prototype.toString.call(e.process)}catch(i){return!1}},p=()=>"object"==typeof self&&self.self===self,f=()=>"browser",_=(...e)=>{if(!e||!Array.isArray(e)||e.length<1)return{};const t=e.shift();for(;e.length>0;){const r=e.shift();if("object"==typeof r)for(const e in r)Object.prototype.hasOwnProperty.call(r,e)&&(t[e]=r[e])}return t},m=(e,...t)=>{if(!t.length)return e;const r=t.shift();if(c(e)&&c(r))for(const s in r)c(r[s])&&!h(r[s])?(e[s]||Object.assign(e,{[s]:{}}),m(e[s],r[s])):(h(e[s])&&h(r[s]),Object.assign(e,{[s]:r[s]}));return m(e,...t)},g=/^[^\u0000-\u001F\u0022\u002A\u003A\u003C\u003E\u003F\u005C\u007F]*[^\u0000-\u001F\u0022\u002A\u002E\u003A\u003C\u003E\u003F\u005C\u007F]{1}$/,E=(e,t=!1)=>{try{if(e.length>65535)return!1;const r=(t?e.slice(1):e).split("/");if(!r||0===r.length)return!1;const s=r.length;for(let e=0;e<s;e++)if(r[e].length>255||!g.test(r[e]))return!1;if(t&&r.length>0){const e=r[0];if("manifest"===e||"mimetype"===e)return!1}return!0}catch(e){return!1}},A=()=>{},C=(e,t,r)=>{const s={};let o,n=Object.keys(e),i=n.length;for(let a=0;a<i;a++){if(o=n[a],!r||!r[o]){const s=e[o],n=t[o];if(typeof s!=typeof n)return!1;if(c(s)&&c(n)){if(!C(s,n,r))return!1}else if(s!==n)return!1}s[o]=!0}n=Object.keys(t),i=n.length;for(let a=0;a<i;a++)if(o=n[a],!s[o])return!1;return!0},D=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?"),y=e=>{const t=e.match(D)||[];return{scheme:t[2],authority:t[4],path:t[5],query:t[7],fragment:t[9]}},I="0".charCodeAt(0),v="1".charCodeAt(0),b="9".charCodeAt(0),T="a".charCodeAt(0),P="A".charCodeAt(0),w="f".charCodeAt(0),R="F".charCodeAt(0),O=e=>{const t=e.charCodeAt(0);return t>=I&&t<=b||t>=T&&t<=w||t>=P&&t<=R},k=e=>e.length>=3&&"%"===e.charAt(0)&&O(e.charAt(1))&&O(e.charAt(2)),L=e=>{const t=e.charCodeAt(0);return t>=I&&t<=b?t-I:t>=T&&t<=w?10+t-T:t>=P&&t<=R?10+t-P:0},S="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-_.~",N="0123456789ABCDEF",M=e=>{const t=[];for(let r=0;r<128;++r)t.push(-1!==e.indexOf(String.fromCharCode(r)));return t},X=M("abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-_.~:/?#[]@!$&'()*+,;="),x=M(S),U=M(S+"/"),j=(e,t)=>{if(e<128&&t[e])return String.fromCharCode(e);let r="%";return r+=N.charAt(e>>4&15),r+=N.charAt(15&e),r},B=e=>{const t=[];for(let r=0;r<e.length;r++){let s=e.charCodeAt(r);s<128?t.push(s):s<2048?t.push(192|s>>6,128|63&s):s<55296||s>=57344?t.push(224|s>>12,128|s>>6&63,128|63&s):++r<e.length&&(s=65536+((1023&s)<<10|1023&e.charCodeAt(r)),t.push(240|s>>18,128|s>>12&63,128|s>>6&63,128|63&s))}return t},V=(e,t)=>{const r=B(e);let s="";for(let o=0;o<r.length;o++)s+=j(r[o],t);return s},H=e=>(e=e.normalize("NFC"),V(e,x)),F=e=>{e=e.normalize("NFC");let t=0,r="";for(;t<e.length;)k(e.substr(t))?(r+=e.substr(t,3),t+=3):r+=V(e.charAt(t++),X);return r},Y=(e,t)=>{let r=0,s="",o=!1,n=!1,i=!1,a=!0,d=!0,c=!1,l="",h="",u=",",p=-1;const f=e=>{if(s+=a?h:c||d?u:",",n&&l&&(a||c||d)&&(s+=H(l),(!i||e.length>0)&&(s+="=")),e){let t;t=o?F(e):H(e),p>0&&(t=((e,t)=>{let r=0;for(;r<e.length&&t>0;){if(k(e.substr(r))){let t=(L(e.substr(r+1))<<4)+L(e.substr(r+2));if(r+=3,192==(192&t))for(;r<e.length&&k(e.substr(r))&&(t=(L(e.substr(r+1))<<4)+L(e.substr(r+2)),r+=3,128==(192&t)););}else++r;--t}return e.substr(0,r)})(t,p)),s+=t}a=!1,d=!1};for(;r<e.length;)if("{"===e.charAt(r)){if(++r<e.length){switch(o=!1,n=!1,h="",u=",",i=!1,e.charAt(r++)){case"+":o=!0;break;case"#":h="#",o=!0;break;case".":h=".",u=".";break;case"/":h="/",u="/";break;case";":h=";",u=";",n=i=!0;break;case"?":h="?",u="&",n=!0;break;case"&":h="&",u="&",n=!0;break;default:--r}for(l="",a=!0,d=!0;r<e.length;)if("}"===e.charAt(r)||","===e.charAt(r)||"*"===e.charAt(r)||":"===e.charAt(r)){if(c=!1,p=-1,"*"===e.charAt(r)){if(c=!0,++r>=e.length)break}else if(":"===e.charAt(r)){if(++r>=e.length)break;for(e.charCodeAt(r)>=v&&e.charCodeAt(r)<=b&&(p=0);r<e.length&&e.charCodeAt(r)>=I&&e.charCodeAt(r)<=b&&p<1e4;)p=10*p+(e.charCodeAt(r++)-I);if(r>=e.length)break}for(;r<e.length&&"}"!==e.charAt(r)&&","!==e.charAt(r);)++r;if(l.length>0&&"*"===l.charAt(l.length-1)&&(c=!0,l=l.substr(0,l.length-1)),l.length>0){const e=t?t[l]:void 0;if(e||""===e)if(Array.isArray(e)){p=-1;for(let t=0;t<e.length;t++)f(String(e[t]))}else if("object"==typeof e&&null!==e)for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&(_=t,m=String(e[t]),s+=a?h:c||d?u:",",n&&l&&a&&!c&&(s+=H(l),(!i||m.length>0)&&(s+="=")),_&&(s+=o?F(_):H(_),s+=c?"=":",",m&&(s+=o?F(m):H(m))),a=!1,d=!1);else f(String(e))}if("}"===e.charAt(r++))break;l="",d=!0}else l+=e.charAt(r++)}}else k(e.substr(r))?(s+=e.substr(r,3),r+=3):s+=V(e.charAt(r++),X);var _,m;return s};function W(e){return(new TextEncoder).encode(e)}const q=/^([^:]+):(.*)$/,z=/^\s+|\s+$/g,G=(e,t,r)=>h(t)?new a.DCXError(a.DCXError.INVALID_PARAMS,`Param '${e}' type must be one of: [${t.join(",")}].${r&&r.length>0?" Possible values: "+r.join(", ")+".":""}`):new a.DCXError(a.DCXError.INVALID_PARAMS,`Param '${e}' must be of type '${t}'.${r&&r.length>0?" Possible values: "+r.join(", ")+".":""}`),K=(e,t,r,s=!1,o=[])=>{if(s&&null==t)return!0;if(h(r)){for(const n in r){const i=r[n];try{return K(e,t,i,s,o),!0}catch(e){}}throw G(e,r,o)}if("null"===r&&null!==t||"undefined"===r&&void 0!==t||"nullish"===r&&null!=t)throw G(e,r,o);if("null"===r||"undefined"===r||"nullish"===r)return!0;if(!s&&null==t)throw G(e,r,o);if(r.endsWith("[]")){if(!h(t))throw G(e,r,o);return t.forEach((t,s)=>{K(`${e}[${s}]`,t,r.substr(0,r.length-2))}),!0}let n=r.toLowerCase();switch(r){case"integer":case"+number":case"-number":n="number"}if("array"===n){if(!h(t))throw G(e,r,o)}else if("enum"!==n){if(typeof t!==n)throw G(e,r,o);if("integer"===r&&("number"!=typeof t||!Number.isInteger(t)))throw G(e,r,o);if("+number"===r&&("number"!=typeof t||t<0))throw G(e,r,o);if("-number"===r&&("number"!=typeof t||t>0))throw G(e,r,o)}if(o.length>0){const s=o.length;let n=!1;for(let e=0;e<s;e++)if(o[e]===t){n=!0;break}if(!n)throw G(e,r,o)}return!0};function $(...e){return e.map(e=>K(...e))}function J(e,t){const r={};for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&void 0!==e[s]&&(r[s]=1);for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&void 0!==t[s]&&delete r[s];return Object.keys(r)}function Z(e,t){return{operations:e.operations.concat(t),cost:e.cost+1}}function Q(e,t,r,s=Q){if(e===t)return[];const o=h(e),n=h(t);return o&&n?function(e,t,r,s){const o={"0,0":{operations:[],cost:0}},n=isNaN(e.length)||e.length<=0?0:e.length,i=isNaN(t.length)||t.length<=0?0:t.length,a=function r(n,i){const a=`${n},${i}`;let d=o[a];if(void 0===d){if(n>0&&i>0&&!s(e[n-1],t[i-1],new re).length)d=r(n-1,i-1);else{const s=[];if(n>0){const e=r(n-1,i),t={op:"remove",index:n-1};s.push(Z(e,t))}if(i>0){const e=r(n,i-1),o={op:"add",index:n-1,value:t[i-1]};s.push(Z(e,o))}if(n>0&&i>0){const o=r(n-1,i-1),a={op:"replace",index:n-1,original:e[n-1],value:t[i-1]};s.push(Z(o,a))}d=s.sort((e,t)=>e.cost-t.cost)[0]}o[a]=d}return d}(n,i).operations,[d]=a.reduce(([e,t],o)=>{if(function(e){return"add"===e.op}(o)){const s=o.index+1+t,i=s<n+t?String(s):"-",a={op:o.op,path:r.add(i).toString(),value:o.value};return[e.concat(a),t+1]}if(function(e){return"remove"===e.op}(o)){const s={op:o.op,path:r.add(String(o.index+t)).toString()};return[e.concat(s),t-1]}const i=r.add(String(o.index+t)),a=s(o.original,o.value,i);return[e.concat(...a),t]},[[],0]);return d}(e,t,r,s):!o&&!n&&c(e)&&c(t)?function(e,t,r,s){const o=[];return J(e,t).forEach(e=>{o.push({op:"remove",path:r.add(e).toString()})}),J(t,e).forEach(e=>{o.push({op:"add",path:r.add(e).toString(),value:t[e]})}),function(e){const t=e.length,r={};for(let s=0;s<t;s++){const t=e[s];for(const e in t)Object.prototype.hasOwnProperty.call(t,e)&&void 0!==t[e]&&(r[e]=(r[e]||0)+1)}for(const s in r)r[s]<t&&delete r[s];return Object.keys(r)}([e,t]).forEach(n=>{o.push(...s(e[n],t[n],r.add(n)))}),o}(e,t,r,s):[{op:"replace",path:r.toString(),value:t}]}function ee(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function te(e){return e.replace(/~/g,"~0").replace(/\//g,"~1")}class re{constructor(e=[""]){this.tokens=e}static fromJSON(e){const t=e.split("/").map(ee);if(""!==t[0])throw new a.DCXError(a.DCXError.INVALID_DATA,`Invalid JSON Pointer: ${e}`);return new re(t)}toString(){return this.tokens.map(te).join("/")}evaluate(e){let t=null,r="",s=e;for(let o=1,n=this.tokens.length;o<n;o++)t=s,r=this.tokens[o],s=(t||{})[r];return{parent:t,key:r,value:s}}get(e){return this.evaluate(e).value}set(e,t){let r=e;for(let s=1,o=this.tokens.length-1,n=this.tokens[s];s<o;s++)r=(r||{})[n];r&&(r[this.tokens[this.tokens.length-1]]=t)}push(e){this.tokens.push(e)}add(e){const t=this.tokens.concat(String(e));return new re(t)}}class se{constructor(e=[]){this._operations=e}get operations(){return this._operations}getDocument(){return JSON.stringify(this._operations)}add(e,t){return $(["path",e,"string"]),this._operations.push({op:"add",path:e,value:t}),this}addToList(e,t,r){if($(["path",e,"string"]),"number"!=typeof r&&"end"!==r&&"-"!==r)throw new a.DCXError(a.DCXError.INVALID_PARAMS,'Index must be a number, or either "end"/"-" to append to end.');return this._operations.push({op:"add",value:t,path:`${e.endsWith("/")?e:e+"/"}${"end"===r?"-":r}`}),this}remove(e){return $(["path",e,"string"]),this._operations.push({op:"remove",path:e}),this}replace(e,t){return $(["path",e,"string"]),this._operations.push({op:"replace",path:e,value:t}),this}move(e,t){return $(["source",e,"string"],["destination",t,"string"]),this._operations.push({op:"move",from:e,path:t}),this}copy(e,t){return $(["source",e,"string"],["destination",t,"string"]),this._operations.push({op:"copy",from:e,path:t}),this}}function oe(e,t){return{property:e,issue:t}}function ne(e){const t=[];if("object"!=typeof e||null==e||h(e))return t.push(oe("*","Operation not an object.")),t;switch("string"!=typeof e.path&&t.push(oe("path","Missing or invalid.")),e.op){case"remove":break;case"add":case"replace":null==e.value&&t.push(oe("value","Missing or invalid. Required for add/replace."));break;case"move":case"copy":"string"!=typeof e.from&&t.push(oe("from","Missing or invalid. Required for move/copy."));break;default:t.push(oe("op","Missing or invalid."))}return!(t.length>0)||t}function ie(e){if(!c(e))throw new Error("Expecting object");const t={};for(const r in e)null!=e[r]&&(t[r]=e[r]);return t}const ae=/^utf-?8|ascii|utf-?16-?le|ucs-?2|base-?64|latin-?1$/i,de=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,ce=/\s|\uFEFF|\xA0/,le=/\r?\n[\x20\x09]+/g,he=/[;,"]/,ue=/[;,"]|\s/,pe=1,fe=2,_e=4;function me(e){return e.replace(de,"")}function ge(e){return ce.test(e)}function Ee(e,t){for(;ge(e[t]);)t++;return t}function Ae(e){return ue.test(e)}class Ce{constructor(e){this.refs=[],e&&this.parse(e)}rel(e){const t=[];for(let r=0;r<this.refs.length;r++)this.refs[r].rel===e&&t.push(this.refs[r]);return t}get(e,t){e=e.toLowerCase();const r=[];for(let s=0;s<this.refs.length;s++)this.refs[s][e]===t&&r.push(this.refs[s]);return r}set(e){return this.refs.push(e),this}has(e,t){e=e.toLowerCase();for(let r=0;r<this.refs.length;r++)if(this.refs[r][e]===t)return!0;return!1}parse(e,t=0){let r=t?e.slice(t):e;r=me(r).replace(le,"");let s=pe;const o=r.length;let n=0,i=null;for(;n<o;)if(s===pe){if(ge(r[n])){n++;continue}if("<"!==r[n])throw new Error('Unexpected character "'+r[n]+'" at offset '+n);{const e=r.indexOf(">",n);if(-1===e)throw new Error("Expected end of URI delimiter at offset "+n);i={uri:r.slice(n+1,e)},this.refs.push(i),n=e,s=fe}n++}else if(s===fe){if(ge(r[n])){n++;continue}if(";"===r[n])s=_e,n++;else{if(","!==r[n])throw new Error('Unexpected character "'+r[n]+'" at offset '+n);s=pe,n++}}else{if(s!==_e)throw new Error('Unknown parser state "'+s+'"');{if(";"===r[n]||ge(r[n])){n++;continue}const e=r.indexOf("=",n);if(-1===e)throw new Error("Expected attribute delimiter at offset "+n);const t=me(r.slice(n,e)).toLowerCase();let a="";if(n=e+1,n=Ee(r,n),'"'===r[n])for(n++;n<o;){if('"'===r[n]){n++;break}"\\"===r[n]&&n++,a+=r[n],n++}else{let e=n+1;for(;!he.test(r[e])&&e<o;)e++;a=r.slice(n,e),n=e}if(i&&i[t]&&ye(t));else if(i&&"*"===t[t.length-1])i[t]=ve(a);else if(a="rel"===t||"type"===t?a.toLowerCase():a,i&&null!=i[t]){const e=i[t];h(e)?e.push(a):i[t]=[i[t],a]}else{if(!i)throw new Error("Unexpected null ref");i[t]=a}switch(r[n]){case",":s=pe;break;case";":s=_e}n++}}return i=null,this}toString(){const e=[];let t,r="";for(let s=0;s<this.refs.length;s++)t=this.refs[s],r=Object.keys(this.refs[s]).reduce((function(e,r){return"uri"===r?e:e+"; "+be(r,t[r])}),"<"+t.uri+">"),e.push(r);return e.join(", ")}}const De=e=>ae.test(e),ye=e=>"rel"===e||"type"===e||"media"===e||"title"===e||"title*"===e,Ie=e=>e.replace(/"/g,'\\"'),ve=e=>{const t=/([^']+)?(?:'([^']+)')?(.+)/.exec(e)||[];return{language:t[2].toLowerCase(),encoding:De(t[1])?null:t[1].toLowerCase(),value:De(t[1])?decodeURIComponent(t[3]):t[3]}},be=(e,t)=>Array.isArray(t)?t.map(t=>be(e,t)).join("; "):"*"===e[e.length-1]||"string"!=typeof t?((e,t)=>{const r=(t.encoding||"utf-8").toUpperCase(),o=t.language||"en";let n="";return n=s.isBuffer(t.value)&&De(r)?t.value.toString(r):s.isBuffer(t.value)?t.value.toString("hex").replace(/[0-9a-f]{2}/gi,"%$1"):encodeURIComponent(t.value),e+"="+r+"'"+o+"'"+n})(e,t):((e=>"rel"===e||"type"===e||"anchor"===e)(e)?t=Ae(t)?'"'+Ie(t)+'"':Ie(t):Ae(t)&&(t='"'+(t=(t=encodeURIComponent(t)).replace(/%20/g," ").replace(/%2C/g,",").replace(/%3B/g,";"))+'"'),e+"="+t);function Te(e,t,r,s="id"){const o=Oe(e)[t];if(o){if(Array.isArray(o)){const e=o.filter(e=>e.mode===s);return e.length>0?e[0][r]:o.length>0?o[0][r]:void 0}return o[r]}}function Pe(e,t,r="id"){const s=Oe(e),o=s[t];let n;if(c(o)&&"string"==typeof o.href?n=o.href:Array.isArray(o)&&(n=Te(s,t,"href",r)),"string"!=typeof n)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Missing or invalid link href.");return n}function we(e,t,r,s="id"){const o=Pe(Oe(e),t,s);return Y(o,ie(r))}const Re=(e,t=0)=>(new Ce).parse(e,t);function Oe(e){let t=e;return c(t)?(c(e._links)?t=e._links:c(e.links)&&(t=e.links),t):{}}var ke=Object.freeze({__proto__:null,Link:Ce,getLinkProperty:Te,getLinkHref:Pe,getLinkHrefTemplated:we,parse:Re});let Le;const Se=()=>{if(Le)return Le;const t=u();return Le=t&&c(e.performance)&&l(e.performance.now)?e.performance:t&&c(e.perf_hooks)&&c(e.perf_hooks.performance)&&l(e.perf_hooks.performance.now)?e.perf_hooks.performance:p()&&c(self.performance)&&l(self.performance.now)?self.performance:Date,Le};class Ne{constructor(e){this._canceled=!1,this._done=!1;const t=function(e){if("browser"===e){let t;const r=new ReadableStream({start(e){t=e}},{highWaterMark:10485760});return{controller:t,platform:e,stream:r}}}(e),{platform:r,stream:s}=t;this._platform=r,this._stream=s,"browser"===t.platform?this._browserController=t.controller:(t.stream.on("close",()=>{this._resolve()}),t.stream.on("end",()=>{this._done=!0,this._resolve()}),t.stream.on("error",e=>{a.isAdobeDCXError(e)||(e=new a.AdobeDCXError(a.AdobeDCXError.UNEXPECTED,"Unexpected stream error.",e)),this._reject(e)})),this._donePromise=new Promise((e,t)=>{this._reject=t,this._resolve=e})}get underlyingStream(){return this._stream}get platform(){return this._platform}get _writable(){return Promise.resolve()}whenDone(){return this._donePromise}pipe(e){return"node"===this._platform?this._stream.pipe(e):(this._stream.pipeTo(e).then(e=>{this._done=!0,this._resolve()}),e)}read(e){if(this._canceled)throw new a.AdobeDCXError(a.AdobeDCXError.ABORTED,"Stream was aborted.");if(this._error)throw new a.AdobeDCXError(a.AdobeDCXError.INVALID_STATE,"Stream is in error state.",this._error);if("node"===this._platform){const t=this._stream;return new Promise((r,s)=>{let i,a=t.read(e);if(a)return r({done:this._done,value:a});if(this._done)return r({done:this._done,value:void 0});const d=e=>(h(),s(e)),c=()=>{if(a=t.read(e),!a)return this._done?l(!0):void(i=o(c));l(this._done)},l=(e=!0)=>(h(),r({value:a,done:e}));function h(){t.off("readable",c),t.off("error",d),n(i)}t.on("readable",c),t.on("error",d)})}const t=this._stream;if(t.locked)throw new a.AdobeDCXError(a.AdobeDCXError.INVALID_STATE,"Reader already holds lock.");const r=t.getReader();return r.read().then(({done:e,value:t})=>(r.releaseLock(),e&&(this._done=!0,this._resolve()),{done:e,value:t}))}_push(e){return null===e?(this._end(),Promise.resolve(!0)):"on"in this._stream?(this._stream.push(e),this._writable.then(()=>!1)):(this._browserController.enqueue(e),this._writable.then(()=>!1))}_end(){"on"in this._stream?this._stream.push(null):(this._browserController.close(),this._done=!0,this._resolve())}_close(){"on"in this._stream?this._stream.push(null):(this._browserController.close(),this._done=!0,this._resolve())}_destroy(){if("on"in this._stream)return this._stream.destroy();this._browserController.close(),this._resolve()}_cancel(){if(this._canceled=!0,this._error=new a.AdobeDCXError(a.AdobeDCXError.ABORTED,"Stream aborted."),"on"in this._stream)return this._stream.destroy(this._error);this._browserController.error(this._error),this._reject(this._error)}}const Me=ke;t.EventEmitter=class{constructor(e){this._handlers={},e.forEach(e=>{this._handlers[e]=[]})}on(e,t){return this._handlers[e].push(t)-1}emit(e,t){this._handlers[e].forEach(e=>{l(e)&&e(...t)})}removeHandler(e,t){delete this._handlers[e][t]}removeAllHandlers(e){e?this._handlers[e]=[]:this._handlers={}}},t.JSONPatchPointer=re,t.Link=Ce,t.LinkUtils=Me,t.SDKType=f,t.WatchProxy=function(e){if(e.__watch_proxy__)return e;if("watchProperty"in e)throw new Error("Cannot proxy object, watchProperty already exists.");let t={};const r=((e,r)=>{t[e]=t[e]||[],t[e].push(r)}).bind({listeners:t}),s={set:function(e,r,s){try{r in t&&h(t[r])&&t[r].map(t=>t.call(void 0,s,e[r],e))}catch(e){throw e}return e[r]=s,!0}},{proxy:o,revoke:n}=Proxy.revocable(e,s);return Object.defineProperty(o,"__watch_proxy__",{value:!0,enumerable:!1,configurable:!0}),Object.defineProperty(o,"revokeWatchProxy",{value:()=>(n(),t={},delete e.__watch_proxy__,delete e.revokeWatchProxy,delete e.watchProperty,e),enumerable:!1,configurable:!0}),Object.defineProperty(o,"watchProperty",{value:r,enumerable:!1,configurable:!0}),o},t._toUTF8Array=B,t.appendPathElements=(...e)=>{if(!e||!Array.isArray(e))return"";const t=[],r=e.length;for(let s=0;s<r;s++){let o=e[s];"string"==typeof o&&""!==o&&(0===s&&1!==o.length||"/"===o.charAt(0)&&(o=o.slice(1)),s!==r-1&&"/"===o.charAt(o.length-1)&&(o=o.slice(0,o.length-1)),t.push(o))}return t.join("/")},t.arrayBufferToString=function(e,t){return e?(null!=t&&(e=e.slice(0,t)),(new TextDecoder).decode(e)):""},t.assert=(e,t)=>{if(!1===e())throw new a.DCXError(a.DCXError.INVALID_PARAMS,t)},t.cleanEtag=e=>"string"!=typeof e?e:e.startsWith("W/")?e.split("W/")[1]:e,t.combineInPlace=function(...e){if(e.length<2)return;const t=e.shift();_(t,...e),e.map(e=>{Object.assign(t,e)})},t.concatUint8Arrays=function(e,t){const r=new Uint8Array(e.length+t.length);return r.set(e,0),r.set(t,e.length),r},t.consumeStream=(e,t,r)=>{e.on("data",r||A),e.on("end",t||A)},t.createJSONPatch=function(e,t,r){const s=new re;return(r?function(e){return function t(r,s,o){const n=e(r,s,o);return h(n)?n:Q(r,s,o,t)}}(r):Q)(e,t,s)},t.createPatchDocumentBuilder=function(e){return new se(e)},t.dataToBuffer=function(e){return"string"==typeof e?W(e):e},t.deepCopy=e=>JSON.parse(JSON.stringify(e)),t.endPointOf=e=>{const t=y(e),r=t.scheme,s=t.authority,o="https"===r?443:"http"===r?80:-1;let n;return r&&s&&(n=(r+"://"+s).toLowerCase(),o>=0&&s.indexOf(":")<0&&(n=n+":"+o)),n},t.ensureRelativeHrefStartsWithSlash=e=>{if(e){const t=y(e),r=t.scheme,s=t.authority;r||s||"/"!==e.charAt(0)&&(e="/"+e)}return e},t.escapeURLPath=e=>(String.prototype.normalize?e=e.normalize("NFC"):console.warn("String.normalize not found while escaping URL path. You may be missing a polyfill."),e.length>0&&"/"===e.charAt(0)&&(e=e.substr(1)),V(e,U)),t.expandURITemplate=Y,t.flatCopy=e=>{const t={},r=Object.keys(e),s=r.length;for(let o=0;o<s;o++){const s=r[o];t[s]=e[s]}return t},t.generateUuid=()=>i.v4(),t.getDomainFromURL=e=>{if(!e||"string"!=typeof e)return e;const t=(e=(e=(e=(e=e.indexOf("//")>-1?e.split("/")[2]:e.split("/")[0]).split("?")[0]).split("/")[0]).split(":")[0]).split(".");return t.slice(Math.max(t.length-2,0)).join(".")},t.getLinkHref=Pe,t.getLinkHrefTemplated=we,t.getLinkProperty=Te,t.getPerformance=Se,t.getStartIdxOfMimeType=e=>e?e.search("(text|image|audio|video|ingredient|document|model|application|font)\\/"):-1,t.getSuffixIdxOfMimeType=(e,t)=>e&&t?e.indexOf(t):-1,t.hexVal=L,t.isArray=h,t.isArrayBuffer=e=>c(e)&&l(e.constructor)&&"ArrayBuffer"===e.constructor.name&&l(e.slice),t.isArrayBufferView=e=>c(e)&&l(e.constructor)&&"DataView"===e.constructor.name&&c(e.buffer)&&l(e.buffer.slice),t.isBrowser=p,t.isBrowserSDK=()=>!0,t.isBuffer=e=>c(e)&&l(e.constructor)&&"Buffer"===e.constructor.name&&l(e.slice),t.isDefined=e=>null!=e,t.isFunction=l,t.isHexChar=O,t.isJsonContentType=e=>{if("string"!=typeof e)return!1;const t=e.toLowerCase().split("application/");if(t.length<2)return!1;const r=t[1].split(";")[0].trim();return"json"===r||r.endsWith("+json")},t.isNode=u,t.isNodeReadableStream=e=>d(e)&&l(e.on),t.isObject=c,t.isPctEncoding=k,t.isPromise=e=>null!=e&&c(e)&&l(e.then),t.isReadableStream=d,t.isStreamProvider=e=>c(e)&&(l(e.getStream)||l(e.getStreamAsync)),t.isUndefined=e=>null==e,t.isValidAbsolutePath=e=>E(e,!0),t.isValidAdobeURN=e=>/^urn:aaid:[a-zA-Z]{2}:[a-zA-Z]{2}:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e),t.isValidPath=E,t.isVoid=e=>null==e,t.isWebWorker=()=>p()&&!!self.WorkerGlobalScope,t.merge=_,t.mergeDeep=m,t.newReadableStream=function(){const e=u()?"node":"browser",t=new Ne(e),r=Object.getOwnPropertyDescriptors(t),s=Object.getOwnPropertyDescriptors(Object.getPrototypeOf(t.underlyingStream));for(const o in s)o in t||o in r||Object.defineProperty(t,o,s[o]);return t},t.noOp=A,t.normalizeHeaders=e=>{if(null==e||"object"!=typeof e)return{};const t={},r=Object.keys(e);for(const s in r){const o=r[s],n=e[o];Object.prototype.hasOwnProperty.call(e,o)&&null!=n&&(t[o.toLowerCase()]=h(n)?n.join(";"):n)}return t},t.now=()=>Se().now(),t.objectsEqual=C,t.parse=Re,t.parseHeaders=e=>{const t={},r=e.split(/\r?\n/);let s,o;for(let n=0;n<r.length;++n){const e=r[n];if(e.length>0){const r=e.charCodeAt(0);if(!s||9!==r&&32!==r){const r=q.exec(e);r&&r.length>1&&(s=r[1].toLowerCase(),o=r[2]||"",o=o.replace(z,""),t[s]?t[s]=t[s]+","+o:t[s]=o)}else t[s]=t[s]+" "+e.replace(z,"")}}return t},t.parseURI=y,t.pruneUndefined=ie,t.removeLeadingSlashForPath=e=>(e.length>0&&"/"===e.charAt(0)&&(e=e.substr(1)),e),t.safeGet=function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]},t.stringToBuffer=W,t.timeStamp=(e=!1)=>{let t=(new Date).getTime();return e&&(t-=t%1e3),t},t.validateJSONPatchDocument=function(e){if(!h(e))return[oe("doc","Invalid type.")];const t=[];return e.forEach((e,r)=>{const s=ne(e);!0!==s&&s.forEach(e=>{e.property=`doc[${r}].${e.property}`,t.push(e)})}),!(t.length>0)||t},t.validateJSONPatchOperation=ne,t.validateObject=function(e,t,...r){if(t=t?" "+t+" ":" ",!e||"object"!=typeof e)throw new a.DCXError(a.DCXError.INVALID_PARAMS,`Object${t}is invalid.`);try{r.forEach(t=>{K(t[0],e[t[0]],t[1],t[2]||!1,t[3]||[])})}catch(e){throw new a.DCXError(a.DCXError.INVALID_PARAMS,`Object${t}is invalid. ${e.message.replace("Param","Property")}`,e)}},t.validateParam=K,t.validateParams=$}).call(this,r(23),r(10).Buffer,r(312).setImmediate,r(312).clearImmediate)},3078:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s,o,n,i,a,d=r(3793);function c(e,r,s="css"){var o,n,i;d.validateParams(["data",r,"object"]),d.validateObject(r,"data",["composite","object"],["response","object"],["error","object",!0]);const{component:a,error:c,composite:h,branch:u,derivationType:p,isBlockTransferred:f}=r,_=(null===(o=r.error)||void 0===o?void 0:o.response)||r.response;let m,g=!1;switch(e){case t.AnalyticsEvent.CreateComposite:g=!0,m=t.AnalyticsEventSubCategory.Create;break;case t.AnalyticsEvent.PushComposite:g=!0,m=t.AnalyticsEventSubCategory.Push;break;case t.AnalyticsEvent.PullComposite:g=!0,m=t.AnalyticsEventSubCategory.MinPull;break;case t.AnalyticsEvent.PullCompositeVersion:g=!0,m=t.AnalyticsEventSubCategory.VersionPull;break;case t.AnalyticsEvent.DownloadComponent:case t.AnalyticsEvent.UploadComponent:d.validateParams(["component",a,"object"]),d.validateObject(a,"data.component",["type","string"]),m=e===t.AnalyticsEvent.DownloadComponent?t.AnalyticsEventSubCategory.Download:t.AnalyticsEventSubCategory.Upload;break;default:m=t.AnalyticsEventSubCategory.Unknown}g&&d.validateParams(["branch",u,"object",!0]);const E={"env.com.name":"dcx-js","env.svc.name":s,"env.com.version":"5.21.0","event.request_id":_.headers["x-request-id"],"event.cloud_id":h.assetId,"custom.content.repository_id":h.repositoryId,"event.type":t.AnalyticsEventType.Success,"event.category":t.AnalyticsEventCategory.CompositeXfer,"event.subcategory":m},A=null===(n=null==c?void 0:c.underlyingError)||void 0===n?void 0:n.code,C=null===(i=null==c?void 0:c.underlyingError)||void 0===i?void 0:i.message;return c&&(E["event.error_code"]=c.code,E["event.error_desc"]=c.message,E["dcx.underlying_error_code"]=A,E["dcx.underlying_error_desc"]=C,E["event.type"]=t.AnalyticsEventType.Error),m===t.AnalyticsEventSubCategory.Unknown?l(E):g?(E["dcx.num_total_components"]=null==u?void 0:u.allComponents().length,E["custom.content.xmp_derivation_type"]=p,c&&(E["dcx.root_error_desc"]=C),l(E)):(E["content.mimetype"]=a.type,c&&(E["dcx.block_transferred"]=null!=f&&f,E["content.type"]=a.type,E["content.size"]=a.length,E["dcx.component_rel"]=a.relationship),l(E))}function l(e){const t={};for(const r in e){const s=e[r];d.isUndefined(s)||Array.isArray(s)||d.isObject(s)||(t[r]=s)}return t}t.AnalyticsEventType=void 0,(s=t.AnalyticsEventType||(t.AnalyticsEventType={}))[s.Success=0]="Success",s[s.Error=1]="Error",t.AnalyticsEventCategory=void 0,(o=t.AnalyticsEventCategory||(t.AnalyticsEventCategory={}))[o.CompositeXfer=0]="CompositeXfer",t.AnalyticsEventSubCategory=void 0,(n=t.AnalyticsEventSubCategory||(t.AnalyticsEventSubCategory={}))[n.Push=0]="Push",n[n.MinPull=1]="MinPull",n[n.VersionPull=2]="VersionPull",n[n.Upload=3]="Upload",n[n.Download=4]="Download",n[n.Create=5]="Create",n[n.Unknown=6]="Unknown",t.AnalyticsEvent=void 0,(i=t.AnalyticsEvent||(t.AnalyticsEvent={})).PushComposite="analyticsPush",i.CreateComposite="analyticsCreate",i.PullComposite="analyticsPull",i.PullCompositeVersion="analyticsPullVersion",i.UploadComponent="analyticsUpload",i.DownloadComponent="analyticsDownload",i.All="*",t.LogLevel=void 0,(a=t.LogLevel||(t.LogLevel={}))[a.Deprecated=0]="Deprecated",a[a.Error=1]="Error",a[a.Warn=2]="Warn",a[a.Log=3]="Log",a[a.Debug=4]="Debug";const h={[t.LogLevel.Deprecated]:"error",[t.LogLevel.Error]:"error",[t.LogLevel.Log]:"log",[t.LogLevel.Warn]:"warn",[t.LogLevel.Debug]:"debug"};class u extends d.EventEmitter{constructor(e){super([t.AnalyticsEvent.CreateComposite,t.AnalyticsEvent.UploadComponent,t.AnalyticsEvent.PushComposite,t.AnalyticsEvent.PullComposite,t.AnalyticsEvent.PullCompositeVersion,t.AnalyticsEvent.DownloadComponent]),this._logLevel=t.LogLevel.Warn,this._prevDebugTime=d.now(),this._debugFormatter=(e,t,r,s)=>`[${e} (+${(1e3*(t-r)).toFixed(0)})] ${s.map(e=>"string"==typeof e?e:JSON.stringify(e)).join(" ")}`,this._debugNamespaces=[],this._debugSkips=[],this.suppressDeprecationWarnings=!1,e&&(this._logCallback=e),this._initNamespaces()}get debugNamespaces(){return this._debugNamespaces}get debugSkips(){return this._debugSkips}set logLevel(e){if(!Object.values(t.LogLevel).includes(e))throw new Error(`Invalid LogLevel, must be one of: ${Object.values(t.LogLevel).join(", ")}.`);this._logLevel=e}get logLevel(){return this._logLevel}on(e,r){if(e!==t.AnalyticsEvent.All)return super.on(e,r);const s=Object.values(t.AnalyticsEvent);let o;for(let t=0,n=s.length;t<n;t++){const e=s[t];o=super.on(e,r)}return o}static getInstance(){return null==u._instance&&(u._instance=new u),u._instance}static newLogger(e){return new u(e)}set logCallback(e){this._logCallback=e}get logCallback(){return this._logCallback}_initNamespaces(){d.isNode()?this.setDebugNamespaces(Object({NODE_ENV:"production",APP_ENV:"browser"}).DCX_DEBUG||""):d.isObject(globalThis)&&d.isObject(globalThis.dcxjs)&&this.setDebugNamespaces(globalThis.dcxjs.debug||""),this._debugNamespaces.length>0&&(this._logLevel=t.LogLevel.Debug)}_log(e,r,s){try{if(e===u.LEVEL_DEPRECATED)!this.suppressDeprecationWarnings&&this._logLevel>=e&&console.warn(...s);else if("function"==typeof this._logCallback&&this._logLevel>=e)this._logCallback.call(void 0,...s);else if(this._logLevel>=e)if(e===t.LogLevel.Debug){if(this._debugEnabled(r)){const e=this._prevDebugTime;this._prevDebugTime=d.now(),(console.debug||console.log)(this._debugFormatter(r,this._prevDebugTime,e,s))}}else console[h[e]](...s)}catch(d){}}log(...e){this._log(t.LogLevel.Log,void 0,e)}warn(...e){this._log(t.LogLevel.Warn,void 0,e)}error(...e){this._log(t.LogLevel.Error,void 0,e)}deprecated(...e){this._log(t.LogLevel.Deprecated,void 0,e)}_debugEnabled(e){if("*"===e[e.length-1])return!0;let t,r;for(t=0,r=this._debugSkips.length;t<r;t++)if(this._debugSkips[t].test(e))return!1;for(t=0,r=this._debugNamespaces.length;t<r;t++)if(this._debugNamespaces[t].test(e))return!0;return!1}setDebugFormatter(e){this._debugFormatter=e}setDebugNamespaces(e){let t;this._debugNamespaces=[],this._debugSkips=[];const r=("string"==typeof e?e:"").split(/[\s,]+/),s=r.length;for(t=0;t<s;t++)r[t]&&("-"===(e=r[t].replace(/\*/g,".*?"))[0]?this._debugSkips.push(new RegExp("^"+e.substr(1)+"$")):this._debugNamespaces.push(new RegExp("^"+e+"$")))}Debug(e){return(...r)=>{this._log(t.LogLevel.Debug,e,r)}}}u.LEVEL_DEBUG=t.LogLevel.Debug,u.LEVEL_LOG=t.LogLevel.Log,u.LEVEL_WARN=t.LogLevel.Warn,u.LEVEL_ERROR=t.LogLevel.Error,u.LEVEL_DEPRECATED=t.LogLevel.Deprecated;const p=()=>{const e=f();return void 0!==e._logCallback?e:u.getInstance()},f=()=>{if("object"==typeof globalThis&&"object"==typeof globalThis.dcxjs&&globalThis.dcxjs.logger&&globalThis.dcxjs.logger.getInstance)return globalThis.dcxjs.logger.getInstance();const e=()=>{};return{log:e,warn:e,error:e,deprecated:e,debug:e,newLogger:f}};var _=p();t.AdobeDCXLogger=u,t.default=_,t.emitAnalyticsEvent=(e,t)=>{const r=p(),s=c(e,t);try{r.emit(e,[s])}catch(e){r.error("Error in analytics hook: ",e)}},t.getGlobalLogger=f,t.getGlobalOrLocalLogger=p,t.log=(...e)=>{const t=p();e.forEach(t.log.bind(t))},t.makeAnalyticsEvent=c,t.newDebug=e=>p().Debug(e),t.setLogCallback=e=>{f().logCallback=e}},3079:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=r(2786);const o=e=>"[object Function]"===toString.call(e);const n=class{constructor(e,t){return this._promise=null,this._props={},this._registeredProps=[],this._handlers={cancel:[]},this._done=!1,this._canceled=!1,this._internalKeys=[],this.name="AdobePromise",this._internalKeys=[...Object.keys(this),...Object.keys(Object.getOwnPropertyDescriptors(Object.getPrototypeOf(this))),"_cancelReason"],t&&"object"==typeof t&&this._setProps(t),this._promise=new Promise((t,r)=>e.call(this,e=>{this._done||(this._done=!0,t(e))},e=>{this._done||(this._done=!0,r(e))},this._registerCancelHandler.bind(this))),new Proxy(this,{set:function(e,t,r){if(e._internalKeys.includes(t)){if(!["_promise","_canceled","_cancelReason","_props","_registeredProps"].includes(t))throw new Error("Cannot overwrite internal AdobePromise property.");e[t]=r}else e._registeredProps.includes(t)||e._registeredProps.push(t),e.props[t]=r;return!0},get:function(e,t){return"symbol"==typeof t||e._internalKeys.includes(t)?e[t]:e.props[t]}})}get[Symbol.toStringTag](){return this.name}static reject(e,t){return new n((t,r)=>Promise.reject(e).catch(e=>{r&&r(e)}),t)}static resolve(e,t){return new n(t=>{s.isObject(e)&&o(e.then)?e.then(e=>{t(e)}):t(e)},t)}static allSettled(e,t){return 0===e.length?n.resolve([],t):new n(t=>{const r=[];e.map((s,o)=>{s.then(e=>{r[o]={status:"fulfilled",value:e}}).catch(e=>{r[o]={status:"rejected",reason:e}}).then(()=>{r.filter(e=>!!e).length===e.length&&t(r)})})},t)}get canceled(){return this._canceled}getPromise(){return this._promise}_resolveOrReject(e,t){return this._promise.then(r=>this._canceled?t&&t(this._cancelReason):e(r)).catch(e=>t&&t(this._cancelReason||e))}then(e,t){if(null==e&&null==t)return this;const r=new n((e,t,r)=>(r&&r(e=>{this.cancel.call(this,e),t&&t(e)}),this._resolveOrReject.call(this,e,t)),this._props);return r._promise=r.getPromise().then(t=>{const s=e&&e(t);if(s instanceof n){const e=s;this.onCancel(t=>e.cancel(t));for(const t in this.props)null==e.props[t]&&(e.props[t]=this.props[t]);e._setProps(e.props),this._setProps(e.props),r._setProps(e.props)}return s}).catch(t),r}parallel(e,t){return this._promise.then(e,t)}catch(e){return this._promise=this._promise.catch(e),this}finally(e){return this._promise=this._promise.finally(e),this}cancel(e){this._canceled||(this._canceled=!0,this._cancelReason=e,this._callHandlers("cancel",e||new Error("Aborted")))}abort(e){this.cancel(e)}onCancel(e){o(e)&&this._registerCancelHandler(e)}get props(){return this._props}_setProps(e){if(this._props===e)return;this._props=e;const t=[],r=Object.getOwnPropertyDescriptors(n),s=Object.getOwnPropertyDescriptors(Object.getPrototypeOf(e));if(s.constructor.value!==Object)for(const o in s){if(o in r||o in this&&!this._registeredProps.includes(o))continue;t.push(o);const n=s[o],i=Object.assign({},n);delete i.get,delete i.set,(n.get||n.set)&&(delete i.value,delete i.writable,n.get&&(i.get=n.get.bind(e)),n.set&&(i.set=n.set.bind(e))),Object.defineProperty(this,o,i)}for(const o of Object.keys(e))t.push(o),o in r||o in this&&!this._registeredProps.includes(o)||Object.defineProperty(this,o,{get:()=>this._props[o],set:e=>{this._props[o]=e},configurable:!0});return this._registeredProps=t,this}_registerCancelHandler(e){this._handlers.cancel.push(e)}_callHandlers(e,t){this._handlers[e].map(e=>e&&e(t))}_destroy(){this._handlers.cancel=[]}},i=n;t.AdobePromise=i,t.default=n},331:function(e,t){e.exports=function(e){return"string"!=typeof e?e:(/^['"].*['"]$/.test(e)&&(e=e.slice(1,-1)),/["'() \t\n]/.test(e)?'"'+e.replace(/"/g,'\\"').replace(/\n/g,"\\n")+'"':e)}},3578:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var s=r(2785),o=r(3078),n=r(3079),i=r(2786);function a(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var d,c,l,h=a(s),u=a(n);t.HeaderKeys=void 0,(d=t.HeaderKeys||(t.HeaderKeys={})).CONTENT_TYPE="content-type",d.IF_MATCH="if-match",d.IF_NONE_MATCH="if-none-match",t.HTTPMethods=void 0,(c=t.HTTPMethods||(t.HTTPMethods={})).GET="GET",c.PUT="PUT",c.PATCH="PATCH",c.HEAD="HEAD",c.POST="POST",c.DELETE="DELETE",t.LinkRelation=void 0,(l=t.LinkRelation||(t.LinkRelation={})).REPO_METADATA="http://ns.adobe.com/adobecloud/rel/metadata/repository",l.REPOSITORY="http://ns.adobe.com/adobecloud/rel/repository",l.BASE_DIRECTORY="http://ns.adobe.com/adobecloud/rel/directory/base",l.DIRECTORY="http://ns.adobe.com/adobecloud/rel/directory",l.PRIMARY="http://ns.adobe.com/adobecloud/rel/primary",l.RENDITION="http://ns.adobe.com/adobecloud/rel/rendition",l.APP_METADATA="http://ns.adobe.com/adobecloud/rel/metadata/application",l.ID="http://ns.adobe.com/adobecloud/rel/id",l.PATH="http://ns.adobe.com/adobecloud/rel/path",l.PAGE="http://ns.adobe.com/adobecloud/rel/page",l.ACL_POLICY="http://ns.adobe.com/adobecloud/rel/ac/policy",l.ACCESS_CHECK="http://ns.adobe.com/adobecloud/rel/ac/check",l.EFFECTIVE_PRIVILAGES="http://ns.adobe.com/adobecloud/rel/ac/effective",l.BULK_REQUEST="http://ns.adobe.com/adobecloud/rel/bulk",l.BLOCK_UPLOAD_INIT="http://ns.adobe.com/adobecloud/rel/block/init",l.DISCARD="http://ns.adobe.com/adobecloud/rel/discard",l.RESTORE="http://ns.adobe.com/adobecloud/rel/restore",l.EMBEDDED_METADATA="http://ns.adobe.com/adobecloud/rel/metadata/embedded",l.VERSION_HISTORY="version-history",l.MANIFEST="http://ns.adobe.com/adobecloud/rel/manifest",l.COMPONENT="http://ns.adobe.com/adobecloud/rel/component",l.REPO_OPS="http://ns.adobe.com/adobecloud/rel/ops",l.RESOLVE_BY_ID="http://ns.adobe.com/adobecloud/rel/resolve/id",l.RESOLVE_BY_PATH="http://ns.adobe.com/adobecloud/rel/resolve/path",l.CREATE="http://ns.adobe.com/adobecloud/rel/create",l.ANNOTATIONS="http://ns.adobe.com/adobecloud/rel/annotations",l.BLOCK_DOWNLOAD="http://ns.adobe.com/adobecloud/rel/download",l.BLOCK_EXTEND="http://ns.adobe.com/adobecloud/rel/block/extend",l.BLOCK_TRANSFER="http://ns.adobe.com/adobecloud/rel/block/transfer",l.BLOCK_FINALIZE="http://ns.adobe.com/adobecloud/rel/block/finalize";const p="application/vnd.adobecloud.directory+json",f="application/vnd.adobecloud.bulk-transfer+json";var _,m,g,E,A,C;t.Properties=void 0,(_=t.Properties||(t.Properties={})).DC_FORMAT="dc:format",_.DC_TITLE="dc:title",_.LINKS="_links",_.PAGE="_page",_.CHILDREN="children",_.EMBEDDED="_embedded",_.REPO_ASSET_ID="repo:assetId",_.REPO_REPOSITORY_ID="repo:repositoryId",_.REPO_REPOSITORY_TYPE="repo:repositoryType",_.REPO_BASE_ASSET_ID="repo:baseAssetId",_.REPO_SIZE="repo:size",_.REPO_NAME="repo:name",_.REPO_PATH="repo:path",_.REPO_ASSET_CLASS="repo:assetClass",_.REPO_CREATE_DATE="repo:createDate",_.REPO_MODIFY_DATE="repo:modifyDate",_.REPO_DISCARD_DATE="repo:discardDate",_.REPO_ETAG="repo:etag",_.REPO_CREATED_BY="repo:createdBy",_.REPO_MODIFIED_BY="repo:modifiedBy",_.REPO_DISCARDED_BY="repo:discardedBy",_.REPO_DEVICE_CREATE_DATE="storage:deviceCreateDate",_.REPO_DEVICE_MODIFY_DATE="storage:deviceModifyDate",_.REPO_VERSION="repo:version",_.REPO_STATE="repo:state",_.REPO_AVAILABLE_REGIONS="repo:availableRegions",_.REPO_REGIONS="repo:regions",_.REPO_OWNER="repo:owner",_.REPO_OWNER_ID="id",_.REPO_OWNER_TYPE="type",_.STORAGE_ASSIGNEE="storage:assignee",_.STORAGE_ASSIGNEE_ID="id",_.STORAGE_ASSIGNEE_TYPE="type",_.IMAGE_LENGTH="tiff:imageLength",_.IMAGE_WIDTH="tiff:imageWidth",_.NUM_OF_PAGES="xmpTPg:NPages",_.PAGE_START="start",_.PAGE_ORDER_BY="orderBy",_.PAGE_NEXT="next",_.PAGE_COUNT="count",_.PAGE_LIMIT="limit",t.VersionProperties=void 0,(m=t.VersionProperties||(t.VersionProperties={})).REPO_ID="repo:id",m.CREATED="created",m.CREATED_BY="created_by",m.MILESTONE="milestone",m.VERSION="version",m.TOTAL_CHILDREN="total_children",t.PolicyProperties=void 0,(g=t.PolicyProperties||(t.PolicyProperties={})).REPO_ACL="repo:acl",g.REPO_PRINCIPLE="repo:principal",g.REPO_MODIFIER="repo:modifier",g.REPO_PRIVILEGES="repo:privileges",g.REPO_RELATIONS="repo:relations",g.REPO_INHERITANCE="repo:inheritance",t.PolicyPrincipalProperties=void 0,(E=t.PolicyPrincipalProperties||(t.PolicyPrincipalProperties={})).XDM_PROVIDER="xdm:provider",E.ID="@id",E.TYPE="@type",t.XDMProviderProperties=void 0,(t.XDMProviderProperties||(t.XDMProviderProperties={})).ID="@id",t.EmbeddedMetadataMediaTypes=void 0,(A=t.EmbeddedMetadataMediaTypes||(t.EmbeddedMetadataMediaTypes={})).XML="application/rdf+xml",A.JSON="application/ld+json",t.BlockTransferProperties=void 0,(C=t.BlockTransferProperties||(t.BlockTransferProperties={})).REPO_SIZE="repo:size",C.REPO_BLOCK_SIZE="repo:blocksize",C.REPO_REL_TYPE="repo:reltype",C.COMPONENT_ID="component_id",C.DC_FORMAT="dc:format",C.REPO_MD5="repo:md5",C.REPO_EXPIRES="repo:expires",C.REPO_IF_MATCH="repo:if-match",C.MAX_SINGLE_TRANSFER_SIZE="repo:maxSingleTransferSize",C.REPO_MIN_BLOCK_TRANSFER_SIZE="repo:minBlockTransferSize";const D=["buffer","arraybuffer","string","text","blob","json","stream","defaultbuffer"];function y(e){return!!i.isObject(e)&&"headers"in e&&"responseType"in e&&"statusCode"in e&&"xhr"in e}function I(e){return!!i.isObject(e)&&y(e.response)}function v(e){return!!i.isObject(e)&&I(e)&&"result"in e}function b(e){return i.isObject(e)&&i.isFunction(e.slice)}function T(e){return!!i.isObject(e)&&("string"==typeof e.repositoryId&&"string"==typeof e.path||"string"==typeof e.assetId)}function P(e){return i.isObject(e)&&("AdobeHTTPService"===e.name||i.isFunction(e.invoke))}function w(e){return i.isObject(e)&&P(e.service)}function R(e){if(!i.isObject(e))return!1;const r=e[t.Properties.LINKS];return!!i.isObject(r)&&!!(r[t.LinkRelation.BLOCK_TRANSFER]&&r[t.LinkRelation.BLOCK_EXTEND]&&r[t.LinkRelation.BLOCK_FINALIZE])}const O=o.newDebug("dcx:assets:service"),k=e=>w(e)?e.service:e,L=e=>w(e)?e.cache:void 0;function S(e,t){O("constructServiceEndpoint()",e);const r=t._repoAPIBaseUrl;return r&&(e=`${r.endsWith("/")?r.substr(0,r.length-1):r}${e}`),O("cSE()",e),e}const N={400:"Bad request",401:"Unauthorized",403:"Forbidden",404:"Not found",409:"Already exists",412:"Precondition failed",501:"Not implemented",507:"Exceeds quota"},M=(e,t)=>{if(!e)return new h.default("UNEXPECTED_RESPONSE","Invalid or missing status code",void 0,t);if(e<300&&e>199)return!0;const r=N[e]||"Unexpected response";switch(e){case 400:return new h.default("UNEXPECTED_RESPONSE",r,void 0,t);case 401:return new h.default("UNAUTHORIZED",r,void 0,t);case 403:return new h.default("FORBIDDEN",r,void 0,t);case 404:return new h.default("NOT_FOUND",r,void 0,t);case 409:return new h.default("ALREADY_EXISTS",r,void 0,t);case 412:return new h.default("PRECONDITION_FAILED",r,void 0,t);case 501:return new h.default("NOT_IMPLEMENTED",r,void 0,t);case 507:return new h.default("EXCEEDS_QUOTA",r,void 0,t)}return!1},X=(e,t,r)=>{if(null==t&&null==r&&null==e)return M;const s=r||{},o=t||{},n=e||[];return(e,t)=>{if(!e)return new h.default("UNEXPECTED_RESPONSE","Invalid or missing status code",void 0,t);if(n.includes(e))return!0;const r=o[e]||N[e]||"Unexpected response",a=s[e],d=M(e,t);return!0===d&&null==a||(i.isObject(d)?new h.default(a||d.code,r,void 0,t):!!a&&new h.default(a,r,void 0,t))}},x=(e,t=[],r,s)=>{if(!i.isObject(e))throw new h.default(r||h.default.INVALID_PARAMS,s||"Missing or invalid links on Asset");t.map(t=>{if(!(t in e&&i.isObject(e[t])))throw new h.default(r||h.default.INVALID_PARAMS,s||`Missing required link: ${t}`)})},U=(e={},t=[])=>{if(0!==t.length){for(let r=0;r<t.length;r++){const s=t[r];if(s in e&&i.isObject(e[s]))return s}throw new h.default(h.default.INVALID_PARAMS,`Missing links, one required: ${t.join(", ")}`)}},j=(e,t,r,s)=>{const o=i.getLinkProperty(e,t,r);if(!o)throw new h.default(h.default.INVALID_DATA,`Missing ${r} param on Link`);if(o!==s)throw new h.default(h.default.INVALID_DATA,`Invalid ${r} param on Link, expected ${s}`)},B=(e,t=[])=>{try{x(e,t)}catch(e){return!1}return!0},V=(e,t=[])=>B(e.links||e._links,t);function H(e){if(!T(e))throw new h.default(h.default.INVALID_PARAMS,"Asset must contain links or repositoryId + path or assetId to be resolved.")}function F(e,t,r){if(!i.isObject(e))throw new h.default(h.default.INVALID_PARAMS,`Invalid parameter. Expected object, encountered "${null===e?"null":typeof e}".`);if(!(t in e))throw new h.default(h.default.INVALID_PARAMS,`Invalid parameter object. Expected object containing key "${t}".`);if(r)try{i.validateParam(t,e[t],r)}catch(i){throw new h.default(h.default.INVALID_PARAMS,`Invalid parameter object. Expected object containing key "${t}" with type "${r}", encountered type "${typeof e[t]}".`)}}function Y(e,t,r){if(!(t.length<1)){for(const s of t)try{return void F(e,s,r)}catch(e){}throw new h.default(h.default.INVALID_PARAMS,`Invalid parameter object. Expected object containing one of [${t.join(", ")}]`+(r?` with type ${r}, encountered types [${t.map(t=>typeof e[t]).join(", ")}].`:"."))}}const W=o.newDebug("dcx:assets:util:http");function q(e,r,s){return W("headHTTPResource()"),k(e).invoke(t.HTTPMethods.HEAD,r,s,void 0,{isStatusValid:X()})}function z(e,r,s,o){return k(e).invoke(t.HTTPMethods.GET,r,s,void 0,{isStatusValid:X(),responseType:o})}const G=o.newDebug("dcx:assets:util:link");function K(e){G("getIndexLinks()");const t=k(e),r=L(e);if(r){const e=r.getIndexLinks();if(e)return u.default.resolve(e);r.setPending("INDEX")}return q(t,S("/",t)).then(e=>J(e)).then(e=>(r&&r.setIndexLinks(e),e)).catch(e=>{throw r&&r.delete("INDEX"),e})}function $(e){G("getIndexDocument()");const r=k(e),s=L(e);if(s){const e=s.getIndexRepository();if(e)return e}const o=S("/",r);return r.invoke(t.HTTPMethods.GET,o,void 0,void 0,{responseType:"json",isStatusValid:X()}).then(e=>{const r=J(e),o=e.response,n={};for(const s in o.children){const e=o.children[s],r=e[t.Properties.LINKS];switch(e[t.Properties.REPO_PATH]){case"/Index.json":n.indexLinks=r;break;case"/Assets.json":n.assetLinks=r;break;case"/Repositories.json":n.repositoryLinks=r}}return s&&(s.setIndexLinks(r),s.setIndexRepository(n)),n})}function J(e){if(!e.headers||!e.headers.link)throw new s.DCXError(s.DCXError.INVALID_DATA,"Failed to parse, missing link header");return Z(e.headers.link)}function Z(e){try{const r=i.parse(e),s={};for(const e in r.refs){const o=r.refs[e],n={};o.uri&&(n.href=o.uri),o.templated&&(n.templated="true"===o.templated),o.type&&(n.type=o.type),o[t.BlockTransferProperties.MAX_SINGLE_TRANSFER_SIZE]&&(n[t.BlockTransferProperties.MAX_SINGLE_TRANSFER_SIZE]=o[t.BlockTransferProperties.MAX_SINGLE_TRANSFER_SIZE]),o[t.BlockTransferProperties.REPO_MIN_BLOCK_TRANSFER_SIZE]&&(n[t.BlockTransferProperties.REPO_MIN_BLOCK_TRANSFER_SIZE]=o[t.BlockTransferProperties.REPO_MIN_BLOCK_TRANSFER_SIZE]),s[o.rel]=n}return Object.assign({},s)}catch(e){throw new s.DCXError(s.DCXError.INVALID_DATA,"Failed to parse, invalid link header",e)}}function Q(e,t){return e=e&&e instanceof te?e:new te,"stream"!==t||i.isObject(e.stream)||(e.stream=i.newReadableStream()),e}function ee(e){if(i.isObject(this)){if("string"==typeof this.opsHref)return u.default.resolve(this.opsHref);if(i.isFunction(this.opsHref))return u.default.resolve(this.opsHref())}return K(e).then(e=>{try{return i.getLinkHref(e,t.LinkRelation.REPO_OPS)}catch(e){throw new s.DCXError(s.DCXError.UNEXPECTED,"Could not get ops href.",e)}})}class te{}const re=o.newDebug("dcx:assets:util:serialization");function se(e,r){re("deserializeAsset()");const s={};return s.repositoryId=e.repositoryId||e[t.Properties.REPO_REPOSITORY_ID],s.assetId=e.assetId||e[t.Properties.REPO_ASSET_ID],s.name=e.name||e[t.Properties.REPO_NAME],s.size=null!=e.size?e.size:e[t.Properties.REPO_SIZE],s.path=e.path||e[t.Properties.REPO_PATH],s.assetClass=e.etag||e[t.Properties.REPO_ASSET_CLASS],s.etag=e.etag||e[t.Properties.REPO_ETAG],s.version=e.version||e[t.Properties.REPO_VERSION],s.format=e.format||e[t.Properties.DC_FORMAT],s.md5=e.md5,s.createDate=e.createDate||e[t.Properties.REPO_CREATE_DATE],s.modifyDate=e.modifyDate||e.modifiedDate||e[t.Properties.REPO_MODIFY_DATE],s.discardDate=e.discardDate||e[t.Properties.REPO_DISCARD_DATE],s.createdBy=e.createdBy||e[t.Properties.REPO_CREATED_BY],s.modifiedBy=e.modifiedBy||e[t.Properties.REPO_MODIFIED_BY],s.discardedBy=e.discardedBy||e[t.Properties.REPO_DISCARDED_BY],s.deviceCreateDate=e.deviceCreateDate||e[t.Properties.REPO_DEVICE_CREATE_DATE],s.deviceModifyDate=e.deviceModifyDate||e[t.Properties.REPO_DEVICE_MODIFY_DATE],s.baseAssetId=e.baseAssetId||e[t.Properties.REPO_BASE_ASSET_ID],s.state=e.state||e[t.Properties.REPO_STATE],s.links=e.links||e[t.Properties.LINKS],r&&(r[t.LinkRelation.EFFECTIVE_PRIVILAGES]&&(s.embedded={EffectivePrivileges:r[t.LinkRelation.EFFECTIVE_PRIVILAGES]}),r[t.LinkRelation.REPOSITORY]&&(s.embedded=i.merge({},s.embedded,{RepositoryResource:oe(r[t.LinkRelation.REPOSITORY])}))),e[t.Properties.EMBEDDED]&&(e[t.Properties.EMBEDDED][t.LinkRelation.EFFECTIVE_PRIVILAGES]&&(s.embedded={EffectivePrivileges:e._embedded[t.LinkRelation.EFFECTIVE_PRIVILAGES]}),e[t.Properties.EMBEDDED][t.LinkRelation.REPOSITORY]&&(s.embedded=i.merge({},s.embedded,{RepositoryResource:oe(e._embedded[t.LinkRelation.REPOSITORY])}))),i.pruneUndefined(s)}function oe(e={}){return re("deserializeRepository()"),{repositoryId:e[t.Properties.REPO_REPOSITORY_ID],repositoryType:e[t.Properties.REPO_REPOSITORY_TYPE],owner:e[t.Properties.REPO_OWNER],createDate:e[t.Properties.REPO_CREATE_DATE],title:e[t.Properties.DC_TITLE],availableRegions:e[t.Properties.REPO_AVAILABLE_REGIONS]}}const ne=o.newDebug("dcx:assets:operations"),ie=o.newDebug("dcx:assets:operations:builder");function ae(e,t,r,s,o){return ne("copyAsset()"),i.validateParams(["svc",e,"object"],["srcAsset",t,"object"],["destAsset",r,"object"],["createIntermediates",s,"boolean"],["overwriteExisting",o,"boolean",!0]),Y(t,["repo:path","path","assetId","repo:assetId"],"string"),Y(r,["repo:path","path","assetId","repo:assetId"],"string"),Ce(t),Ce(r),ee.call(this,e).then(n=>_e(k(e),n,ye("copy",r,t,{overwriteExisting:o,createIntermediates:s}))).then(ge.bind(void 0,r)).then(Ee)}function de(e,t,r,s,o){return ne("moveAsset()"),i.validateParams(["svc",e,"object"],["srcAsset",t,"object"],["destAsset",r,"object"],["createIntermediates",s,"boolean"],["overwriteExisting",o,"boolean",!0]),Y(t,["repo:path","path","assetId","repo:assetId"],"string"),Y(r,["repo:path","path","assetId","repo:assetId"],"string"),Ce(t),Ce(r),ee.call(this,e).then(n=>_e(k(e),n,ye("move",r,t,{createIntermediates:s,overwriteExisting:o}))).then(ge.bind(void 0,r)).then(Ee)}function ce(e,t,r,s){ne("discardAsset()"),i.validateParams(["svc",e,"object"],["asset",t,"object"],["etag",r,"string",!0],["recursive",s,"boolean",!0]);const o=k(e);return Y(t,["repo:path","path","assetId","repo:assetId"],"string"),Ce(t),ee.call(this,e).then(e=>{const n=ye("discard",Object.assign(Object.assign({},t),{etag:r}),void 0,{recursive:s});return _e(o,e,n)}).then(Ae)}function le(e,r,s,o){ne("deleteAsset()"),i.validateParams(["svc",e,"object"],["asset",r,"object"],["etag",s,"string",!0],["recursive",o,"boolean",!0]);const n=k(e);if(r.format===p&&null==o)throw new h.default(h.default.INVALID_PARAMS,"Recursive flag is required for directory assets.");if(!o&&V(r,[t.LinkRelation.REPO_METADATA])){const e=i.getLinkHrefTemplated(r,t.LinkRelation.REPO_METADATA,{});return n.invoke("DELETE",e,{[t.HeaderKeys.IF_MATCH]:i.cleanEtag(s)||"*"},void 0,{isStatusValid:X()}).then(Ae)}return Y(r,["repo:path","path","assetId","repo:assetId"],"string"),Ce(r),ee.call(this,e).then(e=>{const t=ye("delete",Object.assign(Object.assign({},r),{etag:s}),void 0,{recursive:o});return _e(n,e,t)}).then(Ae)}function he(e,t){ne("restoreAsset()"),i.validateParams(["svc",e,"object"],["asset",t,"object"]);const r=k(e);return Y(t,["assetId","repo:assetId"],"string"),Ce(t),ee.call(this,e).then(e=>{const s=ye("restore",t);return _e(r,e,s)}).then(ge.bind(void 0,t)).then(Ee)}function ue(e,t,r,s,o){var n;return ne("packageAssets()"),i.validateParams(["svc",e,"object"],["destination",r,"object"]),i.validateParam("sources",t,["object","object[]"]),t=i.isArray(t)?t:[t],n=["repo:path","path","assetId","repo:assetId"],"string",t.map(e=>Y(e,n,"string")),Ce(t),Y(r,["repo:path","path","assetId","repo:assetId"],"string"),Ce(r),ee.call(this,e).then(n=>_e(k(e),n,ye("package",r,t,{createIntermediates:s,overwriteExisting:o}))).then(ge.bind(void 0,r)).then(Ae)}function pe(e){return{result:(i.isArray(e.response)?e.response:[e.response]).map(fe),response:e}}function fe(e){if(!e.error)return e;const t=Object.assign({},e),r=X()(e.error.status);return t.error=s.isAdobeDCXError(r)?r:new h.default(h.default.UNEXPECTED,"Unexpected response"),t._additionalData=e.error,t.error._message=e.error.title,t}function _e(e,r,s,o){return ne("doOperation()"),i.validateParams(["svc",e,"object"],["opsEndpoint",r,"string"],["operationDocument",s,["string","object"]],["addlHeaders",o,"object",!0]),function(e,r,s,o={}){return e.invoke(t.HTTPMethods.POST,r,Object.assign({[t.HeaderKeys.CONTENT_TYPE]:"application/vnd.adobe.asset-operation+json"},o),"string"==typeof s?s:JSON.stringify(s),{isStatusValid:X(),responseType:"json",retryOptions:{pollCodes:[202],pollHeader:"location",pollMethod:"get"}})}(e,r,s,o).then(e=>{if(e.response=e.response||{},e.response.error)throw new h.default(h.default.UNEXPECTED_RESPONSE,e.response.type||"Operation failed.",new Error(e.response.title),e);return e})}class me{constructor(){this.opBatchLimit=100,this._docs=[]}getDocumentEntry(e){return this._docs[e]}getDocument(){return this._docs}get entryCount(){return this._docs.length}copy(e,t,r,s,o){ie("copy()"),this._assertUnderLimit(),this._checkSourceType(e),this._checkTargetType(t),Ce(e),Ce(t);const n=ye("copy",t,e,{createIntermediates:r,overwriteExisting:s},o);return this._docs.push(n),this}move(e,t,r,s,o){ie("move()"),this._assertUnderLimit(),this._checkSourceType(e),this._checkTargetType(t),Ce(e),Ce(t);const n=ye("move",t,e,{createIntermediates:r,overwriteExisting:s},o);return this._docs.push(n),this}package(e,t,r,s,o){ie("package()"),this._assertUnderLimit(),(e=i.isArray(e)?e:[e]).map(e=>{this._checkSourceType(e)}),Ce(e),this._checkTargetType(t),Ce(t);const n=ye("package",t,e,{createIntermediates:r,overwriteExisting:s},o);return this._docs.push(n),this}discard(e,t,r){ie("discard()"),this._assertUnderLimit(),this._checkTargetType(e),Ce(e);const s=ye("discard",e,void 0,{recursive:t},r);return this._docs.push(s),this}restore(e,t){ie("restore()"),this._assertUnderLimit(),Y(e,["href","assetId","repo:assetId"],"string"),this._checkTargetType(e),Ce(e);const r=ye("restore",e,void 0,void 0,t);return this._docs.push(r),this}delete(e,t,r){ie("delete()"),this._assertUnderLimit(),this._checkTargetType(e),Ce(e);const s=ye("delete",e,void 0,{recursive:t},r);return this._docs.push(s),this}_assertUnderLimit(){if(this._docs.length>=this.opBatchLimit)throw new h.default(h.default.INVALID_STATE,`Exceeds limit of ${this.opBatchLimit} operations in a single batch.`)}_checkTargetType(e){this._checkSourceOrTargetType(e,"Target")}_checkSourceType(e){this._checkSourceOrTargetType(e,"Source")}_checkSourceOrTargetType(e,t){const r=[!!e.href,!!e.assetId||!!e["repo:assetId"],!!e.path||!!e["repo:path"]];if(0===r.filter(e=>e).length)throw new h.default(h.default.INVALID_PARAMS,`${t} identifier is underspecified. Exactly one of [href, repo:path, repo:assetId] required.`);if(r.filter(e=>e).length>1)throw new h.default(h.default.INVALID_PARAMS,`${t} identifier is overspecified. Exactly one of [href, repo:path, repo:assetId] required.`);const s=this._getSourceType(e),o="Source"===t?this._batchSourceType:this._batchTargetType;if(o){if(s!==o)throw new h.default(h.default.INVALID_PARAMS,`Operation ${t.toLowerCase()} types must all be the same type. Expected ${o}, encountered ${s}.`)}else"Source"===t?this._batchSourceType=s:this._batchTargetType=s}_getSourceType(e){return e.href?"idBasedHref":e.assetId||e["repo:assetId"]?"id":e.path||e["repo:path"]?e.baseAssetId||e["repo:baseAssetId"]?"pathAndBaseAssetId":"path":void 0}}function ge(e,t){return t.response.asset=Object.assign(Object.assign({},t.response.asset||{}),{repositoryId:e.repositoryId||e["repo:repositoryId"]}),t}function Ee(e){return{response:e,result:se(e.response.asset)}}function Ae(e){return{response:e,result:{success:e.statusCode>199&&e.statusCode<400}}}function Ce(e){i.isArray(e)?e.map(e=>{e.href||Y(e,["repo:repositoryId","repositoryId"],"string")}):e.href||Y(e,["repo:repositoryId","repositoryId"],"string")}function De(e,r,s){if(ne("_convertToACPSource()"),"object"!=typeof r)return;const o={"repo:repositoryId":r.repositoryId||r["repo:repositoryId"],"repo:path":r.path||r["repo:path"],"repo:assetId":r.assetId||r["repo:assetId"],"repo:baseAssetId":r.baseAssetId||r["repo:baseAssetId"],href:r.href};return"string"==typeof o.href?(delete o["repo:path"],delete o["repo:assetId"],delete o["repo:baseAssetId"]):"string"==typeof o["repo:assetId"]&&(delete o["repo:path"],delete o["repo:baseAssetId"]),"target"===e?!0===s?o[t.HeaderKeys.IF_MATCH]="directory"!==r.format&&"directory"!==r["dc:format"]&&i.cleanEtag(r.etag)||"*":!1===s?o[t.HeaderKeys.IF_NONE_MATCH]="*":"directory"!==r.format&&"directory"!==r["dc:format"]&&(o[t.HeaderKeys.IF_MATCH]=i.cleanEtag(r.etag)):"directory"!==r.format&&"directory"!==r["dc:format"]&&(o[t.HeaderKeys.IF_MATCH]=i.cleanEtag(r.etag)||"*"),ne("_cTACPS() out",o),i.pruneUndefined(o)}function ye(e,t,r,s={},o={}){ne("_buildOperationDoc()");const n=i.pruneUndefined({op:e,target:t,source:i.isArray(r)?[]:r?{}:void 0}),{overwriteExisting:a,createIntermediates:d,recursive:c}=s;if(n.source&&(n.source=i.isArray(r)?r.map(e=>De("source",e,a)).filter(e=>null!=e):De("source",r,a)),"object"==typeof t){const e=De("target",t,a);e&&(n.target=e)}return null==n.target["repo:assetId"]&&null!=d&&(n.intermediates=d),null!=c&&(n.recursive=c),Object.assign(n,o),ne("_OD() doc",n),n}function Ie(e,t,r,s){return new(r||(r=Promise))((function(o,n){function i(e){try{d(s.next(e))}catch(e){n(e)}}function a(e){try{d(s.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,a)}d((s=s.apply(e,t||[])).next())}))}var ve;t.BlockTransferStates=void 0,(ve=t.BlockTransferStates||(t.BlockTransferStates={})).NOT_INITIALIZED="NOT_INITIALIZED",ve.INITIALIZING="INITIALIZING",ve.INITIALIZED="INITIALIZED",ve.WAITING="WAITING",ve.STARTED="STARTED",ve.PAUSING="PAUSING",ve.PAUSED="PAUSED",ve.CANCELED="CANCELED",ve.ERROR="ERROR",ve.FINALIZING="FINALIZING",ve.COMPLETE="COMPLETE";const be=new class{constructor(){this._uploads=[],this._downloads=[],this._pendingUploadRequests=[],this._pendingDownloadRequests=[],this._downloadChunkSize=10485760}get downloads(){return this._downloads}get uploads(){return this._uploads}set downloadChunkSize(e){i.validateParams(["downloadChunkSize",e,"+number"]),this._downloadChunkSize=e}get downloadChunkSize(){return this._downloadChunkSize}get pendingUploadRequests(){return this._pendingUploadRequests}get pendingDownloadRequests(){return this._pendingDownloadRequests}resetUploads(){this._uploads=[],this._pendingUploadRequests=[]}addAndStartUpload(e){return this._addAndStart("upload",e)}addAndStartDownload(e){return e.state!==t.BlockTransferStates.INITIALIZED?Promise.resolve(e):this._addAndStart("download",e)}startNextWaiting(e){const r="upload"===e?this._uploads:this._downloads,s=[];let o=!1;for(const i in r){const e=r[i];!o&&e&&e.state===t.BlockTransferStates.WAITING?(e.start(),o=!0):e.state!==t.BlockTransferStates.CANCELED&&e.state!==t.BlockTransferStates.ERROR&&e.state!==t.BlockTransferStates.COMPLETE||s.push(i)}const n=s.map(e=>delete r[e]).filter(e=>!!e);"download"===e?this._downloads=n:this._uploads=n}_addAndStart(e,r){const s="upload"===e?this._uploads:this._downloads;return 0===s.filter(e=>e&&(e.state===t.BlockTransferStates.NOT_INITIALIZED||e.state===t.BlockTransferStates.INITIALIZED||e.state===t.BlockTransferStates.INITIALIZING||e.state===t.BlockTransferStates.STARTED)).length?r.start():r._setWaiting(),s.push(r),r.promise}},Te=o.newDebug("dcx:assets:blockdownload"),Pe=o.newDebug("dcx:assets:blockdownload:leaf");class we extends i.EventEmitter{constructor(e,r,s={}){super(["stateChanged"]),this._state=t.BlockTransferStates.NOT_INITIALIZED,this._cachedBlocks=[],this._blockRequestIndex=0,this._blockHandledIndex=0,this._currentByteRange=[void 0,void 0],this._pending=[],Te("constructor");const{startByte:o,blockSize:n,endByte:a,url:d,totalSize:c,maxConcurrentRequests:l}=Object.assign({blockSize:be.downloadChunkSize,maxConcurrentRequests:4},i.pruneUndefined(s));i.validateParams(["svc",e,"object"],["responseType",r,"enum",!1,["stream","buffer"]],["blockSize",n,"+number"],["url",d,"string",!0],["startByte",o,"number",!0],["endByte",a,"number",!0],["totalSize",c,"number",!0],["maxConcurrentRequests",l,"+number"]),this._maxConcurrentRequests=l,this._blockSize=Math.round(n),this._mode=r,this._service=e,this._url=d,this._startByte=o,this._endByte=a,this._totalSize=c,"buffer"===this._mode?(this._bytes=new Uint8Array,this._stream={_end:()=>{},_destroy:()=>{}}):s.stream?this._stream=s.stream:this._stream=i.newReadableStream(),this._promise=new u.default((e,t)=>{this._resolve=()=>{Te("resolving"),this._stream._end(),this.removeAllHandlers(),e(this)},this._reject=e=>{Te("rejecting: ",e),this._stream._destroy(),this.removeAllHandlers(),t(e)}})}get buffer(){return this._bytes}get stream(){return this._stream}get mode(){return this._mode}get state(){return this._state}get promise(){return this._promise}_requestBlock(e,r,s,o){Te("_requestBlock(): ",e,r,s,o);const n=Le(e,r);return this._service.invoke(t.HTTPMethods.GET,this._url,n,void 0,{responseType:"defaultbuffer",isStatusValid:X()}).then(e=>({response:e,index:s,lane:o}))}init(e=this._url,r=this._totalSize){if(Te("init(): ",e,r),this._state===t.BlockTransferStates.INITIALIZED&&e===this._url&&r===this._totalSize)return u.default.resolve(this);if(this._assertStateIsValid("init"),this._shiftState(t.BlockTransferStates.INITIALIZING),this._url=e,this._initByteRange(r),this._totalSize!==1/0||null==this._currentByteRange[0])return this._shiftState(t.BlockTransferStates.INITIALIZED),u.default.resolve(this);const{startByte:s,endByte:o,blockIndex:n}=this._nextBlockData();let i=t.BlockTransferStates.INITIALIZED;return this._requestBlock(s,o,n,0).then(e=>(this._updateTotalSize(e),o>this._endByte&&(i=t.BlockTransferStates.FINALIZING),e)).then(this._handleBlock.bind(this)).then(()=>this._shiftState(i)).catch(this._handleErrorAndThrow.bind(this))}start(){if(Te("start()"),this._assertStateIsValid("start"),this._shiftState(t.BlockTransferStates.STARTED),null!=this._currentByteRange[0])return this._start(),this._promise;const[e,r]=this._currentByteRange,s=this._blockRequestIndex;return this._blockRequestIndex+=1,this._currentByteRange=[r+1,r],this._requestBlock(e,r,s,0).then(this._handleBlock.bind(this)).then(this._shiftState.bind(this,t.BlockTransferStates.FINALIZING)).catch(this._handleError.bind(this)),this._promise}pause(){return Te("pause()"),this._assertStateIsValid("pause"),this._shiftState(t.BlockTransferStates.PAUSING),u.default.allSettled(this._pending).then(()=>(this._shiftState(t.BlockTransferStates.PAUSED),be.startNextWaiting("download"),this))}resume(){return Te("resume()"),this._assertStateIsValid("resume"),this._shiftState(t.BlockTransferStates.STARTED),this._start(),this}cancel(){return Te("cancel()"),this._assertStateIsValid("cancel"),this._shiftState(t.BlockTransferStates.CANCELED),this._reject(new h.default(h.default.ABORTED,"BlockDownload aborted.")),be.startNextWaiting("download"),this._promise}_setWaiting(){this._shiftState(t.BlockTransferStates.WAITING)}_start(){Te("_start()");for(let e=0;e<this._maxConcurrentRequests;e++)this._loop(e).catch(this._handleError.bind(this))}get _loopShouldContinue(){return Te("_loopShouldContinue() ",this._currentByteRange,this._endByte),this._state===t.BlockTransferStates.STARTED&&this._currentByteRange[0]<=this._endByte}_loop(e){return Ie(this,void 0,void 0,(function*(){Te("_loop(): ",e);let r=!1;for(;this._loopShouldContinue&&!r;){const{startByte:t,endByte:s,blockIndex:o,done:n}=this._nextBlockData();r=n;const i=this._requestBlock(t,s,o,e).then(this._handleBlock.bind(this)).catch(this._handleError.bind(this));this._pending[e]=i,yield i}Te(`_loop(${e}) done, ${r}`),r&&(Te(`_loop(${e}) finalize`),this._shiftState(t.BlockTransferStates.FINALIZING))}))}_nextBlockData(){Te("_nextBlockData()");const e=this._blockRequestIndex;this._blockRequestIndex+=1;const[t,r]=this._currentByteRange;return this._currentByteRange[0]+=this._blockSize,this._currentByteRange[1]=Math.min(this._currentByteRange[1]+this._blockSize,this._endByte),{startByte:t,endByte:r,blockIndex:e,done:r>=this._endByte}}_initByteRange(e=this._totalSize){if(Te("_initByteRange(): ",e),this._totalSize=e,null!=this._totalSize&&this._totalSize<0)throw new h.default(h.default.INVALID_PARAMS,"Total size must be positive.");if(this._totalSize||(this._totalSize=1/0),this._endByte||(this._endByte=this._totalSize),!this._startByte&&this._endByte===this._totalSize)return this._startByte=0,void(this._currentByteRange=[0,this._blockSize-1]);if(null!=this._startByte&&(this._currentByteRange[0]=Math.max(this._startByte,0)),(null==this._endByte||this._endByte>0)&&(this._currentByteRange[1]=Math.min(this._endByte,(this._startByte||0)+this._blockSize-1)),null!=this._startByte||this._endByte===1/0||this._endByte>0)return;if(this._totalSize===1/0){if(-this._endByte>this._blockSize)throw new h.default(h.default.INVALID_PARAMS,"Cannot download last N bytes without a total size.");return void(this._currentByteRange=[void 0,this._endByte])}this._startByte=Math.max(0,this._totalSize+this._endByte),this._endByte=this._totalSize;const t=Math.min(this._startByte+this._blockSize-1,this._endByte);this._currentByteRange=[this._startByte,t]}_finalize(){return Te("_finalize() start"),be.startNextWaiting("download"),u.default.allSettled(this._pending).then(()=>{this._checkCachedBlocks(),this._shiftState(t.BlockTransferStates.COMPLETE)})}_updateTotalSize(e){if(Te("_updateTotalSize()"),null==this._totalSize||this._totalSize===1/0)try{const t=e.response.headers["content-range"],r=parseInt(t.split("/")[1]);i.assert(()=>!isNaN(r),"Invalid number."),this._totalSize=r,this._endByte===1/0&&(this._endByte=this._totalSize)}catch(o){throw new h.default(h.default.INVALID_DATA,"Could not determine total size.",o,e.response)}return Te("_uTS(): ",this._totalSize,this._endByte),e}_handleError(e){Te("_handleError(): ",e),this._shiftState(t.BlockTransferStates.ERROR),this._error=e,s.isAdobeDCXError(e)||(this._error=new h.default(h.default.UNEXPECTED,"An unexpected error occurred.",e)),this._reject(this._error)}_handleErrorAndThrow(e){throw this._handleError(e),this._error}_handleBlock(e,t=!0){this._endByte===1/0&&this._updateTotalSize(e);const{index:r,response:s}=e;Te(`_handleBlock(${r})`),r===this._blockHandledIndex?(Te(`_hB(${r}) handled`,s.response.byteLength),this._pushBlockData(s),this._blockHandledIndex+=1,this._cachedBlocks=this._cachedBlocks.filter(e=>e.index!==r)):t&&this._cachedBlocks.push(e),t&&this._checkCachedBlocks()}_checkCachedBlocks(){this._cachedBlocks.sort((e,t)=>e.index-t.index).map(e=>this._handleBlock(e,!1))}_pushBlockData(r){if(this._state===t.BlockTransferStates.ERROR)return;const s=r.response instanceof e?r.response:new Uint8Array(r.response);"stream"!==this._mode?this._bytes=i.concatUint8Arrays(this._bytes,s):this._stream._push(s)}_shiftState(e){return Te("_shiftState(): ",e),this._state===t.BlockTransferStates.COMPLETE||this._state===t.BlockTransferStates.ERROR||this._state===t.BlockTransferStates.CANCELED||(this._state=e,this.emit("stateChanged",[this._state,this]),e===t.BlockTransferStates.FINALIZING&&this._finalize(),e===t.BlockTransferStates.COMPLETE&&this._resolve()),this}_assertStateIsValid(e,r=this._state){Te("_assertStateIsValid() ",e,r);let s=!1;const o="Invalid state transition.";switch(e){case"init":r===t.BlockTransferStates.NOT_INITIALIZED&&(s=!0);break;case"start":r!==t.BlockTransferStates.INITIALIZED&&r!==t.BlockTransferStates.WAITING||(s=!0);break;case"pause":r===t.BlockTransferStates.STARTED&&(s=!0);break;case"resume":r===t.BlockTransferStates.PAUSED&&(s=!0);break;case"cancel":s=!0}if(!s)throw Te("_aSIV() throw ",o),new h.default(h.default.INVALID_STATE,o,void 0,void 0,{method:e,currentState:r})}}function Re(e,t,r){return new we(e,t,r)}function Oe(e,r,s,o,n="defaultbuffer",i,a){Pe("_doBlockDownload()");const d=Q(this,n),c=Re(e,"stream"===n?"stream":"buffer",{startByte:s,endByte:o,stream:d.stream});d.blockDownload=c;let l=u.default.resolve(r,d);return i||(l=l.then(()=>e.invoke(t.HTTPMethods.GET,r,void 0,void 0,{responseType:"json",isStatusValid:X()})).then(e=>{if("string"!=typeof e.response.href)throw new h.default(h.default.UNEXPECTED_RESPONSE,"No block download href found in response.",void 0,e);return a=e.response.size,e.response.href})),l.then(e=>c.init(e,a)).then(()=>be.addAndStartDownload(c)).then(()=>"stream"===n?{statusCode:200,headers:{},responseType:n,response:c.stream,message:"OK"}:{statusCode:200,headers:{},responseType:n,response:ke(c.buffer,n),message:"OK"})}function ke(e,t){if("defaultbuffer"===t||"buffer"===t||"arraybuffer"===t)return e.buffer;if("blob"===t)return new Blob([e]);const r=i.arrayBufferToString(e);if("text"===t)return r;try{return JSON.parse(r)}catch(e){return r}}function Le(e,t){return null==e&&null==t?{}:{range:`bytes=${null!=e?e:null!=t&&t>0?"0":""}-${null!=t?Math.abs(t):""}`}}var Se;t.ProblemTypes=void 0,(Se=t.ProblemTypes||(t.ProblemTypes={})).RESPONSE_TOO_LARGE="http://ns.adobe.com/adobecloud/problem/responsetoolarge",Se.QUOTA_EXCEEDED="http://ns.adobe.com/adobecloud/problem/quotaexceeded",Se.DCX_VALIDATION="http://ns.adobe.com/adobecloud/problem/dcxvalidation",Se.BULK_REQUEST_NOT_ATTEMPTED="http://ns.adobe.com/adobecloud/problem/bulkrequestnotattempted";const Ne=o.newDebug("dcx:assets:private");function Me(e,t){let r;if(!b(this))throw new s.DCXError(s.DCXError.INVALID_PARAMS,"Data cannot be sliced");return r=this.slice(e,t),new Promise(e=>{e(r)})}function Xe(e,r,o,n,a="defaultbuffer",d,c,l={}){let h;Ne("_getUrlFallbackDirect()");const p=Q(this,a);return u.default.resolve(void 0,p).then(()=>e.invoke(t.HTTPMethods.GET,o,Object.assign({},l),void 0,{responseType:"stream"===a?"defaultbuffer":a,isStatusValid:X([400])})).then(e=>(Ne("_gUFD() status code",e.statusCode),h=e,400===e.statusCode&&e.xhr?e.xhr.getResponseDataAsJSON():("stream"===a&&p.stream&&(p.stream._push(h.response),p.stream._end()),e))).then(e=>{const r=i.isObject(e)&&(400===h.statusCode||400===e.status)&&e.type===t.ProblemTypes.RESPONSE_TOO_LARGE;if(Ne("_gUFD() do direct",r),!r&&400===h.statusCode)throw new s.DCXError(s.DCXError.UNEXPECTED_RESPONSE,"Unexpected response",void 0,h);return r}).then(o=>{if(!o)return h;if(!("location"in h.headers)||"string"!=typeof h.headers.location){if(!B(r.links,[t.LinkRelation.BLOCK_DOWNLOAD]))throw new s.DCXError(s.DCXError.INVALID_DATA,"Resource too large and missing download link.");const o=i.getLinkHrefTemplated(r.links,t.LinkRelation.BLOCK_DOWNLOAD,{resource:n,component_id:d,revision:c});return Oe.call(p,e,o,void 0,void 0,a,!1)}return Oe.call(p,e,h.headers.location,void 0,void 0,a,!0)})}const xe=o.newDebug("dcx:assets:bulk");function Ue(e,r){let s=Uint8Array.from([]);for(let o=0;o<e.length;o++){const n=e[o];s=0===o?i.concatUint8Arrays(s,i.stringToBuffer(`--${r}\r\n`)):i.concatUint8Arrays(s,i.stringToBuffer(`\r\n--${r}\r\n`)),s=i.concatUint8Arrays(s,i.stringToBuffer(`${[t.HeaderKeys.CONTENT_TYPE]}: application/http\r\n`)),s=i.concatUint8Arrays(s,i.stringToBuffer(`\r\n${n.method} ${n.href}`));let a=!1;for(const e in n.headers){const t=e.toLowerCase();"content-length"===t&&(a=!0),s=i.concatUint8Arrays(s,i.stringToBuffer(`\r\n${t}: ${n.headers[e]}`))}if(n.body){const e=je(n.body);a||(s=i.concatUint8Arrays(s,i.stringToBuffer(`\r\ncontent-length: ${e.length}`))),s=i.concatUint8Arrays(s,i.stringToBuffer("\r\n\r\n")),s=i.concatUint8Arrays(s,e)}}return s=i.concatUint8Arrays(s,i.stringToBuffer(`\r\n--${r}--\r\n`)),s.buffer}function je(e){if("string"==typeof e)return i.stringToBuffer(e);if(i.isArrayBuffer(e))return new Uint8Array(e);if(b(e))return e;throw new s.AdobeDCXError(s.AdobeDCXError.INVALID_PARAMS,"Bulk subrequest body expecting string | ArrayBuffer | Buffer")}function Be(e,r){const o=e.headers[t.HeaderKeys.CONTENT_TYPE];if(!o)throw new s.AdobeDCXError(s.AdobeDCXError.UNEXPECTED_RESPONSE,"Missing boundary header in multipart response");const n=o.split("=")[1],a=function(e,t){const r=[],s=e.split(`--${t}`).slice(1,-1);for(const[,o]of s.entries()){const e=o.split("\r\n\r\n");let t,s;e[1]&&(s=parseInt(e[1].split("\r\n",1)[0].split(" ")[1]),t=i.parseHeaders(e[1]));const n={headers:t,response:e[2]?e[2].trim():void 0,statusCode:s};r.push(n)}return r}(e.response,n);if(r&&a.length!==r)throw new s.AdobeDCXError(s.AdobeDCXError.UNEXPECTED_RESPONSE,`Unexpected number of parts; Expected ${r}`);return a}function Ve(e){if(e.length>10)throw new s.AdobeDCXError(s.AdobeDCXError.INVALID_PARAMS,"A single bulk request can only contain a maximum of 10 sub-requests.");const{writeOperations:r,readOperations:o}=e.reduce((e,r)=>{if("string"!=typeof r.href)throw new s.AdobeDCXError(s.AdobeDCXError.INVALID_PARAMS,"A sub-request of the bulk operation is missing an href");if("string"!=typeof r.method)throw new s.AdobeDCXError(s.AdobeDCXError.INVALID_PARAMS,"A sub-request of the bulk operation is missing the HTTP method");const o=r.method.toUpperCase();if(!Object.values(t.HTTPMethods).includes(o))throw new s.AdobeDCXError(s.AdobeDCXError.INVALID_PARAMS,"A sub-request of the bulk operation includes an invalid HTTP method");return[t.HTTPMethods.GET,t.HTTPMethods.HEAD].includes(o)?e.readOperations.push(r):e.writeOperations.push(r),e},{readOperations:[],writeOperations:[]});if(r.length>0&&o.length>0)throw new s.AdobeDCXError(s.AdobeDCXError.INVALID_PARAMS,"Cannot mix READ and WRITE operations in bulk sub requests.")}function He(e,r,s,o="id"){xe("performBulkRequest()"),i.validateParams(["svc",e,"object"],["asset",r,"object"],["requests",s,"array"],["linkMode",o,"string",!0,["id","path"]]),x(r.links,[t.LinkRelation.BULK_REQUEST]),Ve(s);const n=`boundary-${Date.now()}`,a=Ue(s,n),d={[t.HeaderKeys.CONTENT_TYPE]:`multipart/mixed;boundary=${n}`},c=i.getLinkHref(r.links,t.LinkRelation.BULK_REQUEST,o);return e.invoke(t.HTTPMethods.POST,c,d,a,{isStatusValid:X(),retryOptions:{pollHeader:"location",pollCodes:[202],pollMethod:t.HTTPMethods.GET}}).then(e=>({result:Be(e,s.length),response:e}))}const Fe=o.newDebug("dcx:assets:asset"),Ye=o.newDebug("dcx:assets:asset:leaf");class We{constructor(e,t,r={}){this.type="asset",this._data={},this._data=se(e),this._svc=k(t),this._cache=L(t),this._links=i.merge({},e.links||{},e._links||{},r)}setLinks(e){this._links=e,this._updateCachedLinks()}get links(){return this._links}setLink(e,t){this._links[e]=t,this._updateCachedLinks()}getLink(e){return this._links[e]}removeLink(e){delete this._links[e],this._updateCachedLinks()}_updateCachedLinks(){this._cache&&this._cache.setValueWithAsset(this.links,this.asset)}getLinkProperty(e,t,r="id"){return Fe("getLinkProperty()"),i.getLinkProperty({_links:this._links},e,t,r)}getLinkHrefTemplated(e,t,r="id"){return Fe("getLinkHrefTemplated()"),i.getLinkHrefTemplated({_links:this._links},e,t,r)}getLinkHref(e,t="id"){return Fe("getLinkHref()"),i.getLinkHref({_links:this._links},e,t)}get asset(){return Object.assign(Object.assign({},this._data),this.links)}get serviceConfig(){return{service:this._svc,cache:this._cache}}get repositoryId(){return this._data.repositoryId}set repositoryId(e){this._data.repositoryId=e}get assetId(){return this._data.assetId}set assetId(e){this._data.assetId=e}get path(){return this._data.path}set path(e){this._data.path=e}get name(){return this._data.name}get etag(){return this._data.etag}set etag(e){this._data.etag=e}get version(){return this._data.version}set version(e){this._data.version=e}get format(){return this._data.format}set format(e){this._data.format=e}get assetClass(){return this._data.assetClass}get createDate(){return this._data.createDate}get modifyDate(){return this._data.modifyDate}get discardDate(){return this._data.discardDate}get createdBy(){return this._data.createdBy}get modifiedBy(){return this._data.modifiedBy}get discardedBy(){return this._data.discardedBy}get deviceCreateDate(){return this._data.deviceCreateDate}get deviceModifyDate(){return this._data.deviceModifyDate}get baseAssetId(){return this._data.baseAssetId}set baseAssetId(e){this._data.baseAssetId=e}get state(){return this._data.state}get size(){return this._data.size}set size(e){this._data.size=e}get md5(){return this._data.md5}fetchLinksIfMissing(e=[]){return Fe("fetchLinksIfMissing()"),ut(this.serviceConfig,this,e).then(({result:e,response:t})=>(this.setLinks(i.merge(this.links,e)),this._updateDataWithResponse(t),this))}useLinkOrResolveResource(e,t){return Fe("useLinkOrResolveResource()"),lt(this.serviceConfig,this,e,t).then(e=>(this._updateDataWithResponse(e.response),this.setLinks(i.merge(this.links,e.result.links)),e))}headPrimaryResource(){return Fe("headPrimaryResource()"),this.fetchLinksIfMissing([t.LinkRelation.PRIMARY]).then(()=>ze(this._svc,this)).then(e=>{this._updateDataWithResponse(e);const t=J(e);return this.setLinks(t),e})}getRepoMetadata(){return Fe("getRepoMetadata()"),this.useLinkOrResolveResource(t.LinkRelation.REPO_METADATA,"json").then(e=>{this._data=i.merge(this._data,e.result,se(e.response.response));const t=e.response.response;return t&&t._links&&this.setLinks(i.merge(this.links,t._links)),{result:this._data,response:e.response}})}headAppMetadata(){return Fe("headAppMetadata()"),this.fetchLinksIfMissing([t.LinkRelation.APP_METADATA]).then(()=>tt(this._svc,this)).then(e=>{const t=J(e);return this.setLinks(t),e})}getAppMetadata(e){return Fe("getAppMetadata()"),i.validateParams(["etag",e,"string",!0]),this.fetchLinksIfMissing([t.LinkRelation.APP_METADATA]).then(()=>rt(this._svc,this,e))}putAppMetadata(e,r){return Fe("putAppMetadata()"),i.validateParams(["etag",r,"string",!0],["metadata",e,["object","string"]]),this.fetchLinksIfMissing([t.LinkRelation.APP_METADATA]).then(()=>st(this._svc,this,e,r))}patchAppMetadata(e,r){return Fe("patchAppMetadata()"),i.validateParams(["patchDoc",e,["string","object[]"]],["etag",r,"string"]),this.fetchLinksIfMissing([t.LinkRelation.APP_METADATA]).then(()=>ot(this._svc,this,e,r))}getBaseDirectoryMetadata(){return Fe("getBaseDirectoryMetadata()"),Qe(this._svc)}getLinks(){return Fe("getLinks()"),i.isObject(this.links)&&Object.keys(this.links).length>0?u.default.resolve(this.links):Ze(this._svc,this).then(e=>(this.setLinks(e),e))}getRepositoryResource(){return Fe("getRepositoryResource()"),this.fetchLinksIfMissing([t.LinkRelation.REPOSITORY]).then(()=>et(this._svc,this)).then(e=>(this.repositoryId=e.result["repo:repositoryId"],e))}getEffectivePrivileges(){return Fe("getEffectivePrivileges()"),this.fetchLinksIfMissing([t.LinkRelation.EFFECTIVE_PRIVILAGES]).then(()=>nt(this._svc,this))}performBulkRequest(e,r){return Fe("performBulkRequest()"),i.validateParams(["requests",e,"array"],["linkMode",r,"string",!0,["id","path"]]),this.fetchLinksIfMissing([t.LinkRelation.BULK_REQUEST]).then(()=>He(this._svc,this,e,r))}getACLPolicy(){return Fe("getACLPolicy()"),this.fetchLinksIfMissing([t.LinkRelation.ACL_POLICY]).then(()=>it(this._svc,this))}checkACLPrivilege(e,r){return Fe("checkACLPrivilege()"),i.validateParams(["privilege",e,"string"],["relation",r,"string"]),this.fetchLinksIfMissing([t.LinkRelation.ACCESS_CHECK]).then(()=>at(this._svc,this,e,r))}putACLPolicy(e){return Fe("putACLPolicy()"),this.patchACLPolicy(e)}patchACLPolicy(e){return Fe("patchACLPolicy()"),i.validateParams(["policy",e,["string","object"]]),this.fetchLinksIfMissing([t.LinkRelation.ACL_POLICY]).then(()=>dt(this._svc,this,e))}deleteACLPolicy(){return Fe("deleteACLPolicy()"),this.fetchLinksIfMissing([t.LinkRelation.ACL_POLICY]).then(()=>ct(this._svc,this))}getPrimaryResource(e){Fe("getPrimaryResource()"),i.validateParams(["responseType",e,"string"]);const r=Q({},e);return this._withSourcePromise(r).then(()=>this.fetchLinksIfMissing([t.LinkRelation.PRIMARY])).then(()=>qe.call(r,this._svc,this,e))}copy(e,t,r){return Fe("copy()"),i.validateParams(["destination",e,["object","string"]],["createIntermediates",t,"boolean"],["overwriteExisting",r,"boolean"]),"string"==typeof e&&(e=ft.call(this,e)),ae(this.serviceConfig,{repositoryId:this.repositoryId,assetId:this.assetId,path:this.path},e,t,r).then(({response:e,result:t})=>({response:e,result:new We(t,this.serviceConfig)}))}move(e,t,r){return Fe("move()"),i.validateParams(["destination",e,["object","string"]],["createIntermediates",t,"boolean"],["overwriteExisting",r,"boolean"]),"string"==typeof e&&(e=ft.call(this,e)),de(this.serviceConfig,{repositoryId:this.repositoryId,assetId:this.assetId,path:this.path},e,t,r).then(({response:e,result:t})=>(this._data=Object.assign(Object.assign({},this._data),i.pruneUndefined(t)),{response:e,result:this}))}delete(e,t=!1){return Fe("delete()"),i.validateParams(["etag",e,"string",!0],["recursive",t,"boolean"]),le(this.serviceConfig,{repositoryId:this.repositoryId,assetId:this.assetId,path:this.path},e,t).then(e=>(this._data.state="DELETED",e))}discard(e,t=!1){return Fe("discard()"),i.validateParams(["etag",e,"string",!0],["recursive",t,"boolean"]),ce(this.serviceConfig,{repositoryId:this.repositoryId,assetId:this.assetId,path:this.path},e,t).then(e=>(this._data.state="DISCARDED",e))}package(e,t,r){return Fe("package()"),i.validateParams(["destination",e,["object","string"]],["createIntermediates",t,"boolean"],["overwriteExisting",r,"boolean"]),"string"==typeof e&&(e=ft.call(this,e)),ue(this._svc,{repositoryId:this.repositoryId,assetId:this.assetId,path:this.path},e,t,r)}restore(){return Fe("restore()"),he(this._svc,{repositoryId:this.repositoryId,assetId:this.assetId}).then(({response:e,result:t})=>(this._data=Object.assign(Object.assign(Object.assign({},this._data),i.pruneUndefined(t)),{state:"ACTIVE"}),{response:e,result:this}))}_updateDataWithResponse(e){return e?(this._data.etag=e.headers.etag||this._data.etag,this._data.version=e.headers.version||this._data.version,this._data.assetId=e.headers["asset-id"]||this._data.assetId,this._data.md5=e.headers["content-md5"]||this._data.md5,this._data.repositoryId=e.headers["repository-id"]||this._data.repositoryId,e):e}_withSourcePromise(e){return u.default.resolve(void 0,e)}}function qe(e,r,s){Fe("getPrimaryResource()"),i.validateParams(["svc",e,"object"],["asset",r,"object"],["responseType",s,"enum",!0,D]),x(r.links,[t.LinkRelation.PRIMARY]);const o=i.getLinkHref(r.links,t.LinkRelation.PRIMARY),n=Q(this,s);return Xe.call(n,e,r,o,t.LinkRelation.PRIMARY,s)}function ze(e,r){Fe("headPrimaryResource()"),i.validateParams(["svc",e,"object"],["asset",r,"object"]),x(r.links,[t.LinkRelation.PRIMARY]);const s=i.getLinkHref(r.links,t.LinkRelation.PRIMARY);return e.invoke(t.HTTPMethods.HEAD,s,void 0,void 0,{isStatusValid:X()})}function Ge(e,r,s="id",o){return Ye("getResolveLinkForAsset()"),i.validateParams(["svc",e,"object"],["asset",r,"object"],["mode",s,"enum",!1,["id","path"]],["resource",o,["string","object"],!0]),H(r),K(e).then(e=>{const n="string"==typeof r.assetId,a={repositoryId:r.repositoryId,[n?"id":"path"]:r.assetId||r.path,mode:s,resource:i.isObject(o)?JSON.stringify(o):o};return i.getLinkHrefTemplated(e,n?t.LinkRelation.RESOLVE_BY_ID:t.LinkRelation.RESOLVE_BY_PATH,a)})}function Ke(e,t,r="id",s,o){Ye("resolveAsset()"),i.validateParams(["svc",e,"object"],["asset",t,"object"],["mode",r,"enum",!0,["id","path"]],["resource",s,["string","object"],!0]),H(t);const n=k(e),a=L(e),d=a&&t.assetId&&t.repositoryId&&"id"===r;return d&&(Ye("rA() set pending"),a.setPending(t.assetId,t.repositoryId)),Ge(e,t,r,s).then(e=>null==s?q(n,e):z(n,e,void 0,o)).then(e=>({response:e,result:_t(t,e,"id"===r,a)})).catch(e=>{throw d&&a.deleteWithAsset(t),e})}function $e(e,t){return Ye("fetchLinksForAsset()"),Je(e,t).then(e=>e.result.links)}function Je(e,r){if(Ye("fetchAsset()"),i.validateParams(["svc",e,"object"],["asset",r,"object"]),T(r))return Ke(e,r,"id").then(e=>e);let o;try{o=U(r.links,[t.LinkRelation.ID,t.LinkRelation.REPO_METADATA,t.LinkRelation.PRIMARY,t.LinkRelation.PATH])}catch(e){throw new s.DCXError(s.DCXError.INVALID_PARAMS,"Asset is not resolvable. Must contain repositoryId & path, assetId, or links.",e)}const n=i.getLinkHref(r.links,o),a=k(e),d=L(e);return a.invoke(t.HTTPMethods.HEAD,n,void 0,void 0,{isStatusValid:X()}).then(e=>({result:_t(r,e,o===t.LinkRelation.ID,d),response:e}))}function Ze(e,r){Ye("getLinksForAsset()"),i.validateParams(["svc",e,"object"],["asset",r,"object"]);const s=r.links||r[t.Properties.LINKS];if(i.isObject(s)&&0!==Object.keys(s).length)return u.default.resolve(s);const o=L(e);if(o){const e=o.getValueWithAsset(r);if(e)return u.default.resolve(e)}return $e(e,r)}function Qe(e,t){throw Ye("getBaseDirectoryMetadata()"),new s.DCXError(s.DCXError.NOT_IMPLEMENTED,"Method not implemented.")}function et(e,r){Ye("getRepositoryResource()"),i.validateParams(["svc",e,"object"],["asset",r,"object"]),x(r.links,[t.LinkRelation.REPOSITORY]);const s=i.getLinkHref(r.links,t.LinkRelation.REPOSITORY);return e.invoke(t.HTTPMethods.GET,s,{},void 0,{responseType:"json",isStatusValid:X()}).then(e=>({result:e.response,response:e}))}function tt(e,r){Fe("headAppMetadata()"),i.validateParams(["svc",e,"object"],["asset",r,"object"]),x(r.links,[t.LinkRelation.APP_METADATA]);const s=i.getLinkHref(r.links,t.LinkRelation.APP_METADATA);return e.invoke(t.HTTPMethods.HEAD,s,void 0,void 0,{isStatusValid:X()})}function rt(e,r,s){Ye("getAppMetadata()"),i.validateParams(["svc",e,"object"],["asset",r,"object"],["etag",s,"string",!0]);const o=i.getLinkHref(r.links,t.LinkRelation.APP_METADATA),n={};return s&&(n[t.HeaderKeys.IF_NONE_MATCH]=s),e.invoke(t.HTTPMethods.GET,o,n,void 0,{responseType:"json",isStatusValid:X([304])}).then(e=>{let t=e.response,r=e.headers.etag;return 304===e.statusCode&&(t=null,r=s),{result:t,response:e,etag:r}})}function st(e,r,s,o){Ye("putAppMetadata()"),i.validateParams(["svc",e,"object"],["asset",r,"object"],["metadata",s,["object","string"]],["etag",o,"string",!0]),x(r.links,[t.LinkRelation.APP_METADATA]);const n=i.getLinkHref(r.links,t.LinkRelation.APP_METADATA);return e.invoke(t.HTTPMethods.PUT,n,i.pruneUndefined({[t.HeaderKeys.IF_MATCH]:o,[t.HeaderKeys.CONTENT_TYPE]:"application/json"}),"string"==typeof s?s:JSON.stringify(s),{isStatusValid:X()}).then(e=>({response:e,result:{etag:e.headers.etag}}))}function ot(e,r,s,o){Ye("patchAppMetadata()"),i.validateParams(["svc",e,"object"],["asset",r,"object"],["metadata",s,["object[]","string"]],["etag",o,"string"]),x(r.links,[t.LinkRelation.APP_METADATA]);const n=i.getLinkHref(r.links,t.LinkRelation.APP_METADATA);return e.invoke(t.HTTPMethods.PATCH,n,i.pruneUndefined({[t.HeaderKeys.IF_MATCH]:o,[t.HeaderKeys.CONTENT_TYPE]:"application/json-patch+json"}),"string"==typeof s?s:JSON.stringify(s),{isStatusValid:X()}).then(e=>({response:e,result:{etag:e.headers.etag}}))}function nt(e,r){Ye("getEffectivePrivileges()"),i.validateParams(["svc",e,"object"],["asset",r,"object"]),x(r.links,[t.LinkRelation.EFFECTIVE_PRIVILAGES]);const s=i.getLinkHref(r.links,t.LinkRelation.EFFECTIVE_PRIVILAGES);return e.invoke(t.HTTPMethods.GET,s,{},void 0,{responseType:"json",isStatusValid:X()}).then(e=>({result:e.response,response:e}))}function it(e,r){Ye("getACLPolicy()"),i.validateParams(["svc",e,"object"],["asset",r,"object"]),x(r.links,[t.LinkRelation.ACL_POLICY]);const s=i.getLinkHref(r.links,t.LinkRelation.ACL_POLICY);return e.invoke(t.HTTPMethods.GET,s,{},void 0,{responseType:"json",isStatusValid:X()}).then(e=>({result:e.response,response:e}))}function at(e,r,s,o){Ye("checkACLPrivilege()"),i.validateParams(["svc",e,"object"],["asset",r,"object"],["privilege",s,"string",!1,["ack","read","write","delete"]]),x(r.links,[t.LinkRelation.ACCESS_CHECK]);const n=i.getLinkHrefTemplated(r.links,t.LinkRelation.ACCESS_CHECK,{privilege:s.toString(),relation:o});return e.invoke(t.HTTPMethods.GET,n,{directive:"acl-check-no-body"},void 0,{responseType:"json",isStatusValid:X([403])}).then(e=>({result:403!==e.statusCode,response:e}))}function dt(e,r,s){Ye("putACLPolicy()"),i.validateParams(["svc",e,"object"],["asset",r,"object"],["policy",s,["string","object"]]),x(r.links,[t.LinkRelation.ACL_POLICY]);const o=i.getLinkHref(r.links,t.LinkRelation.ACL_POLICY);return k(e).invoke(t.HTTPMethods.PATCH,o,{[t.HeaderKeys.CONTENT_TYPE]:"application/vnd.adobecloud.accesscontrolpolicy+json"},"string"==typeof s?s:JSON.stringify(s),{responseType:"json",isStatusValid:X()}).then(e=>({result:e.response,response:e}))}function ct(e,r){Ye("deleteACLPolicy()"),i.validateParams(["svc",e,"object"],["asset",r,"object"]),x(r.links,[t.LinkRelation.ACL_POLICY]);const s=i.getLinkHref(r.links,t.LinkRelation.ACL_POLICY);return k(e).invoke(t.HTTPMethods.DELETE,s,{},void 0,{responseType:"json",isStatusValid:X()}).then(e=>({result:e.response,response:e}))}function lt(e,r,o,n){Ye("useLinkOrResolveResource()"),i.validateParams(["svc",e,"object"],["asset",r,"object"],["resource",o,"string"]);const a=k(e);let d;try{d=i.getLinkHref(r.links,o)}catch(s){}return u.default.resolve(d).then(t=>{if("string"==typeof t)return Ye("uLORR() asset has link"),t;const s=L(e);return pt(r,s,[o])}).then(e=>{if("string"==typeof e)return e;try{return i.getLinkHref(e,o)}catch(e){return}}).then(i=>{if("string"==typeof i)return Ye("uLORR() cache or asset had link"),a.invoke(t.HTTPMethods.GET,i,void 0,void 0,{isStatusValid:X(),responseType:n});if(!T(r))throw new s.DCXError(s.DCXError.INVALID_PARAMS,"Asset is not resolvable. Must contain repository ID + path/id or links.");return Ke(e,r,"id",o,n)}).then(e=>v(e)?e:{result:r,response:e})}function ht(e,t,r=[],s=!1){return ut(e,t,r,s).then(({result:e})=>e)}function ut(e,t,r=[],o=!1){if(Ye("fetchLinksIfMissing()",r),i.validateParams(["svc",e,"object"],["asset",t,"object"],["linksToPopulate",r,"string[]"],["suppressMissingErrors",o,"boolean",!0]),B(t.links,r))return Ye("fLIM() links exist"),u.default.resolve({result:t.links});const n=L(e);return pt(t,n,r,!0).then(r=>r||(Ye("fLIM() fetching links"),Je(e,t))).then(e=>{let n,a,d=e;if(v(e)&&(n=e.response,d=e.result.links,a=e.result),!o&&!B(d,r))throw new s.DCXError(s.DCXError.INVALID_PARAMS,"Required links could not be fetched for asset.",void 0,n,i.pruneUndefined({required:r,asset:a}));return Ye("fLIM() fetchedOCached exists"),{result:d||t.links,response:n}})}function pt(e,t,r,s){if(Ye("getLinksFromCache()"),!t)return u.default.resolve(void 0);const o=t.getValueWithAsset(e);return null==o?(s&&t.setPending(e.assetId,e.repositoryId),u.default.resolve(void 0)):u.default.resolve(o).then(o=>r?B(o,r)?o:void(s&&t.setPending(e.assetId,e.repositoryId)):o)}function ft(e){return{[i.isValidAdobeURN(e)?"assetId":"path"]:e,repositoryId:this.asset.repositoryId}}function _t(e,r,s,o){const n=J(r),a=Object.assign(Object.assign(Object.assign({},function(e){return i.isObject(e.asset)?e.asset:e}(e)),i.pruneUndefined({assetId:r.headers["asset-id"]||r.headers["x-resource-id"],format:r.headers[t.HeaderKeys.CONTENT_TYPE],md5:r.headers["content-md5"],etag:r.headers.etag,version:r.headers.version,repositoryId:r.headers["repository-id"]})),{links:n});return s&&n&&Object.keys(n).length>0&&o&&o.setValueWithAsset(n,a),a}function mt(e,r,o){if(i.isFunction(o))return!0;let n;B(e.links,[t.LinkRelation.BLOCK_UPLOAD_INIT])&&(n=i.getLinkProperty(e.links,t.LinkRelation.BLOCK_UPLOAD_INIT,t.BlockTransferProperties.MAX_SINGLE_TRANSFER_SIZE));const a=n?parseInt(n):10485760,d=gt(o),c=r||d;if(!c)throw new s.DCXError(s.DCXError.INVALID_DATA,"Data size could not be determined");return!!(a&&c>a||d>a)||c>10485760||d>10485760}const gt=e=>e.byteLength||e.size||i.isFunction(e.getBytes)&&e.getBytes().length||e.length;function Et(e,t,r,s){const o=i.parseHeaders(s);return{id:t,length:r,type:e,links:Z(o.link),etag:o.etag,location:o.location,version:o.version,revision:o.revision,md5:o["content-md5"]}}const At=o.newDebug("dcx:assets:blockupload"),Ct=o.newDebug("dcx:assets:blockupload:leaf");class Dt{constructor(e,r,o,n,a,d,c,l,h){this._internalBlockUploadId=i.generateUuid(),this._state=t.BlockTransferStates.NOT_INITIALIZED,this._currentBlockIndex=0,this._pendingBlockRequests=[],this._bytesUploaded=0,this._totalBlocksUploaded=0,this._finalizeDocumentSizeEstimate=0,this._indeterminateTransfer=!1,this._svc=e,this._getSliceCallback=r,R(o)?(this._blockTransferDocument=o,this._transferBlockLinks=this._blockTransferDocument[t.Properties.LINKS][t.LinkRelation.BLOCK_TRANSFER],this._state=t.BlockTransferStates.INITIALIZED,At(`BlockUpload Initialized: Transfer document found with ${this._transferBlockLinks.length} links. BlockUploadId: ${this._internalBlockUploadId}`)):(i.validateParams(["relationType",n,"string"],["dataSize",a,"number"],["contentType",d,"string"],["componentId",c,"string",!0],["etag",h,"string",!0]),this._asset=o,x(this._asset.links,[t.LinkRelation.BLOCK_UPLOAD_INIT],s.DCXError.UNEXPECTED,"/rel/block/init missing from BlockTransferDocument."),this._relationType=n,this._dataSize=a,this._contentType=d,this._componentId=c,this._md5=l,this._ifMatch=h),this._promise=new u.default((e,t)=>{this._reject=t,this._resolve=e}),be.uploads.push(this)}init(){if(this._assertStateIsValid("init"),!this._blockTransferDocument){this._state=t.BlockTransferStates.INITIALIZING;const e=i.pruneUndefined({"repo:reltype":this._relationType.toString(),"repo:if-match":this._ifMatch,"repo:size":this._dataSize,"dc:format":this._contentType,component_id:this._componentId,"repo:md5":this._md5});return yt(this._svc,this._asset,e).then(e=>(this._blockTransferDocument=e.result,this._transferBlockLinks=this._blockTransferDocument[t.Properties.LINKS][t.LinkRelation.BLOCK_TRANSFER],this._finalizeDocumentSizeEstimate=JSON.stringify(this._blockTransferDocument).length,this._state=t.BlockTransferStates.INITIALIZED,At(`BlockUpload Initialized: Transfer document found with ${this._transferBlockLinks.length} links. BlockUploadId: ${this._internalBlockUploadId}`),this))}return this._finalizeDocumentSizeEstimate=JSON.stringify(this._blockTransferDocument).length,u.default.resolve(this)}get state(){return this._state}get promise(){return this._promise}start(){return this._assertStateIsValid("start"),be.uploads[0]!==this||this._state!==t.BlockTransferStates.INITIALIZED&&this._state!==t.BlockTransferStates.PAUSED||(At(`Starting the transfer of BlockUpload: ${this._internalBlockUploadId}`),this._state=t.BlockTransferStates.STARTED,this._uploadLoop()),this._promise}pause(){return this._assertStateIsValid("pause"),this._state=t.BlockTransferStates.PAUSING,u.default.allSettled(this._pendingBlockRequests).then(()=>(this._state=t.BlockTransferStates.PAUSED,At(`BlockUploading has been paused.  BlockUploadId: ${this._internalBlockUploadId}`),this))}resume(){return this._assertStateIsValid("resume"),At(`BlockUploading has been resumed.  BlockUploadId: ${this._internalBlockUploadId}`),this.start(),this}cancel(){this._assertStateIsValid("cancel"),this.state!==t.BlockTransferStates.ERROR&&(this._state=t.BlockTransferStates.CANCELED),At(`A BlockUpload has been canceled... BlockUploadId: ${this._internalBlockUploadId}`),this._promise.cancel(),this._cancel()}_setWaiting(){this._state=t.BlockTransferStates.WAITING}uploadNextBlock(e){if(this._assertStateIsValid("uploadNextBlock"),this._isEmptyBlock(e))throw new s.DCXError(s.DCXError.INVALID_PARAMS,"Trying to upload empty data block.");const r=this._blockTransferDocument[t.Properties.LINKS][t.LinkRelation.BLOCK_TRANSFER][this._currentBlockIndex].href;let o;At(`Uploading a block... BlockUploadId: ${this._internalBlockUploadId}`);const n=e.byteLength,i=this._uploadBlock(e,r).then(e=>(this._totalBlocksUploaded++,this._updateProgress(n),o(),At(`A block has completed... ${this._pendingBlocksCount} requests still active. BlockUploadId: ${this._internalBlockUploadId}`),e)).catch(e=>{At(`A block upload has failed. BlockUploadId: ${this._internalBlockUploadId}`),o(),this._state=t.BlockTransferStates.ERROR,this._reject(new s.DCXError(s.DCXError.UNEXPECTED_RESPONSE,"A block has failed during upload",e,e.response)),this.cancel()});return o=this._pushPendingBlockRequest(i),i}get _pendingBlocksCount(){return be.pendingUploadRequests.filter(e=>!!e).length}_nextBlockLock(){return this._pendingBlocksCount<4?Promise.resolve():Promise.race(be.pendingUploadRequests.filter(e=>!!e))}_uploadLoop(){this._nextBlockLock().then(()=>{if(this._state===t.BlockTransferStates.FINALIZING||this._state===t.BlockTransferStates.COMPLETE)throw t.BlockTransferStates.COMPLETE;if(this._state===t.BlockTransferStates.PAUSING||this._state===t.BlockTransferStates.PAUSED)throw t.BlockTransferStates.PAUSED;if(this._state===t.BlockTransferStates.CANCELED)throw t.BlockTransferStates.CANCELED;if(this._state===t.BlockTransferStates.ERROR)throw t.BlockTransferStates.ERROR}).then(()=>this._getBlockAtIndex(this._currentBlockIndex)).then(e=>this._isEmptyBlock(e)?(At(`No more blocks.  BlockUploadId: ${this._internalBlockUploadId}`),this._continueBlockUploads(),Promise.all(this._pendingBlockRequests).then(this._finalize.bind(this))):e&&e.byteLength>0&&this._currentBlockIndex>=this._transferBlockLinks.length?this._extend().then(()=>e):e).then(e=>{if(!e)throw t.BlockTransferStates.COMPLETE;this.uploadNextBlock(e),this._currentBlockIndex++}).then(()=>{this._uploadLoop()}).catch(e=>{if("string"!=typeof e&&(this._continueBlockUploads(),this._reject(e)),e!==t.BlockTransferStates.COMPLETE){if(e!==t.BlockTransferStates.PAUSED)return e===t.BlockTransferStates.CANCELED?(At(`BlockUpload loop is terminated due to the upload being canceled. BlockUploadId: ${this._internalBlockUploadId}`),void this._continueBlockUploads()):e===t.BlockTransferStates.ERROR?(At(`BlockUpload loop is terminated due to error state. BlockUploadId: ${this._internalBlockUploadId}`),void this._continueBlockUploads()):void 0;At(`BlockUpload loop is terminated due to paused state. BlockUploadId: ${this._internalBlockUploadId}`)}else At(`BlockUpload loop is complete. BlockUploadId: ${this._internalBlockUploadId}`)})}_getBlockAtIndex(e){if(this._state===t.BlockTransferStates.STARTED){const r=e*this._blockTransferDocument[t.BlockTransferProperties.REPO_BLOCK_SIZE];return Promise.resolve(this._getSliceCallback(r,r+this._blockTransferDocument[t.BlockTransferProperties.REPO_BLOCK_SIZE]).catch(()=>{throw new s.DCXError(s.DCXError.UNEXPECTED_RESPONSE,"The getSliceCallback threw an unexpected error.")}))}}_uploadBlock(e,r){return this._svc.invoke(t.HTTPMethods.PUT,r,void 0,e,{isStatusValid:X()})}_isEmptyBlock(e){return null==e||0===e.byteLength}_extend(){x(this._blockTransferDocument[t.Properties.LINKS],[t.LinkRelation.BLOCK_EXTEND],s.DCXError.UNEXPECTED,"The transfer document does not contain an extend href");const e=Math.ceil(1.5*this._blockTransferDocument[t.BlockTransferProperties.REPO_SIZE]),r=i.getLinkHrefTemplated(this._blockTransferDocument[t.Properties.LINKS],t.LinkRelation.BLOCK_EXTEND,{size:e});return this._svc.invoke(t.HTTPMethods.POST,r,{},void 0,{isStatusValid:X(),responseType:"json"}).then(e=>(this._indeterminateTransfer=!0,this._blockTransferDocument=e.response,this._transferBlockLinks=this._blockTransferDocument[t.Properties.LINKS][t.LinkRelation.BLOCK_TRANSFER],At(`Transfer document was extended to ${this._transferBlockLinks.length} transfer links. BlockUploadId: ${this._internalBlockUploadId}`),e)).catch(e=>{throw new s.DCXError(s.DCXError.UNEXPECTED_RESPONSE,"An unexpected error occurred while extending the block transfer document.",e,e.response)})}_pushPendingBlockRequest(e){const t=this._pendingBlockRequests.push(e),r=be.pendingUploadRequests.push(e);return()=>{delete this._pendingBlockRequests[t-1],delete be.pendingUploadRequests[r-1]}}_updateProgress(e){At("_updateProgress()",e);let r,s=Math.max(this._blockTransferDocument[t.BlockTransferProperties.REPO_SIZE],this._bytesUploaded)+this._finalizeDocumentSizeEstimate;if(!0===e?r=s:(r=this._bytesUploaded+=e,s+=e),this.onProgress&&i.isFunction(this.onProgress))try{this.onProgress(r,s,this._indeterminateTransfer)}catch(e){console.error("Error in onProgress callback",e)}}_cancel(){this._pendingBlockRequests.map(e=>{e&&e.cancel()}),this._state!==t.BlockTransferStates.ERROR&&this._resolve(this)}_assertStateIsValid(e,r){const o=r||this._state;switch(e){case"init":if(o!==t.BlockTransferStates.NOT_INITIALIZED&&o!==t.BlockTransferStates.INITIALIZED)throw new s.DCXError(s.DCXError.INVALID_STATE,"BlockUpload has already been initialized");break;case"start":if(o===t.BlockTransferStates.NOT_INITIALIZED)throw new s.DCXError(s.DCXError.INVALID_STATE,"Please call init before starting the block upload");break;case"pause":if(o!==t.BlockTransferStates.STARTED)throw new s.DCXError(s.DCXError.INVALID_STATE,"Cannot pause a transfer that has not been started");break;case"resume":if(o!==t.BlockTransferStates.PAUSED&&o!==t.BlockTransferStates.PAUSING)throw new s.DCXError(s.DCXError.INVALID_STATE,"Cannot resume a transfer that has not been paused");break;case"uploadNextBlock":if(o===t.BlockTransferStates.PAUSED||o===t.BlockTransferStates.CANCELED)throw new s.DCXError(s.DCXError.INVALID_STATE,"Cannot add block when Paused or Cancelled");break;case"getBlockAtIndex":if(o!==t.BlockTransferStates.STARTED)throw new s.DCXError(s.DCXError.INVALID_STATE,`Cannot fetch block while in the ${o} state`);break;case"cancel":if(o!==t.BlockTransferStates.STARTED&&o!==t.BlockTransferStates.FINALIZING&&o!==t.BlockTransferStates.PAUSING&&o!==t.BlockTransferStates.PAUSED&&o!==t.BlockTransferStates.ERROR)throw new s.DCXError(s.DCXError.INVALID_STATE,`Trying to cancel while in an invalid state ${o}`)}}_continueBlockUploads(){if(be.uploads[0]===this)if(be.uploads.shift(),be.uploads.length>0){const e=be.uploads[0];At("Another block upload found in the queue, starting..."),e.start()}else 0===this._pendingBlocksCount&&(At("There are no more pending block transfers.. Clean up blockUploadManager.."),be.resetUploads())}_finalize(){At(`Finalizing block transfer.  BlockUploadId: ${this._internalBlockUploadId}`),this._state=t.BlockTransferStates.FINALIZING;const e=i.getLinkHrefTemplated(this._blockTransferDocument[t.Properties.LINKS],t.LinkRelation.BLOCK_FINALIZE,{});return this._blockTransferDocument[t.Properties.LINKS][t.LinkRelation.BLOCK_TRANSFER]=this._transferBlockLinks.slice(0,this._totalBlocksUploaded),this._svc.invoke(t.HTTPMethods.POST,e,{[t.HeaderKeys.CONTENT_TYPE]:f},JSON.stringify(i.pruneUndefined(this._blockTransferDocument)),{isStatusValid:X(),retryOptions:{pollHeader:"location",pollCodes:[202],timeoutAfter:12e4}}).then(e=>{200!==e.statusCode&&201!==e.statusCode||(At(`Finalize complete.  BlockUploadId: ${this._internalBlockUploadId}`),this.finalizeResponse=e,this.uploadRecord=Et(this._blockTransferDocument.format,this._blockTransferDocument.component_id,this._bytesUploaded,e.response),this._state=t.BlockTransferStates.COMPLETE,this._updateProgress(!0),this._resolve(this)),this._continueBlockUploads()}).catch(e=>{At("Error occurred finalizing the block transfer.. Rejecting"),this._reject(new s.DCXError(s.DCXError.UNEXPECTED_RESPONSE,"An error occurred while finalizing the block transfer.",e,e.response)),this._continueBlockUploads()})}}function yt(e,r,o,n={}){if(i.validateParams(["svc",e,"object"],["asset",r,"object"],["transferDocument",o,"object"],["additionalHeaders",n,"object",!0]),x(r.links,[t.LinkRelation.BLOCK_UPLOAD_INIT]),o["repo:resource"]){if(!o["repo:resource"].reltype)throw new s.DCXError(s.DCXError.INVALID_DATA,"reltype param is required in the Resource Designator");o["repo:reltype"]=o["repo:resource"].reltype,o["repo:resource"].component_id&&(o.component_id=o["repo:resource"].component_id),o["repo:resource"].etag&&(o["repo:if-match"]=o["repo:resource"].etag),delete o["repo:resource"]}if(o["repo:reltype"]===t.LinkRelation.COMPONENT&&!o.component_id)throw new s.DCXError(s.DCXError.INVALID_DATA,"Component Id required to block upload to a component");const a=i.getLinkHref(r.links,t.LinkRelation.BLOCK_UPLOAD_INIT);n[t.HeaderKeys.CONTENT_TYPE]=f;const d=i.normalizeHeaders(n);return e.invoke(t.HTTPMethods.POST,a,d,JSON.stringify(o),{responseType:"json",isStatusValid:X()}).then(e=>({response:e,result:e.response}))}function It(e,r,o,n,a,d,c,l,h,p){if(Ct("_doBlockUpload()"),i.validateParams(["svc",e,"object"],["asset",r,"object"],["size",d,"number",!0],["md5",l,"string",!0],["etag",p,"string",!0]),mt(r,d,o)){if(!d)throw new s.DCXError(s.DCXError.INVALID_DATA,"A size estimate is required when a GetSliceCallback is provided. The size is used to determine the number of requests required to block transfer the asset.");let h=o;o&&!i.isFunction(o)&&(h=Me.bind(i.dataToBuffer(o))),x(r.links,[t.LinkRelation.BLOCK_UPLOAD_INIT]);const f=new Dt(e,h,r,a,d,n,c,l,p);return u.default.resolve(void 0,{blockUpload:f}).then(()=>f.init()).then(e=>e.start()).then(e=>{const t=e.finalizeResponse||{headers:{}};return{response:t,result:e.uploadRecord,blockUpload:e,isBlockUpload:!0,asset:{assetId:r.assetId||t.headers["asset-id"],repositoryId:r.repositoryId||t.headers["repository-id"],etag:t.headers.etag,links:r.links}}})}const f=o,_=d||gt(o);x(r.links,[a]);const m=i.getLinkHrefTemplated(r.links,a,{component_id:c});return u.default.resolve(void 0,{blockUpload:void 0}).then(()=>(function e(r,o,n,a,d,c,l,h,u=!1,p=!1,f={}){if(Ne("_doUpload()"),i.validateParams(["svc",r,"object"],["asset",o,"object"],["href",a,"string"],["headHref",d,"string"],["contentType",c,"string",!0],["maybeIsNew",l,"boolean",!0],["etag",h,"string",!0],["isRetry",u,"boolean",!0],["isBlockTransferUrl",p,"boolean",!0],["additionalHeaders",f,"object",!0]),null==l)return r.invoke(t.HTTPMethods.HEAD,d,f,void 0,{isStatusValid:X([404])}).then(t=>{const s=200!==t.statusCode;return e(r,o,n,a,d,c,s,h,u,p,f)});const _=l;return _?delete f[t.HeaderKeys.IF_MATCH]:f[t.HeaderKeys.IF_MATCH]=h||"*",c&&(f[t.HeaderKeys.CONTENT_TYPE]=c),r.invoke(t.HTTPMethods.PUT,a,f,n,{isStatusValid:X([404,409,412]),retryOptions:{pollHeader:"location",pollCodes:[202]}}).then(t=>{const i=t.statusCode;if(i>400&&!u){if(null!=h)throw X()(i,t);if(!_&&404===i)return e(r,o,n,a,d,c,!0,h,!0,p,f);if(404===i)throw new s.DCXError(s.DCXError.NOT_FOUND,"Unexpected response",void 0,t);if(409===i||412===i)return e(r,o,n,a,d,c,void 0,h,!0,p,f)}return t})})(e,r,f,m,m,n,h,p)).then(e=>{let t={};try{t=J(e)}catch(e){}return{response:e,result:{revision:e.headers.revision||e.headers.version,location:e.headers.location,links:t,etag:e.headers.etag,version:e.headers.version||e.headers.revision,md5:e.headers.md5||e.headers["content-md5"],length:_,type:n},isBlockUpload:!1,asset:{assetId:r.assetId||e.headers["asset-id"],repositoryId:r.repositoryId||e.headers["repository-id"],links:r.links||t}}}).catch(e=>{throw e})}const vt=be;class bt{constructor(e=1e5,t="SESSION"){if(this.values={},this.maxEntries=1e5,this.promiseToResolveMap=new Map,e<=0)throw new s.DCXError(s.DCXError.INVALID_PARAMS,"Cache Max enteries must be great than 0.");this.maxEntries=e,this.defaultSessionKey=t}clear(){this.promiseToResolveMap.forEach(e=>{e.call(void 0)});for(const e in this.values)this.values[e].clear();this.values={}}getKey(e){if(e.assetId||"object"!=typeof e)return e.assetId}getValueWithAsset(e){if(!e.assetId&&"object"==typeof e)return;const t=this.getKey(e);return t?this.get(t,e.repositoryId):void 0}setPending(e,t=this.defaultSessionKey){let r;this.values[t]||(this.values[t]=new Map);const s=this.values[t].get(e);if(s&&s instanceof Promise)return this.promiseToResolveMap.get(s);const o=new Promise(e=>{r=e});return this.values[t].set(e,o),this.promiseToResolveMap.set(o,r),o.then(()=>this.promiseToResolveMap.delete(o)).catch(()=>this.promiseToResolveMap.delete(o)),r}get(e,t=this.defaultSessionKey){if(this.values[t]&&t in this.values)return this.values[t].get(e)}setValueWithAsset(e,t){if(!e)return;const r=this.getKey(t);if(r){const s=t.repositoryId||this.defaultSessionKey;this.set(e,r,s)}}set(e,t,r=this.defaultSessionKey){if(this.values[r]){if(this.values[r]&&this.values[r].get(t)instanceof Promise){const s=this.values[r].get(t),o=this.promiseToResolveMap.get(s);this.promiseToResolveMap.delete(s),o&&o(e)}}else this.values[r]=new Map;if(this.values[r].size>=this.maxEntries){const e=this.values[r].keys().next().value;this.values[r].delete(e)}this.values[r].set(t,Promise.resolve(e))}delete(e,t=this.defaultSessionKey){this.values[t]&&this.values[t].delete(e)}deleteWithAsset(e){const t=this.getKey(e);t&&this.delete(t,e.repositoryId)}}function Tt(e){return e||"defaultbuffer"}function Pt(e,r,s="json"){i.validateParams(["svc",e,"object"],["asset",r,"object"],["format",s,"enum",!1,["json","xml"]]),x(r.links,[t.LinkRelation.EMBEDDED_METADATA]);const o=i.getLinkHref(r.links,t.LinkRelation.EMBEDDED_METADATA);return e.invoke(t.HTTPMethods.GET,o,{accept:t.EmbeddedMetadataMediaTypes[s.toUpperCase()],vary:"accept"},void 0,{isStatusValid:X(),responseType:"json"===s?"json":"text"}).then(e=>({result:e.response,response:e}))}function wt(e,r,s,o,n="json"){i.validateParams(["svc",e,"object"],["asset",r,"object"],["data",s,["string","object","object[]"]],["etag",o,"string",!0],["format",n,"enum",!1,["json","xml"]]),x(r.links,[t.LinkRelation.EMBEDDED_METADATA]);const a=i.getLinkHref(r.links,t.LinkRelation.EMBEDDED_METADATA);return e.invoke(t.HTTPMethods.PUT,a,{[t.HeaderKeys.CONTENT_TYPE]:t.EmbeddedMetadataMediaTypes[n.toUpperCase()],[t.HeaderKeys.IF_MATCH]:o},"string"==typeof s?s:JSON.stringify(s),{isStatusValid:X()})}function Rt(e,r,s,o){i.validateParams(["svc",e,"object"],["asset",r,"object"],["data",s,["string","object","object[]"]],["etag",o,"string",!0]),x(r.links,[t.LinkRelation.EMBEDDED_METADATA]);const n=i.getLinkHref(r.links,t.LinkRelation.EMBEDDED_METADATA);return e.invoke(t.HTTPMethods.PATCH,n,{[t.HeaderKeys.CONTENT_TYPE]:"application/json-patch+json",[t.HeaderKeys.IF_MATCH]:o},"string"==typeof s?s:JSON.stringify(s),{isStatusValid:X(),retryOptions:{pollCodes:[202],pollHeader:"location",pollMethod:"GET"}})}const Ot=o.newDebug("dcx:assets:filebase"),kt=o.newDebug("dcx:assets:filebase:leaf");class Lt extends We{constructor(e,r,s){super(e,r,s),this._data.width=null!=e.width?e.width:e[t.Properties.IMAGE_WIDTH],this._data.length=null!=e.length?e.length:e[t.Properties.IMAGE_LENGTH],this._data.renderable=null!=e.renderable?e.renderable:"object"==typeof this._data.links?t.LinkRelation.RENDITION in this._data.links:void 0}get width(){return this._data.width}get length(){return this._data.length}get renderable(){return this._data.renderable}getRendition(e,r){return Ot("getRendition()"),i.validateParams(["opts",e,"object",!0],["responseType",r,"string",!0]),this.fetchLinksIfMissing([t.LinkRelation.RENDITION]).then(()=>St(this._svc,this,e,r))}getEmbeddedMetadata(e="json"){return Ot("getEmbeddedMetadata()"),i.validateParams(["format",e,"enum",!1,["json","xml"]]),this.fetchLinksIfMissing([t.LinkRelation.EMBEDDED_METADATA]).then(()=>Pt(this._svc,this,e))}putEmbeddedMetadata(e,r,s="json"){return i.validateParams(["data",e,["object","object[]","string"]],["etag",r,"string",!0],["format",s,"enum",!1,["json","xml"]]),this.fetchLinksIfMissing([t.LinkRelation.EMBEDDED_METADATA]).then(()=>wt(this._svc,this,e,r,s)).then(this._updateDataWithResponse.bind(this))}patchEmbeddedMetadata(e,r){return i.validateParams(["data",e,["object","object[]","string"]],["etag",r,"string",!0]),this.fetchLinksIfMissing([t.LinkRelation.EMBEDDED_METADATA]).then(()=>Rt(this._svc,this,e,r)).then(this._updateDataWithResponse.bind(this))}blockDownload(e,r,s,o,n,a){Ot("blockDownload()"),i.validateParams(["startByte",e,"number",!0],["endByte",r,"number",!0],["resource",s,"string",!0],["componentId",o,"string",!0],["version",n,"string",!0],["responseType",a,"enum",!0,D]),i.assert(()=>null==e||null==r||e<r,"endByte must be greater than startByte");const d=Q({},a);return this._withSourcePromise(d).then(()=>this.fetchLinksIfMissing([t.LinkRelation.BLOCK_DOWNLOAD])).then(()=>Nt.call(d,this._svc,this,e,r,s,o,n,a))}updatePrimaryResource(e,r,s,o,n){Ot("updatePrimaryResource()");const a=i.isFunction(e)?t.LinkRelation.BLOCK_UPLOAD_INIT:t.LinkRelation.PRIMARY;return this.fetchLinksIfMissing([a]).then(()=>Mt(this._svc,this,e,r,s,o,n)).then(e=>(this._data.etag=e.result.etag,this._data.md5=e.result.md5,this._data.length=e.result.length,this._data.version=e.result.version,e))}}function St(e,r,s,o="defaultbuffer"){kt("getRendition()"),i.validateParams(["svc",e,"object"],["asset",r,"object"],["opts",s,"object",!0]),x(r.links,[t.LinkRelation.RENDITION]);const n=i.getLinkHrefTemplated(r.links,t.LinkRelation.RENDITION,Object.assign({},s));return e.invoke(t.HTTPMethods.GET,n,{},void 0,{responseType:Tt(o),isStatusValid:X()}).then(e=>({result:e.response,response:e}))}function Nt(e,r,s,o,n,a,d,c){kt("doBlockDownload()"),i.validateParams(["svc",e,"object"],["assetOrPresignedUrl",r,["object","string"]],["startByte",s,"number",!0],["endByte",o,"number",!0],["resource",n,"string",!0],["componentId",a,"string",!0],["version",d,"string",!0],["responseType",c,"enum",!0,D]),i.assert(()=>null==s||null==o||s<o,"endByte must be greater than startByte");const l=Q(this,c);if("string"==typeof r)return Oe.call(l,e,r,s,o,c,!0);const h=r;x(h.links,[t.LinkRelation.BLOCK_DOWNLOAD]);const u=i.getLinkHrefTemplated(h.links,t.LinkRelation.BLOCK_DOWNLOAD,{resource:n,component_id:a,revision:d});return Oe.call(l,e,u,s,o,c,!1)}function Mt(e,r,s,o,n,a,d){return kt("updatePrimaryResource()"),i.validateParams(["svc",e,"object"],["asset",r,"object"],["dataOrSliceCallback",s,["function","object","string"]],["contentType",o,"string"],["size",n,"number",!0],["md5",d,"string",!0]),x(r.links,[t.LinkRelation.PRIMARY]),It(e,r,s,o,t.LinkRelation.PRIMARY,n,void 0,d,!1,a)}const Xt=o.newDebug("dcx:assets:pagination");class xt{constructor(e,r,o){if(this._links=e,this._svc=r,this._transformer=o,this._items={},!e||!e[t.LinkRelation.PAGE])throw new s.DCXError(s.DCXError.INVALID_PARAMS,"Asset must have links that contain a page relation.")}get items(){return Object.values(this._items)}get data(){return this._data}getPage(e={}){Xt("getPage()");const{embed:r}=e,s=function(e,t){var r={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(r[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(e);o<s.length;o++)t.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(e,s[o])&&(r[s[o]]=e[s[o]])}return r}(e,["embed"]);r&&(s.embed=r.join(","));const o=i.getLinkHrefTemplated(this._links,t.LinkRelation.PAGE,s);return this._svc.invoke(t.HTTPMethods.GET,o,void 0,void 0,{isStatusValid:X(),responseType:"json"}).then(e=>{const t=this.parseResponse(e);return this._data=t,{paged:this,result:this._data,response:e}})}getNextPage(){if(Xt("getNextPage()"),this.hasNextPage()&&this._nextPageLink)return this._svc.invoke(t.HTTPMethods.GET,this._nextPageLink.href,void 0,void 0,{isStatusValid:X(),responseType:"json"}).then(e=>{const t=this.parseResponse(e);return this._data=t,{paged:this,result:this._data,response:e}})}hasNextPage(){return Xt("hasNextPage() ",void 0!==this._nextPageLink),void 0!==this._nextPageLink}[Symbol.asyncIterator](){return this}next(){return Ie(this,void 0,void 0,(function*(){if(Xt("next()"),!this.hasNextPage())return{done:!0,value:void 0};const e=yield this.getNextPage();return e?{done:!1,value:e}:{done:!0,value:void 0}}))}parseResponse(e){Xt("parseResponse()"),this._items={};const r=e.response;for(const s in r[t.Properties.CHILDREN]){const e=r[t.Properties.CHILDREN][s],[o,n]=this._transformer(e,this._svc);this._items[o]=n}return this._nextPageLink=r[t.Properties.LINKS].next,this.currentPage=r[t.Properties.PAGE],r}}const Ut=o.newDebug("dcx:assets:version"),jt=o.newDebug("dcx:assets:version:leaf");class Bt extends Lt{constructor(e,t,r){super(e,t,r),this._svc=t,this.type="version",this._data=Ft(e)}get milestone(){return this._data.milestone}getRepositoryResource(){throw Ut("getRepositoryResource()"),new s.DCXError(s.DCXError.NOT_IMPLEMENTED,"Method not implemented.")}getEffectivePrivileges(){throw Ut("getEffectivePrivileges()"),new s.DCXError(s.DCXError.NOT_IMPLEMENTED,"Method not implemented.")}performBulkRequest(e,t){throw Ut("performBulkRequest()"),new s.DCXError(s.DCXError.NOT_IMPLEMENTED,"Method not implemented.")}checkACLPrivilege(e,t){throw Ut("checkACLPrivilege()"),new s.DCXError(s.DCXError.NOT_IMPLEMENTED,"Method not implemented.")}getACLPolicy(){throw Ut("getACLPolicy()"),new s.DCXError(s.DCXError.NOT_IMPLEMENTED,"Method not implemented.")}}function Vt(e){jt("adobeVersionTransformer()");const t=Ft(e);return t.links=i.merge({},e.links,e._links),[t.version,t]}function Ht(e,t){jt("versionTransformer()");const r=new Bt(e,t);return[r.version,r]}function Ft(e){return jt("deserializeVersion()"),{version:e.version||e[t.VersionProperties.VERSION],createDate:e.created||e[t.VersionProperties.CREATED],createdBy:e.createdBy||e[t.VersionProperties.CREATED_BY],milestone:e.milestone||e[t.VersionProperties.MILESTONE],links:e._links}}const Yt=o.newDebug("dcx:assets:file"),Wt=o.newDebug("dcx:assets:file:leaf");class qt extends Lt{constructor(e,t,r){super(e,t,r),this.type="file"}getPagedVersions(e={itemTransformer:Ht}){return Yt("getPagedVersions()"),i.validateParams(["pageOpts",e,"object",!0]),this.fetchLinksIfMissing([t.LinkRelation.PAGE]).then(()=>Kt(this._svc,this,e))}getVersionResource(e){return Yt("getVersionResource()"),i.validateParams(["version",e,"string"]),this.fetchLinksIfMissing([t.LinkRelation.PAGE]).then(()=>Gt(this._svc,this,e).then(e=>({result:e.result?new Bt(e.result,this._svc):void 0,response:e.response})))}patchVersions(e,r){return Yt("patchVersions()"),i.validateParams(["patchDoc",e,["string","array"]],["etag",r,"string",!0]),this.fetchLinksIfMissing([t.LinkRelation.VERSION_HISTORY]).then(()=>zt(this._svc,this,e,r))}initBlockUpload(e,r){return i.validateParams(["transferDocument",e,"object"],["additionalHeaders",r,"object",!0]),this.fetchLinksIfMissing([t.LinkRelation.BLOCK_UPLOAD_INIT]).then(()=>yt(this._svc,this,e,r))}copy(e,t,r){return super.copy(e,t,r).then(({response:e,result:t})=>({response:e,result:new qt(t,this.serviceConfig)}))}}function zt(e,r,s,o){Wt("patchVersions()"),i.validateParams(["svc",e,"object"],["asset",r,"object"],["patchDoc",s,["string","array"]],["etag",o,"string",!0]),x(r.links,[t.LinkRelation.VERSION_HISTORY]);const n={[t.HeaderKeys.CONTENT_TYPE]:"application/json-patch+json"};o&&(n[t.HeaderKeys.IF_MATCH]=o);const a=i.getLinkHref(r.links,t.LinkRelation.VERSION_HISTORY);return e.invoke(t.HTTPMethods.PATCH,a,n,"string"==typeof s?s:JSON.stringify(s),{isStatusValid:X()})}function Gt(e,r,s){Wt("getVersionResource()"),i.validateParams(["svc",e,"object"],["asset",r,"object"],["version",s,"string"]),x(r.links,[t.LinkRelation.PAGE]),j(r.links,t.LinkRelation.PAGE,"type","application/vnd.adobe.versions+json");const o=i.getLinkHrefTemplated(r.links,t.LinkRelation.PAGE,{version:s});return e.invoke(t.HTTPMethods.GET,o,{},void 0,{responseType:"json",isStatusValid:X()}).then(e=>({result:e.response[t.VersionProperties.TOTAL_CHILDREN]>0?e.response[t.Properties.CHILDREN][0]:void 0,response:e}))}function Kt(e,r,s={}){return Wt("getPagedVersions()"),i.validateParams(["svc",e,"object"],["asset",r,"object"],["pageOpts",s,"object"]),x(r.links,[t.LinkRelation.PAGE]),j(r.links,t.LinkRelation.PAGE,"type","application/vnd.adobe.versions+json"),new xt(r.links,e,s.itemTransformer||Vt).getPage(s)}const $t=o.newDebug("dcx:assets:composite"),Jt=o.newDebug("dcx:assets:composite:leaf");class Zt extends qt{constructor(e,t,r){super(e,t,r),this.type="composite"}headManifest(){return $t("headManifest()"),this.fetchLinksIfMissing([t.LinkRelation.MANIFEST]).then(()=>Qt(this._svc,this))}getManifest(e,r){return $t("getManifest()"),i.validateParams(["version",e,"string",!0],["etag",r,"string",!0]),this.fetchLinksIfMissing([t.LinkRelation.MANIFEST]).then(()=>er(this._svc,this,e,r))}getManifestUrl(e){$t("getManifestUrl()");const r=null==e?t.LinkRelation.MANIFEST:t.LinkRelation.PAGE;return this.fetchLinksIfMissing([r]).then(()=>tr(this._svc,this,e))}getComponent(e,r,s,o){$t("getComponent()");const n=Q({},s);return this._withSourcePromise(n).then(()=>this.fetchLinksIfMissing([t.LinkRelation.COMPONENT])).then(()=>sr.call(n,this._svc,this,e,r,s,o))}getComponentUrl(e,r){return $t("getComponentUrl()"),this.fetchLinksIfMissing([t.LinkRelation.COMPONENT]).then(()=>rr(this._svc,this,e,r))}updateManifest(e,r,s,o){return $t("updateManifest()"),this.fetchLinksIfMissing([t.LinkRelation.MANIFEST]).then(()=>or(this._svc,this,e,r,s,o)).then(this._updateDataWithResponse.bind(this))}putComponent(e,r,s,o,n,i){return $t("putComponent()"),this.fetchLinksIfMissing([t.LinkRelation.COMPONENT]).then(()=>nr(this._svc,this,e,r,s,o,n,i))}copy(e,t,r){return super.copy(e,t,r).then(({response:e,result:t})=>({response:e,result:new Zt(t,this.serviceConfig)}))}}function Qt(e,r){Jt("headCompositeManifest()"),i.validateParams(["svc",e,"object"],["asset",r,"object"]),x(r.links,[t.LinkRelation.MANIFEST]);const s=i.getLinkHref(r.links,t.LinkRelation.MANIFEST);return e.invoke(t.HTTPMethods.HEAD,s,{},void 0,{responseType:"json",isStatusValid:X()})}function er(e,r,s,o){return Jt("getCompositeManifest()"),i.validateParams(["svc",e,"object"],["asset",r,"object"],["version",s,"string",!0],["etag",o,"string",!0]),x(r.links,[t.LinkRelation.MANIFEST]),tr(e,r,s).then(r=>e.invoke(t.HTTPMethods.GET,r,o?{[t.HeaderKeys.IF_NONE_MATCH]:o}:{},void 0,{responseType:"json",isStatusValid:X([304])})).then(e=>({manifestData:e.response||null,manifestEtag:e.headers.etag,response:e}))}function tr(e,r,o){return Jt("getCompositeManifestUrl()"),i.validateParams(["svc",e,"object"],["asset",r,"object"],["versionId",o,"string",!0]),u.default.resolve().then(()=>{if(o)return Gt(e,r,o)}).then(e=>{if(null!=o){if(!e||!i.isObject(e)||"object"!=typeof e.result)throw new s.DCXError(s.DCXError.UNEXPECTED_RESPONSE,"Invalid version resource.",void 0,e?e.response:void 0);return x(e.result[t.Properties.LINKS],[t.LinkRelation.MANIFEST]),i.getLinkHref(e.result[t.Properties.LINKS],t.LinkRelation.MANIFEST)}return i.getLinkHref(r.links,t.LinkRelation.MANIFEST)})}function rr(e,r,s,o){return Jt("getCompositeComponentUrl()"),i.validateParams(["svc",e,"object"],["asset",r,"object"],["componentId",s,"string"],["version",o,"string",!0]),x(r.links,[t.LinkRelation.COMPONENT]),i.getLinkHrefTemplated(r.links,t.LinkRelation.COMPONENT,{component_id:s,revision:o})}function sr(e,r,s,o,n="defaultbuffer",a={}){Jt("getCompositeComponent()"),i.validateParams(["svc",e,"object"],["asset",r,"object"],["componentId",s,"string"],["version",o,"string",!0],["responseType",n,"string",!0],["addlHeaders",a,"object",!0]);const d=rr(e,r,s,o),c=Q(this,n);return Xe.call(c,e,r,d,t.LinkRelation.COMPONENT,n,s,o,a)}function or(e,r,o,n,a=1,d){if(Jt("updateCompositeManifest() ",n,d),i.validateParams(["svc",e,"object"],["asset",r,"object"],["manifest",o,["object","string"]],["overwrite",n,"boolean"],["validationLevel",a,"+number"],["etag",d,"string",!0]),a<1)throw new s.DCXError(s.DCXError.INVALID_PARAMS,"ValidationLevel must be >=1");return x(r.links,[t.LinkRelation.BULK_REQUEST,t.LinkRelation.REPO_METADATA]),tr(e,r).then(r=>{const s={};n?s[t.HeaderKeys.IF_MATCH]="*":d&&(s[t.HeaderKeys.IF_MATCH]=d);const i=`application/vnd.adobe.dcx-manifest+json; validation-level=${a}`;return s[t.HeaderKeys.CONTENT_TYPE]=i,e.invoke(t.HTTPMethods.PUT,r,s,"string"==typeof o?o:JSON.stringify(o),{isStatusValid:X([412,409]),responseType:"json"})}).then(t=>{if(Jt("uCM() status code: ",t.statusCode),412===t.statusCode&&n)return Jt("uCM() retry 412 without overwrite"),or(e,r,o,!1,a,void 0);if(409===t.statusCode&&n)return Jt("uCM() retry 409 without overwrite"),or(e,r,"string"==typeof o?o:JSON.stringify(o),!1,a,d);if(409===t.statusCode)throw new s.DCXError(s.DCXError.UPDATE_CONFLICT,"Manifest has been changed",void 0,t);if(412===t.statusCode)throw new s.DCXError(s.DCXError.PRECONDITION_FAILED,"Precondition failed",void 0,t);return t})}function nr(e,r,s,o,n,a,d,c){return i.validateParams(["svc",e,"object"],["asset",r,"object"],["componentId",s,"string"],["contentType",n,"string"],["maybeIsNew",a,"boolean",!0],["size",d,"number",!0],["md5",c,"string",!0]),It(e,r,o,n,t.LinkRelation.COMPONENT,d,s,c,a).then(({response:e,result:t,isBlockUpload:r,asset:o})=>{const i={response:e,result:Object.assign(Object.assign({},t),{id:s,type:n}),isBlockUpload:r,asset:o};return Object.defineProperty(i,"compositeAsset",{get:()=>o}),i})}const ir=o.newDebug("dcx:assets:directory"),ar=o.newDebug("dcx:assets:directory:leaf");class dr extends We{constructor(e,r,s){super(e,r,s),this.type="directory",this.children=[],this.children=e[t.Properties.CHILDREN]}getPagedChildren(e){return ir("getPagedChildren()"),this.fetchLinksIfMissing([t.LinkRelation.PAGE]).then(()=>hr(this._svc,this,e))}createAsset(e,r,s,o,n){return ir("createAsset()"),i.validateParams(["relPath",e,"string"],["createIntermediates",r,"boolean"],["contentType",s,"string"],["additionalHeaders",n,"object",!0]),this.fetchLinksIfMissing([t.LinkRelation.CREATE]).then(()=>ur(this._svc,this,e,r,s,o,n)).then(e=>(this._cache&&e.result.links&&this._cache.setValueWithAsset(e.result.links,e.result),{result:new We(e.result,this.serviceConfig),response:e.response}))}copy(e,t,r){return super.copy(e,t,r).then(({response:e,result:t})=>({response:e,result:new dr(t,this.serviceConfig)}))}}function cr(e){ar("directoryTransformer()");const r=se(e);r.links=i.merge({},e.links,e._links);const s=e.children||e[t.Properties.CHILDREN];return s&&s.length>0&&(r.children=s.map(e=>se(e))),[r.assetId,r]}function lr(e,r){return ar("getDirectoryByURL()"),e.invoke(t.HTTPMethods.GET,r,void 0,void 0,{responseType:"json",isStatusValid:X()}).then(e=>({result:e.response,response:e}))}function hr(e,r,o={}){if(ar("getPagedChildren()"),x(r.links,[t.LinkRelation.PAGE]),o&&o.embed&&o.embed.includes(t.LinkRelation.REPOSITORY))throw new s.DCXError(s.DCXError.INVALID_PARAMS,"Repository Resource embeds on directory listings are not supported");try{return new xt(r.links,e,cr).getPage(o)}catch(s){return u.default.reject(s)}}function ur(e,r,s,o,n,a,d={}){ar("createAsset()"),i.validateParams(["service",e,"object"],["parentDir",r,"object"],["relPath",s,"string"],["createIntermediates",o,"boolean"],["contentType",n,"string"],["additionalHeaders",d,"object",!0]),x(r.links,[t.LinkRelation.CREATE]),a="RepositoryMetadata"===a?t.LinkRelation.REPO_METADATA:a;const c=i.isObject(a)?JSON.stringify(a):a,l=i.getLinkHrefTemplated(r.links,t.LinkRelation.CREATE,{path:s,intermediates:o.toString(),respondWith:c,mode:"id"}),h=Object.assign({},{[t.HeaderKeys.CONTENT_TYPE]:n},d);return e.invoke(t.HTTPMethods.POST,l,h,void 0,{responseType:"json",isStatusValid:X()}).then(e=>{const o=s.split("/")[s.split("/").length-1];let d;r.path&&(d=i.appendPathElements(r.path,s));const c=J(e),l=e.headers,h=i.isObject(e.response)?e.response:{etag:"",md5:""},u=l["asset-id"]||l["x-resource-id"],p=r.repositoryId;let f=h.etag,_=h.md5;null==a&&(f=l.etag,_=l["content-md5"]);const m=i.isObject(e.response)&&a&&(a===t.LinkRelation.REPO_METADATA||i.isObject(a)&&a.reltype===t.LinkRelation.REPO_METADATA)?se(e.response):{};return{result:i.pruneUndefined(i.mergeDeep({name:o},m,i.pruneUndefined({links:c,assetId:u,etag:f,md5:_,repositoryId:p,format:n,path:d}))),response:e}})}const pr=o.newDebug("dcx:assets:discoverable");function fr(e){pr("discoverableAssetTransformer()");const r=e[t.Properties.EMBEDDED][t.LinkRelation.REPO_METADATA],s=se(r,e[t.Properties.EMBEDDED]);return s.links=i.merge({},e.links,r._links),[s.assetId,s]}function _r(e){pr("discoverableReposTransformer()");const r=e[t.Properties.EMBEDDED][t.LinkRelation.PRIMARY],s=oe(r);return s.links=r._links,[s.repositoryId,s]}var mr;t.RenditionType=void 0,(mr=t.RenditionType||(t.RenditionType={})).IMAGE_JPG="image/jpg",mr.IMAGE_PNG="image/png",mr.VIDEO_METADATA="application/vnd.adobe.ccv.videometadata";const gr=o.newDebug("dcx:assets:factory");function Er(e,t){gr("hydrateAsset()"),i.validateParams(["asset",e,"object"],["svc",t,"object"]);const r=e.format||"",s=r.endsWith("+dcx")?"composite":r===p?"directory":r.split("/").length>1?"file":"asset";switch(s){case"directory":return e.type===s&&e instanceof dr?e:new dr(e,t);case"composite":return e.type===s&&e instanceof Zt?e:new Zt(e,t);case"file":return e.type===s&&e instanceof qt?e:new qt(e,t);case"asset":return e.type===s&&e instanceof We?e:new We(e,t);default:return new We(e,t)}}const Ar=o.newDebug("dcx:assets:indexdocument");function Cr(e){Ar("deserializeIndexDocument()");const r=e.children.map(e=>{const r=se(e[t.Properties.EMBEDDED][t.LinkRelation.REPO_METADATA]),s=oe(e[t.Properties.EMBEDDED][t.LinkRelation.REPOSITORY]);return r.embedded={RepositoryResource:s},r});return{regions:e[t.Properties.REPO_REGIONS],assignedDirectories:r,links:e._links}}const Dr=o.newDebug("dcx:assets:versionset"),yr=o.newDebug("dcx:assets:versionset:leaf");t.ACLPolicyMediaType="application/vnd.adobecloud.accesscontrolpolicy+json",t.Asset=We,t.AssetFactory=class{constructor(e){this._svc=e}hydrate(e){return Er(e,this._svc)}},t.BlockTransferMediaType=f,t.BlockUpload=Dt,t.Composite=Zt,t.DEFAULT_BLOCK_DOWNLOAD_THRESHOLD=52428800,t.DEFAULT_BLOCK_UPLOAD_THRESHOLD=10485760,t.DEFAULT_CACHE_MAX_ENTRIES=1e5,t.DEFAULT_MAX_CONCURRENT_REQUESTS=4,t.Directory=dr,t.DirectoryMediaType=p,t.File=qt,t.GenericCache=bt,t.JSONLDMediaType="application/ld+json",t.JSONMediaType="application/json",t.JSONPatchMediaType="application/json-patch+json",t.LeafContext=te,t.MAX_CACHE_PERIOD_MS=2592e6,t.ManifestMediaType="application/vnd.adobe.dcx-manifest+json",t.OperationDocumentBuilder=me,t.OperationDocumentMediaType="application/vnd.adobe.asset-operation+json",t.PageResource=xt,t.RepositoryLinksCache=class extends bt{constructor(e=1e5,t=2592e6){super(e,"SESSION"),this.timestampsOnLinkCreation=0,this.maxCachePeriodMS=0,this.maxCachePeriodMS=t}isLinkExpired(){return this.maxCachePeriodMS<Date.now()-this.timestampsOnLinkCreation}setIndexLinks(e){this.set(e,"INDEX","SESSION"),this.timestampsOnLinkCreation=Date.now()}getIndexLinks(){if(!this.isLinkExpired())return this.get("INDEX","SESSION")}setIndexRepository(e){this.indexRepository=e}getIndexRepository(){return this.indexRepository}},t.Version=Bt,t.VersionSet=class{constructor(e,r,s){this._svc=r,this.versionCount=e.versionCount||e[t.VersionProperties.TOTAL_CHILDREN],this.repositoryId=e.repositoryId||e[t.Properties.REPO_REPOSITORY_ID],this.assetId=e.assetId||e[t.Properties.REPO_ASSET_ID],this.versions=[];for(const o in e.versions||e[t.Properties.CHILDREN])this.versions.push(new Bt(e.versions&&e.versions[o]?e.versions[o]:e[t.Properties.CHILDREN][o],r));this.links=i.merge({},e.links,e._links,s)}versionByVersionId(e){return Dr("versionByVersionId()"),this.versions.find(t=>t.version===e)}versionsByLabel(e){return Dr("versionsByLabel()"),this.versions.filter(t=>!(!t.milestone||t.milestone.label!==e))}},t.adobeVersionTransformer=Vt,t.assertLinksContain=x,t.assertLinksContainAny=U,t.assertValidBulkRequest=Ve,t.assetTransformer=function(e){Ye("assetTransformer()");const t=se(e);return t.links=i.merge({},e.links,e._links),[t.assetId,t]},t.blockTransferManager=vt,t.bodyToUint8Array=je,t.buildRangeHeader=Le,t.checkACLPrivilege=at,t.constructMultipartRequestBody=Ue,t.constructServiceEndpoint=S,t.convertToACPRepoMetadataResource=function(e){re("convertToACPRepoMetadataResource()");const r={};return r[t.Properties.REPO_REPOSITORY_ID]=e[t.Properties.REPO_REPOSITORY_ID]||e.repositoryId,r[t.Properties.REPO_ASSET_ID]=e[t.Properties.REPO_ASSET_ID]||e.assetId,r[t.Properties.REPO_NAME]=e[t.Properties.REPO_NAME]||e.name,r[t.Properties.REPO_SIZE]=null!=e[t.Properties.REPO_SIZE]?e[t.Properties.REPO_SIZE]:e.size,r[t.Properties.REPO_PATH]=e[t.Properties.REPO_PATH]||e.path,r[t.Properties.REPO_ASSET_CLASS]=e[t.Properties.REPO_ASSET_CLASS]||e.etag,r[t.Properties.REPO_ETAG]=e[t.Properties.REPO_ETAG]||e.etag,r[t.Properties.REPO_VERSION]=e[t.Properties.REPO_VERSION]||e.version,r[t.Properties.DC_FORMAT]=e[t.Properties.DC_FORMAT]||e.format,r[t.Properties.REPO_CREATE_DATE]=e[t.Properties.REPO_CREATE_DATE]||e.createDate,r[t.Properties.REPO_MODIFY_DATE]=e[t.Properties.REPO_MODIFY_DATE]||e.modifyDate||e.modifiedDate,r[t.Properties.REPO_DISCARD_DATE]=e[t.Properties.REPO_DISCARD_DATE]||e.discardDate,r[t.Properties.REPO_CREATED_BY]=e[t.Properties.REPO_CREATED_BY]||e.createdBy,r[t.Properties.REPO_MODIFIED_BY]=e[t.Properties.REPO_MODIFIED_BY]||e.modifiedBy,r[t.Properties.REPO_DISCARDED_BY]=e[t.Properties.REPO_DISCARDED_BY]||e.discardedBy,r[t.Properties.REPO_DEVICE_CREATE_DATE]=e[t.Properties.REPO_DEVICE_CREATE_DATE]||e.deviceCreateDate,r[t.Properties.REPO_DEVICE_MODIFY_DATE]=e[t.Properties.REPO_DEVICE_MODIFY_DATE]||e.deviceModifyDate,r[t.Properties.REPO_BASE_ASSET_ID]=e[t.Properties.REPO_BASE_ASSET_ID]||e.baseAssetId,r[t.Properties.REPO_STATE]=e[t.Properties.REPO_STATE]||e.state,r[t.Properties.LINKS]=e[t.Properties.LINKS]||e.links,i.pruneUndefined(r)},t.copyAsset=ae,t.createAsset=ur,t.defaultBufferResponseType=Tt,t.deleteACLPolicy=ct,t.deleteAsset=le,t.deserializeAsset=se,t.deserializeIndexDocument=Cr,t.deserializeRepository=oe,t.deserializeUploadComponentRecord=Et,t.deserializeVersion=Ft,t.deserializeVersionSet=function(e){yr("deserializeVersionSet()");const r={versionCount:e[t.VersionProperties.TOTAL_CHILDREN],repositoryId:e[t.VersionProperties.REPO_ID],assetId:e[t.Properties.REPO_ASSET_ID],links:{},versions:[]},s=e.children||e[t.Properties.CHILDREN];return s&&s.length>0&&(r.versions=s.map(e=>Ft(e))),r.links=e._links,r},t.directoryTransformer=cr,t.discardAsset=ce,t.discoverableAssetTransformer=fr,t.discoverableReposTransformer=_r,t.doBatchOperation=function(e,t,r,s){return _e(e,t,r,s).then(pe)},t.doBlockDownload=Nt,t.doLinksContain=B,t.doOperation=_e,t.doesAssetContainLinks=V,t.fetchLinksForAsset=$e,t.fetchLinksForAssetWithResponse=Je,t.fetchLinksIfMissing=ht,t.getACLPolicy=it,t.getAppMetadata=rt,t.getBaseDirectoryMetadata=Qe,t.getCompositeComponent=sr,t.getCompositeComponentPresignedUrl=function(e,r,o,n){Jt("getCompositeComponentPresignedUrl()"),i.validateParams(["svc",e,"object"],["asset",r,"object"],["componentId",o,"string"],["version",n,"string",!0]),x(r.links,[t.LinkRelation.BLOCK_DOWNLOAD]);const a=i.getLinkHrefTemplated(r.links,t.LinkRelation.BLOCK_DOWNLOAD,{revision:n,component_id:o,resource:t.LinkRelation.COMPONENT});return e.invoke(t.HTTPMethods.GET,a,void 0,void 0,{isStatusValid:X(),responseType:"json",retryOptions:{pollCodes:[202],pollHeader:"location",pollMethod:t.HTTPMethods.GET}}).then(e=>{if("string"!=typeof e.response.href)throw new s.DCXError(s.DCXError.INVALID_DATA,"Direct download URL not found.",void 0,e);return{response:e,result:e.response.href}})},t.getCompositeComponentUrl=rr,t.getCompositeManifest=er,t.getCompositeManifestUrl=tr,t.getDataLength=gt,t.getDirectory=function(e,r){return ar("directoryTransformer()"),ht(e,r,[t.LinkRelation.PRIMARY]).then(r=>lr(k(e),i.getLinkHref(r,t.LinkRelation.PRIMARY)))},t.getDirectoryByURL=lr,t.getDiscoverableAssets=function(e,r={}){pr("getDiscoverableAssets()"),i.validateParams(["svc",e,"object"],["pageOpts",r,"object"]);const s=k(e);return $(s).then(e=>{const r=i.getLinkHref(e.assetLinks,t.LinkRelation.PRIMARY);return s.invoke(t.HTTPMethods.HEAD,r,void 0,void 0,{isStatusValid:X()})}).then(e=>{const t=J(e);return new xt(t,s,fr).getPage(r)}).then(e=>({result:e.response.response,paged:e.paged,response:e.response}))},t.getDiscoverableRepos=function(e,r={}){pr("getDiscoverableRepos()"),i.validateParams(["svc",e,"object"],["pageOpts",r,"object"]);const s=k(e);return $(s).then(e=>{const r=i.getLinkHref(e.repositoryLinks,t.LinkRelation.PRIMARY);return s.invoke(t.HTTPMethods.HEAD,r,void 0,void 0,{isStatusValid:X()})}).then(e=>{const t=J(e);return new xt(t,s,_r).getPage(r)}).then(e=>({result:e.response.response,paged:e.paged,response:e.response}))},t.getEffectivePrivileges=nt,t.getEmbeddedMetadata=Pt,t.getHTTPResource=z,t.getIndexDocument=function(e){Ar("getIndexDocument()"),i.validateParams(["svc",e,"object"]);const r=k(e);return $(r).then(e=>{const s=i.getLinkHref(e.indexLinks,t.LinkRelation.PRIMARY);return r.invoke(t.HTTPMethods.GET,s,void 0,void 0,{responseType:"json",isStatusValid:X()})}).then(e=>({result:Cr(e.response),response:e.response}))},t.getIndexLinks=K,t.getIndexRepository=$,t.getLinksForAsset=Ze,t.getLinksFromCache=pt,t.getOpsHref=ee,t.getOrMakeStreamableContext=Q,t.getPagedChildren=hr,t.getPagedVersions=Kt,t.getPrimaryResource=qe,t.getRendition=St,t.getRepoMetadata=function(e,r){Ye("getRepoMetadata()"),i.validateParams(["svc",e,"object"],["asset",r,"object"]),x(r.links,[t.LinkRelation.REPO_METADATA]);const s=i.getLinkHref(r.links,t.LinkRelation.REPO_METADATA);return e.invoke(t.HTTPMethods.GET,s,void 0,void 0,{responseType:"json",isStatusValid:X()}).then(e=>{const r=J(e),s=e.response;return s[t.Properties.LINKS]=i.merge({},s[t.Properties.LINKS],r),{result:s,response:e}})},t.getRepositoryResource=et,t.getReposityLinksCache=L,t.getResolveByIdHref=function(e){if(i.isObject(this)){if("string"==typeof this.resolveByIdHref)return u.default.resolve(this.resolveByIdHref);if(i.isFunction(this.resolveByIdHref))return u.default.resolve(this.resolveByIdHref())}return K(e).then(e=>{try{return i.getLinkHref(e,t.LinkRelation.RESOLVE_BY_ID)}catch(e){throw new s.DCXError(s.DCXError.UNEXPECTED,"Could not get ResolveByID href.",e)}})},t.getResolveByPathHref=function(e){if(i.isObject(this)){if("string"==typeof this.resolveByPathHref)return u.default.resolve(this.resolveByPathHref);if(i.isFunction(this.resolveByPathHref))return u.default.resolve(this.resolveByPathHref())}return K(e).then(e=>{try{return i.getLinkHref(e,t.LinkRelation.RESOLVE_BY_PATH)}catch(e){throw new s.DCXError(s.DCXError.UNEXPECTED,"Could not get ResolveByPath href.",e)}})},t.getResolveLinkForAsset=Ge,t.getService=k,t.getVersionResource=Gt,t.headAppMetadata=tt,t.headCompositeManifest=Qt,t.headHTTPResource=q,t.headPrimaryResource=ze,t.hydrateAsset=Er,t.isAdobeResponseLike=y,t.isBufferLike=b,t.isHttpService=P,t.isMinimalAdobeAsset=function(e){return!!i.isObject(e)&&(i.isObject(e.links)||"string"==typeof e.repositoryId&&("string"==typeof e.path||"string"==typeof e.assetId))},t.isRepoResponseLike=I,t.isRepoResponseResultLike=v,t.isResolvableAsset=T,t.isServiceConfig=w,t.isTransferDocument=R,t.moveAsset=de,t.newBlockDownload=Re,t.newOperationDocBuilder=function(){return new me},t.packageAssets=ue,t.parseLinkString=Z,t.parseLinksFromResponseHeader=J,t.parseMultipartResponseParts=Be,t.patchACLPolicy=dt,t.patchAppMetadata=ot,t.patchEmbeddedMetadata=Rt,t.patchVersions=zt,t.performBulkRequest=He,t.putACLPolicy=function(e,t,r){return Ye("putACLPolicy()"),dt(e,t,r)},t.putAppMetadata=st,t.putCompositeComponent=nr,t.putEmbeddedMetadata=wt,t.resolveAsset=Ke,t.restoreAsset=he,t.shouldUseBlockTransferForDownload=(e,t=52428800)=>((e,t)=>e>=t)(e,t),t.shouldUseBlockTransferForUpload=mt,t.updateCompositeManifest=or,t.updatePrimaryResource=Mt,t.useLinkOrResolveResource=lt,t.versionTransformer=Ht,t.waitForBlockDownloadToStart=function(e){return new Promise(t=>{let r;e.finally(()=>{clearTimeout(r),t()}),function s(){if(i.isObject(e.blockDownload))return clearTimeout(r),t();r=setTimeout(s,1)}()})}}).call(this,r(10).Buffer)},3792:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=r(3078);var o=function(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}(r(3079));let n=!1;const i=globalThis;var a,d;n||(n=!0,i.dcxjs={_modules:{}},Object.assign(i.dcxjs,{getModule:e=>{var t;return null===(t=i.dcxjs)||void 0===t?void 0:t.modules[e]},registerModule:(e,t)=>{const r=i.dcxjs;if(!r)throw new Error("[@dcx/core] Namespace not yet initialized.");if(e in r.modules)throw new Error(`[@dcx/core] Module ${e} already registered.`);r.modules[e]={module:t}}}),Object.defineProperty(i.dcxjs,"modules",{get:()=>i.dcxjs._modules}),null===(a=i.dcxjs)||void 0===a||a.registerModule("AdobeDCXLogger",s.AdobeDCXLogger),Object.defineProperty(i.dcxjs,"logger",{get:()=>{var e;return null===(e=i.dcxjs)||void 0===e?void 0:e.getModule("AdobeDCXLogger").module},enumerable:!0}),null===(d=i.dcxjs)||void 0===d||d.registerModule("AdobeDCXPromise",o.default));const c=globalThis.dcxjs;t.dcxjs=c,t.default=c,t.getModule=e=>{var t;const r=i.dcxjs;if(!r)throw new Error("[@dcx/core] Namespace not yet initialized.");return null===(t=r.getModule(e))||void 0===t?void 0:t.module}},3793:function(e,t,r){"use strict";(function(e,s,o,n){Object.defineProperty(t,"__esModule",{value:!0});var i=r(4603),a=r(2785);const d=e=>c(e)&&l(e.pipe),c=e=>null!=e&&"object"==typeof e,l=e=>"[object Function]"===toString.call(e),h=e=>Array.isArray(e),u=()=>{try{return"[object process]"===Object.prototype.toString.call(e.process)}catch(i){return!1}},p=()=>"object"==typeof self&&self.self===self,f=()=>"browser",_=(...e)=>{if(!e||!Array.isArray(e)||e.length<1)return{};const t=e.shift();for(;e.length>0;){const r=e.shift();if("object"==typeof r)for(const e in r)Object.prototype.hasOwnProperty.call(r,e)&&(t[e]=r[e])}return t},m=(e,...t)=>{if(!t.length)return e;const r=t.shift();if(c(e)&&c(r))for(const s in r)c(r[s])&&!h(r[s])?(e[s]||Object.assign(e,{[s]:{}}),m(e[s],r[s])):(h(e[s])&&h(r[s]),Object.assign(e,{[s]:r[s]}));return m(e,...t)},g=/^[^\u0000-\u001F\u0022\u002A\u003A\u003C\u003E\u003F\u005C\u007F]*[^\u0000-\u001F\u0022\u002A\u002E\u003A\u003C\u003E\u003F\u005C\u007F]{1}$/,E=(e,t=!1)=>{try{if(e.length>65535)return!1;const r=(t?e.slice(1):e).split("/");if(!r||0===r.length)return!1;const s=r.length;for(let e=0;e<s;e++)if(r[e].length>255||!g.test(r[e]))return!1;if(t&&r.length>0){const e=r[0];if("manifest"===e||"mimetype"===e)return!1}return!0}catch(e){return!1}},A=()=>{},C=(e,t,r)=>{const s={};let o,n=Object.keys(e),i=n.length;for(let a=0;a<i;a++){if(o=n[a],!r||!r[o]){const s=e[o],n=t[o];if(typeof s!=typeof n)return!1;if(c(s)&&c(n)){if(!C(s,n,r))return!1}else if(s!==n)return!1}s[o]=!0}n=Object.keys(t),i=n.length;for(let a=0;a<i;a++)if(o=n[a],!s[o])return!1;return!0},D=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?"),y=e=>{const t=e.match(D)||[];return{scheme:t[2],authority:t[4],path:t[5],query:t[7],fragment:t[9]}},I="0".charCodeAt(0),v="1".charCodeAt(0),b="9".charCodeAt(0),T="a".charCodeAt(0),P="A".charCodeAt(0),w="f".charCodeAt(0),R="F".charCodeAt(0),O=e=>{const t=e.charCodeAt(0);return t>=I&&t<=b||t>=T&&t<=w||t>=P&&t<=R},k=e=>e.length>=3&&"%"===e.charAt(0)&&O(e.charAt(1))&&O(e.charAt(2)),L=e=>{const t=e.charCodeAt(0);return t>=I&&t<=b?t-I:t>=T&&t<=w?10+t-T:t>=P&&t<=R?10+t-P:0},S="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-_.~",N="0123456789ABCDEF",M=e=>{const t=[];for(let r=0;r<128;++r)t.push(-1!==e.indexOf(String.fromCharCode(r)));return t},X=M("abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-_.~:/?#[]@!$&'()*+,;="),x=M(S),U=M(S+"/"),j=(e,t)=>{if(e<128&&t[e])return String.fromCharCode(e);let r="%";return r+=N.charAt(e>>4&15),r+=N.charAt(15&e),r},B=e=>{const t=[];for(let r=0;r<e.length;r++){let s=e.charCodeAt(r);s<128?t.push(s):s<2048?t.push(192|s>>6,128|63&s):s<55296||s>=57344?t.push(224|s>>12,128|s>>6&63,128|63&s):++r<e.length&&(s=65536+((1023&s)<<10|1023&e.charCodeAt(r)),t.push(240|s>>18,128|s>>12&63,128|s>>6&63,128|63&s))}return t},V=(e,t)=>{const r=B(e);let s="";for(let o=0;o<r.length;o++)s+=j(r[o],t);return s},H=e=>(e=e.normalize("NFC"),V(e,x)),F=e=>{e=e.normalize("NFC");let t=0,r="";for(;t<e.length;)k(e.substr(t))?(r+=e.substr(t,3),t+=3):r+=V(e.charAt(t++),X);return r},Y=(e,t)=>{let r=0,s="",o=!1,n=!1,i=!1,a=!0,d=!0,c=!1,l="",h="",u=",",p=-1;const f=e=>{if(s+=a?h:c||d?u:",",n&&l&&(a||c||d)&&(s+=H(l),(!i||e.length>0)&&(s+="=")),e){let t;t=o?F(e):H(e),p>0&&(t=((e,t)=>{let r=0;for(;r<e.length&&t>0;){if(k(e.substr(r))){let t=(L(e.substr(r+1))<<4)+L(e.substr(r+2));if(r+=3,192==(192&t))for(;r<e.length&&k(e.substr(r))&&(t=(L(e.substr(r+1))<<4)+L(e.substr(r+2)),r+=3,128==(192&t)););}else++r;--t}return e.substr(0,r)})(t,p)),s+=t}a=!1,d=!1};for(;r<e.length;)if("{"===e.charAt(r)){if(++r<e.length){switch(o=!1,n=!1,h="",u=",",i=!1,e.charAt(r++)){case"+":o=!0;break;case"#":h="#",o=!0;break;case".":h=".",u=".";break;case"/":h="/",u="/";break;case";":h=";",u=";",n=i=!0;break;case"?":h="?",u="&",n=!0;break;case"&":h="&",u="&",n=!0;break;default:--r}for(l="",a=!0,d=!0;r<e.length;)if("}"===e.charAt(r)||","===e.charAt(r)||"*"===e.charAt(r)||":"===e.charAt(r)){if(c=!1,p=-1,"*"===e.charAt(r)){if(c=!0,++r>=e.length)break}else if(":"===e.charAt(r)){if(++r>=e.length)break;for(e.charCodeAt(r)>=v&&e.charCodeAt(r)<=b&&(p=0);r<e.length&&e.charCodeAt(r)>=I&&e.charCodeAt(r)<=b&&p<1e4;)p=10*p+(e.charCodeAt(r++)-I);if(r>=e.length)break}for(;r<e.length&&"}"!==e.charAt(r)&&","!==e.charAt(r);)++r;if(l.length>0&&"*"===l.charAt(l.length-1)&&(c=!0,l=l.substr(0,l.length-1)),l.length>0){const e=t?t[l]:void 0;if(e||""===e)if(Array.isArray(e)){p=-1;for(let t=0;t<e.length;t++)f(String(e[t]))}else if("object"==typeof e&&null!==e)for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&(_=t,m=String(e[t]),s+=a?h:c||d?u:",",n&&l&&a&&!c&&(s+=H(l),(!i||m.length>0)&&(s+="=")),_&&(s+=o?F(_):H(_),s+=c?"=":",",m&&(s+=o?F(m):H(m))),a=!1,d=!1);else f(String(e))}if("}"===e.charAt(r++))break;l="",d=!0}else l+=e.charAt(r++)}}else k(e.substr(r))?(s+=e.substr(r,3),r+=3):s+=V(e.charAt(r++),X);var _,m;return s};function W(e){return(new TextEncoder).encode(e)}const q=/^([^:]+):(.*)$/,z=/^\s+|\s+$/g,G=(e,t,r)=>h(t)?new a.DCXError(a.DCXError.INVALID_PARAMS,`Param '${e}' type must be one of: [${t.join(",")}].${r&&r.length>0?" Possible values: "+r.join(", ")+".":""}`):new a.DCXError(a.DCXError.INVALID_PARAMS,`Param '${e}' must be of type '${t}'.${r&&r.length>0?" Possible values: "+r.join(", ")+".":""}`),K=(e,t,r,s=!1,o=[])=>{if(s&&null==t)return!0;if(h(r)){for(const n in r){const i=r[n];try{return K(e,t,i,s,o),!0}catch(e){}}throw G(e,r,o)}if("null"===r&&null!==t||"undefined"===r&&void 0!==t||"nullish"===r&&null!=t)throw G(e,r,o);if("null"===r||"undefined"===r||"nullish"===r)return!0;if(!s&&null==t)throw G(e,r,o);if(r.endsWith("[]")){if(!h(t))throw G(e,r,o);return t.forEach((t,s)=>{K(`${e}[${s}]`,t,r.substr(0,r.length-2))}),!0}let n=r.toLowerCase();switch(r){case"integer":case"+number":case"-number":n="number"}if("array"===n){if(!h(t))throw G(e,r,o)}else if("enum"!==n){if(typeof t!==n)throw G(e,r,o);if("integer"===r&&("number"!=typeof t||!Number.isInteger(t)))throw G(e,r,o);if("+number"===r&&("number"!=typeof t||t<0))throw G(e,r,o);if("-number"===r&&("number"!=typeof t||t>0))throw G(e,r,o)}if(o.length>0){const s=o.length;let n=!1;for(let e=0;e<s;e++)if(o[e]===t){n=!0;break}if(!n)throw G(e,r,o)}return!0};function $(...e){return e.map(e=>K(...e))}function J(e,t){const r={};for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&void 0!==e[s]&&(r[s]=1);for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&void 0!==t[s]&&delete r[s];return Object.keys(r)}function Z(e,t){return{operations:e.operations.concat(t),cost:e.cost+1}}function Q(e,t,r,s=Q){if(e===t)return[];const o=h(e),n=h(t);return o&&n?function(e,t,r,s){const o={"0,0":{operations:[],cost:0}},n=isNaN(e.length)||e.length<=0?0:e.length,i=isNaN(t.length)||t.length<=0?0:t.length,a=function r(n,i){const a=`${n},${i}`;let d=o[a];if(void 0===d){if(n>0&&i>0&&!s(e[n-1],t[i-1],new re).length)d=r(n-1,i-1);else{const s=[];if(n>0){const e=r(n-1,i),t={op:"remove",index:n-1};s.push(Z(e,t))}if(i>0){const e=r(n,i-1),o={op:"add",index:n-1,value:t[i-1]};s.push(Z(e,o))}if(n>0&&i>0){const o=r(n-1,i-1),a={op:"replace",index:n-1,original:e[n-1],value:t[i-1]};s.push(Z(o,a))}d=s.sort((e,t)=>e.cost-t.cost)[0]}o[a]=d}return d}(n,i).operations,[d]=a.reduce(([e,t],o)=>{if(function(e){return"add"===e.op}(o)){const s=o.index+1+t,i=s<n+t?String(s):"-",a={op:o.op,path:r.add(i).toString(),value:o.value};return[e.concat(a),t+1]}if(function(e){return"remove"===e.op}(o)){const s={op:o.op,path:r.add(String(o.index+t)).toString()};return[e.concat(s),t-1]}const i=r.add(String(o.index+t)),a=s(o.original,o.value,i);return[e.concat(...a),t]},[[],0]);return d}(e,t,r,s):!o&&!n&&c(e)&&c(t)?function(e,t,r,s){const o=[];return J(e,t).forEach(e=>{o.push({op:"remove",path:r.add(e).toString()})}),J(t,e).forEach(e=>{o.push({op:"add",path:r.add(e).toString(),value:t[e]})}),function(e){const t=e.length,r={};for(let s=0;s<t;s++){const t=e[s];for(const e in t)Object.prototype.hasOwnProperty.call(t,e)&&void 0!==t[e]&&(r[e]=(r[e]||0)+1)}for(const s in r)r[s]<t&&delete r[s];return Object.keys(r)}([e,t]).forEach(n=>{o.push(...s(e[n],t[n],r.add(n)))}),o}(e,t,r,s):[{op:"replace",path:r.toString(),value:t}]}function ee(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function te(e){return e.replace(/~/g,"~0").replace(/\//g,"~1")}class re{constructor(e=[""]){this.tokens=e}static fromJSON(e){const t=e.split("/").map(ee);if(""!==t[0])throw new a.DCXError(a.DCXError.INVALID_DATA,`Invalid JSON Pointer: ${e}`);return new re(t)}toString(){return this.tokens.map(te).join("/")}evaluate(e){let t=null,r="",s=e;for(let o=1,n=this.tokens.length;o<n;o++)t=s,r=this.tokens[o],s=(t||{})[r];return{parent:t,key:r,value:s}}get(e){return this.evaluate(e).value}set(e,t){let r=e;for(let s=1,o=this.tokens.length-1,n=this.tokens[s];s<o;s++)r=(r||{})[n];r&&(r[this.tokens[this.tokens.length-1]]=t)}push(e){this.tokens.push(e)}add(e){const t=this.tokens.concat(String(e));return new re(t)}}class se{constructor(e=[]){this._operations=e}get operations(){return this._operations}getDocument(){return JSON.stringify(this._operations)}add(e,t){return $(["path",e,"string"]),this._operations.push({op:"add",path:e,value:t}),this}addToList(e,t,r){if($(["path",e,"string"]),"number"!=typeof r&&"end"!==r&&"-"!==r)throw new a.DCXError(a.DCXError.INVALID_PARAMS,'Index must be a number, or either "end"/"-" to append to end.');return this._operations.push({op:"add",value:t,path:`${e.endsWith("/")?e:e+"/"}${"end"===r?"-":r}`}),this}remove(e){return $(["path",e,"string"]),this._operations.push({op:"remove",path:e}),this}replace(e,t){return $(["path",e,"string"]),this._operations.push({op:"replace",path:e,value:t}),this}move(e,t){return $(["source",e,"string"],["destination",t,"string"]),this._operations.push({op:"move",from:e,path:t}),this}copy(e,t){return $(["source",e,"string"],["destination",t,"string"]),this._operations.push({op:"copy",from:e,path:t}),this}}function oe(e,t){return{property:e,issue:t}}function ne(e){const t=[];if("object"!=typeof e||null==e||h(e))return t.push(oe("*","Operation not an object.")),t;switch("string"!=typeof e.path&&t.push(oe("path","Missing or invalid.")),e.op){case"remove":break;case"add":case"replace":null==e.value&&t.push(oe("value","Missing or invalid. Required for add/replace."));break;case"move":case"copy":"string"!=typeof e.from&&t.push(oe("from","Missing or invalid. Required for move/copy."));break;default:t.push(oe("op","Missing or invalid."))}return!(t.length>0)||t}function ie(e){if(!c(e))throw new Error("Expecting object");const t={};for(const r in e)null!=e[r]&&(t[r]=e[r]);return t}const ae=/^utf-?8|ascii|utf-?16-?le|ucs-?2|base-?64|latin-?1$/i,de=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,ce=/\s|\uFEFF|\xA0/,le=/\r?\n[\x20\x09]+/g,he=/[;,"]/,ue=/[;,"]|\s/,pe=1,fe=2,_e=4;function me(e){return e.replace(de,"")}function ge(e){return ce.test(e)}function Ee(e,t){for(;ge(e[t]);)t++;return t}function Ae(e){return ue.test(e)}class Ce{constructor(e){this.refs=[],e&&this.parse(e)}rel(e){const t=[];for(let r=0;r<this.refs.length;r++)this.refs[r].rel===e&&t.push(this.refs[r]);return t}get(e,t){e=e.toLowerCase();const r=[];for(let s=0;s<this.refs.length;s++)this.refs[s][e]===t&&r.push(this.refs[s]);return r}set(e){return this.refs.push(e),this}has(e,t){e=e.toLowerCase();for(let r=0;r<this.refs.length;r++)if(this.refs[r][e]===t)return!0;return!1}parse(e,t=0){let r=t?e.slice(t):e;r=me(r).replace(le,"");let s=pe;const o=r.length;let n=0,i=null;for(;n<o;)if(s===pe){if(ge(r[n])){n++;continue}if("<"!==r[n])throw new Error('Unexpected character "'+r[n]+'" at offset '+n);{const e=r.indexOf(">",n);if(-1===e)throw new Error("Expected end of URI delimiter at offset "+n);i={uri:r.slice(n+1,e)},this.refs.push(i),n=e,s=fe}n++}else if(s===fe){if(ge(r[n])){n++;continue}if(";"===r[n])s=_e,n++;else{if(","!==r[n])throw new Error('Unexpected character "'+r[n]+'" at offset '+n);s=pe,n++}}else{if(s!==_e)throw new Error('Unknown parser state "'+s+'"');{if(";"===r[n]||ge(r[n])){n++;continue}const e=r.indexOf("=",n);if(-1===e)throw new Error("Expected attribute delimiter at offset "+n);const t=me(r.slice(n,e)).toLowerCase();let a="";if(n=e+1,n=Ee(r,n),'"'===r[n])for(n++;n<o;){if('"'===r[n]){n++;break}"\\"===r[n]&&n++,a+=r[n],n++}else{let e=n+1;for(;!he.test(r[e])&&e<o;)e++;a=r.slice(n,e),n=e}if(i&&i[t]&&ye(t));else if(i&&"*"===t[t.length-1])i[t]=ve(a);else if(a="rel"===t||"type"===t?a.toLowerCase():a,i&&null!=i[t]){const e=i[t];h(e)?e.push(a):i[t]=[i[t],a]}else{if(!i)throw new Error("Unexpected null ref");i[t]=a}switch(r[n]){case",":s=pe;break;case";":s=_e}n++}}return i=null,this}toString(){const e=[];let t,r="";for(let s=0;s<this.refs.length;s++)t=this.refs[s],r=Object.keys(this.refs[s]).reduce((function(e,r){return"uri"===r?e:e+"; "+be(r,t[r])}),"<"+t.uri+">"),e.push(r);return e.join(", ")}}const De=e=>ae.test(e),ye=e=>"rel"===e||"type"===e||"media"===e||"title"===e||"title*"===e,Ie=e=>e.replace(/"/g,'\\"'),ve=e=>{const t=/([^']+)?(?:'([^']+)')?(.+)/.exec(e)||[];return{language:t[2].toLowerCase(),encoding:De(t[1])?null:t[1].toLowerCase(),value:De(t[1])?decodeURIComponent(t[3]):t[3]}},be=(e,t)=>Array.isArray(t)?t.map(t=>be(e,t)).join("; "):"*"===e[e.length-1]||"string"!=typeof t?((e,t)=>{const r=(t.encoding||"utf-8").toUpperCase(),o=t.language||"en";let n="";return n=s.isBuffer(t.value)&&De(r)?t.value.toString(r):s.isBuffer(t.value)?t.value.toString("hex").replace(/[0-9a-f]{2}/gi,"%$1"):encodeURIComponent(t.value),e+"="+r+"'"+o+"'"+n})(e,t):((e=>"rel"===e||"type"===e||"anchor"===e)(e)?t=Ae(t)?'"'+Ie(t)+'"':Ie(t):Ae(t)&&(t='"'+(t=(t=encodeURIComponent(t)).replace(/%20/g," ").replace(/%2C/g,",").replace(/%3B/g,";"))+'"'),e+"="+t);function Te(e,t,r,s="id"){const o=Oe(e)[t];if(o){if(Array.isArray(o)){const e=o.filter(e=>e.mode===s);return e.length>0?e[0][r]:o.length>0?o[0][r]:void 0}return o[r]}}function Pe(e,t,r="id"){const s=Oe(e),o=s[t];let n;if(c(o)&&"string"==typeof o.href?n=o.href:Array.isArray(o)&&(n=Te(s,t,"href",r)),"string"!=typeof n)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Missing or invalid link href.");return n}function we(e,t,r,s="id"){const o=Pe(Oe(e),t,s);return Y(o,ie(r))}const Re=(e,t=0)=>(new Ce).parse(e,t);function Oe(e){let t=e;return c(t)?(c(e._links)?t=e._links:c(e.links)&&(t=e.links),t):{}}var ke=Object.freeze({__proto__:null,Link:Ce,getLinkProperty:Te,getLinkHref:Pe,getLinkHrefTemplated:we,parse:Re});let Le;const Se=()=>{if(Le)return Le;const t=u();return Le=t&&c(e.performance)&&l(e.performance.now)?e.performance:t&&c(e.perf_hooks)&&c(e.perf_hooks.performance)&&l(e.perf_hooks.performance.now)?e.perf_hooks.performance:p()&&c(self.performance)&&l(self.performance.now)?self.performance:Date,Le};class Ne{constructor(e){this._canceled=!1,this._done=!1;const t=function(e){if("browser"===e){let t;const r=new ReadableStream({start(e){t=e}},{highWaterMark:10485760});return{controller:t,platform:e,stream:r}}}(e),{platform:r,stream:s}=t;this._platform=r,this._stream=s,"browser"===t.platform?this._browserController=t.controller:(t.stream.on("close",()=>{this._resolve()}),t.stream.on("end",()=>{this._done=!0,this._resolve()}),t.stream.on("error",e=>{a.isAdobeDCXError(e)||(e=new a.AdobeDCXError(a.AdobeDCXError.UNEXPECTED,"Unexpected stream error.",e)),this._reject(e)})),this._donePromise=new Promise((e,t)=>{this._reject=t,this._resolve=e})}get underlyingStream(){return this._stream}get platform(){return this._platform}get _writable(){return Promise.resolve()}whenDone(){return this._donePromise}pipe(e){return"node"===this._platform?this._stream.pipe(e):(this._stream.pipeTo(e).then(e=>{this._done=!0,this._resolve()}),e)}read(e){if(this._canceled)throw new a.AdobeDCXError(a.AdobeDCXError.ABORTED,"Stream was aborted.");if(this._error)throw new a.AdobeDCXError(a.AdobeDCXError.INVALID_STATE,"Stream is in error state.",this._error);if("node"===this._platform){const t=this._stream;return new Promise((r,s)=>{let i,a=t.read(e);if(a)return r({done:this._done,value:a});if(this._done)return r({done:this._done,value:void 0});const d=e=>(h(),s(e)),c=()=>{if(a=t.read(e),!a)return this._done?l(!0):void(i=o(c));l(this._done)},l=(e=!0)=>(h(),r({value:a,done:e}));function h(){t.off("readable",c),t.off("error",d),n(i)}t.on("readable",c),t.on("error",d)})}const t=this._stream;if(t.locked)throw new a.AdobeDCXError(a.AdobeDCXError.INVALID_STATE,"Reader already holds lock.");const r=t.getReader();return r.read().then(({done:e,value:t})=>(r.releaseLock(),e&&(this._done=!0,this._resolve()),{done:e,value:t}))}_push(e){return null===e?(this._end(),Promise.resolve(!0)):"on"in this._stream?(this._stream.push(e),this._writable.then(()=>!1)):(this._browserController.enqueue(e),this._writable.then(()=>!1))}_end(){"on"in this._stream?this._stream.push(null):(this._browserController.close(),this._done=!0,this._resolve())}_close(){"on"in this._stream?this._stream.push(null):(this._browserController.close(),this._done=!0,this._resolve())}_destroy(){if("on"in this._stream)return this._stream.destroy();this._browserController.close(),this._resolve()}_cancel(){if(this._canceled=!0,this._error=new a.AdobeDCXError(a.AdobeDCXError.ABORTED,"Stream aborted."),"on"in this._stream)return this._stream.destroy(this._error);this._browserController.error(this._error),this._reject(this._error)}}const Me=ke;t.EventEmitter=class{constructor(e){this._handlers={},e.forEach(e=>{this._handlers[e]=[]})}on(e,t){return this._handlers[e].push(t)-1}emit(e,t){this._handlers[e].forEach(e=>{l(e)&&e(...t)})}removeHandler(e,t){delete this._handlers[e][t]}removeAllHandlers(e){e?this._handlers[e]=[]:this._handlers={}}},t.JSONPatchPointer=re,t.Link=Ce,t.LinkUtils=Me,t.SDKType=f,t.WatchProxy=function(e){if(e.__watch_proxy__)return e;if("watchProperty"in e)throw new Error("Cannot proxy object, watchProperty already exists.");let t={};const r=((e,r)=>{t[e]=t[e]||[],t[e].push(r)}).bind({listeners:t}),s={set:function(e,r,s){try{r in t&&h(t[r])&&t[r].map(t=>t.call(void 0,s,e[r],e))}catch(e){throw e}return e[r]=s,!0}},{proxy:o,revoke:n}=Proxy.revocable(e,s);return Object.defineProperty(o,"__watch_proxy__",{value:!0,enumerable:!1,configurable:!0}),Object.defineProperty(o,"revokeWatchProxy",{value:()=>(n(),t={},delete e.__watch_proxy__,delete e.revokeWatchProxy,delete e.watchProperty,e),enumerable:!1,configurable:!0}),Object.defineProperty(o,"watchProperty",{value:r,enumerable:!1,configurable:!0}),o},t._toUTF8Array=B,t.appendPathElements=(...e)=>{if(!e||!Array.isArray(e))return"";const t=[],r=e.length;for(let s=0;s<r;s++){let o=e[s];"string"==typeof o&&""!==o&&(0===s&&1!==o.length||"/"===o.charAt(0)&&(o=o.slice(1)),s!==r-1&&"/"===o.charAt(o.length-1)&&(o=o.slice(0,o.length-1)),t.push(o))}return t.join("/")},t.arrayBufferToString=function(e){return e?(new TextDecoder).decode(e):""},t.assert=(e,t)=>{if(!1===e())throw new a.DCXError(a.DCXError.INVALID_PARAMS,t)},t.cleanEtag=e=>"string"!=typeof e?e:e.startsWith("W/")?e.split("W/")[1]:e,t.combineInPlace=function(...e){if(e.length<2)return;const t=e.shift();_(t,...e),e.map(e=>{Object.assign(t,e)})},t.concatUint8Arrays=function(e,t){const r=new Uint8Array(e.length+t.length);return r.set(e,0),r.set(t,e.length),r},t.consumeStream=(e,t,r)=>{e.on("data",r||A),e.on("end",t||A)},t.createJSONPatch=function(e,t,r){const s=new re;return(r?function(e){return function t(r,s,o){const n=e(r,s,o);return h(n)?n:Q(r,s,o,t)}}(r):Q)(e,t,s)},t.createPatchDocumentBuilder=function(e){return new se(e)},t.dataToBuffer=function(e){return"string"==typeof e?W(e):e},t.deepCopy=e=>JSON.parse(JSON.stringify(e)),t.endPointOf=e=>{const t=y(e),r=t.scheme,s=t.authority,o="https"===r?443:"http"===r?80:-1;let n;return r&&s&&(n=(r+"://"+s).toLowerCase(),o>=0&&s.indexOf(":")<0&&(n=n+":"+o)),n},t.ensureRelativeHrefStartsWithSlash=e=>{if(e){const t=y(e),r=t.scheme,s=t.authority;r||s||"/"!==e.charAt(0)&&(e="/"+e)}return e},t.escapeURLPath=e=>(String.prototype.normalize?e=e.normalize("NFC"):console.warn("String.normalize not found while escaping URL path. You may be missing a polyfill."),V(e,U)),t.expandURITemplate=Y,t.flatCopy=e=>{const t={},r=Object.keys(e),s=r.length;for(let o=0;o<s;o++){const s=r[o];t[s]=e[s]}return t},t.generateUuid=()=>i.v4(),t.getDomainFromURL=e=>{if(!e||"string"!=typeof e)return e;const t=(e=(e=(e=(e=e.indexOf("//")>-1?e.split("/")[2]:e.split("/")[0]).split("?")[0]).split("/")[0]).split(":")[0]).split(".");return t.slice(Math.max(t.length-2,0)).join(".")},t.getLinkHref=Pe,t.getLinkHrefTemplated=we,t.getLinkProperty=Te,t.getPerformance=Se,t.hexVal=L,t.isArray=h,t.isArrayBuffer=e=>c(e)&&l(e.constructor)&&"ArrayBuffer"===e.constructor.name&&l(e.slice),t.isArrayBufferView=e=>c(e)&&l(e.constructor)&&"DataView"===e.constructor.name&&c(e.buffer)&&l(e.buffer.slice),t.isBrowser=p,t.isBrowserSDK=()=>!0,t.isBuffer=e=>c(e)&&l(e.constructor)&&"Buffer"===e.constructor.name&&l(e.slice),t.isDefined=e=>null!=e,t.isFunction=l,t.isHexChar=O,t.isJsonContentType=e=>{if("string"!=typeof e)return!1;const t=e.toLowerCase().split("application/");if(t.length<2)return!1;const r=t[1].split(";")[0].trim();return"json"===r||r.endsWith("+json")},t.isNode=u,t.isNodeReadableStream=e=>d(e)&&l(e.on),t.isObject=c,t.isPctEncoding=k,t.isPromise=e=>null!=e&&c(e)&&l(e.then),t.isReadableStream=d,t.isStreamProvider=e=>c(e)&&(l(e.getStream)||l(e.getStreamAsync)),t.isUndefined=e=>null==e,t.isValidAbsolutePath=e=>E(e,!0),t.isValidAdobeURN=e=>/^urn:aaid:[a-zA-Z]{2}:[a-zA-Z]{2}:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e),t.isValidPath=E,t.isVoid=e=>null==e,t.isWebWorker=()=>p()&&!!self.WorkerGlobalScope,t.merge=_,t.mergeDeep=m,t.newReadableStream=function(){const e=u()?"node":"browser",t=new Ne(e),r=Object.getOwnPropertyDescriptors(t),s=Object.getOwnPropertyDescriptors(Object.getPrototypeOf(t.underlyingStream));for(const o in s)o in t||o in r||Object.defineProperty(t,o,s[o]);return t},t.noOp=A,t.normalizeHeaders=e=>{if(null==e||"object"!=typeof e)return{};const t={},r=Object.keys(e);for(const s in r){const o=r[s],n=e[o];Object.prototype.hasOwnProperty.call(e,o)&&null!=n&&(t[o.toLowerCase()]=h(n)?n.join(";"):n)}return t},t.now=()=>Se().now(),t.objectsEqual=C,t.parse=Re,t.parseHeaders=e=>{const t={},r=e.split(/\r?\n/);let s,o;for(let n=0;n<r.length;++n){const e=r[n];if(e.length>0){const r=e.charCodeAt(0);if(!s||9!==r&&32!==r){const r=q.exec(e);r&&r.length>1&&(s=r[1].toLowerCase(),o=r[2]||"",o=o.replace(z,""),t[s]?t[s]=t[s]+","+o:t[s]=o)}else t[s]=t[s]+" "+e.replace(z,"")}}return t},t.parseURI=y,t.pruneUndefined=ie,t.safeGet=function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]},t.stringToBuffer=W,t.timeStamp=(e=!1)=>{let t=(new Date).getTime();return e&&(t-=t%1e3),t},t.validateJSONPatchDocument=function(e){if(!h(e))return[oe("doc","Invalid type.")];const t=[];return e.forEach((e,r)=>{const s=ne(e);!0!==s&&s.forEach(e=>{e.property=`doc[${r}].${e.property}`,t.push(e)})}),!(t.length>0)||t},t.validateJSONPatchOperation=ne,t.validateObject=function(e,t,...r){if(t=t?" "+t+" ":" ",!e||"object"!=typeof e)throw new a.DCXError(a.DCXError.INVALID_PARAMS,`Object${t}is invalid.`);try{r.forEach(t=>{K(t[0],e[t[0]],t[1],t[2]||!1,t[3]||[])})}catch(e){throw new a.DCXError(a.DCXError.INVALID_PARAMS,`Object${t}is invalid. ${e.message.replace("Param","Property")}`,e)}},t.validateParam=K,t.validateParams=$}).call(this,r(23),r(10).Buffer,r(312).setImmediate,r(312).clearImmediate)},3794:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var s=r(2785),o=r(3078),n=r(3079),i=r(2786);var a=function(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}(n);function d(e,t,r,s){return new(r||(r=Promise))((function(o,n){function i(e){try{d(s.next(e))}catch(e){n(e)}}function a(e){try{d(s.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,a)}d((s=s.apply(e,t||[])).next())}))}const c=o.newDebug("dcx:http:auth");class l{constructor(e,t,r){this._authToken=e,this._apiKey=t,this._pendingAuth=!1,this._hasBaseRefreshCb=!1,this._authListeners=[],this._persistentListeners=[],this._authenticationAllowList=["adobe.io"],this._authTokenScheme="Bearer",i.validateParams(["authToken",e,"string",!0],["apiKey",t,"string",!0],["refreshCb",r,"function",!0]),r&&(this._hasBaseRefreshCb=!0,this.onChange((e,t)=>{"unauthenticated"===e&&r.call(null,t)},!0)),e&&t||(c("init unauthenticated"),this._pendingAuth=!0,setTimeout(()=>{c("after tick",this._pendingAuth),this._pendingAuth&&this.refreshAuth()}))}get authenticationAllowList(){return this._authenticationAllowList}set authenticationAllowList(e){if(!Array.isArray(e))throw new s.DCXError(s.DCXError.INVALID_PARAMS,"Expecting an array.");this._authenticationAllowList=e}get isNoAuthMode(){return!this._hasBaseRefreshCb}set isNoAuthMode(e){this._hasBaseRefreshCb=!e}get apiKey(){return this._apiKey}get authToken(){return this._authToken}get authTokenScheme(){return this._authTokenScheme}set authTokenScheme(e){this._authTokenScheme=e}setAuthToken(e){c("setAuthToken"),this._authToken=e,this._pendingAuth=!1,this._authChanged("updated")}setApiKey(e){this._apiKey=e}resume(){c("resume()"),this._pendingAuth=!1,this._authChanged("updated")}get pendingAuth(){return this._pendingAuth}onChange(e,t=!1){c("onChange, persistent:",t);const r=this._authListeners.push(e)-1;return t&&this._persistentListeners.push(r),()=>{try{t&&(this._persistentListeners=this._persistentListeners.filter(e=>e!==r)),delete this._authListeners[r]}catch(e){}}}clearListeners(e=!1){if(c("clearListeners, persistent:",e),!0===e)return this._authListeners=[],void(this._persistentListeners=[]);this._authListeners=this._authListeners.map((e,t)=>{if(this._persistentListeners.includes(t))return e})}get refreshPromise(){return this._refreshPromise}_authChanged(e){return d(this,void 0,void 0,(function*(){c("authChanged",e),this._pendingAuth="unauthenticated"===e,queueMicrotask(()=>d(this,void 0,void 0,(function*(){const t=[];this._authListeners.map(r=>{if("function"==typeof r){const s=r.call(null,e,this);s&&"object"==typeof s&&s.then&&t.push(s)}}),yield Promise.all(t),"updated"===e&&this._resolveRefresh()})))}))}_resolveRefresh(){c("_resolveRefresh"),this._refreshResolve&&this._refreshResolve(this.getAuthData()),this._refreshResolve=void 0,this._refreshPromise=void 0}refreshAuth(){return c("refreshAuth"),this._refreshPromise||(this._refreshPromise=new Promise(e=>{this._refreshResolve=e}),this._authChanged("unauthenticated")),this._refreshPromise}getAuthData(){return{authToken:this._authToken,apiKey:this._apiKey}}getAuth(){return d(this,void 0,void 0,(function*(){return Promise.resolve(this.getAuthData())}))}isAuthorizedURL(e){const t=i.getDomainFromURL(e);return this._authenticationAllowList.includes(t)}logout(){c("logout"),this._apiKey=void 0,this._authToken=void 0,!1===this._pendingAuth&&(this._pendingAuth=!0,this._authChanged("unauthenticated"))}applyAuthHeaders(e,t){const r={"x-api-key":void 0,authorization:void 0};return this.isAuthorizedURL(e)&&(null!==t["x-api-key"]&&this.apiKey&&(r["x-api-key"]=this.apiKey),null!==t.authorization&&this.authToken&&(r.authorization=(this.authTokenScheme?`${this.authTokenScheme} `:"")+this.authToken)),i.pruneUndefined(Object.assign(Object.assign({},t),r))}}const h=o.newDebug("dcx:http:xhr");let u;if(u="undefined"!=typeof window?window.XMLHttpRequest:XMLHttpRequest,null==u)throw new s.AdobeDCXError(s.AdobeDCXError.INVALID_STATE,"XMLHttpRequest module not found.");var p;t.XhrErrorCodes=void 0,(p=t.XhrErrorCodes||(t.XhrErrorCodes={}))[p.NO_ERROR=0]="NO_ERROR",p.ABORTED="ABORTED",p.NETWORK="NETWORK_ERROR",p.TIMEOUT="TIMED_OUT",p.TOO_MANY_REDIRECTS="TOO_MANY_REDIRECTS",p.INSECURE_REDIRECT="INSECURE_REDIRECT";class f{constructor(e={}){this._sent=!1,this._bytesReported=0,this._errorCode=t.XhrErrorCodes.NO_ERROR,this._autoParseJson=!1,this.headers={},this.responseType="text",this._progressListeners=[];const{forceXhr:r,preCallback:o,postCallback:n,timeout:i}=e;this._preCallback=o,this._postCallback=n,this._timeout=null==i?12e4:i,this._xhr=r?new r:new u,this._autoParseJson=null==e.autoParseJson||e.autoParseJson,e.additionalNodeOptions&&this._xhr.setNodeOptions&&this._xhr.setNodeOptions(e.additionalNodeOptions),this._promise=new Promise(e=>{this._resolve=e,this._xhr.addEventListener("abort",()=>{h("aborted",this._errorCode,this._timeout),this._errorCode=this._errorCode||t.XhrErrorCodes.ABORTED,this._finalize()}),this._xhr.addEventListener("progress",e=>{h(`progress ${e.loaded}/${e.total}`),this._bytesReported+=e.loaded,e.lengthComputable?(this._estimatedTotalBytes=e.total,this._notifyProgressListeners(this._bytesReported,this._estimatedTotalBytes,!1)):this._notifyProgressListeners(this._bytesReported,this._estimatedTotalBytes||e.total,!0)}),this._xhr.addEventListener("error",e=>{switch(h("err",this._errorCode,e,this._xhr.status,this._timeout),this._underlyingError=e,e?e.code:void 0){case"ERR_FR_TOO_MANY_REDIRECTS":this._errorCode=t.XhrErrorCodes.TOO_MANY_REDIRECTS;break;case s.AdobeDCXError.INSECURE_REDIRECT:this._errorCode=t.XhrErrorCodes.INSECURE_REDIRECT;break;case t.XhrErrorCodes.TIMEOUT:break;default:this._errorCode=t.XhrErrorCodes.NETWORK}this._finalize()}),this._xhr.addEventListener("load",()=>{h("load"),this._estimatedTotalBytes&&this._estimatedTotalBytes>this._bytesReported&&this._notifyProgressListeners(this._estimatedTotalBytes,this._estimatedTotalBytes,!1),this._finalize()}),this._xhr.addEventListener("timeout",()=>{h("timeout",this._timeout),this._errorCode=t.XhrErrorCodes.TIMEOUT,this._finalize()})})}get xhr(){return this._xhr}_shouldAutoParseResponse(){const e=this._errorCode===t.XhrErrorCodes.NO_ERROR&&this._sent&&"text"===this._xhr.responseType&&this._autoParseJson&&"string"==typeof this._xhr.response&&this._xhr.response.length<102400&&i.isJsonContentType(this.getResponseHeader("content-type"));return h("_shouldAutoParseResponse()",e),e}_finalize(){if(h("_finalize",this._xhr.status,this._errorCode),this._shouldAutoParseResponse())try{const e=JSON.parse(this._xhr.response);this._autoParsedResponse=e,this._xhr.responseType="json"}catch(s){}this._postCallback&&this._postCallback(this),this._timeoutTimeout&&clearTimeout(this._timeoutTimeout),this._progressListeners=[],this._resolve(this)}_validateResponseType(t){if("buffer"===t){if("function"!=typeof e)throw new s.AdobeDCXError(s.AdobeDCXError.INVALID_PARAMS,"No Buffer class")}else if("blob"===t){if("function"!=typeof Blob)throw new s.AdobeDCXError(s.AdobeDCXError.INVALID_PARAMS,"No Blob class")}else if("text"!==t&&"json"!==t&&"arraybuffer"!==t)throw new s.AdobeDCXError(s.AdobeDCXError.INVALID_PARAMS,"Unsupported response type");return t.toLowerCase()}send(e,r,o,n={},a="text",d={}){if(h("send"),this._sent)throw new Error("Xhr already sent");this.href=e,this.method=r.toUpperCase(),this.body=o,this.body&&(this._estimatedTotalBytes=this.body.byteLength||this.body.length||this.body.size),this._timeout=d.timeout||this._timeout||0,h("setting timeout",this._timeout),this._xhr.timeout=this._timeout,a&&(a=this._validateResponseType(a),h("responseType: ",a),this.responseType="buffer"===a?"arraybuffer":"stream"===a||"void"===a?"text":a),n=i.normalizeHeaders(n),this.headers=n,this._preCallback&&this._preCallback(this),this._xhr.open(this.method,this.href,!0),this._xhr.responseType=this.responseType;for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t)){if(this.href.startsWith("http:")&&"authorization"===t.toLowerCase()&&null!=n[t])throw new s.AdobeDCXError(s.AdobeDCXError.INVALID_PARAMS,"Must not send auth token over unsecured connection");if(Array.isArray(n[t])){const e=n[t].join(",");this._xhr.setRequestHeader(t,e)}else this._xhr.setRequestHeader(t,n[t])}return null!=d.withCredentials&&(this._xhr.withCredentials=d.withCredentials),null!=o?this._xhr.send(o):this._xhr.send(),this._sent=!0,this._timeout&&(h("set timeout",this._timeout),setTimeout(()=>{h("timed out"),this._errorCode=t.XhrErrorCodes.TIMEOUT,this._xhr.abort()},this._timeout)),this._promise}abort(){if(h("abort()"),!this._sent)throw new Error("Cannot abort before sending.");this._xhr.abort()}getResponseHeader(e){if(!this._sent)throw new Error("Cannot getResponseHeader before sending.");const t=e.toLowerCase(),r=this.getAllResponseHeaders();if(t in r)return r[t]}getAllResponseHeaders(){if(!this._sent)throw new Error("Cannot getAllResponseHeaders before sending.");if(this._parsedResponseHeaders)return this._parsedResponseHeaders;const e=this._xhr.getAllResponseHeaders();return this._parsedResponseHeaders="string"==typeof e?i.parseHeaders(e):i.normalizeHeaders(e),this._parsedResponseHeaders}isError(){if(!this._sent)throw new Error("Cannot check isError before sending.");return this._errorCode!==t.XhrErrorCodes.NO_ERROR}isAborted(){if(!this._sent)throw new Error("Cannot check isAborted before sending.");return this._errorCode===t.XhrErrorCodes.ABORTED}isTimedOut(){if(!this._sent)throw new Error("Cannot check isTimedOut before sending.");return this._errorCode===t.XhrErrorCodes.TIMEOUT}isSent(){return this._sent}getErrorCode(){return this._errorCode}getStatus(){if(!this._sent)throw new Error("Cannot getStatus before sending.");return this._xhr.status}getResponse(){if(!this._sent)throw new Error("Cannot getResponse before sending.");return this._response||(this._response={statusCode:this.getStatus(),headers:this.getAllResponseHeaders(),responseType:this._autoParsedResponse?"json":this._xhr.responseType,response:this.getResponseData(),message:this._xhr.statusText,xhr:this},this._autoParsedResponse&&(this._response.originalResponseData=this._xhr.response)),this._response}getResponseDataAsJSON(){return d(this,void 0,void 0,(function*(){if("json"===this._xhr.responseType)return this._xhr.response;if(this._autoParsedResponse)return this._autoParsedResponse;let e=this._xhr.response;if("text"===this._xhr.responseType&&null!=this._xhr.responseText)e=this._xhr.responseText;else if("arraybuffer"===this._xhr.responseType)e=i.arrayBufferToString(this._xhr.response);else if("blob"===this._xhr.responseType&&(e instanceof Blob||i.isFunction(e.text)))e=yield e.text();else try{const t=this._xhr.responseText;t&&(e=t)}catch(e){}if("string"==typeof e)try{return JSON.parse(e)}catch(o){return e}return e}))}getResponseData(){if(!this._sent)throw new Error("Cannot getResponseData before sending.");return this._autoParsedResponse||this._xhr.response}onProgress(e){const t=this._progressListeners.push(e)-1;return()=>{try{delete this._progressListeners[t]}catch(e){}}}_notifyProgressListeners(e,t,r){this._progressListeners.map(s=>s&&s.call&&s.call(null,e,t,r))}}const _=o.newDebug("dcx:http:backoff");function m(e,r,s,n={},a,c={},l=!1){const{disableRetry:h=!1,responseType:u="text",authCallback:p=null,progressListeners:m=[],initialWait:g=2e3,maxWait:E=32e3,preCallback:A,postCallback:C,preScheduleCallback:D,postScheduleCallback:y,preferRetryAfterHeader:I=!0,pollCodes:v=[],pollHeader:b,pollMethod:T="get"}=c;let{retryCodes:P=[],timeoutAfter:w=72e3}=c;P=l?[...v,...P]:h||i.isReadableStream(s)||i.isStreamProvider(s)?[]:c.retryCodes||[/^(?!^501$|^507$)^(5\d{2})$|429|423$/],_("retry codes",P);const R=c.increase||((e,t,r)=>1===e?r:t*t>E?E:t*t);let O=0,k=0,L=!1;const S=i.now();let N,M,X,x=i.now(),U=0,j=!1,B=!1;const V=[];let H;function F(){_("getSnapshot()",L,O,i.now(),x,U);const e=L||null!=N?0:O-(i.now()-x);let t=U;t+=L?i.now()-x:0;const r=(N||i.now())-S;return{count:k,canceled:j,timedOut:B,requests:V,duration:r,totalWaited:t,requestPending:L,waitingFor:e}}function Y(){const e=R(k,O,g);return e>=E?E:e}function W(e){if(e)return t=>e(t,F())}function q(e){const t=e.getResponseHeader("retry-after");if(I&&t){if(isNaN(t)){const e=Date.parse(t)-i.now();return _("nextWait from retry-after",e),e<0?Y():e}return 1e3*parseInt(e.getResponseHeader("retry-after"))}}function z(e,t=P){if(!e)return!1;if(Array.isArray(t))for(let r=0;r<t.length;r++){if("number"==typeof t[r]&&e===t[r])return _("checkRetriable true 1"),!0;if("object"==typeof t[r]&&t[r].test&&t[r].test(e.toString(10)))return _("checkRetriable true 2"),!0}else if("object"==typeof t&&t.test)return _("checkRetriable",t.test(e.toString(10))),t.test(e.toString(10));return _("checkRetriable false"),!1}function G(t=O){return d(this,void 0,void 0,(function*(){if(U>=w)return _("timed out",U,w),B=!0,M(X);x=i.now(),D&&(yield D(F())),_("retry in ",t),H=setTimeout(()=>{_("retry start"),o.log(`${r.toUpperCase()} ${e}`),L=!0,U+=t,X=new f(Object.assign(Object.assign({},c),{timeout:a,preCallback:W(A),postCallback:W(C)})),V.push(X),k++;for(const e in m)X.onProgress(m[e]);X.send(e,r,s,n,u).then(t=>d(this,void 0,void 0,(function*(){if(L=!1,!(t.isError()||z(t.getStatus(),P)||401===t.getStatus()&&null!=p||"string"==typeof b&&null!=v&&z(t.getStatus(),v)))return N=i.now(),M(t);if(t.isAborted()||j)return N=i.now(),j=!0,M(t);if(!l&&"string"==typeof b&&null!=v&&z(t.getStatus(),v)){const s=t.getResponseHeader(b.toLowerCase());if(s){l=!0,e=s,r=T,P=[...P,...v],U=0,w*=3;const o=t.getResponseHeader("retry-after");if(I&&o){const e=q(t);if(null!=e)return O=e,G(O)}return G(0)}}if(401===t.getStatus()){if(p){try{n=yield p(e,n)}catch(e){return M(t)}return G(0)}return N=i.now(),M(t)}if(z(t.getStatus())){const e=t.getResponseHeader("retry-after");if(I&&e){const e=q(t);if(null!=e)return O=e,G(O)}return O=Y(),G(O)}return N=i.now(),M(t)})))},t),y&&(yield y(F()))}))}const K=new Promise(e=>{M=e,G(0)});return{getPromise:()=>K,cancel:function(){_("cancel()"),j=!0,null!=X&&X.abort(),L||(_("abort"),clearTimeout(H),M({getErrorCode:()=>t.XhrErrorCodes.ABORTED}))},onProgress:function(e){if(m.push(e),null!=X)return X.onProgress&&X.onProgress(e)},getSnapshot:F}}class g{constructor(e,t,r,s,o="text",n,i,a={}){const{descriptor:d}=a;delete a.descriptor;const{cancel:c,getPromise:l,onProgress:h,getSnapshot:u}=m(e,t,r,s,a.timeout,Object.assign(Object.assign(Object.assign(Object.assign({},a),{responseType:o,authCallback:i}),a.retryOptions),{descriptor:d,forceXhr:a.forceXhr,autoParseJson:a.autoParseJson}));h((e,t)=>n("progress",{total:t,sentOrReceived:e})),this._cancel=c,this._promise=l(),this._getSnapshot=u}getSnapshot(){return this._getSnapshot()}getPromise(){return this._promise}cancel(e){this._cancel(e)}}const E=o.newDebug("dcx:http:req");class A{constructor(e){if(this._pausable=!1,this._listeners={progress:[],cancel:[]},this._isStatusValid=e.isStatusValid||(()=>!0),this._authProvider=e.authProvider,this._id=e.id,this._descriptor=e.descriptor,e.descriptor&&e.descriptor.progress){const t=e.descriptor.progress;this.on("progress",({sentOrReceived:e,total:r})=>{t.call(void 0,e,r)})}const r=this._authProvider.applyAuthHeaders(e.url,i.normalizeHeaders(e.headers||{}));this._networkRequest=new g(e.url,e.method,e.body,r,e.responseType,this._emit.bind(this),this._getAuthCb(),e),this._promise=this._networkRequest.getPromise().then(r=>{const o=r.getErrorCode(),n=o||this._isStatusValid(r.getStatus(),r.getResponse());if(o||!0!==n){if(o===t.XhrErrorCodes.ABORTED)throw new s.DCXError(s.DCXError.ABORTED,"Aborted");if(o===t.XhrErrorCodes.NETWORK)throw new s.DCXError(s.DCXError.NETWORK_ERROR,"Network error",void 0,r.getResponse());if(n instanceof s.DCXError||n instanceof Error)throw new s.DCXError(n.code||s.DCXError.UNEXPECTED_RESPONSE,n._message||n.message,n.underlyingError,r.getResponse());throw new s.DCXError(s.DCXError.UNEXPECTED_RESPONSE,"Unexpected response",void 0,r.getResponse())}const i=this._networkRequest.getSnapshot().requests;return E("resolve",e.id),Object.assign(Object.assign({},r.getResponse()),{xhr:i[i.length-1]})}).catch(t=>{throw E("reject",e.id),t})}get id(){return this._id}get descriptor(){return this._descriptor}_getAuthCb(){return this._authProvider.isNoAuthMode?e=>e:this._authCb.bind(this)}_authCb(e,t){return E("_authCb()"),this._authProvider.isAuthorizedURL(e)?this._authProvider.refreshAuth().then(()=>this._authProvider.applyAuthHeaders(e,t)):Promise.reject(new s.DCXError(s.DCXError.UNAUTHORIZED,"URL is not part of authenticationAllowList.",void 0,void 0,{url:e}))}_emit(e,t){this._listeners[e].map(e=>e.call(null,t))}getPromise(){return this._promise}cancel(e){return this._networkRequest.cancel(e)}on(e,t){this._listeners[e].push(t)}}const C=e=>new A(e),D=o.newDebug("dcx:http:map");class y{constructor(){this._map=new Map}addRequest(e,t){return D("addRequest()",e),this._map.set(e,t),t.getPromise().then(t=>{D("then",e),this._map.delete(e)}).catch(t=>{D("catch",e,t),this._map.delete(e)}),e}get(e){return this._map.get(e)}get length(){return this._map.size}has(e){return this._map.has(e)}removeById(e){const t=this._map.get(e);t&&this.remove(t)}remove(e,t){return e&&e.cancel&&e.cancel(t)}clear(e){this._map.forEach(t=>{this.remove(t,e)}),this._map.clear()}removeAllWithToken(e){this._map.forEach(t=>{t.descriptor.token===e&&this.remove(t)})}}const I=o.newDebug("dcx:http:q"),v=e=>"head"===e.method.toLowerCase();class b{constructor(){this._queue=[],this._later={},this._headEndPtr=0,this._isPriority=v,this._usePriority=!1}push(e,t,r){return d(this,void 0,void 0,(function*(){let s;const o=new Promise(e=>{s=e});if("number"!=typeof t||t<=0){const t={descriptor:e,notifySent:e=>s(e),notifyCanceled:this._notifyCanceled(s)};return this._push(t),o}const{id:n}=e,i=setTimeout(()=>{this._ready(n)},t),a=e=>s(e);return this._later[n]={readyTimeout:i,wait:t,descriptor:e,notifySent:a,notifyCanceled:this._notifyCanceled(s),notifyReady:()=>{r&&r.call(null,{wait:t,descriptor:e,notifySent:a})}},o}))}_notifyCanceled(e){return t=>{if(!t)return e({canceled:!0});e({canceled:!0,error:t})}}_push(e){this._usePriority&&this._isPriority(e.descriptor)?this._queue.splice(this._headEndPtr++,0,e):this._queue.push(e)}remove(e){if(e.id in this._later)return I("remove from later",e.id),this._remove(e.id);const t=this._indexOf(e);return I("remove from q",t),t>=0?this._remove(t):void 0}_remove(e,t){if(I("_remove",e),"string"==typeof e){const r=this._later[e];return r.notifyCanceled.call(null,t),r.readyTimeout&&clearTimeout(r.readyTimeout),void delete this._later[e]}this._queue[e].notifyCanceled.call(null,t),this._queue.splice(e,1),e<this._headEndPtr&&this._headEndPtr--}_indexOf(e){const t=!!e.method,r=t&&this._usePriority&&this._isPriority(e),s=r?this._headEndPtr:this._queue.length,o=r||!t?0:this._headEndPtr;for(let n=o;n<o+s;n++)if(e.id===this._queue[n].descriptor.id)return n;return-1}exists(e){return e.id in this._later||this._indexOf(e)>=0}_ready(e){const t=this._later[e],r=t.notifyReady;delete this._later[e],delete t.notifyReady,delete t.readyTimeout,delete t.wait,this._push(t),"function"==typeof r&&r.call(null)}pop(){const e=this._queue.shift();return this._headEndPtr>0&&this._headEndPtr--,e}get length(){return I("length: ",this._queue.length,Object.keys(this._later).length),this._queue.length+Object.keys(this._later).length}clear(e){for(let r=this._queue.length-1;r>=0;r--)this._remove(r,e);this._queue=[];const t=Object.keys(this._later);for(const r in t){const s=t[r];this._remove(s,e)}this._later={}}removeAllWithToken(e){for(let r=this._queue.length-1;r>=0;r--)this._queue[r].descriptor.token===e&&this._remove(r);const t=Object.keys(this._later);for(const r in t){const s=t[r];this._later[s].descriptor.token===e&&this._remove(s)}}}const T=o.newDebug("dcx:http:service");class P{constructor(e,t={}){this.name="AdobeHTTPService",this._requestQueue=new b,this._requestsOutstanding=new y,this._authProvider=void 0,this._isActive=!0,this._handlesRedirects=!0,this._withCredentials=!1,this._additionalNodeOptions={},this._retryOptions={},e instanceof l||i.isObject(e)&&i.isFunction(e.onChange)?this._authProvider=e:i.isFunction(e)&&(t.useAuthProvider?(this._authProvider=new l(void 0,void 0,e),this._waitingForAuthentication=!0):(this._authProvider=new l(void 0,void 0,()=>e.call(null,this)),this._waitingForAuthentication=!0)),this._authProvider?this._authProvider.onChange(this._onAuthChange.bind(this)):(this._authProvider=new l,this._authProvider.resume()),this._maxOutstanding=t.maxOutstanding||5,this._withCredentials=t.crossOriginCredentials||!1,this._timeout=null==t.timeout?12e4:t.timeout,t.server&&(this.server=t.server)}get isActive(){return this._isActive}set isActive(e){this._isActive!==e&&(this._isActive=e,e||this._authProvider.logout(),this._checkQueue())}get crossOriginCredentials(){return this._withCredentials}set crossOriginCredentials(e){this._withCredentials=e}get maxOutstanding(){return this._maxOutstanding}set maxOutstanding(e){this._maxOutstanding=e,this._checkQueue()}get handlesRedirects(){return this._handlesRedirects}get server(){return this._server}set server(e){this._server=e&&e.endsWith("/")?e.substr(0,e.length-1):e}_forceXhr(e,t=!1){this._forcedXhr=e,this._handlesRedirects=!t}setAdditionalHeaders(e){this._additionalHeaders=e||{}}setValidateStatus(e){this._isStatusValid=e}setAdditionalNodeOptions(e){this._additionalNodeOptions=e,i.isNode()&&e&&0===e.maxRedirects&&(this._handlesRedirects=!1)}setRetryOptions(e){this._retryOptions=e}set authenticationAllowList(e){this._authProvider.authenticationAllowList=e}get authenticationAllowList(){return this._authProvider.authenticationAllowList}get authProvider(){return this._authProvider}setApiKey(e){this._authProvider.setApiKey(e)}setTimeout(e){this._timeout=e}setAuthToken(e){e?this._authProvider.setAuthToken(e):this._authProvider.logout()}_onAuthChange(e,t){T("_oAC",e);const r=this._waitingForAuthentication;"unauthenticated"===e?this._waitingForAuthentication=!0:(this._waitingForAuthentication=!1,!1!==r&&this._checkQueue())}resume(){this._waitingForAuthentication=!1,this._authProvider.resume(),this._checkQueue()}setRequestHooks(e,t){this._beforeHook=e,this._afterHook=t}invoke(t="GET",r,o={},n,d={},c){T("invoke",t,r,d);let l=(d=d||{}).autoParseJson||!1,h=d.responseType;if(null!=h&&"void"!==h||(l=null==d.autoParseJson||d.autoParseJson,h=d.responseType="text"),"stream"===h)throw new s.DCXError(s.DCXError.NOT_IMPLEMENTED,"Stream response type not yet implemented.");if("defaultbuffer"===h&&(h=i.isNode()?d.responseType="buffer":d.responseType="arraybuffer"),"buffer"===h){if("function"!=typeof e)throw new s.DCXError(s.DCXError.INVALID_PARAMS,"No Buffer class")}else if("blob"===h){if("function"!=typeof Blob)throw new s.DCXError(s.DCXError.INVALID_PARAMS,"No Blob class")}else if(h&&"text"!==h&&"json"!==h&&"arraybuffer"!==h)throw new s.DCXError(s.DCXError.INVALID_PARAMS,"Unsupported response type");!i.endPointOf(r)&&this.server&&(r=`${this.server}/${r.startsWith("/")?r.substr(1,r.length):r}`),T("invoke href",r),o=i.merge({},o,this._additionalHeaders),T("invoke headers",o),d.additionalNodeOptions=Object.assign({},this._additionalNodeOptions||{},d.additionalNodeOptions||{}),d.isStatusValid=d.isStatusValid||this._isStatusValid,d.retryOptions=Object.assign({},this._retryOptions||{},d.retryOptions||{});let u={method:t,href:r,headers:o,token:void 0,body:n,options:d,progress:void 0,autoParseJson:l},p=d.reuseRequestDesc;p&&p instanceof a.default&&"props"in p&&(p=p.props),p&&((this._requestQueue.exists(p)||p.id&&null!=this._requestsOutstanding.get(p.id))&&T("requestDesc still in use"),u=i.merge(p,u)),u.id=u.id||i.generateUuid(),c&&("maxRedirects"in d.additionalNodeOptions&&(d.additionalNodeOptions.maxRedirects=0),d.retryOptions&&0!==Object.keys(d.retryOptions).length||(d.retryOptions={disableRetry:!0}));const f=this._getRequestPromise(u);return f.getPromise().then(this._checkQueue.bind(this)).catch(this._checkQueue.bind(this)),i.isFunction(c)&&(T("invoke - cb"),f.then(e=>{T("invoke - cb - resolve ",e.statusCode);try{c(void 0,e,e.response)}catch(e){console.error("[dcx:http] error in success callback",e,e.stack)}}).catch(e=>{T("invoke - cb - reject: ",e);try{c(e,e.response)}catch(e){console.error("[dcx:http] error in failure callback",e,e.stack)}})),this._checkQueue(),f}_makeRequest(e){T("_makeRequest(): ",e.id);const t=e.options||{},r=C(i.pruneUndefined(Object.assign(Object.assign({url:e.href,autoParseJson:e.autoParseJson,descriptor:e},e),{timeout:t.timeout||this._timeout,authProvider:this._authProvider,forceXhr:this._forcedXhr,responseType:t.responseType,preCallback:this._beforeHook,postCallback:this._afterHook,isStatusValid:t.isStatusValid,additionalNodeOptions:t.additionalNodeOptions,retryOptions:t.retryOptions})));return this._requestsOutstanding.addRequest(e.id,r),e.startTime=(new Date).valueOf(),r}_checkQueue(){queueMicrotask(this._checkQueueLoop.bind(this))}_checkQueueLoop(){if(T("_checkQueueLoop()",this._waitingForAuthentication,this.isActive,this._requestsOutstanding.length,"<?",this.maxOutstanding),!this._isActive){T("_cQL inactive");const e=new s.DCXError(s.DCXError.SERVICE_IS_INACTIVE,"Network request in inactive state");this._requestsOutstanding.clear(e),this._requestQueue.clear(e)}let e=!0;for(;e&&!this._waitingForAuthentication&&this._requestsOutstanding.length<this.maxOutstanding&&(e=this._requestQueue.pop(),null!=e);){const t=this._makeRequest(e.descriptor);e.notifySent(t)}T("_cQL done")}_getRequestPromise(e){return T("_getRequestPromise()"),new a.default((t,r,o)=>{if(!this._isActive)return T("_gRP inactive"),r(new s.DCXError(s.DCXError.SERVICE_IS_INACTIVE,"Network request in inactive state"));o(()=>{T("_gRP cancel 1",e.id),this._requestQueue.remove(e)});let n=e.noSoonerThen||null;return n&&(n-=i.now(),n=n<0?0:n>3e5?3e5:n),delete e.noSoonerThen,this._requestQueue.push(e,n,this._checkQueue.bind(this)).then(n=>(T("_gRP sent",e.id),n.canceled?(T("_gRP reject 1: ",e.id),r(new s.DCXError(s.DCXError.ABORTED,"Request aborted",n.error))):(o(t=>{T("_gRP cancel 2",e.id,t),n.cancel(new s.DCXError(s.DCXError.ABORTED,"Request aborted",t))}),n.getPromise().then(r=>(T("_gRP resolve 1",e.id,r),t(r))).catch(t=>(T("_gRP reject 2: ",e.id,t),r(t)))))).catch(r)},e)}abort(e){e&&e.cancel?e.cancel():this._requestQueue.exists(e)?this._requestQueue.remove(e):this._requestsOutstanding.removeById(e.id)}abortAllWithToken(e){T("abortAllWithToken()"),this._requestsOutstanding.removeAllWithToken(e),this._requestQueue.removeAllWithToken(e)}}const w=P;t.AdobeNetworkHTTPService=w,t.AuthProvider=l,t.HTTPService=P,t.StreamProvider=class{constructor(e,t){this.getStream=e,this.getStreamAsync=t}},t.Xhr=f,t.createHTTPService=(e,t)=>new P(e,t||{})}).call(this,r(10).Buffer)},3795:function(e,t,r){"use strict";(function(e){var t=void 0!==e?e:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};function r(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}var o=r,n=s;function i(e){if(o===setTimeout)return setTimeout(e,0);if((o===r||!o)&&setTimeout)return o=setTimeout,setTimeout(e,0);try{return o(e,0)}catch(r){try{return o.call(null,e,0)}catch(r){return o.call(this,e,0)}}}"function"==typeof t.setTimeout&&(o=setTimeout),"function"==typeof t.clearTimeout&&(n=clearTimeout);var a,d=[],c=!1,l=-1;function h(){c&&a&&(c=!1,a.length?d=a.concat(d):l=-1,d.length&&u())}function u(){if(!c){var e=i(h);c=!0;for(var t=d.length;t;){for(a=d,d=[];++l<t;)a&&a[l].run();l=-1,t=d.length}a=null,c=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function p(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];d.push(new f(e,t)),1!==d.length||c||i(u)}function f(e,t){this.fun=e,this.array=t}function _(){}f.prototype.run=function(){this.fun.apply(null,this.array)};var m,g=_,E=_,A=_,C=_,D=_,y=_,I=_,v=t.performance||{},b=v.now||v.mozNow||v.msNow||v.oNow||v.webkitNow||function(){return(new Date).getTime()},T=new Date,P={nextTick:p,title:"browser",browser:!0,env:{},argv:[],version:"",versions:{},on:g,addListener:E,once:A,off:C,removeListener:D,removeAllListeners:y,emit:I,binding:function(e){throw new Error("process.binding is not supported")},cwd:function(){return"/"},chdir:function(e){throw new Error("process.chdir is not supported")},umask:function(){return 0},hrtime:function(e){var t=.001*b.call(v),r=Math.floor(t),s=Math.floor(t%1*1e9);return e&&(r-=e[0],(s-=e[1])<0&&(r--,s+=1e9)),[r,s]},platform:"browser",release:{},config:{},uptime:function(){return(new Date-T)/1e3}},w="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:{};(function(e,t){e.exports=function(){function t(e){return"function"==typeof e}var r=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},s=0,o=void 0,n=void 0,i=function(e,t){f[s]=e,f[s+1]=t,2===(s+=2)&&(n?n(_):m())};var a="undefined"!=typeof window?window:void 0,d=a||{},c=d.MutationObserver||d.WebKitMutationObserver,l="undefined"==typeof self&&void 0!==P&&"[object process]"==={}.toString.call(P),h="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function u(){var e=setTimeout;return function(){return e(_,1)}}var f=new Array(1e3);function _(){for(var e=0;e<s;e+=2)(0,f[e])(f[e+1]),f[e]=void 0,f[e+1]=void 0;s=0}var m=void 0;function g(e,t){var r=this,s=new this.constructor(C);void 0===s[A]&&M(s);var o=r._state;if(o){var n=arguments[o-1];i((function(){return S(o,s,n,r._result)}))}else k(r,s,e,t);return s}function E(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var t=new this(C);return b(t,e),t}m=l?function(){return p(_)}:c?function(){var e=0,t=new c(_),r=document.createTextNode("");return t.observe(r,{characterData:!0}),function(){r.data=e=++e%2}}():h?function(){var e=new MessageChannel;return e.port1.onmessage=_,function(){return e.port2.postMessage(0)}}():void 0===a?function(){try{var e=Function("return this")().require("vertx");return void 0!==(o=e.runOnLoop||e.runOnContext)?function(){o(_)}:u()}catch(e){return u()}}():u();var A=Math.random().toString(36).substring(2);function C(){}var D=void 0,y=1,I=2;function v(e,r,s){r.constructor===e.constructor&&s===g&&r.constructor.resolve===E?function(e,t){t._state===y?R(e,t._result):t._state===I?O(e,t._result):k(t,void 0,(function(t){return b(e,t)}),(function(t){return O(e,t)}))}(e,r):void 0===s?R(e,r):t(s)?function(e,t,r){i((function(e){var s=!1,o=function(e,t,r,s){try{e.call(t,r,s)}catch(e){return e}}(r,t,(function(r){s||(s=!0,t!==r?b(e,r):R(e,r))}),(function(t){s||(s=!0,O(e,t))}),e._label);!s&&o&&(s=!0,O(e,o))}),e)}(e,r,s):R(e,r)}function b(t,r){if(t===r)O(t,new TypeError("You cannot resolve a promise with itself"));else if(function(e){var t=typeof e;return null!==e&&("object"===t||"function"===t)}(r)){var s=void 0;try{s=r.then}catch(e){return void O(t,e)}v(t,r,s)}else R(t,r)}function T(e){e._onerror&&e._onerror(e._result),L(e)}function R(e,t){e._state===D&&(e._result=t,e._state=y,0!==e._subscribers.length&&i(L,e))}function O(e,t){e._state===D&&(e._state=I,e._result=t,i(T,e))}function k(e,t,r,s){var o=e._subscribers,n=o.length;e._onerror=null,o[n]=t,o[n+y]=r,o[n+I]=s,0===n&&e._state&&i(L,e)}function L(e){var t=e._subscribers,r=e._state;if(0!==t.length){for(var s=void 0,o=void 0,n=e._result,i=0;i<t.length;i+=3)s=t[i],o=t[i+r],s?S(r,s,o,n):o(n);e._subscribers.length=0}}function S(e,r,s,o){var n=t(s),i=void 0,a=void 0,d=!0;if(n){try{i=s(o)}catch(e){d=!1,a=e}if(r===i)return void O(r,new TypeError("A promises callback cannot return that same promise."))}else i=o;r._state!==D||(n&&d?b(r,i):!1===d?O(r,a):e===y?R(r,i):e===I&&O(r,i))}var N=0;function M(e){e[A]=N++,e._state=void 0,e._result=void 0,e._subscribers=[]}var X=function(){function e(e,t){this._instanceConstructor=e,this.promise=new e(C),this.promise[A]||M(this.promise),r(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?R(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&R(this.promise,this._result))):O(this.promise,new Error("Array Methods must be provided an Array"))}return e.prototype._enumerate=function(e){for(var t=0;this._state===D&&t<e.length;t++)this._eachEntry(e[t],t)},e.prototype._eachEntry=function(e,t){var r=this._instanceConstructor,s=r.resolve;if(s===E){var o=void 0,n=void 0,i=!1;try{o=e.then}catch(e){i=!0,n=e}if(o===g&&e._state!==D)this._settledAt(e._state,t,e._result);else if("function"!=typeof o)this._remaining--,this._result[t]=e;else if(r===x){var a=new r(C);i?O(a,n):v(a,e,o),this._willSettleAt(a,t)}else this._willSettleAt(new r((function(t){return t(e)})),t)}else this._willSettleAt(s(e),t)},e.prototype._settledAt=function(e,t,r){var s=this.promise;s._state===D&&(this._remaining--,e===I?O(s,r):this._result[t]=r),0===this._remaining&&R(s,this._result)},e.prototype._willSettleAt=function(e,t){var r=this;k(e,void 0,(function(e){return r._settledAt(y,t,e)}),(function(e){return r._settledAt(I,t,e)}))},e}();var x=function(){function e(t){this[A]=N++,this._result=this._state=void 0,this._subscribers=[],C!==t&&("function"!=typeof t&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof e?function(e,t){try{t((function(t){b(e,t)}),(function(t){O(e,t)}))}catch(t){O(e,t)}}(this,t):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return e.prototype.catch=function(e){return this.then(null,e)},e.prototype.finally=function(e){var r=this,s=r.constructor;return t(e)?r.then((function(t){return s.resolve(e()).then((function(){return t}))}),(function(t){return s.resolve(e()).then((function(){throw t}))})):r.then(e,e)},e}();return x.prototype.then=g,x.all=function(e){return new X(this,e).promise},x.race=function(e){var t=this;return r(e)?new t((function(r,s){for(var o=e.length,n=0;n<o;n++)t.resolve(e[n]).then(r,s)})):new t((function(e,t){return t(new TypeError("You must pass an array to race."))}))},x.resolve=E,x.reject=function(e){var t=new this(C);return O(t,e),t},x._setScheduler=function(e){n=e},x._setAsap=function(e){i=e},x._asap=i,x.polyfill=function(){var e=void 0;if(void 0!==w)e=w;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var r=null;try{r=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===r&&!t.cast)return}e.Promise=x},x.Promise=x,x}()}(m={path:void 0,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&m.path)}},m.exports),m.exports).polyfill(),String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return this.substr(t||0,e.length)===e})}).call(this,r(23))},3796:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=r(3578),o=r(2785),n=r(3078),i=r(3079),a=r(2786);function d(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var c=d(o),l=d(i);class h{constructor(e,t,r,s,o,n){this.id=e,this.etag=t,this.version=r,this.md5=s,this.length=o,this.type=n}}class u{constructor(e,t,r){this.compositeId=e,this.compositeAssetId=t,this.repositoryId=r,this.records={}}addUploadRecord(e,t){a.validateParams(["componentId",e,"string"],["record",t,"object"]),this.records[e]=t}getComponentDescriptor(e){const t=this._checkRAPIComponentParams(e);return JSON.stringify(function(e,t,r,s){try{a.validateObject(s,"UploadRecord",["id","string"],["version","string"],["length","number"],["etag","string"],["type","string"])}catch(e){throw new o.DCXError(o.DCXError.INVALID_STATE,"Invalid record data",e)}const n={versionId:"0",componentId:s.id,cloudAssetId:e,compositeId:t,repositoryId:r,componentRevisionId:s.version,type:s.type,cloudExpiration:void 0,size:s.length,etag:s.etag,hashType:"md5",hashValue:s.md5};return a.pruneUndefined(n)}(this.compositeAssetId,this.compositeId,this.repositoryId,t))}getComponentURL(e,t){const r=this._checkRAPIComponentParams(t);return e.getCompositeComponentUrlForDownload({repositoryId:this.repositoryId,assetId:this.compositeAssetId},t,r.length,r.version)}getComponent(e,t,r){const s=this._checkRAPIComponentParams(t);return e.getCompositeComponent({repositoryId:this.repositoryId,assetId:this.compositeAssetId},t,s.version,r)}_checkRAPIComponentParams(e){if(!this.repositoryId)throw new o.DCXError(o.DCXError.INVALID_STATE,"Repository ID must be defined.",void 0,void 0,{componentId:e});const t=this.records[e];if(!t)throw new o.DCXError(o.DCXError.INVALID_PARAMS,"UploadRecord does not exist",void 0,void 0,{componentId:e});return t}}function p(e,t,r){return a.validateParams(["compositeId",e,"string",!0],["compositeAssetId",t,"string"],["repositoryId",r,["string","undefined"]]),new u(e,t,r)}function f(e,t,r,s,o,n){return a.validateParams(["componentId",e,"string"],["etag",t,"string"],["version",r,"string"],["md5",s,"string"],["length",o,"number"],["type",n,"string"]),new h(e,t,r,s,o,n)}function _(e,t,r){a.validateParams(["repoUploadResults",t,"object"],["compositeId",r,"string",!0]),a.validateObject(t,"repoUploadResults",["result","object"]);const o=t.asset||t.compositeAsset,{result:n}=t;if(!(o.assetId&&o.repositoryId||o.links||n.links))throw new c.default(c.default.INVALID_PARAMS,"AdobeRepoUploadResult#asset object missing repositoryId or assetId, and links");const i=f(n.id,n.etag,n.revision,n.md5,n.length,n.type);let d;if(o.assetId&&o.repositoryId)d=l.default.resolve(p(r,o.assetId,o.repositoryId));else{a.validateParams(["session",e,"object"]);const t=o.links||n.links,i=s.assertLinksContainAny(t,[s.LinkRelation.PRIMARY,s.LinkRelation.ID,s.LinkRelation.PATH,s.LinkRelation.COMPONENT]),l=a.getLinkHrefTemplated(t,i,{component_id:"manifest"});d=e.headHTTPResource(l).then(e=>{const t=e.headers["repository-id"],s=e.headers["asset-id"];if(!t||!s)throw new c.default(c.default.INVALID_DATA,"Fetched data missing repositoryId or assetId");return p(r,s,t)})}return d.then(e=>(e.addUploadRecord(n.id,i),e))}const m=n.newDebug("dcx:repoapisession");class g{constructor(e,t,r){this._authenticationAllowList=[],this._blockUploadThreshold=s.DEFAULT_BLOCK_UPLOAD_THRESHOLD,this._blockDownloadThreshold=s.DEFAULT_BLOCK_DOWNLOAD_THRESHOLD,a.validateParams(["httpService",e,"object"],["server",t,"string"]),this._service=e,this._service._repoAPIBaseUrl=t;const o=a.endPointOf(t);if(!o)throw new c.default(c.default.INVALID_PARAMS,"Could not determine endpoint from: "+t);this._endPoint=o,this.authenticationAllowList=["adobe.com","adobe.io","fotolia.net"],a.isObject(r)&&a.isFunction(r.getIndexLinks)?this._linksCache=r:this._linksCache=new s.RepositoryLinksCache}get serviceConfig(){return{service:this._service,cache:this._linksCache}}get blockUploadThreshold(){return this._blockUploadThreshold}set blockUploadThreshold(e){a.validateParam("threshold",e,"+number"),this._blockUploadThreshold=e}get blockDownloadThreshold(){return this._blockDownloadThreshold}set blockDownloadThreshold(e){a.validateParam("threshold",e,"+number"),this._blockDownloadThreshold=e}createAsset(e,t,r,o,n,i){return this.fetchLinksIfMissing(e,[s.LinkRelation.CREATE]).then(()=>s.createAsset(this._service,e,t,r,o,n,i)).then(e=>(this._linksCache.setValueWithAsset(e.result.links,e.result),e))}createComposite(e,t,r){if(m("createComposite()"),a.validateParams(["parentDir",e,"object"],["relPath",t,"string"],["contentType",r,"string"]),!r.endsWith("+dcx"))throw new c.default(c.default.INVALID_PARAMS,'Composite contentType must end in "+dcx"');if(!s.isMinimalAdobeAsset(e))throw new c.default(c.default.INVALID_PARAMS,"parentDir must contain links or repositoryId & assetId or path");let n=!1;return this.createAsset(e,t,!0,r).catch(e=>{if(e.response&&409===e.response.statusCode)return{response:e.response};throw e}).then(e=>{if(409!==e.response.statusCode)return n=!0,this._linksCache.setValueWithAsset(e.result.links,e.result),e;const t=s.parseLinksFromResponseHeader(e.response);return s.headPrimaryResource(this._service,{links:t})}).then(r=>{if(n)return r;r=r;const o=s.parseLinksFromResponseHeader(r);this._linksCache.setValueWithAsset(o,{assetId:r.headers["asset-id"]||r.headers["x-resource-id"],repositoryId:e.repositoryId});const i=r.headers[s.HeaderKeys.CONTENT_TYPE];if("string"!=typeof i)throw new c.default(c.default.INVALID_DATA,"Missing Content-Type header.",void 0,r);if("+dcx"!==i.substr(i.length-4,4))throw new c.default(c.default.FILE_EXISTS_IN_CLOUD,"Cannot overwrite file at "+t,void 0,r);throw new c.default(c.default.ALREADY_EXISTS,"Composite already exists at "+t,void 0,r)}).catch(e=>{if(e.code===c.default.FILE_EXISTS_IN_CLOUD||e.code===c.default.ALREADY_EXISTS)throw e;throw o.unexpectedResponse("Error creating composite",e,e.response)})}getIndexLinks(){return s.getIndexLinks(this.serviceConfig)}getIndexRepository(){return s.getIndexRepository(this._service)}getIndexDocument(){return s.getIndexDocument(this._service)}getDiscoverableAssets(e={}){return s.getDiscoverableAssets(this.serviceConfig,e)}getDiscoverableRepos(e={}){return s.getDiscoverableRepos(this.serviceConfig,e)}headHTTPResource(e,t){return s.headHTTPResource(this._service,e,t)}headCompositeManifest(e){return this.fetchLinksIfMissing(e,[s.LinkRelation.COMPONENT]).then(()=>s.headCompositeManifest(this._service,e))}resolveAsset(e,t="id",r,o){return s.resolveAsset(this.serviceConfig,e,t,r,o)}headPrimaryResource(e){return this.fetchLinksIfMissing(e,[s.LinkRelation.PRIMARY]).then(()=>s.headPrimaryResource(this._service,e))}getRepoMetadata(e){return this.useLinkOrResolveResource(e,s.LinkRelation.REPO_METADATA,"json").then(e=>({result:s.deserializeAsset(e.response.response),response:e.response}))}getEmbeddedMetadata(e,t="json"){return a.validateParams(["asset",e,"object"],["format",t,"enum",!1,["json","xml"]]),this.fetchLinksIfMissing(e,[s.LinkRelation.EMBEDDED_METADATA]).then(()=>s.getEmbeddedMetadata(this._service,e,t))}putEmbeddedMetadata(e,t,r,o="json"){return a.validateParams(["asset",e,"object"],["data",t,["string","object","object[]"]],["etag",r,"string",!0],["format",o,"enum",!1,["json","xml"]]),this.fetchLinksIfMissing(e,[s.LinkRelation.EMBEDDED_METADATA]).then(()=>s.putEmbeddedMetadata(this._service,e,t,r,o))}patchEmbeddedMetadata(e,t,r){return a.validateParams(["asset",e,"object"],["data",t,["string","object","object[]"]],["etag",r,"string",!0]),this.fetchLinksIfMissing(e,[s.LinkRelation.EMBEDDED_METADATA]).then(()=>s.patchEmbeddedMetadata(this._service,e,t,r))}getDirectory(e,t){return this.fetchLinksIfMissing(e,[s.LinkRelation.PAGE]).then(()=>s.getPagedChildren(this._service,e,t).then(e=>({result:s.directoryTransformer(e.paged.data)[1],paged:e.paged,response:e.response})))}getDirectoryByURL(e){return s.getDirectoryByURL(this._service,e).then(e=>({response:e.response,result:s.deserializeAsset(e.result)}))}getLinksForAsset(e){return s.getLinksForAsset(this.serviceConfig,e)}getACLPolicy(e){return this.fetchLinksIfMissing(e,[s.LinkRelation.ACL_POLICY]).then(()=>s.getACLPolicy(this._service,e))}getPrimaryResource(e,t){const r=s.getOrMakeStreamableContext({},t);return this._withSourcePromise(r).then(()=>this.fetchLinksIfMissing(e,[s.LinkRelation.PRIMARY])).then(()=>s.getPrimaryResource.call(r,this._service,e,t))}updatePrimaryResource(e,t,r,o,n,i){return this.fetchLinksIfMissing(e,[s.LinkRelation.PRIMARY]).then(()=>s.updatePrimaryResource(this._service,e,t,r,o,n,i))}getRepositoryResource(e){return this.fetchLinksIfMissing(e,[s.LinkRelation.REPOSITORY]).then(()=>s.getRepositoryResource(this._service,e))}getVersions(e,t){return this.fetchLinksIfMissing(e,[s.LinkRelation.PAGE]).then(()=>s.getPagedVersions(this._service,e,t).then(e=>({result:s.deserializeVersionSet(e.result),response:e.response,paged:e.paged})))}getVersionResource(e,t){return this.fetchLinksIfMissing(e,[s.LinkRelation.PAGE]).then(()=>s.getVersionResource(this._service,e,t).then(e=>({result:s.deserializeVersion(e.result),response:e.response})))}blockDownloadAsset(e,t,r,o,n,i,a){if("string"==typeof e)return s.doBlockDownload(this._service,e,t,r,o,n,i,a);const d=s.getOrMakeStreamableContext({},a);return this._withSourcePromise(d).then(()=>this.fetchLinksIfMissing(e,[s.LinkRelation.PRIMARY])).then(()=>s.doBlockDownload.call(d,this._service,e,t,r,o,n,i,a))}fetchLinksIfMissing(e,t){return s.fetchLinksIfMissing(this.serviceConfig,e,t).then(t=>{if(e.links!==t){if(a.isFunction(e.setLinks)){const r=e.links||{};e.setLinks(a.merge(r,t))}else e.links=a.merge(e.links||{},t);this._linksCache.setValueWithAsset(e.links,e)}return t})}useLinkOrResolveResource(e,t,r){return s.useLinkOrResolveResource(this.serviceConfig,e,t,r).then(t=>(e.links!==t.result.links&&(e.links=a.merge(e.links||{},t.result.links),this._linksCache.setValueWithAsset(e.links,e)),t))}getLinkHrefForAsset(e,t,r="id"){return this.fetchLinksIfMissing(e,[t]).then(e=>a.getLinkHref(e,t,r))}getEffectivePrivileges(e){return this.fetchLinksIfMissing(e,[s.LinkRelation.EFFECTIVE_PRIVILAGES]).then(()=>s.getEffectivePrivileges(this._service,e))}checkACLPrivilege(e,t,r){return this.fetchLinksIfMissing(e,[s.LinkRelation.ACCESS_CHECK]).then(()=>s.checkACLPrivilege(this._service,e,t,r))}headAppMetadata(e){return this.fetchLinksIfMissing(e,[s.LinkRelation.APP_METADATA]).then(()=>s.headAppMetadata(this._service,e))}getAppMetadata(e,t){return this.fetchLinksIfMissing(e,[s.LinkRelation.APP_METADATA]).then(()=>s.getAppMetadata(this._service,e,t))}putAppMetadata(e,t,r){return this.fetchLinksIfMissing(e,[s.LinkRelation.APP_METADATA]).then(()=>s.putAppMetadata(this._service,e,t,r))}patchAppMetadata(e,t,r){return this.fetchLinksIfMissing(e,[s.LinkRelation.APP_METADATA]).then(()=>s.patchAppMetadata(this._service,e,t,r))}getCompositeManifestUrl(e,t){a.validateParams(["asset",e,"object"],["version",t,"string",!0]);const r=this._getAsAdobeAsset(e);return r.version=t||r.version,this.fetchLinksIfMissing(r,[s.LinkRelation.MANIFEST]).then(()=>s.getCompositeManifestUrl(this._service,r,t))}getCompositeManifest(e,t,r){a.validateParams(["asset",e,"object"],["version",t,"string",!0],["etag",r,"string",!0]);const o=this._getAsAdobeAsset(e);return o.version=t||o.version,this.fetchLinksIfMissing(o,[s.LinkRelation.MANIFEST]).then(()=>s.getCompositeManifest(this._service,o,t,r))}getRendition(e,t,r){return this.fetchLinksIfMissing(e,[s.LinkRelation.RENDITION]).then(()=>s.getRendition(this._service,e,t,r))}getCompositeComponentUrlForDownload(e,t,r,o){const n=this._getAsAdobeAsset(e);return r>this.blockDownloadThreshold?this.fetchLinksIfMissing(n,[s.LinkRelation.BLOCK_DOWNLOAD]).then(()=>s.getCompositeComponentPresignedUrl(this._service,n,t,o)).then(({response:e,result:t})=>({response:e,isPresignedUrl:!0,url:t})):this.getCompositeComponentUrl(n,t,o).then(e=>({response:void 0,url:e,isPresignedUrl:!1}))}getCompositeComponentUrl(e,t,r){a.validateParams(["asset",e,"object"],["componentId",t,"string"],["version",r,"string",!0]);const o=this._getAsAdobeAsset(e);return o.version=r||o.version,this.fetchLinksIfMissing(o,[s.LinkRelation.COMPONENT]).then(()=>s.getCompositeComponentUrl(this._service,o,t,r))}getCompositeComponent(e,t,r,o){a.validateParams(["asset",e,"object"],["componentId",t,"string"],["version",r,"string",!0],["responseType",o,"enum",!0,["blob","json","text","buffer","arraybuffer"]]);const n=this._getAsAdobeAsset(e);r=r||n.version;const i=s.getOrMakeStreamableContext({},o);return this._withSourcePromise(i).then(()=>this.fetchLinksIfMissing(n,[s.LinkRelation.COMPONENT])).then(()=>s.getCompositeComponent.call(i,this._service,n,t,r,o))}putCompositeComponent(e,t,r,o,n,i,d){a.validateParams(["asset",e,"object"],["componentId",t,"string"],["contentType",o,"string"],["maybeIsNew",n,"boolean",!0],["size",i,"number",!0],["md5",d,"string",!0]);const c=this._getAsAdobeAsset(e);return this.fetchLinksIfMissing(c,[s.LinkRelation.COMPONENT,s.LinkRelation.BLOCK_UPLOAD_INIT]).then(()=>s.putCompositeComponent(this._service,e,t,r,o,n,i,d))}performBulkRequest(e,t,r){return this.fetchLinksIfMissing(e,[s.LinkRelation.BULK_REQUEST]).then(()=>s.performBulkRequest(this._service,e,t,r))}updateCompositeManifest(e,t,r,o=1,n){m("updateCompositeManifest()"),a.validateParams(["asset",e,"object"],["manifest",t,["object","string"]],["overwrite",r,"boolean"],["validationLevel",o,"+number"],["etag",n,"string",!0]);const i=this._getAsAdobeAsset(e);return this.fetchLinksIfMissing(i,[s.LinkRelation.MANIFEST]).then(()=>s.updateCompositeManifest(this._service,i,t,r,o,n))}patchVersions(e,t,r){return a.validateParams(["asset",e,"object"],["patchDoc",t,["string","array"]],["etag",r,"string",!0]),this.fetchLinksIfMissing(e,[s.LinkRelation.VERSION_HISTORY]).then(()=>s.patchVersions(this._service,e,t,r))}putACLPolicy(e,t,r){return this.patchACLPolicy(e,t)}patchACLPolicy(e,t){return a.validateParams(["asset",e,"object"],["policy",t,["string","object"]]),this.fetchLinksIfMissing(e,[s.LinkRelation.VERSION_HISTORY]).then(()=>s.patchACLPolicy(this._service,e,t))}deleteACLPolicy(e){return a.validateParams(["asset",e,"object"]),this.fetchLinksIfMissing(e,[s.LinkRelation.ACL_POLICY]).then(()=>s.deleteACLPolicy(this._service,e))}copyAsset(e,t,r,o){return s.copyAsset(this.serviceConfig,e,t,r,o)}moveAsset(e,t,r,o){return s.moveAsset(this.serviceConfig,e,t,r,o)}deleteAsset(e,t,r){return s.deleteAsset(this.serviceConfig,{repositoryId:e.repositoryId,path:e.path,assetId:e.assetId},t,r).then(t=>(this._linksCache.deleteWithAsset(e),t))}discardAsset(e,t,r){return s.discardAsset(this.serviceConfig,{repositoryId:e.repositoryId,path:e.path,assetId:e.assetId},t,r)}restoreAsset(e){return s.restoreAsset(this.serviceConfig,e)}packageAssets(e,t,r,o){return s.packageAssets(this.serviceConfig,e,t,r,o)}performOperation(e,t){return s.getOpsHref(this.serviceConfig).then(r=>s.doOperation(this._service,r,e,t))}performBatchOperation(e,t){return s.getOpsHref(this.serviceConfig).then(r=>s.doBatchOperation(this._service,r,e,t))}uploadResultsFromAdobeRepoUploadResult(e,t){return _(this,e,t)}updateCachedAssetLinks(e){if(!e.assetId)throw new c.default(c.default.INVALID_PARAMS,"Asset must contain an assetId");this._linksCache.setValueWithAsset(e.links||e._links,e)}updateCachedIndexLinks(e){if(!e)throw new c.default(c.default.INVALID_PARAMS,"Index LinkSet must not be null");this._linksCache.setIndexLinks(e)}getLinksCache(){return this._linksCache}setLinksCache(e){this._linksCache=e}clearLinksCache(){this._linksCache.clear()}_isDCXCompositeLike(e){return!!a.isObject(e)&&(null!=e.repositoryId||null!=e.assetId||a.isObject(e._current))}_isDCXBranchLike(e){return!!a.isObject(e)&&(null!=e.compositeAssetId||null!=e.compositeRepositoryId||a.isObject(e._core))}_isDCXComponentLike(e){return!!a.isObject(e)&&null!=e.owner&&this._isDCXBranchLike(e.owner)}_withSourcePromise(e){return l.default.resolve(void 0,e)}_getAsAdobeAsset(e){if("object"!=typeof e||Array.isArray(e))throw new c.default(c.default.INVALID_PARAMS,"Invalid asset-like object.");if(s.isMinimalAdobeAsset(e))return e;let t,r={};if(("repositoryId"in e||"assetId"in e||"links"in e||"version"in e)&&(r={repositoryId:e.repositoryId,assetId:e.assetId,links:e.links,version:e.version}),this._isDCXBranchLike(e)&&(t=e._core),this._isDCXComponentLike(e)||t){const s=e,o=t||(s&&s.owner&&s.owner._core?s.owner._core:void 0);if(o){const e=o._getSourceAssetInfoOfComponent(r);e&&"object"==typeof e&&(r.assetId=e.compositeAssetId||r.assetId,r.repositoryId=e.compositeRepositoryId||r.repositoryId,r.links=e.links||r.links,r.version=e.version||r.version)}}const o=e,n=e;return r.assetId=r.assetId?r.assetId:o.owner?o.owner.compositeAssetId:n.compositeAssetId,r.repositoryId=r.repositoryId?r.repositoryId:o.owner?o.owner.compositeRepositoryId:n.compositeRepositoryId,r}get authenticationAllowList(){return this._authenticationAllowList}set authenticationAllowList(e){if(!Array.isArray(e))throw new c.default(c.default.INVALID_PARAMS,"Expecting an array.");this._authenticationAllowList=e}_resolveUrl(e){return a.endPointOf(e)?e:a.appendPathElements(this._service._repoAPIBaseUrl||this._service.server,e)}registerLinks(e,t,r){e=e._links||e;const s={assetId:r||"urn:aaid:faux:"+a.generateUuid(),repositoryId:t||"faux-repo-id"};return this._linksCache.setValueWithAsset(e,s),s}getRequestFor(e,t){return new Promise((r,s)=>{const o={_service:{invoke:(e,t,s,o,n)=>{r({method:e,url:t,headers:s,body:o,options:n})}},_getAsAdobeAsset:this._getAsAdobeAsset.bind(this),fetchLinksIfMissing:this.fetchLinksIfMissing.bind(this)},n=this[e].call(o,...t);if(!a.isPromise(n))return s(new c.default(c.default.INVALID_STATE,"Could not retrieve request."));n.catch(()=>{})})}}t.AdobeRepoAPISession=g,t.createRepoAPISession=(e,t,r)=>new g(e,t,r),t.createUploadRecord=f,t.createUploadResults=p,t.uploadResultsFromAdobeRepoUploadResult=_,t.uploadResultsFromComponentDescriptor=function(e){let t;a.validateParams(["decriptor",e,"string"]);try{t=JSON.parse(e)}catch(e){throw new c.default(c.default.INVALID_JSON,"Invalid component descriptor",e)}switch(t.versionId){case"0":case void 0:if(!t.repositoryId)throw new c.default(c.default.INVALID_DATA,"Component descriptor missing repositoryId");try{const e=p(t.compositeId,t.cloudAssetId,t.repositoryId),r=f(t.componentId,t.etag,t.componentRevisionId,t.hashValue,t.size,t.type);return e.addUploadRecord(t.componentId,r),e}catch(e){throw new c.default(c.default.INVALID_DATA,"Invalid component descriptor",e)}default:throw new c.default(c.default.INVALID_DATA,"ComponentDescriptor serialization versionId not valid or not yet handled.")}}},3797:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=r(2786);function o(e){return s.isObject(e)&&s.isArray(e.patchDocument)?e.patchDocument:[]}function n(e,t="dcx-js",r=(new Date).toISOString(),n=s.generateUuid()){const i=o(this),d=a(n,e,t,r);return s.createPatchDocumentBuilder(i).add("/xmpMM:History/@list/-",d).replace("/xmpMM:InstanceID",n).replace("/xmp:ModifyDate",r).replace("/xmp:MetadataDate",r).operations}function i(e,t,r){const n=o(this);return s.createPatchDocumentBuilder(n).add(`/${e}:${t}`,r).operations}function a(e,t,r,s){return{"stEvt:action":t,"stEvt:when":s,"stEvt:softwareAgent":r,"stEvt:instanceID":e}}function d(e="dcx-js",t,r=s.generateUuid(),o=(new Date).toISOString()){return`<rdf:li\n    stEvt:action="${t}"\n    stEvt:instanceID="xmp.iid:${r}"\n    stEvt:when="${o}"\n    stEvt:softwareAgent="${e}"/>`}function c(e="dcx-js",t=s.generateUuid(),r=(new Date).toISOString(),o,n){return o||(o=[d(e,"created",t,r)]),`<x:xmpmeta xmlns:x="adobe:ns:meta/" x:xmptk="Adobe XMP Core 7.1.2">\n        <rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">\n            <rdf:Description rdf:about=""\n            xmlns:xmp="http://ns.adobe.com/xap/1.0/"\n            xmlns:xmpMM="http://ns.adobe.com/xap/1.0/mm/"\n            ${n?'xmlns:stRef="http://ns.adobe.com/xap/1.0/sType/ResourceRef#"':""}\n            xmlns:stEvt="http://ns.adobe.com/xap/1.0/sType/ResourceEvent#"\n            xmpMM:OriginalDocumentID="xmp.did:${t}"\n            xmp:ModifyDate="${r}"\n            xmp:MetadataDate="${r}"\n            xmp:CreatorTool="${e}"\n            xmp:CreateDate="${r}"\n            xmpMM:DocumentID="xmp.did:${t}"\n            xmpMM:InstanceID="xmp.iid:${t}">\n                <xmpMM:History>\n                    <rdf:Seq>\n                        ${o.join("\n")}\n                    </rdf:Seq>\n                </xmpMM:History>\n                ${n||""}\n            </rdf:Description>\n        </rdf:RDF>\n    </x:xmpmeta>`}class l{constructor(e){this._data=e}getElementsByTagName(e){return this._data.children.filter(t=>"string"!=typeof t&&t.tagName===e).map(u)}}class h extends l{constructor(e){super(e),this._data=e}setAttribute(e,t){this._data.attributes[e]=t}getAttribute(e){return this._data.attributes[e]}appendChild(e,t={},r=[]){const s={tagName:e,attributes:t,children:r};return this._data.children.push(s),u(s)}}function u(e){return new h(e)}class p extends l{constructor(e){super(e)}parse(e){const t=function(e,t={}){let r=t.pos||0;const s=!!t.keepComments,o=!!t.keepWhitespace,n="<",i="<".charCodeAt(0),a=">",d=">".charCodeAt(0),c="-".charCodeAt(0),l="/".charCodeAt(0),h="!".charCodeAt(0),u="'".charCodeAt(0),p='"'.charCodeAt(0),f="[".charCodeAt(0),_="]".charCodeAt(0);function m(t){const n=[];for(;e[r];)if(e.charCodeAt(r)===i){if(e.charCodeAt(r+1)===l){const s=r+2;if(r=e.indexOf(a,r),-1===e.substring(s,r).indexOf(t)){const t=e.substring(0,r).split("\n");throw new Error("Unexpected close tag\nLine: "+(t.length-1)+"\nColumn: "+(t[t.length-1].length+1)+"\nChar: "+e[r])}return r+1&&(r+=1),n}if(e.charCodeAt(r+1)===h){if(e.charCodeAt(r+2)===c){const t=r;for(;-1!==r&&(e.charCodeAt(r)!==d||e.charCodeAt(r-1)!==c||e.charCodeAt(r-2)!==c||-1===r);)r=e.indexOf(a,r+1);-1===r&&(r=e.length),s&&n.push(e.substring(t,r+1))}else{if(e.charCodeAt(r+2)===f&&e.charCodeAt(r+8)===f&&"cdata"===e.substr(r+3,5).toLowerCase()){const t=e.indexOf("]]>",r);-1===t?(n.push(e.substr(r+9)),r=e.length):(n.push(e.substring(r+9,t)),r=t+3);continue}{const t=r+1;r+=2;let s=!1;for(;(e.charCodeAt(r)!==d||!0===s)&&e[r];)e.charCodeAt(r)===f?s=!0:!0===s&&e.charCodeAt(r)===_&&(s=!1),r++;n.push(e.substring(t,r))}}r++;continue}const o=D();n.push(o),"?"===o.tagName[0]&&(n.push(...o.children),o.children=[])}else{const e=g();(o||e.trim().length>0)&&n.push(e),r++}return n}function g(){const t=r;return r=e.indexOf(n,r)-1,-2===r&&(r=e.length),e.slice(t,r+1)}const E="\r\n\t>/= ";function A(){const t=r;for(;-1===E.indexOf(e[r])&&e[r];)r++;return e.slice(t,r)}const C=t.noChildNodes||["img","br","input","meta","link","hr"];function D(){r++;const t=A(),s={};let o=[];for(;e.charCodeAt(r)!==d&&e[r];){const n=e.charCodeAt(r);if(n>64&&n<91||n>96&&n<123){const n=A();let i,a=e.charCodeAt(r);for(;a&&a!==u&&a!==p&&!(a>64&&a<91||a>96&&a<123)&&a!==d;)r++,a=e.charCodeAt(r);if(a===u||a===p){if(i=y(),-1===r)return{tagName:t,attributes:s,children:o}}else i=null,r--;s[n]=i}r++}if(e.charCodeAt(r-1)!==l)if("script"===t){const t=r+1;r=e.indexOf("<\/script>",r),o=[e.slice(t,r)],r+=9}else if("style"===t){const t=r+1;r=e.indexOf("</style>",r),o=[e.slice(t,r)],r+=8}else-1===C.indexOf(t)?(r++,o=m(t)):r++;else r++;return{tagName:t,attributes:s,children:o}}function y(){const t=e[r],s=r+1;return r=e.indexOf(t,s),e.slice(s,r)}function I(){const r=new RegExp("\\s"+t.attrName+"\\s*=['\"]"+t.attrValue+"['\"]").exec(e);return r?r.index:-1}let v;if(void 0!==t.attrValue)for(t.attrName=t.attrName||"id",v=[];-1!==(r=I());)r=e.lastIndexOf("<",r),-1!==r&&v.push(D()),e=e.substr(r),r=0;else v=t.parseNode?D():m("");return t.simplify?function e(t){const r={};if(!t.length)return"";if(1===t.length&&"string"==typeof t[0])return t[0];t.forEach((function(t){if("object"!=typeof t)return;r[t.tagName]||(r[t.tagName]=[]);const s=e(t.children);r[t.tagName].push(s),Object.keys(t.attributes).length&&(s._attributes=t.attributes)}));for(const s in r)1===r[s].length&&(r[s]=r[s][0]);return r}(Array.isArray(v)?v:[v]):v}(e);return this._data={children:s.isArray(t)?t:[t]},this}getElementsByTagName(e){return super.getElementsByTagName(e)}toString(){return function(e,t=!1){let r="",s=0;function o(e){if(s+=1,e){t&&e.length>0&&"string"!=typeof e[0]&&(r+="\r\n");for(let t=0;t<e.length;t++)"string"==typeof e[t]?r+=e[t].trim():n(e[t]);t&&e.length>0&&"string"!=typeof e[0]&&!r.endsWith("\r\n")&&(r+="\r\n")}s-=1}function n(e){r+=t?"<".padStart(s)+e.tagName:"<"+e.tagName;for(const t in e.attributes)null===e.attributes[t]?r+=" "+t:-1===e.attributes[t].indexOf('"')?r+=" "+t+'="'+e.attributes[t].trim()+'"':r+=" "+t+"='"+e.attributes[t].trim()+"'";"?"!==e.tagName[0]?(r+=">",o(e.children),t&&r.endsWith("\r\n")?r+="</".padStart(s)+e.tagName+">\r\n":r+=t?"</"+e.tagName+">\r\n":"</"+e.tagName+">"):r+=t?"?>\r\n":"?>"}return o(e),r}(this._data.children)}}function f(e){return(new p).parse(e)}function _(e,t,r){const s=e.getElementsByTagName(t),o=e.getAttribute(t);s.length<1&&null==o&&e.setAttribute(t,r)}t.XMLElement=h,t.XMLParser=p,t.appendHistoryEvent=n,t.deleteProperty=function(e,t){const r=o(this);return s.createPatchDocumentBuilder(r).remove(`/${e}:${t}`).operations},t.initializeXMPJSON=function(e="dcx-js",t=s.generateUuid(),r=(new Date).toISOString()){return{"xmp:ModifyDate":r,"xmp:MetadataDate":r,"xmp:CreatorTool":e,"@context":{xmpMM:"http://ns.adobe.com/xap/1.0/mm/",stEvt:"http://ns.adobe.com/xap/1.0/sType/ResourceEvent#",xmp:"http://ns.adobe.com/xap/1.0/"},"xmpMM:DocumentID":`xmp.did:${t}`,"xmpMM:History":{"@list":[{"stEvt:softwareAgent":e,"stEvt:action":"created","stEvt:when":r,"stEvt:instanceID":`xmp.iid:${t}`}]},"xmp:CreateDate":r,"@id":"","xmpMM:InstanceID":`xmp.iid:${t}`,"xmpMM:OriginalDocumentID":`xmp.did:${t}`}},t.initializeXMPXML=c,t.makeDerivedWithAction=function(e="dcx-js",t,r=s.generateUuid(),i=(new Date).toISOString()){const a=o(this),d=s.createPatchDocumentBuilder(a).add("/@context/stRef","http://ns.adobe.com/xap/1.0/sType/ResourceRef#").add("/@context/xmpMM","http://ns.adobe.com/xap/1.0/mm/").add("/xmpMM:DerivedFrom",{}).copy("/xmpMM:DocumentID","/xmpMM:DerivedFrom/stRef:documentID").copy("/xmp:ModifyDate","/xmpMM:DerivedFrom/stRef:lastModifyDate").copy("/xmpMM:InstanceID","/xmpMM:DerivedFrom/stRef:instanceID").copy("/xmpMM:OriginalDocumentID","/xmpMM:DerivedFrom/stRef:originalDocumentID").replace("/xmpMM:InstanceID",r).replace("/xmpMM:DocumentID",r);return n.call({patchDocument:d.operations},t,e,i,r)},t.makeDerivedWithXML=function(e,t,r,o=(new Date).toISOString()){return e||t||r||(e=s.generateUuid()),`<xmpMM:DerivedFrom\n        stRef:documentID="xmp.did:${t||r||e}"\n        stRef:instanceID="xmp.iid:${r||t||e}"\n        stRef:originalDocumentID="xmp.did:${e||t||r}"\n        stRef:lastModifyDate="${o}"/>`},t.makeHistoryEventXML=d,t.parseXML=f,t.registerNamespace=function(e,t){const r=o(this);return s.createPatchDocumentBuilder(r).add(`/@context/${t}`,e).operations},t.repairXMPXML=function(e,t="dcx-js",r=s.generateUuid(),o=(new Date).toISOString()){const n=f(e),i=n.getElementsByTagName("x:xmpmeta");if(i.length<1)return c(t,r,o);const a=i[0].getElementsByTagName("rdf:RDF");if(a.length<1)return c(t,r,o);const d=a[0].getElementsByTagName("rdf:Description");if(d.length<1)return c(t,r,o);const l=d[0];return _(l,"xmp:ModifyDate",o),_(l,"xmp:MetadataDate",o),_(l,"xmp:CreatorTool",t),_(l,"xmp:CreateDate",o),_(l,"xmpMM:DocumentID",`xmp.did:${r}`),_(l,"xmpMM:InstanceID",`xmp.iid:${r}`),_(l,"xmpMM:OriginalDocumentID",`xmp.did:${r}`),function(e){const t=["xmpMM:History","rdf:Seq"];let r=e;for(;t.length>0;){const e=t.shift(),s=r.getElementsByTagName(e);r=s.length>0?s[0]:r.appendChild(e)}}(l),n.toString()},t.setCreatorTool=function(e){return i.call(this,"xmp","CreatorTool",e)},t.setProperty=i,t.updateLastHistoryEvent=function(e,t,r){const n=o(this);if(null==e&&null==t&&null==r)return n;const i=s.createPatchDocumentBuilder(n);let d=a(s.generateUuid(),e,t,r);d=s.pruneUndefined(d);for(const s in d)i.replace(`/xmpMM:History/@list/-/${s}`,d[s]);return i.operations}},4602:function(e,t,r){"use strict";var s;r.r(t),r.d(t,"v1",(function(){return _})),r.d(t,"v3",(function(){return b})),r.d(t,"v4",(function(){return T})),r.d(t,"v5",(function(){return R})),r.d(t,"NIL",(function(){return O})),r.d(t,"version",(function(){return k})),r.d(t,"validate",(function(){return a})),r.d(t,"stringify",(function(){return u})),r.d(t,"parse",(function(){return m}));var o=new Uint8Array(16);function n(){if(!s&&!(s="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return s(o)}var i=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var a=function(e){return"string"==typeof e&&i.test(e)},d=[],c=0;c<256;++c)d.push((c+256).toString(16).substr(1));var l,h,u=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=(d[e[t+0]]+d[e[t+1]]+d[e[t+2]]+d[e[t+3]]+"-"+d[e[t+4]]+d[e[t+5]]+"-"+d[e[t+6]]+d[e[t+7]]+"-"+d[e[t+8]]+d[e[t+9]]+"-"+d[e[t+10]]+d[e[t+11]]+d[e[t+12]]+d[e[t+13]]+d[e[t+14]]+d[e[t+15]]).toLowerCase();if(!a(r))throw TypeError("Stringified UUID is invalid");return r},p=0,f=0;var _=function(e,t,r){var s=t&&r||0,o=t||new Array(16),i=(e=e||{}).node||l,a=void 0!==e.clockseq?e.clockseq:h;if(null==i||null==a){var d=e.random||(e.rng||n)();null==i&&(i=l=[1|d[0],d[1],d[2],d[3],d[4],d[5]]),null==a&&(a=h=16383&(d[6]<<8|d[7]))}var c=void 0!==e.msecs?e.msecs:Date.now(),_=void 0!==e.nsecs?e.nsecs:f+1,m=c-p+(_-f)/1e4;if(m<0&&void 0===e.clockseq&&(a=a+1&16383),(m<0||c>p)&&void 0===e.nsecs&&(_=0),_>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");p=c,f=_,h=a;var g=(1e4*(268435455&(c+=122192928e5))+_)%4294967296;o[s++]=g>>>24&255,o[s++]=g>>>16&255,o[s++]=g>>>8&255,o[s++]=255&g;var E=c/4294967296*1e4&268435455;o[s++]=E>>>8&255,o[s++]=255&E,o[s++]=E>>>24&15|16,o[s++]=E>>>16&255,o[s++]=a>>>8|128,o[s++]=255&a;for(var A=0;A<6;++A)o[s+A]=i[A];return t||u(o)};var m=function(e){if(!a(e))throw TypeError("Invalid UUID");var t,r=new Uint8Array(16);return r[0]=(t=parseInt(e.slice(0,8),16))>>>24,r[1]=t>>>16&255,r[2]=t>>>8&255,r[3]=255&t,r[4]=(t=parseInt(e.slice(9,13),16))>>>8,r[5]=255&t,r[6]=(t=parseInt(e.slice(14,18),16))>>>8,r[7]=255&t,r[8]=(t=parseInt(e.slice(19,23),16))>>>8,r[9]=255&t,r[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,r[11]=t/4294967296&255,r[12]=t>>>24&255,r[13]=t>>>16&255,r[14]=t>>>8&255,r[15]=255&t,r};var g=function(e,t,r){function s(e,s,o,n){if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));for(var t=[],r=0;r<e.length;++r)t.push(e.charCodeAt(r));return t}(e)),"string"==typeof s&&(s=m(s)),16!==s.length)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var i=new Uint8Array(16+e.length);if(i.set(s),i.set(e,s.length),(i=r(i))[6]=15&i[6]|t,i[8]=63&i[8]|128,o){n=n||0;for(var a=0;a<16;++a)o[n+a]=i[a];return o}return u(i)}try{s.name=e}catch(o){}return s.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",s.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",s};function E(e){return 14+(e+64>>>9<<4)+1}function A(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function C(e,t,r,s,o,n){return A((i=A(A(t,e),A(s,n)))<<(a=o)|i>>>32-a,r);var i,a}function D(e,t,r,s,o,n,i){return C(t&r|~t&s,e,t,o,n,i)}function y(e,t,r,s,o,n,i){return C(t&s|r&~s,e,t,o,n,i)}function I(e,t,r,s,o,n,i){return C(t^r^s,e,t,o,n,i)}function v(e,t,r,s,o,n,i){return C(r^(t|~s),e,t,o,n,i)}var b=g("v3",48,(function(e){if("string"==typeof e){var t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(var r=0;r<t.length;++r)e[r]=t.charCodeAt(r)}return function(e){for(var t=[],r=32*e.length,s=0;s<r;s+=8){var o=e[s>>5]>>>s%32&255,n=parseInt("0123456789abcdef".charAt(o>>>4&15)+"0123456789abcdef".charAt(15&o),16);t.push(n)}return t}(function(e,t){e[t>>5]|=128<<t%32,e[E(t)-1]=t;for(var r=1732584193,s=-271733879,o=-1732584194,n=271733878,i=0;i<e.length;i+=16){var a=r,d=s,c=o,l=n;r=D(r,s,o,n,e[i],7,-680876936),n=D(n,r,s,o,e[i+1],12,-389564586),o=D(o,n,r,s,e[i+2],17,606105819),s=D(s,o,n,r,e[i+3],22,-1044525330),r=D(r,s,o,n,e[i+4],7,-176418897),n=D(n,r,s,o,e[i+5],12,1200080426),o=D(o,n,r,s,e[i+6],17,-1473231341),s=D(s,o,n,r,e[i+7],22,-45705983),r=D(r,s,o,n,e[i+8],7,1770035416),n=D(n,r,s,o,e[i+9],12,-1958414417),o=D(o,n,r,s,e[i+10],17,-42063),s=D(s,o,n,r,e[i+11],22,-1990404162),r=D(r,s,o,n,e[i+12],7,1804603682),n=D(n,r,s,o,e[i+13],12,-40341101),o=D(o,n,r,s,e[i+14],17,-1502002290),s=D(s,o,n,r,e[i+15],22,1236535329),r=y(r,s,o,n,e[i+1],5,-165796510),n=y(n,r,s,o,e[i+6],9,-1069501632),o=y(o,n,r,s,e[i+11],14,643717713),s=y(s,o,n,r,e[i],20,-373897302),r=y(r,s,o,n,e[i+5],5,-701558691),n=y(n,r,s,o,e[i+10],9,38016083),o=y(o,n,r,s,e[i+15],14,-660478335),s=y(s,o,n,r,e[i+4],20,-405537848),r=y(r,s,o,n,e[i+9],5,568446438),n=y(n,r,s,o,e[i+14],9,-1019803690),o=y(o,n,r,s,e[i+3],14,-187363961),s=y(s,o,n,r,e[i+8],20,1163531501),r=y(r,s,o,n,e[i+13],5,-1444681467),n=y(n,r,s,o,e[i+2],9,-51403784),o=y(o,n,r,s,e[i+7],14,1735328473),s=y(s,o,n,r,e[i+12],20,-1926607734),r=I(r,s,o,n,e[i+5],4,-378558),n=I(n,r,s,o,e[i+8],11,-2022574463),o=I(o,n,r,s,e[i+11],16,1839030562),s=I(s,o,n,r,e[i+14],23,-35309556),r=I(r,s,o,n,e[i+1],4,-1530992060),n=I(n,r,s,o,e[i+4],11,1272893353),o=I(o,n,r,s,e[i+7],16,-155497632),s=I(s,o,n,r,e[i+10],23,-1094730640),r=I(r,s,o,n,e[i+13],4,681279174),n=I(n,r,s,o,e[i],11,-358537222),o=I(o,n,r,s,e[i+3],16,-722521979),s=I(s,o,n,r,e[i+6],23,76029189),r=I(r,s,o,n,e[i+9],4,-640364487),n=I(n,r,s,o,e[i+12],11,-421815835),o=I(o,n,r,s,e[i+15],16,530742520),s=I(s,o,n,r,e[i+2],23,-995338651),r=v(r,s,o,n,e[i],6,-198630844),n=v(n,r,s,o,e[i+7],10,1126891415),o=v(o,n,r,s,e[i+14],15,-1416354905),s=v(s,o,n,r,e[i+5],21,-57434055),r=v(r,s,o,n,e[i+12],6,1700485571),n=v(n,r,s,o,e[i+3],10,-1894986606),o=v(o,n,r,s,e[i+10],15,-1051523),s=v(s,o,n,r,e[i+1],21,-2054922799),r=v(r,s,o,n,e[i+8],6,1873313359),n=v(n,r,s,o,e[i+15],10,-30611744),o=v(o,n,r,s,e[i+6],15,-1560198380),s=v(s,o,n,r,e[i+13],21,1309151649),r=v(r,s,o,n,e[i+4],6,-145523070),n=v(n,r,s,o,e[i+11],10,-1120210379),o=v(o,n,r,s,e[i+2],15,718787259),s=v(s,o,n,r,e[i+9],21,-343485551),r=A(r,a),s=A(s,d),o=A(o,c),n=A(n,l)}return[r,s,o,n]}(function(e){if(0===e.length)return[];for(var t=8*e.length,r=new Uint32Array(E(t)),s=0;s<t;s+=8)r[s>>5]|=(255&e[s/8])<<s%32;return r}(e),8*e.length))}));var T=function(e,t,r){var s=(e=e||{}).random||(e.rng||n)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t){r=r||0;for(var o=0;o<16;++o)t[r+o]=s[o];return t}return u(s)};function P(e,t,r,s){switch(e){case 0:return t&r^~t&s;case 1:return t^r^s;case 2:return t&r^t&s^r&s;case 3:return t^r^s}}function w(e,t){return e<<t|e>>>32-t}var R=g("v5",80,(function(e){var t=[1518500249,1859775393,2400959708,3395469782],r=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){var s=unescape(encodeURIComponent(e));e=[];for(var o=0;o<s.length;++o)e.push(s.charCodeAt(o))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);for(var n=e.length/4+2,i=Math.ceil(n/16),a=new Array(i),d=0;d<i;++d){for(var c=new Uint32Array(16),l=0;l<16;++l)c[l]=e[64*d+4*l]<<24|e[64*d+4*l+1]<<16|e[64*d+4*l+2]<<8|e[64*d+4*l+3];a[d]=c}a[i-1][14]=8*(e.length-1)/Math.pow(2,32),a[i-1][14]=Math.floor(a[i-1][14]),a[i-1][15]=8*(e.length-1)&4294967295;for(var h=0;h<i;++h){for(var u=new Uint32Array(80),p=0;p<16;++p)u[p]=a[h][p];for(var f=16;f<80;++f)u[f]=w(u[f-3]^u[f-8]^u[f-14]^u[f-16],1);for(var _=r[0],m=r[1],g=r[2],E=r[3],A=r[4],C=0;C<80;++C){var D=Math.floor(C/20),y=w(_,5)+P(D,m,g,E)+A+t[D]+u[C]>>>0;A=E,E=g,g=w(m,30)>>>0,m=_,_=y}r[0]=r[0]+_>>>0,r[1]=r[1]+m>>>0,r[2]=r[2]+g>>>0,r[3]=r[3]+E>>>0,r[4]=r[4]+A>>>0}return[r[0]>>24&255,r[0]>>16&255,r[0]>>8&255,255&r[0],r[1]>>24&255,r[1]>>16&255,r[1]>>8&255,255&r[1],r[2]>>24&255,r[2]>>16&255,r[2]>>8&255,255&r[2],r[3]>>24&255,r[3]>>16&255,r[3]>>8&255,255&r[3],r[4]>>24&255,r[4]>>16&255,r[4]>>8&255,255&r[4]]})),O="00000000-0000-0000-0000-000000000000";var k=function(e){if(!a(e))throw TypeError("Invalid UUID");return parseInt(e.substr(14,1),16)}},4603:function(e,t,r){"use strict";var s;r.r(t),r.d(t,"v1",(function(){return _})),r.d(t,"v3",(function(){return b})),r.d(t,"v4",(function(){return T})),r.d(t,"v5",(function(){return R})),r.d(t,"NIL",(function(){return O})),r.d(t,"version",(function(){return k})),r.d(t,"validate",(function(){return a})),r.d(t,"stringify",(function(){return u})),r.d(t,"parse",(function(){return m}));var o=new Uint8Array(16);function n(){if(!s&&!(s="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return s(o)}var i=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var a=function(e){return"string"==typeof e&&i.test(e)},d=[],c=0;c<256;++c)d.push((c+256).toString(16).substr(1));var l,h,u=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=(d[e[t+0]]+d[e[t+1]]+d[e[t+2]]+d[e[t+3]]+"-"+d[e[t+4]]+d[e[t+5]]+"-"+d[e[t+6]]+d[e[t+7]]+"-"+d[e[t+8]]+d[e[t+9]]+"-"+d[e[t+10]]+d[e[t+11]]+d[e[t+12]]+d[e[t+13]]+d[e[t+14]]+d[e[t+15]]).toLowerCase();if(!a(r))throw TypeError("Stringified UUID is invalid");return r},p=0,f=0;var _=function(e,t,r){var s=t&&r||0,o=t||new Array(16),i=(e=e||{}).node||l,a=void 0!==e.clockseq?e.clockseq:h;if(null==i||null==a){var d=e.random||(e.rng||n)();null==i&&(i=l=[1|d[0],d[1],d[2],d[3],d[4],d[5]]),null==a&&(a=h=16383&(d[6]<<8|d[7]))}var c=void 0!==e.msecs?e.msecs:Date.now(),_=void 0!==e.nsecs?e.nsecs:f+1,m=c-p+(_-f)/1e4;if(m<0&&void 0===e.clockseq&&(a=a+1&16383),(m<0||c>p)&&void 0===e.nsecs&&(_=0),_>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");p=c,f=_,h=a;var g=(1e4*(268435455&(c+=122192928e5))+_)%4294967296;o[s++]=g>>>24&255,o[s++]=g>>>16&255,o[s++]=g>>>8&255,o[s++]=255&g;var E=c/4294967296*1e4&268435455;o[s++]=E>>>8&255,o[s++]=255&E,o[s++]=E>>>24&15|16,o[s++]=E>>>16&255,o[s++]=a>>>8|128,o[s++]=255&a;for(var A=0;A<6;++A)o[s+A]=i[A];return t||u(o)};var m=function(e){if(!a(e))throw TypeError("Invalid UUID");var t,r=new Uint8Array(16);return r[0]=(t=parseInt(e.slice(0,8),16))>>>24,r[1]=t>>>16&255,r[2]=t>>>8&255,r[3]=255&t,r[4]=(t=parseInt(e.slice(9,13),16))>>>8,r[5]=255&t,r[6]=(t=parseInt(e.slice(14,18),16))>>>8,r[7]=255&t,r[8]=(t=parseInt(e.slice(19,23),16))>>>8,r[9]=255&t,r[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,r[11]=t/4294967296&255,r[12]=t>>>24&255,r[13]=t>>>16&255,r[14]=t>>>8&255,r[15]=255&t,r};var g=function(e,t,r){function s(e,s,o,n){if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));for(var t=[],r=0;r<e.length;++r)t.push(e.charCodeAt(r));return t}(e)),"string"==typeof s&&(s=m(s)),16!==s.length)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var i=new Uint8Array(16+e.length);if(i.set(s),i.set(e,s.length),(i=r(i))[6]=15&i[6]|t,i[8]=63&i[8]|128,o){n=n||0;for(var a=0;a<16;++a)o[n+a]=i[a];return o}return u(i)}try{s.name=e}catch(o){}return s.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",s.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",s};function E(e){return 14+(e+64>>>9<<4)+1}function A(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function C(e,t,r,s,o,n){return A((i=A(A(t,e),A(s,n)))<<(a=o)|i>>>32-a,r);var i,a}function D(e,t,r,s,o,n,i){return C(t&r|~t&s,e,t,o,n,i)}function y(e,t,r,s,o,n,i){return C(t&s|r&~s,e,t,o,n,i)}function I(e,t,r,s,o,n,i){return C(t^r^s,e,t,o,n,i)}function v(e,t,r,s,o,n,i){return C(r^(t|~s),e,t,o,n,i)}var b=g("v3",48,(function(e){if("string"==typeof e){var t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(var r=0;r<t.length;++r)e[r]=t.charCodeAt(r)}return function(e){for(var t=[],r=32*e.length,s=0;s<r;s+=8){var o=e[s>>5]>>>s%32&255,n=parseInt("0123456789abcdef".charAt(o>>>4&15)+"0123456789abcdef".charAt(15&o),16);t.push(n)}return t}(function(e,t){e[t>>5]|=128<<t%32,e[E(t)-1]=t;for(var r=1732584193,s=-271733879,o=-1732584194,n=271733878,i=0;i<e.length;i+=16){var a=r,d=s,c=o,l=n;r=D(r,s,o,n,e[i],7,-680876936),n=D(n,r,s,o,e[i+1],12,-389564586),o=D(o,n,r,s,e[i+2],17,606105819),s=D(s,o,n,r,e[i+3],22,-1044525330),r=D(r,s,o,n,e[i+4],7,-176418897),n=D(n,r,s,o,e[i+5],12,1200080426),o=D(o,n,r,s,e[i+6],17,-1473231341),s=D(s,o,n,r,e[i+7],22,-45705983),r=D(r,s,o,n,e[i+8],7,1770035416),n=D(n,r,s,o,e[i+9],12,-1958414417),o=D(o,n,r,s,e[i+10],17,-42063),s=D(s,o,n,r,e[i+11],22,-1990404162),r=D(r,s,o,n,e[i+12],7,1804603682),n=D(n,r,s,o,e[i+13],12,-40341101),o=D(o,n,r,s,e[i+14],17,-1502002290),s=D(s,o,n,r,e[i+15],22,1236535329),r=y(r,s,o,n,e[i+1],5,-165796510),n=y(n,r,s,o,e[i+6],9,-1069501632),o=y(o,n,r,s,e[i+11],14,643717713),s=y(s,o,n,r,e[i],20,-373897302),r=y(r,s,o,n,e[i+5],5,-701558691),n=y(n,r,s,o,e[i+10],9,38016083),o=y(o,n,r,s,e[i+15],14,-660478335),s=y(s,o,n,r,e[i+4],20,-405537848),r=y(r,s,o,n,e[i+9],5,568446438),n=y(n,r,s,o,e[i+14],9,-1019803690),o=y(o,n,r,s,e[i+3],14,-187363961),s=y(s,o,n,r,e[i+8],20,1163531501),r=y(r,s,o,n,e[i+13],5,-1444681467),n=y(n,r,s,o,e[i+2],9,-51403784),o=y(o,n,r,s,e[i+7],14,1735328473),s=y(s,o,n,r,e[i+12],20,-1926607734),r=I(r,s,o,n,e[i+5],4,-378558),n=I(n,r,s,o,e[i+8],11,-2022574463),o=I(o,n,r,s,e[i+11],16,1839030562),s=I(s,o,n,r,e[i+14],23,-35309556),r=I(r,s,o,n,e[i+1],4,-1530992060),n=I(n,r,s,o,e[i+4],11,1272893353),o=I(o,n,r,s,e[i+7],16,-155497632),s=I(s,o,n,r,e[i+10],23,-1094730640),r=I(r,s,o,n,e[i+13],4,681279174),n=I(n,r,s,o,e[i],11,-358537222),o=I(o,n,r,s,e[i+3],16,-722521979),s=I(s,o,n,r,e[i+6],23,76029189),r=I(r,s,o,n,e[i+9],4,-640364487),n=I(n,r,s,o,e[i+12],11,-421815835),o=I(o,n,r,s,e[i+15],16,530742520),s=I(s,o,n,r,e[i+2],23,-995338651),r=v(r,s,o,n,e[i],6,-198630844),n=v(n,r,s,o,e[i+7],10,1126891415),o=v(o,n,r,s,e[i+14],15,-1416354905),s=v(s,o,n,r,e[i+5],21,-57434055),r=v(r,s,o,n,e[i+12],6,1700485571),n=v(n,r,s,o,e[i+3],10,-1894986606),o=v(o,n,r,s,e[i+10],15,-1051523),s=v(s,o,n,r,e[i+1],21,-2054922799),r=v(r,s,o,n,e[i+8],6,1873313359),n=v(n,r,s,o,e[i+15],10,-30611744),o=v(o,n,r,s,e[i+6],15,-1560198380),s=v(s,o,n,r,e[i+13],21,1309151649),r=v(r,s,o,n,e[i+4],6,-145523070),n=v(n,r,s,o,e[i+11],10,-1120210379),o=v(o,n,r,s,e[i+2],15,718787259),s=v(s,o,n,r,e[i+9],21,-343485551),r=A(r,a),s=A(s,d),o=A(o,c),n=A(n,l)}return[r,s,o,n]}(function(e){if(0===e.length)return[];for(var t=8*e.length,r=new Uint32Array(E(t)),s=0;s<t;s+=8)r[s>>5]|=(255&e[s/8])<<s%32;return r}(e),8*e.length))}));var T=function(e,t,r){var s=(e=e||{}).random||(e.rng||n)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t){r=r||0;for(var o=0;o<16;++o)t[r+o]=s[o];return t}return u(s)};function P(e,t,r,s){switch(e){case 0:return t&r^~t&s;case 1:return t^r^s;case 2:return t&r^t&s^r&s;case 3:return t^r^s}}function w(e,t){return e<<t|e>>>32-t}var R=g("v5",80,(function(e){var t=[1518500249,1859775393,2400959708,3395469782],r=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){var s=unescape(encodeURIComponent(e));e=[];for(var o=0;o<s.length;++o)e.push(s.charCodeAt(o))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);for(var n=e.length/4+2,i=Math.ceil(n/16),a=new Array(i),d=0;d<i;++d){for(var c=new Uint32Array(16),l=0;l<16;++l)c[l]=e[64*d+4*l]<<24|e[64*d+4*l+1]<<16|e[64*d+4*l+2]<<8|e[64*d+4*l+3];a[d]=c}a[i-1][14]=8*(e.length-1)/Math.pow(2,32),a[i-1][14]=Math.floor(a[i-1][14]),a[i-1][15]=8*(e.length-1)&4294967295;for(var h=0;h<i;++h){for(var u=new Uint32Array(80),p=0;p<16;++p)u[p]=a[h][p];for(var f=16;f<80;++f)u[f]=w(u[f-3]^u[f-8]^u[f-14]^u[f-16],1);for(var _=r[0],m=r[1],g=r[2],E=r[3],A=r[4],C=0;C<80;++C){var D=Math.floor(C/20),y=w(_,5)+P(D,m,g,E)+A+t[D]+u[C]>>>0;A=E,E=g,g=w(m,30)>>>0,m=_,_=y}r[0]=r[0]+_>>>0,r[1]=r[1]+m>>>0,r[2]=r[2]+g>>>0,r[3]=r[3]+E>>>0,r[4]=r[4]+A>>>0}return[r[0]>>24&255,r[0]>>16&255,r[0]>>8&255,255&r[0],r[1]>>24&255,r[1]>>16&255,r[1]>>8&255,255&r[1],r[2]>>24&255,r[2]>>16&255,r[2]>>8&255,255&r[2],r[3]>>24&255,r[3]>>16&255,r[3]>>8&255,255&r[3],r[4]>>24&255,r[4]>>16&255,r[4]>>8&255,255&r[4]]})),O="00000000-0000-0000-0000-000000000000";var k=function(e){if(!a(e))throw TypeError("Invalid UUID");return parseInt(e.substr(14,1),16)}},857:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),r(3792);var s=r(3794),o=r(3078);r(3795);var n=r(2786),i=r(3578),a=r(2785),d=r(3079),c=r(3796),l=r(3797);function h(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var u=h(o),p=function(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(r){if("default"!==r){var s=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,s.get?s:{enumerable:!0,get:function(){return e[r]}})}})),t.default=e,Object.freeze(t)}(n),f=h(a),_=h(d);class m{constructor(){this._communityId=null,this._artworkComponentId=null,this._assetId=null,this._resourcePath=null,this._mainResource=null,this._mainResourceVersion=null,this._artworkResource=null,this._artworkResourceVersion=null,this._title=null,this._alias=null,this._tags=[],this._description=null,this._categoryId=null,this._subCategoryIds=[],this._creatorIds=[],this._undiscoverable=!1,this._isPrivate=!1,this._custom=null}get communityId(){return this._communityId}set communityId(e){this._communityId=e}get artworkComponentId(){return this._artworkComponentId}set artworkComponentId(e){this._artworkComponentId=e}get assetId(){return this._assetId}set assetId(e){this._assetId=e}get resourcePath(){return this._resourcePath}set resourcePath(e){this._resourcePath=e}get mainResource(){return this._mainResource}set mainResource(e){this._mainResource=e}get mainResourceVersion(){return this._mainResourceVersion}set mainResourceVersion(e){this._mainResourceVersion=e}get artworkResource(){return this._artworkResource}set artworkResource(e){this._artworkResource=e}get artworkResourceVersion(){return this._artworkResourceVersion}set artworkResourceVersion(e){this._artworkResourceVersion=e}get title(){return this._title}set title(e){this._title=e}get alias(){return this._alias}set alias(e){this._alias=e}get tags(){return this._tags}set tags(e){this._tags=this._tags.concat(e)}get description(){return this._description}set description(e){this._description=e}get categoryId(){return this._categoryId}set categoryId(e){this._categoryId=e}get subCategoryIds(){return this._subCategoryIds}set subCategoryIds(e){this._subCategoryIds=this._subCategoryIds.concat(e)}get creatorIds(){return this._creatorIds}set creatorIds(e){this._creatorIds=this._creatorIds.concat(e)}get undiscoverable(){return this._undiscoverable}set undiscoverable(e){this._undiscoverable=e}get isPrivate(){return this._isPrivate}set isPrivate(e){this._isPrivate=e}get custom(){return this._custom}set custom(e){this._custom=e}}var g="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:{};function E(e,t,r){return e(r={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&r.path)}},r.exports),r.exports}var A=E((function(e,t){!function(r){var s=t&&!t.nodeType&&t,o=e&&!e.nodeType&&e,n="object"==typeof g&&g;n.global!==n&&n.window!==n&&n.self!==n||(r=n);var i,a,d=2147483647,c=36,l=/^xn--/,h=/[^\x20-\x7E]/,u=/[\x2E\u3002\uFF0E\uFF61]/g,p={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},f=Math.floor,_=String.fromCharCode;function m(e){throw RangeError(p[e])}function E(e,t){for(var r=e.length,s=[];r--;)s[r]=t(e[r]);return s}function A(e,t){var r=e.split("@"),s="";return r.length>1&&(s=r[0]+"@",e=r[1]),s+E((e=e.replace(u,".")).split("."),t).join(".")}function C(e){for(var t,r,s=[],o=0,n=e.length;o<n;)(t=e.charCodeAt(o++))>=55296&&t<=56319&&o<n?56320==(64512&(r=e.charCodeAt(o++)))?s.push(((1023&t)<<10)+(1023&r)+65536):(s.push(t),o--):s.push(t);return s}function D(e){return E(e,(function(e){var t="";return e>65535&&(t+=_((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+_(e)})).join("")}function y(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function I(e,t,r){var s=0;for(e=r?f(e/700):e>>1,e+=f(e/t);e>455;s+=c)e=f(e/35);return f(s+36*e/(e+38))}function v(e){var t,r,s,o,n,i,a,l,h,u,p,_=[],g=e.length,E=0,A=128,C=72;for((r=e.lastIndexOf("-"))<0&&(r=0),s=0;s<r;++s)e.charCodeAt(s)>=128&&m("not-basic"),_.push(e.charCodeAt(s));for(o=r>0?r+1:0;o<g;){for(n=E,i=1,a=c;o>=g&&m("invalid-input"),((l=(p=e.charCodeAt(o++))-48<10?p-22:p-65<26?p-65:p-97<26?p-97:c)>=c||l>f((d-E)/i))&&m("overflow"),E+=l*i,!(l<(h=a<=C?1:a>=C+26?26:a-C));a+=c)i>f(d/(u=c-h))&&m("overflow"),i*=u;C=I(E-n,t=_.length+1,0==n),f(E/t)>d-A&&m("overflow"),A+=f(E/t),E%=t,_.splice(E++,0,A)}return D(_)}function b(e){var t,r,s,o,n,i,a,l,h,u,p,g,E,A,D,v=[];for(g=(e=C(e)).length,t=128,r=0,n=72,i=0;i<g;++i)(p=e[i])<128&&v.push(_(p));for(s=o=v.length,o&&v.push("-");s<g;){for(a=d,i=0;i<g;++i)(p=e[i])>=t&&p<a&&(a=p);for(a-t>f((d-r)/(E=s+1))&&m("overflow"),r+=(a-t)*E,t=a,i=0;i<g;++i)if((p=e[i])<t&&++r>d&&m("overflow"),p==t){for(l=r,h=c;!(l<(u=h<=n?1:h>=n+26?26:h-n));h+=c)D=l-u,A=c-u,v.push(_(y(u+D%A,0))),l=f(D/A);v.push(_(y(l,0))),n=I(r,E,s==o),r=0,++s}++r,++t}return v.join("")}if(i={version:"1.3.2",ucs2:{decode:C,encode:D},decode:v,encode:b,toASCII:function(e){return A(e,(function(e){return h.test(e)?"xn--"+b(e):e}))},toUnicode:function(e){return A(e,(function(e){return l.test(e)?v(e.slice(4).toLowerCase()):e}))}},s&&o)if(e.exports==s)o.exports=i;else for(a in i)i.hasOwnProperty(a)&&(s[a]=i[a]);else r.punycode=i}(g)})),C=function(e){return"string"==typeof e},D=function(e){return"object"==typeof e&&null!==e},y=function(e){return null===e};function I(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var v=function(e,t,r,s){t=t||"&",r=r||"=";var o={};if("string"!=typeof e||0===e.length)return o;var n=/\+/g;e=e.split(t);var i=1e3;s&&"number"==typeof s.maxKeys&&(i=s.maxKeys);var a=e.length;i>0&&a>i&&(a=i);for(var d=0;d<a;++d){var c,l,h,u,p=e[d].replace(n,"%20"),f=p.indexOf(r);f>=0?(c=p.substr(0,f),l=p.substr(f+1)):(c=p,l=""),h=decodeURIComponent(c),u=decodeURIComponent(l),I(o,h)?Array.isArray(o[h])?o[h].push(u):o[h]=[o[h],u]:o[h]=u}return o},b=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}},T=function(e,t,r,s){return t=t||"&",r=r||"=",null===e&&(e=void 0),"object"==typeof e?Object.keys(e).map((function(s){var o=encodeURIComponent(b(s))+r;return Array.isArray(e[s])?e[s].map((function(e){return o+encodeURIComponent(b(e))})).join(t):o+encodeURIComponent(b(e[s]))})).join(t):s?encodeURIComponent(b(s))+r+encodeURIComponent(b(e)):""},P=E((function(e,t){t.decode=t.parse=v,t.encode=t.stringify=T})),w=H;function R(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var O=/^([a-z0-9.+-]+:)/i,k=/:[0-9]*$/,L=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,S=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),N=["'"].concat(S),M=["%","/","?",";","#"].concat(N),X=["/","?","#"],x=/^[+a-z0-9A-Z_-]{0,63}$/,U=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,j={javascript:!0,"javascript:":!0},B={javascript:!0,"javascript:":!0},V={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0};function H(e,t,r){if(e&&D(e)&&e instanceof R)return e;var s=new R;return s.parse(e,t,r),s}R.prototype.parse=function(e,t,r){if(!C(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var s=e.indexOf("?"),o=-1!==s&&s<e.indexOf("#")?"?":"#",n=e.split(o);n[0]=n[0].replace(/\\/g,"/");var i=e=n.join(o);if(i=i.trim(),!r&&1===e.split("#").length){var a=L.exec(i);if(a)return this.path=i,this.href=i,this.pathname=a[1],a[2]?(this.search=a[2],this.query=t?P.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var d=O.exec(i);if(d){var c=(d=d[0]).toLowerCase();this.protocol=c,i=i.substr(d.length)}if(r||d||i.match(/^\/\/[^@\/]+@[^@\/]+/)){var l="//"===i.substr(0,2);!l||d&&B[d]||(i=i.substr(2),this.slashes=!0)}if(!B[d]&&(l||d&&!V[d])){for(var h,u,p=-1,f=0;f<X.length;f++)-1!==(_=i.indexOf(X[f]))&&(-1===p||_<p)&&(p=_);for(-1!==(u=-1===p?i.lastIndexOf("@"):i.lastIndexOf("@",p))&&(h=i.slice(0,u),i=i.slice(u+1),this.auth=decodeURIComponent(h)),p=-1,f=0;f<M.length;f++){var _;-1!==(_=i.indexOf(M[f]))&&(-1===p||_<p)&&(p=_)}-1===p&&(p=i.length),this.host=i.slice(0,p),i=i.slice(p),this.parseHost(),this.hostname=this.hostname||"";var m="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!m)for(var g=this.hostname.split(/\./),E=(f=0,g.length);f<E;f++){var D=g[f];if(D&&!D.match(x)){for(var y="",I=0,v=D.length;I<v;I++)D.charCodeAt(I)>127?y+="x":y+=D[I];if(!y.match(x)){var b=g.slice(0,f),T=g.slice(f+1),w=D.match(U);w&&(b.push(w[1]),T.unshift(w[2])),T.length&&(i="/"+T.join(".")+i),this.hostname=b.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),m||(this.hostname=A.toASCII(this.hostname));var R=this.port?":"+this.port:"",k=this.hostname||"";this.host=k+R,this.href+=this.host,m&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==i[0]&&(i="/"+i))}if(!j[c])for(f=0,E=N.length;f<E;f++){var S=N[f];if(-1!==i.indexOf(S)){var H=encodeURIComponent(S);H===S&&(H=escape(S)),i=i.split(S).join(H)}}var F=i.indexOf("#");-1!==F&&(this.hash=i.substr(F),i=i.slice(0,F));var Y=i.indexOf("?");if(-1!==Y?(this.search=i.substr(Y),this.query=i.substr(Y+1),t&&(this.query=P.parse(this.query)),i=i.slice(0,Y)):t&&(this.search="",this.query={}),i&&(this.pathname=i),V[c]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){R=this.pathname||"";var W=this.search||"";this.path=R+W}return this.href=this.format(),this},R.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",r=this.pathname||"",s=this.hash||"",o=!1,n="";this.host?o=e+this.host:this.hostname&&(o=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(o+=":"+this.port)),this.query&&D(this.query)&&Object.keys(this.query).length&&(n=P.stringify(this.query));var i=this.search||n&&"?"+n||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||V[t])&&!1!==o?(o="//"+(o||""),r&&"/"!==r.charAt(0)&&(r="/"+r)):o||(o=""),s&&"#"!==s.charAt(0)&&(s="#"+s),i&&"?"!==i.charAt(0)&&(i="?"+i),t+o+(r=r.replace(/[?#]/g,(function(e){return encodeURIComponent(e)})))+(i=i.replace("#","%23"))+s},R.prototype.resolve=function(e){return this.resolveObject(H(e,!1,!0)).format()},R.prototype.resolveObject=function(e){if(C(e)){var t=new R;t.parse(e,!1,!0),e=t}for(var r=new R,s=Object.keys(this),o=0;o<s.length;o++){var n=s[o];r[n]=this[n]}if(r.hash=e.hash,""===e.href)return r.href=r.format(),r;if(e.slashes&&!e.protocol){for(var i=Object.keys(e),a=0;a<i.length;a++){var d=i[a];"protocol"!==d&&(r[d]=e[d])}return V[r.protocol]&&r.hostname&&!r.pathname&&(r.path=r.pathname="/"),r.href=r.format(),r}if(e.protocol&&e.protocol!==r.protocol){if(!V[e.protocol]){for(var c=Object.keys(e),l=0;l<c.length;l++){var h=c[l];r[h]=e[h]}return r.href=r.format(),r}if(r.protocol=e.protocol,e.host||B[e.protocol])r.pathname=e.pathname;else{for(var u=(e.pathname||"").split("/");u.length&&!(e.host=u.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==u[0]&&u.unshift(""),u.length<2&&u.unshift(""),r.pathname=u.join("/")}if(r.search=e.search,r.query=e.query,r.host=e.host||"",r.auth=e.auth,r.hostname=e.hostname||e.host,r.port=e.port,r.pathname||r.search){var p=r.pathname||"",f=r.search||"";r.path=p+f}return r.slashes=r.slashes||e.slashes,r.href=r.format(),r}var _=r.pathname&&"/"===r.pathname.charAt(0),m=e.host||e.pathname&&"/"===e.pathname.charAt(0),g=m||_||r.host&&e.pathname,E=g,A=r.pathname&&r.pathname.split("/")||[],D=(u=e.pathname&&e.pathname.split("/")||[],r.protocol&&!V[r.protocol]);if(D&&(r.hostname="",r.port=null,r.host&&(""===A[0]?A[0]=r.host:A.unshift(r.host)),r.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===u[0]?u[0]=e.host:u.unshift(e.host)),e.host=null),g=g&&(""===u[0]||""===A[0])),m)r.host=e.host||""===e.host?e.host:r.host,r.hostname=e.hostname||""===e.hostname?e.hostname:r.hostname,r.search=e.search,r.query=e.query,A=u;else if(u.length)A||(A=[]),A.pop(),A=A.concat(u),r.search=e.search,r.query=e.query;else if(!function(e){return null==e}(e.search))return D&&(r.hostname=r.host=A.shift(),(P=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@"))&&(r.auth=P.shift(),r.host=r.hostname=P.shift())),r.search=e.search,r.query=e.query,y(r.pathname)&&y(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.href=r.format(),r;if(!A.length)return r.pathname=null,r.search?r.path="/"+r.search:r.path=null,r.href=r.format(),r;for(var I=A.slice(-1)[0],v=(r.host||e.host||A.length>1)&&("."===I||".."===I)||""===I,b=0,T=A.length;T>=0;T--)"."===(I=A[T])?A.splice(T,1):".."===I?(A.splice(T,1),b++):b&&(A.splice(T,1),b--);if(!g&&!E)for(;b--;b)A.unshift("..");!g||""===A[0]||A[0]&&"/"===A[0].charAt(0)||A.unshift(""),v&&"/"!==A.join("/").substr(-1)&&A.push("");var P,w=""===A[0]||A[0]&&"/"===A[0].charAt(0);return D&&(r.hostname=r.host=w?"":A.length?A.shift():"",(P=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@"))&&(r.auth=P.shift(),r.host=r.hostname=P.shift())),(g=g||r.host&&A.length)&&!w&&A.unshift(""),A.length?r.pathname=A.join("/"):(r.pathname=null,r.path=null),y(r.pathname)&&y(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.auth=e.auth||r.auth,r.slashes=r.slashes||e.slashes,r.href=r.format(),r},R.prototype.parseHost=function(){var e=this.host,t=k.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)};const F=o.newDebug("dcx:dcxjs:sb"),Y=()=>!0,W={disableRetry:!0};let q=null,z=null;class G{constructor(e,t){this._maxRedirects=5,this._authenticationAllowList=[],this._assetInfoCache={},this._assetIdResolutionTemplate=null,this.SYNC_ASYNC_DEFAULT_DELAY=5,this.ASYNC_DEFAULT_DELAY=1,this.DEFAULT_POLL_DELAY=10,this._service=e,this._server=t,t&&(this._endPoint=n.endPointOf(t))}get maxRedirects(){return this._maxRedirects}set maxRedirects(e){if("number"!=typeof e)throw new f.default(f.default.INVALID_PARAMS,"Expecting a number.");this._maxRedirects=Math.floor(e)}get authenticationAllowList(){return this._authenticationAllowList}set authenticationAllowList(e){if(!Array.isArray(e))throw new f.default(f.default.INVALID_PARAMS,"Expecting an array.");this._authenticationAllowList=e}get authenticationWhitelist(){return this._authenticationAllowList}isValidHref(e){const t=n.endPointOf(e);return!t||t===this._endPoint}isDomainOnWhitelist(e){return this.isDomainOnAllowList(e)}isDomainOnAllowList(e){F("isDomainOnAllowList");const t=n.parseURI(e).authority;if(!t||0===t.length)return!0;const r=t.length,s=this._authenticationAllowList.length;for(let o=0;o<s;o++){const e=this._authenticationAllowList[o],s=e.length;let n;if(n=r>s?t.slice(-s):t,n===e)return F("iDOAL true"),!0}return F("iDOAL false"),!1}getAsset(e,t,r,s){return this._getAsset(e,t,r,void 0,s)}_getAsset(e,t={},r,s,o){if(F("_getAsset()"),!(e=this._resolveUrl(e)))return void o(new f.default(f.default.WRONG_ENDPOINT,"Wrong endpoint: "+e));let d=s;const c={};"string"==typeof t?c["if-none-match"]=t:n.merge(c,t);let l,h=0;const u=(e,t)=>{if(F("_getAsset() respHandler",e,t),e)return void o(a.networkError("Error downloading an asset",e,t));const r=t.statusCode;if(200===r)o(void 0,t);else if(304===r)o(void 0,t);else if(301===r||302===r||303===r||307===r)if(!this._service.handlesRedirects&&this.maxRedirects)if(h<this.maxRedirects){const r=t.headers.location;r?l(r):o(a.unexpectedResponse("Missing location header in redirect response",e,t))}else o(a.unexpectedResponse("Too many redirects",e,t));else o(a.unexpectedResponse("Unexpected response getting an asset",e,t));else o(a.unexpectedResponse("Unexpected response getting an asset",e,t))};return l=t=>{const s={responseType:r,isStatusValid:Y,retryOptions:W,autoParseJson:!1};return t&&(h++,s.reuseRequestDesc=d,this.isDomainOnAllowList(t)||(c.authorization=null)),this._service.invoke(i.HTTPMethods.GET,t||e,c,void 0,s,u)},d=l(),d.progress=n.noOp,d}getAssetAsType(e,t,r,s){return this._getAssetAsType(e,t,r,void 0,void 0,void 0,s)}_cacheLinksFromResponse(e,t){if("string"==typeof e){const r=this._parseCachableLinks(t);if(Object.keys(r).length>0){const t=this._assetInfoCache[e],s=Object.assign({},t||{},n.pruneUndefined(r));this._cacheInfoForAssetId(e,void 0,s)}}}_getAssetAsType(e,t,r,s,o,n,i){return F("_getAssetAsType"),this._getAsset(e,r,t,s,(e,t)=>{if(e)return i(e);if(200===t.statusCode){const e=t.response||t.responseText;null==n&&this._cacheLinksFromResponse(o,t),i(void 0,e,t.headers.etag,t)}else 304===t.statusCode?i(void 0,null,t.headers.etag,t):i(a.unexpectedResponse("Unexpected response getting asset",e,t))})}_getResourcePathFromHref(e,t){return F("_getResourcePathFromHref"),this._service.invoke(i.HTTPMethods.HEAD,e,{},void 0,{isStatusValid:Y,retryOptions:W,autoParseJson:!1},(e,r)=>{if(F("_gRPFH invoked",e,r),e)return t(e);if(200===r.statusCode){const e=r.headers.link;if(e){const r=n.parse(e).get("rel","http://ns.adobe.com/ccapi/path");if(r&&r[0]&&r[0].uri)return t(void 0,r[0].uri)}}return t(a.unexpectedResponse("Unexpected response trying to retrieve path to asset.",void 0,r))})}resolveRootURLAsync(){F("resolveRootURLAsync()");const e=this._resolveUrl("/");let t;return F("rRUA() rootHref",e),q=this._service.invoke(i.HTTPMethods.GET,e,{},void 0,{responseType:"text",isStatusValid:Y,retryOptions:W,autoParseJson:!1}).then(e=>{if(F("rRUA() resolved",e),200!==e.statusCode)throw t=new f.default(f.default.UNEXPECTED_RESPONSE,"Resolve root URL did not succeed with 200",void 0,e),t;{const r=e.responseText||e.response;try{const e=JSON.parse(r),t=e._links?e._links["http://ns.adobe.com/ccapi/resolve/id"]:void 0;if(t)return{href:t.href,self:this}}catch(n){throw t=new f.default(f.default.INVALID_DATA,"Invalid JSON returned by server",n,e),t}}}).catch(e=>{throw F("rRUA() rejected",e),e}),F("rRUA() rootReqDesc",q),q}getPromiseCacheInfo(e){return F("getPromiseCacheInfo()"),null!=z||(z=e(),z&&z.then&&z.then(()=>{F("gPCI() resolved"),z=null},()=>{F("gPCI() rejected"),z=null})),z}_parseCachableLinks(e){const t={},r=e.headers["content-location"],s=e.headers.link;if(s){const e=n.parse(s);let o=e.get("rel","primary");o&&(t.primaryTemplate=r?w(o[0].uri,r).href:o[0].uri),o=e.get("rel","http://ns.adobe.com/ccapi/manifest2"),o?t.manifestTemplate=r?w(o[0].uri,r).href:o[0].uri:(o=e.get("rel","http://ns.adobe.com/ccapi/manifest"),o&&(t.manifestTemplate=r?w(o[0].uri,r).href:o[0].uri)),o=e.get("rel","http://ns.adobe.com/ccapi/component"),o&&(t.componentTemplate=r?w(o[0].uri,r).href:o[0].uri),o=e.get("rel","version-history"),o&&(t.versionHistory=r?w(o[0].uri,r).href:o[0].uri),o=e.get("rel","rendition"),o&&(t.renditionTemplates=r?w(o[0].uri,r).href:o)}return t}getCachedAssetInfo(e,t){F("getCachedAssetInfo()");const r=this._infoForAssetId(e);if(r)return F("gCAI() cached"),t(void 0,r);const s=this._awaitInfoForAssetId(e,t);if(F("gCAI() needs head req",s),s){let r;const s=s=>{let o=n.expandURITemplate(s,{asset_id:e});if(o=this._resolveUrl(o),!o)return F("gCAI() no href"),t(new f.default(f.default.WRONG_ENDPOINT,"Wrong endpoint: "+o));let d={};return r&&(d={reuseRequestDesc:r},F("gCAI() reuse RD",d)),r=this._service.invoke(i.HTTPMethods.HEAD,o,{},void 0,Object.assign(Object.assign({},d),{isStatusValid:Y,retryOptions:W,autoParseJson:!1}),(t,r)=>{if(F("gCAI() resolveAssetId() resolved",t,r),t)return this._cacheInfoForAssetId(e,t);const s=r.statusCode;if(200===s){const t=this._parseCachableLinks(r);return this._cacheInfoForAssetId(e,void 0,t)}return 404===s?this._cacheInfoForAssetId(e,new f.default(f.default.ASSET_NOT_FOUND,"Asset not found",t,r)):this._cacheInfoForAssetId(e,a.unexpectedResponse("Unable to resolve asset id.",t,r))}),r};return this._assetIdResolutionTemplate?(F("gCAI() has resolution template"),s(this._assetIdResolutionTemplate)):(F("gCAI() get resolution template"),q=this.getPromiseCacheInfo(this.resolveRootURLAsync.bind(this)).then(e=>(F("gCAI() getPromiseCacheInfo() resolved",e),this._assetIdResolutionTemplate=e.href,s(e.self._assetIdResolutionTemplate))).catch(e=>{F("gCAI() getPromiseCacheInfo() rejected",e);const r=new f.default(f.default.UNEXPECTED_RESPONSE,"Unable to retrieve asset id resolution link from root resource.",e,e.response);return t(r)}),F("gCAI() rootReqDesc",q),q)}}registerLinks(e){e=e._links||e;const t={};t.assetId="urn:aaid:faux:"+n.generateUuid();let r=e.primary;return r&&(t.primaryTemplate=r.href),r=e["http://ns.adobe.com/ccapi/manifest"],r&&(t.manifestTemplate=r.href),r=e["http://ns.adobe.com/ccapi/manifest2"],r&&(t.manifestTemplate=r.href),r=e["http://ns.adobe.com/ccapi/component"],r&&(t.componentTemplate=r.href),r=e["version-history"],r&&(t.versionHistory=r.href),r=e.rendition,r&&(t.renditionTemplates=[{rel:"rendition",uri:r.href}]),this._assetInfoCache[t.assetId]=t,t.assetId}_infoForAssetId(e){const t=this._assetInfoCache[e];if(t&&!t.callbacks)return t}_awaitInfoForAssetId(e,t){F("_awaitInfoForAssetId");let r=this._assetInfoCache[e];return r?(F("_aIFA pending"),r.callbacks.push(t),!1):(F("_aIFA not pending"),r={},r.assetId=e,r.callbacks=[t],this._assetInfoCache[e]=r,!0)}_cacheInfoForAssetId(e,t,r){F("_cacheInfoForAssetId");let s=this._assetInfoCache[e];if(s){if(t){const r=s.callbacks;this._assetInfoCache[e]=void 0;for(let e=0;e<r.length;e++)r[e](t)}}else!t&&r&&(this._assetInfoCache[e]=s={});if(!t&&r&&(s.assetId||(s.assetId=e),s.primaryTemplate=r.primaryTemplate,s.manifestTemplate=r.manifestTemplate,s.componentTemplate=r.componentTemplate,s.versionHistory=r.versionHistory,s.renditionTemplates=r.renditionTemplates,s.callbacks)){for(let e=0;e<s.callbacks.length;e++)s.callbacks[e](void 0,s);s.callbacks=void 0}}_resolveUrl(e){return n.endPointOf(e)?e:n.appendPathElements(this._server,e)}_makeRelativeUrl(e){if(n.endPointOf(e)){const t=n.parseURI(e);(t.scheme||t.authority)&&(e=t.path,t.query&&(e+="?"+t.query),t.fragment&&(e+="#"+t.fragment))}return e}_parseAsyncResponse(e){F("_parseAsyncResponse");const t=e.responseText||e.response;if(!t)throw new f.default(f.default.INVALID_DATA,"No body data.");const r={},s=t.indexOf("\n");if(-1===s)throw new f.default(f.default.INVALID_DATA,"Could not find status line.");const o=t.slice(0,13===t.charCodeAt(s-1)?s-1:s).split(" ");if(r.statusCode=parseInt(o[1],10),!r.statusCode)throw new f.default(f.default.INVALID_DATA,"Could not find status code.");o.length>2&&(r.statusText=o[2]);let i=t.search(/\r?\n\r?\n/);-1===i&&(i=t.length);const a=t.slice(s+1,i);r.headers=n.parseHeaders(a);const d="\r"===t.charAt(i)?i+4:i+2;return r.response=t.slice(d),r}_pollForAsyncResponse(e,t,r,s){F("_pollForAsyncResponse");const n=Date.now()+1e3*t,d={responseType:"text",reuseRequestDesc:r,noSoonerThen:n,isStatusValid:Y,retryOptions:W,autoParseJson:!1};o.log("asynchronous request - polling");const c=this._service.invoke(i.HTTPMethods.GET,e,void 0,void 0,d,(t,n)=>{if(t)return s(a.networkError("Error polling for an asynchronous reponse",t,n));let i=n.statusCode;if(202===i){let t;o.log("asynchronous request - not yet ready"),n.headers["retry-after"]&&(t=parseInt(n.headers["retry-after"],10)),this._pollForAsyncResponse(e,t||10,r,s)}else if(200===i){o.log("asynchronous request - success");try{n=this._parseAsyncResponse(n)}catch(e){return s(a.unexpectedResponse("Error parsing response body.",e,n))}i=n.statusCode,200===i||201===i||204===i?s(void 0,n):s(a.unexpectedResponse("Unexpected response polling for an asynchronous response",t,n))}else o.log("asynchronous request - error"),s(a.unexpectedResponse("Unexpected response polling for an asynchronous response",t,n))});r=c}_handle202Response(e,t,r,s){F("_handle202Response");const o=e.responseText||e.response;let n;try{n=JSON.parse(o)}catch(t){return s(a.unexpectedResponse("Error parsing 202 response body.",t,e))}const i=n.href;if(!i)return s(a.unexpectedResponse("202 response missing an href.",void 0,e));let d=e.headers["retry-after"];d=d?parseInt(d,10):r,this._pollForAsyncResponse(this._resolveUrl(i),d,t,s)}}G.StreamProvider=s.StreamProvider;const K=()=>!0,$={disableRetry:!0},J=/^\/?content\/2\/[^\/]+\/[^\/]+/,Z=/^\/?api\/v2\/[^\/]+\/assets\/[^\/]+/,Q={"image/jpeg":"jpg","image/png":"png"};class ee extends G{constructor(e,t){if(super(e,t),this.name="AdobeCommunitySession",!this._endPoint)throw new a.AdobeDCXError(a.AdobeDCXError.INVALID_PARAMS,"Could not determine endpoint from: "+t);this.authenticationAllowList=["adobe.com","adobe.io","fotolia.net"]}publishCompositeAtResource(e,t,r){let s="/api/v2/"+t.communityId+"/assets";s=this._resolveUrl(s);const o={resource_path:this.assetIdFromSSResourceHref(t.resourcePath),resource_type:e,metadata:this.metadataFromPubRecord(t)},n={[i.HeaderKeys.CONTENT_TYPE]:i.JSONMediaType};return this._service.invoke(i.HTTPMethods.POST,s,n,JSON.stringify(o),{responseType:"text",autoParseJson:!1,isStatusValid:K,retryOptions:$},(function(e,s){if(e)return r(a.networkError("Error publishing composite",e,s));if(201===s.statusCode){const o=s.headers.location;if(!o)return e=new a.AdobeDCXError(a.AdobeDCXError.INVALID_DATA,"Missing location header returned on response by server",void 0,s),r(a.unexpectedResponse("Unexpected response publishing composite",e,s));const n=function(e){const t=e.match("^.*?\\/api\\/v2\\/([^/]*)/assets\\/([^\\/]*).*$");return t?t[2]:null}(o);if(n)return t.assetId=n,r(void 0,o)}return r(a.unexpectedResponse("Unexpected response publishing composite",e,s))}))}updateCpMetadataAtResource(e,t,r){let s="/api/v2/"+t.communityId+"/assets/"+t.assetId;s=this._resolveUrl(s);const o=this.metadataFromPubRecord(t),n={[i.HeaderKeys.CONTENT_TYPE]:i.JSONMediaType};return this._service.invoke(i.HTTPMethods.PUT,s,n,JSON.stringify(o),{responseType:"text",autoParseJson:!1,isStatusValid:K,retryOptions:$},(e,t)=>e?r(a.networkError("Error publishing composite",e,t)):200===t.statusCode?r(void 0,s):r(a.unexpectedResponse("Unexpected response publishing composite",e,t)))}getCpMetadata(e,t){let r="/api/v2/"+e.communityId+"/assets/"+e.assetId;r=this._resolveUrl(r),this._service.invoke(i.HTTPMethods.GET,r,{},void 0,{responseType:"text",autoParseJson:!1,isStatusValid:K,retryOptions:$},(function(r,s){if(r)return t(a.networkError("Error getting metadata for CP composite",r,s));if(200===s.statusCode){let r;const o=s.response||s;try{r=JSON.parse(o),e.resourcePath=r.resource_path,e.description=r.description||null,e.title=r.title||null,e.alias=r.alias||null,e.undiscoverable=r.undiscoverable||!1,e.isPrivate=r.private||!1;let t=r.tags;t&&null!==t&&t.length>0&&(e.tags=t);let s=r._embedded;if(s&&null!==s&&(t=r.creators,t&&null!==t&&t.length>0)){const r=[];for(let e=0;e<t.length;++e){const s=t[e];if(s&&null!==s){const e=s.id;e&&null!==e&&r.push(e)}}0!==r.length&&(e.creatorIds=r)}if(s=r.category_id,s&&null!==s&&(e.categoryId=s.id||null),t=r.sub_categories,t&&null!==t&&t.length>0){e.subCategoryIds=[];for(let r=0;r<t.length;++r)s=t[r],e.subCategoryIds.push(s.id)}s=r.custom,s&&null!==s&&(e.custom=s)}catch(e){const o=new a.AdobeDCXError(a.AdobeDCXError.INVALID_DATA,"Invalid JSON returned by server",e,s);return t(o)}return t(void 0,e)}return t(a.unexpectedResponse("Unexpected response while getting metadata for CP composite",r,s))}))}updatePublicationRecordData(e,t){const r=t.versionId;if(e.mainResource="manifest",r&&(e.mainResourceVersion=r),null!==e.artworkComponentId){const r=t.getComponentWithId(e.artworkComponentId);if(null==r)throw new a.AdobeDCXError(a.AdobeDCXError.COMPONENT_DOWNLOAD_ERROR,"Bad component ID = "+e.artworkComponentId);let s=e.resourcePath;s=this.assetIdFromSSResourceHref(s),s+=r.absolutePath,e.artworkResource=s,e.artworkResourceVersion=r.version}}getCompositeManifestHref(e,t,r){if(t)throw new a.AdobeDCXError(a.AdobeDCXError.INVALID_PARAMS,"AdobeCommunitySession does not support version manifests.");if(!e.assetId)throw new a.AdobeDCXError(a.AdobeDCXError.INVALID_PARAMS,"Composite must be bound.");if(!this.isProperAssetId(e.assetId))throw new a.AdobeDCXError(a.AdobeDCXError.INVALID_STATE,"Composite asset id has invalid format.");const s=this._resolveUrl(e.assetId);if(!s)throw new a.AdobeDCXError(a.AdobeDCXError.WRONG_ENDPOINT,"Wrong endpoint: "+e.assetId);return r(void 0,n.appendPathElements(s,"manifest"))}getComponent(e,t,r){const s={};let o=s;return this.getComponentHref(e,e.version,(e,n)=>e?r(e):(o=o||s,this._getAsset(n,void 0,t,o,r))),o||s}getRenditionOfComponent(e,t,r,s,o,n){const i={};let a=i;return this.getComponentRenditionHref(e,e.version,t,r,s,(e,r)=>e?n(e):(a=a||i,this._getAsset(r,{accept:t},o,a,n))),a||i}getCompositeManifest(e,t,r,s){let o=e.assetId;return o&&(o=this._resolveUrl(o)),o?(o=n.appendPathElements(o,"manifest"),this.getAssetAsType(o,"text",r,s)):s(new a.AdobeDCXError(a.AdobeDCXError.WRONG_ENDPOINT,"Wrong endpoint: "+e.assetId))}headRequest(e,t){return this._service.invoke(i.HTTPMethods.HEAD,e,{},void 0,{responseType:"text",autoParseJson:!1,isStatusValid:K,retryOptions:$},(function(e,r){if(e)return t(e);t(e,r)}))}getComponentHref(e,t,r){const s=e._owner;if(!s||!s.compositeAssetId)throw new a.AdobeDCXError(a.AdobeDCXError.INVALID_STATE,"Component must be part of a branch of a bound composite.");if(!this.isProperAssetId(s.compositeAssetId))throw new a.AdobeDCXError(a.AdobeDCXError.INVALID_STATE,"Composite asset id has invalid format.");if(s._core){const t=s._core._getSourceAssetInfoOfComponent(e);if(t)return void r(void 0,this._constructComponentHref(t.compositeAssetId,t.componentPath,t.componentVersion))}r(void 0,this._constructComponentHref(s.compositeAssetId,e.absolutePath,t))}getComponentRenditionHref(e,t,r,s,o,n){const i=e._owner;if(!i||!i.compositeAssetId)throw new a.AdobeDCXError(a.AdobeDCXError.INVALID_STATE,"Component must be part of a branch of a bound composite.");if(!this.isProperAssetId(i.compositeAssetId))throw new a.AdobeDCXError(a.AdobeDCXError.INVALID_STATE,"Composite asset id has invalid format.");if(i._core&&i._core._getSourceAssetInfoOfComponent(e))throw new a.AdobeDCXError(a.AdobeDCXError.INVALID_STATE,"Getting a rendition of a source href not implemented.");return n(void 0,this._constructComponentRenditionHref(i.compositeAssetId,e.absolutePath,t,r,s,o))}isProperAssetId(e){return n.ensureRelativeHrefStartsWithSlash(e)}_constructComponentHref(e,t,r){const s=t.slice(1);let o=n.appendPathElements(this._resolveUrl(e),s);return o&&void 0!==r&&(this._hrefUsesContentApis(e)?o+="/version/"+r:o+="?version="+r),o}_constructComponentRenditionHref(e,t,r,s,o,i){let d,c;const l=t.slice(1),h=n.parseURI(e).path;if("/content/2/"===h.slice(0,"/content/2/".length)){const t=Q[s];if(!t)throw new a.AdobeDCXError(a.AdobeDCXError.INVALID_PARAMS,"Unsupported rendition media type: "+s);if(d=J.exec(h),!(d&&d.length>0))throw new a.AdobeDCXError(a.AdobeDCXError.INVALID_PARAMS,"Failed to parse composite href: "+e);c=this._resolveUrl(n.appendPathElements(d[0],"rendition",l,"version",r,"format",t,"dimension",o,"size",String(i)))}else{if(d=Z.exec(h),!(d&&d.length>0))throw new a.AdobeDCXError(a.AdobeDCXError.INVALID_PARAMS,"Failed to parse composite href: "+e);c=this._resolveUrl(n.appendPathElements(d[0],"rendition",o,String(i),l)+"?version="+r)}return c}_hrefUsesContentApis(e){return"/content/2/"===n.parseURI(e).path.slice(0,"/content/2/".length)}assetIdFromSSResourceHref(e){const t=e.match("^\\/pubs\\/([^\\/]*).*$");return t?t[1]:null}metadataFromPubRecord(e){const t={};if(null!==e.title&&(t.title=e.title),null!==e.description&&(t.description=e.description),null!==e.alias&&(t.alias=e.alias),t.undiscoverable=e.undiscoverable,e.isPrivate&&(t.private=e.isPrivate),null!==e.tags&&e.tags.length>0){const r=[];for(let t=0;t<e.tags.length;t++)r.concat(e.tags[t]);t.tags=r}if(null!==e.creatorIds&&e.creatorIds.length>0){const r=[];for(let t=0;t<e.creatorIds.length;t++)r.concat(e.creatorIds[t]);t.creator_ids=r}if(null!==e.categoryId&&(t.category_id=e.categoryId),null!==e.subCategoryIds&&e.subCategoryIds.length>0){const r=[];for(let t=0;t<e.subCategoryIds.length;t++)r.concat(e.subCategoryIds[t]);t.sub_category_ids=r}if(null!==e.custom&&(t.custom=e.custom),null!==e.mainResource&&null!==e.mainResourceVersion){const r={};r.resource_path=e.mainResource,r.resource_version=e.mainResourceVersion,t.main_resource=r}if(null!==e.artworkResource&&null!==e.artworkResourceVersion){const r={};r.resource_path=e.artworkResource,r.resource_version=e.artworkResourceVersion,t.artwork=r}return t}}class te{constructor(e,t,r){this._aborted=!1,this._session=e,this._callback=t,this._cleanup=r,this._componentsPending=0,this._bytesTransfered=0,this._bytesTotal=0,this._onProgress=n.noOp,this._reportProgress=e=>{if(e>0){this._bytesTransfered+=e;const t=this._onProgress;t&&t(this._bytesTransfered,this._bytesTotal)}}}get xferComplete(){return this._xferComplete}get aborted(){return this._aborted}get bytesTransfered(){return this._bytesTransfered}get bytesTotal(){return this._bytesTotal}set onProgress(e){this._onProgress=e}get onProgress(){return this._onProgress}_callCallback(e,t){const r=this._callback;if(r)return this._callback=void 0,r(e,t)}_xferComplete(e,t){const r=this._cleanup;if(!r)return this._callCallback(e,t);this._cleanup=void 0,r(e,t)}abort(e){return this._aborted||(this._aborted=!0,this._session._service.abortAllWithToken(this)),e||(this._callback=void 0,e=new Error("Aborted")),this._xferComplete(e,null)}}class re{constructor(){}static publishCompositeAlreadyPushedToPubs(e,t,r,s,o,n){if(!t||null==t.resourcePath||null==t.communityId)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"ResourcePath & communityId must be set on publication record for the composite to be published.");const i=new te(o,n),d=null!==t.assetId;let c;return e.current&&o.updatePublicationRecordData(t,e.current),d?(c=o.updateCpMetadataAtResource(e.type,t,(function(e,r){return i.xferComplete(e,e?void 0:t)})),c&&(c.token=i),i):(c=o.publishCompositeAtResource(e.type,t,(function(e,r){return i.xferComplete(e,e?void 0:t)})),c&&(c.token=i),i)}static getCpMetadata(e,t,r){if(!t||null==t.assetId||null==t.communityId)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Asset Id & communityId must be set on publication record to fetch its CP metadata.");return e.getCpMetadata(t,r)}}const se={unmodified:"unmodified",modified:"modified",pendingDelete:"pendingDelete",committedDelete:"committedDelete"},oe={pending:"pending",active:"active",archived:"archived"},ne={name:!0,id:!0,state:!0,path:!0,rel:!0,type:!0,etag:!0,length:!0,version:!0,md5:!0,width:!0,height:!0};class ie{constructor(e,t=!1){this._readOnly=!1,this._data={},this.records={},e&&this._setData(e),this._readOnly=t}get compositeId(){return this._compositeId}get owner(){return this._owner}get data(){return this._data}get id(){return this._data.id}set id(e){if(this._readOnly)throw new a.DCXError(a.DCXError.READ_ONLY,"This object is read-only.");if(this._owner)throw new a.DCXError(a.DCXError.READ_ONLY,"Cannot change the id of a component that is part of a branch or element.");if("string"!=typeof e||""===e)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Expecting a non-empty string.");this._data.id=e,this._setDirty()}get name(){return this._data.name}set name(e){if(this._readOnly)throw new a.DCXError(a.DCXError.READ_ONLY,"This object is read-only.");if("string"!=typeof e&&void 0!==e)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Expecting a string or undefined.");this._data.name=e,this._setDirty()}get type(){return this._data.type}set type(e){if(this._readOnly)throw new a.DCXError(a.DCXError.READ_ONLY,"This object is read-only.");if("string"!=typeof e||""===e)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Expecting a non-empty string.");this._data.type=e,this._setDirty()}get path(){return this._data.path}set path(e){if(this._data.path!==e){if(this._readOnly)throw new a.DCXError(a.DCXError.READ_ONLY,"This object is read-only.");if(!n.isValidPath(e))throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Expecting a valid path.");this._owner?this._owner._core._setPathOfComponent(this,e):(this._data.path=e,this._parentPath=""),this._setDirty()}}get parentPath(){return this._parentPath}set parentPath(e){throw new a.DCXError(a.DCXError.READ_ONLY,"parentPath is read-only.")}get absolutePath(){return this._data.path&&this._owner?n.appendPathElements(this._parentPath,this._data.path):void 0}set absolutePath(e){throw new a.DCXError(a.DCXError.READ_ONLY,"absolutePath is read-only.")}get relationship(){return this._data.rel}set relationship(e){if(this._readOnly)throw new a.DCXError(a.DCXError.READ_ONLY,"This object is read-only.");if("string"!=typeof e&&void 0!==e)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Expecting a string or undefined.");this._data.rel=e,this._setDirty()}get state(){return this._data.state}set state(e){if(this._readOnly)throw new a.DCXError(a.DCXError.READ_ONLY,"This object is read-only.");if("string"!=typeof e)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Expecting a string.");if(!Object.keys(se).includes(e))throw new a.DCXError(a.DCXError.INVALID_PARAMS,'State must be "modified", "unmodified", "pendingDelete", or "committedDelete".');this._data.state=e,this._setDirty()}get etag(){return this._data.etag}set etag(e){if(this._readOnly)throw new a.DCXError(a.DCXError.READ_ONLY,"This object is read-only.");if("string"!=typeof e&&void 0!==e)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Expecting a string or undefined.");this._data.etag=e,this._setDirty()}get md5(){return this._data.md5}set md5(e){if(this._readOnly)throw new a.DCXError(a.DCXError.READ_ONLY,"This object is read-only.");if("string"!=typeof e&&void 0!==e)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Expecting a string or undefined.");this._data.md5=e,this._setDirty()}get version(){return this._data.version}set version(e){if(this._readOnly)throw new a.DCXError(a.DCXError.READ_ONLY,"This object is read-only.");if(void 0!==e&&"string"!=typeof e)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Expecting a string or undefined.");this._data.version=e,this._setDirty()}get length(){return this._data.length}set length(e){if(this._readOnly)throw new a.DCXError(a.DCXError.READ_ONLY,"This object is read-only.");if("number"!=typeof e&&void 0!==e)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Expecting a number or undefined.");this._data.length=e,this._setDirty()}get width(){return this._data.width}set width(e){if(this._readOnly)throw new a.DCXError(a.DCXError.READ_ONLY,"This object is read-only.");if("number"!=typeof e&&void 0!==e)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Expecting a number or undefined.");this._data.width=e,this._setDirty()}get height(){return this._data.height}set height(e){if(this._readOnly)throw new a.DCXError(a.DCXError.READ_ONLY,"This object is read-only.");if("number"!=typeof e&&void 0!==e)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Expecting a number or undefined.");this._data.height=e,this._setDirty()}get assetId(){return this._assetId}set assetId(e){if(e!==this._assetId){if(this._assetId)throw new a.DCXError(a.DCXError.INVALID_STATE,"assetId property cannot be changed.");this._assetId=e}}get repositoryId(){return this._repoId}set repositoryId(e){if(e!==this._repoId){if(this._repoId)throw new a.DCXError(a.DCXError.INVALID_STATE,"repoId property cannot be changed.");this._repoId=e}}getCustomKeys(){const e=[],t=Object.keys(this._data),r=t.length;for(let s=0;s<r;s++){const r=t[s];ne[r]||e.push(r)}return e}getValue(e){if("string"!=typeof e)throw new a.DCXError(a.DCXError.INVALID_PARAMS,'Param "key" must be a string');return this._data[e]}setValue(e,t){if(this._readOnly)throw new a.DCXError(a.DCXError.READ_ONLY,"This object is read-only.");if("string"!=typeof e)throw new a.DCXError(a.DCXError.INVALID_PARAMS,'Param "key" must be a string');this._data[e]=t,this._setDirty()}removeValue(e){if(this._readOnly)throw new a.DCXError(a.DCXError.READ_ONLY,"This object is read-only.");if("string"!=typeof e)throw new a.DCXError(a.DCXError.INVALID_PARAMS,'Param "key" must be a string');delete this._data[e],this._setDirty()}getLink(e){if("string"!=typeof e)throw new a.DCXError(a.DCXError.INVALID_PARAMS,'Param "relationship" must be a string');return this._data._links?this._data._links[e]:void 0}setLink(e,t){if(this._readOnly)throw new a.DCXError(a.DCXError.READ_ONLY,"This object is read-only.");if("object"!=typeof e)throw new a.DCXError(a.DCXError.INVALID_PARAMS,'Param "link" must be an object.');if("string"!=typeof t)throw new a.DCXError(a.DCXError.INVALID_PARAMS,'Param "relationship" must be a string');let r=this._data._links;r||(r=this._data._links={}),r[t]=e,this._setDirty()}removeLink(e){if(this._readOnly)throw new a.DCXError(a.DCXError.READ_ONLY,"This object is read-only.");if("string"!=typeof e)throw new a.DCXError(a.DCXError.INVALID_PARAMS,'Param "relationship" must be a string');const t=this._data._links;t&&(delete t[e],Object.keys(t).length<1&&delete this._data._links,this._setDirty())}isEqualTo(e,t){return n.objectsEqual(this._data,e._data,t)}_setData(e){const t=this._verify(e);if(null===t)return this._data=e,this;throw t}_setDirty(){this._owner&&this._owner._setDirty()}_verify(e){return"string"!=typeof e.id?new a.DCXError(a.DCXError.INVALID_DATA,"Component is missing an id of type string"):null}}ie.STATES=se;class ae{constructor(e,t=!1,r=!1){this._data={},e&&this._setData(e),this._readOnly=t,this._isRoot=r}get owner(){return this._owner}get id(){return this._data.id}set id(e){if(this._readOnly)throw new a.DCXError(a.DCXError.READ_ONLY,"This object is read-only.");if(this._owner)throw new a.DCXError(a.DCXError.READ_ONLY,"Cannot change the id of a node that is part of a branch or element.");if("string"!=typeof e||""===e)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Expecting a non-empty string.");this._data.id=e,this._setDirty()}get name(){return this._data.name}set name(e){if(this._readOnly)throw new a.DCXError(a.DCXError.READ_ONLY,"This object is read-only.");if("string"!=typeof e&&void 0!==e)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Expecting a string or undefined.");this._data.name=e,this._setDirty()}get type(){return this._data.type}set type(e){if(this._readOnly)throw new a.DCXError(a.DCXError.READ_ONLY,"This object is read-only.");if("string"!=typeof e&&void 0!==e)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Expecting a string or undefined.");this._data.type=e,this._setDirty()}get relationship(){return this._data.rel}set relationship(e){if(this._readOnly)throw new a.DCXError(a.DCXError.READ_ONLY,"This object is read-only.");if("string"!=typeof e&&void 0!==e)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Expecting a string or undefined.");this._data.rel=e,this._setDirty()}get path(){return this._isRoot?ae.ROOT_PATH:this._data.path}set path(e){if(e!==this.path){if(this._readOnly)throw new a.DCXError(a.DCXError.READ_ONLY,"This object is read-only.");if(this._isRoot)throw new a.DCXError(a.DCXError.READ_ONLY,"Cannot change the path of the root node.");if(e&&!n.isValidPath(e))throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Expecting a valid path or undefined.");this._owner?this._owner._setPathOfNode(this,e||void 0):(this._data.path=e||void 0,this._parentPath=""),this._setDirty()}}get parentPath(){return this._parentPath}set parentPath(e){throw new a.DCXError(a.DCXError.READ_ONLY,"parentPath is read-only.")}get absolutePath(){const e=this.path;return this._isRoot?e:e&&this._owner?n.appendPathElements(this._parentPath,e):void 0}set absolutePath(e){throw new a.DCXError(a.DCXError.READ_ONLY,"absolutePath is read-only.")}get isRoot(){return this._isRoot}set isRoot(e){throw new a.DCXError(a.DCXError.READ_ONLY,"isRoot is read-only.")}getLink(e){if("string"!=typeof e)throw new a.DCXError(a.DCXError.INVALID_PARAMS,'Param "relationship" must be a string');return this._data._links?this._data._links[e]:void 0}setLink(e,t){if(this._readOnly)throw new a.DCXError(a.DCXError.READ_ONLY,"This object is read-only.");if("object"!=typeof e)throw new a.DCXError(a.DCXError.INVALID_PARAMS,'Param "link" must be an object.');if("string"!=typeof t)throw new a.DCXError(a.DCXError.INVALID_PARAMS,'Param "relationship" must be a string');let r=this._data._links;r||(r=this._data._links={}),r[t]=e,this._setDirty()}removeLink(e){if(this._readOnly)throw new a.DCXError(a.DCXError.READ_ONLY,"This object is read-only.");if("string"!=typeof e)throw new a.DCXError(a.DCXError.INVALID_PARAMS,'Param "relationship" must be a string');const t=this._data._links;t&&(delete t[e],Object.keys(t).length<1&&delete this._data._links,this._setDirty())}getCustomKeys(){const e=[],t=Object.keys(this._data),r=t.length;for(let s=0;s<r;s++){const r=t[s];(this._isRoot?de[r]:ce[r])||e.push(r)}return e}getValue(e){if("string"!=typeof e)throw new a.DCXError(a.DCXError.INVALID_PARAMS,'Param "key" must be a string');if("children"===e||"components"===e)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Illegal key");return this._data[e]}setValue(e,t){if(this._readOnly)throw new a.DCXError(a.DCXError.READ_ONLY,"This object is read-only.");if("string"!=typeof e)throw new a.DCXError(a.DCXError.INVALID_PARAMS,'Param "key" must be a string');if("children"===e||"components"===e)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Illegal key");this._data[e]=t,this._setDirty()}removeValue(e){if(this._readOnly)throw new a.DCXError(a.DCXError.READ_ONLY,"This object is read-only.");if("string"!=typeof e)throw new a.DCXError(a.DCXError.INVALID_PARAMS,'Param "key" must be a string');if("children"===e||"components"===e)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Illegal key");delete this._data[e],this._setDirty()}copy(){let e;const t=this._data.children,r=this._data.components;try{t&&delete this._data.children,r&&delete this._data.components;const s=JSON.parse(JSON.stringify(this._data));e=new ae(s)}finally{t&&(this._data.children=t),r&&(this._data.components=r)}return e}isEqualTo(e,t,r){return this._isEqual(this._data,e._data,n.merge({children:!0,components:!0},t),r)}_isEqual(e,t,r,s){let o,i,a,d,c;if(!n.objectsEqual(e,t,r))return!1;if(i=e.components,a=t.components,d=i?i.length:0,c=a?a.length:0,d!==c)return!1;if(d){let e,t,r;for(o=0;o<d;o++){for(e=i[o],t=null,r=0;r<d;r++)if(e.id===a[r].id){t=a[r];break}if(!t)return!1;if(!n.objectsEqual(e,t,s))return!1}}if(i=e.children,a=t.children,d=i?i.length:0,c=a?a.length:0,d!==c)return!1;if(d)for(o=0;o<d;o++)if(!this._isEqual(i[o],a[o],r,s))return!1;return!0}_setData(e){const t=this._verify(e);if(null===t)return this._data=e,this;throw t}_verify(e){return"string"!=typeof e.id?new a.DCXError(a.DCXError.INVALID_DATA,"Node is missing an id of type string"):null}_setDirty(){this._owner&&this._owner._setDirty()}}ae.ROOT_PATH="/";const de={components:!0,children:!0,"manifest-format-version":!0,id:!0,name:!0,type:!0,state:!0,local:!0},ce={components:!0,children:!0,rel:!0,path:!0,id:!0,name:!0,type:!0};class le{constructor(e,t,r=!1){this._allNodes={},this._allComponents={},this._absolutePaths={},this._readOnly=!1,this._isDirty=!1,this._sourceAssetInfoLookup={},this._readOnly=r,this._owner=t,this._setData(e)}get allNodes(){return this._allNodes}get rootNode(){return this.getChildWithAbsolutePath(ae.ROOT_PATH)}set rootNode(e){throw new a.DCXError(a.DCXError.READ_ONLY,'Property "rootNode" is read-only.')}get isDirty(){return this._isDirty}set isDirty(e){throw new a.DCXError(a.DCXError.READ_ONLY,"Cannot set the property isDirty.")}get changeCount(){return this._data.local&&this._data.local.change||0}set changeCount(e){throw new a.DCXError(a.DCXError.READ_ONLY,"Cannot set the property changeCount.")}getChildWithId(e){return this._allNodes[e]}getChildWithAbsolutePath(e){const t=this._absolutePaths[e.toLowerCase()];return t&&t instanceof ae?t:void 0}getChildrenOf(e){const t=e?this._allNodes[e.id]:this.rootNode;if(!t)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Unknown node");const r=[],s=t._data.children;if(Array.isArray(s))for(let o=0;o<s.length;o++){const e=s[o],t=this._allNodes[e.id];if(!t)throw new a.DCXError(a.DCXError.INVALID_DATA,"Node not in cache");r.push(t)}return r}addChild(e,t,r,s){if(this._readOnly)throw new a.DCXError(a.DCXError.READ_ONLY,"This object is read-only.");if(t=t||n.generateUuid(),this._allNodes[t])throw new a.DCXError(a.DCXError.DUPLICATE_VALUE,"Node already exists in branch.");if(r&&("number"!=typeof r||r%1!=0))throw new a.DCXError(a.DCXError.INVALID_PARAMS,'Param "index" must be an integer.');const o=s?this._allNodes[s.id]:this.rootNode;if(!o)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Unknown parent node.");const i=new ae;i.id=t,e&&(i.name=e),i._parentPath=o.absolutePath||o._parentPath;const d=o._data.children;return d?(r>=0&&r<=d.length||(r=d.length),r===d.length?d[r]=i._data:d.splice(r,0,i._data)):o._data.children=[i._data],this._allNodes[i.id]=i,i._owner=this._owner,this._setDirty(),i}removeChild(e){let t=e;if(this._readOnly)throw new a.DCXError(a.DCXError.READ_ONLY,"This object is read-only.");if(!t)throw new a.DCXError(a.DCXError.INVALID_PARAMS,'Expecting param "node".');if(t.isRoot)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Cannot remove the root node.");const r=t.id;if(!r)throw new a.DCXError(a.DCXError.INVALID_PARAMS,'Param "node" must have an id.');const s=this._nodeDataOfParentOfNode(t);if(!s)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Node not found in this branch.");const o=s.parentNodeData.children;return o&&(o.splice(s.index,1),0===o.length&&delete s.parentNodeData.children),t=this._allNodes[r],this._removeNodeFromCachesRecursively(t._data),this._setDirty(),t}moveChild(e,t,r){let s=e;const o=r;if(this._readOnly)throw new a.DCXError(a.DCXError.READ_ONLY,"This object is read-only.");if(!s)throw new a.DCXError(a.DCXError.INVALID_PARAMS,'Expecting param "node".');if(s.isRoot)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Cannot move the root node.");if(t&&("number"!=typeof t||t%1!=0))throw new a.DCXError(a.DCXError.INVALID_PARAMS,'Param "index" must be an integer.');const n=s.id;if(!n)throw new a.DCXError(a.DCXError.INVALID_PARAMS,'Param "node" must have an id.');const i=this._nodeDataOfParentOfNode(s);if(s=this._allNodes[n],!i)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Node not found in this branch.");const d=o?this._allNodes[o.id]:this.rootNode;if(!d)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Unknown parent node.");if(this._nodeIdIsDescendantOf(d.id,s._data))throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Must not create a cycle.");const c=i.parentNodeData.children.splice(i.index,1)[0];try{const e=d._data.children;e?(t>=0&&t<=e.length||(t=e.length),t===e.length?e[t]=c:e.splice(t,0,c)):d._data.children=[c]}catch(e){throw i.parentNodeData.children.splice(i.index,0,c),e}return 0===i.parentNodeData.children.length&&delete i.parentNodeData.children,this._setDirty(),this._allNodes[n]}copyChild(e,t,r,s,o,n){return this._copyChild(e,t,r,s,o,!1,n)}replaceChild(e,t,r,s){return this._copyChild(e,void 0,void 0,t,r||e.id,!0,s)}allComponents(){const e=[];for(const t in this._allComponents)Object.prototype.hasOwnProperty.call(this._allComponents,t)&&e.push(this._allComponents[t]);return e}getComponentWithId(e){return this._allComponents[e]}getComponentWithAbsolutePath(e){const t=this._absolutePaths[e.toLowerCase()];return t&&t instanceof ie?t:void 0}getComponentsOf(e){const t=e?this._allNodes[e.id]:this.rootNode;if(!t)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Unknown node");const r=[],s=t._data.components;if(Array.isArray(s)){let e;for(e=0;e<s.length;e++){const t=s[e],o=this._allComponents[t.id];if(!o)throw new a.DCXError(a.DCXError.INVALID_DATA,"Component not in cache");r[r.length]=o}}return r}addComponentWithUploadResults(e,t,r,s,o){if(this._readOnly)throw new a.DCXError(a.DCXError.READ_ONLY,"This object is read-only.");if(o.compositeId!==this._owner.compositeId)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Param uploadResults does not appear valid to be for this composite.");const n=Object.keys(o.records);if(1!==n.length)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Param uploadResults must contain records of exactly one component upload.");const i=o.records[n[0]],d=i.id;if(this._allComponents[d])throw new a.DCXError(a.DCXError.DUPLICATE_VALUE,"Duplicate component id: "+d);const c=s?this._allNodes[s.id]:this.rootNode;if(!c)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Unknown parent node.");const l=new ie;l.id=d,l.name=e,l.type=i.type,l.relationship=t,l.path=r,l.state=se.unmodified,l.etag=i.etag,l.length=i.length,l.version=i.version,l.md5=i.md5;const h=this._normalizedAbsolutePathForItem(l,c);if(this._absolutePaths[h])throw new a.DCXError(a.DCXError.DUPLICATE_VALUE,"Duplicate absolute path: "+h);l._parentPath=c.absolutePath||c._parentPath;const u=c._data.components;return u?u.push(l.data):c._data.components=[l.data],l._owner=this._owner,this._allComponents[d]=l,this._absolutePaths[h]=l,this._setDirty(),l}updateComponentWithUploadResults(e,t){if(this._readOnly)throw new a.DCXError(a.DCXError.READ_ONLY,"This object is read-only.");if(!(e=this._allComponents[e.id]))throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Unknown component.");if(t.compositeId!==this._owner.compositeId)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Param uploadResults does not appear valid to be for this composite.");const r=t.records[e.id];if(!r)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Param uploadResults does not contain an upload record for the given component.");return e.etag=r.etag,e.version=r.version,e.md5=r.md5,e.length=r.length,this._setSourceAssetInfoOfComponent(void 0,e),e.state=se.unmodified,this._setDirty(),e}removeComponent(e){if(this._readOnly)throw new a.DCXError(a.DCXError.READ_ONLY,"This object is read-only.");if(!e)throw new a.DCXError(a.DCXError.INVALID_PARAMS,'Expecting param "component".');const t=e.id;if(!t)throw new a.DCXError(a.DCXError.INVALID_PARAMS,'Param "component" must have an id.');const r=this._nodeDataOfParentOfComponent(e);if(!r)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Component not found in this branch.");return r.parentNodeData.components.splice(r.index,1),0===r.parentNodeData.components.length&&delete r.parentNodeData.components,e=this._allComponents[t],delete this._allComponents[t],delete this._absolutePaths[this._normalizedAbsolutePathForItem(e)],e._owner=void 0,e._parentPath="",this._setDirty(),e}moveComponent(e,t){if(this._readOnly)throw new a.DCXError(a.DCXError.READ_ONLY,"This object is read-only.");if(!e)throw new a.DCXError(a.DCXError.INVALID_PARAMS,'Expecting param "component".');const r=e.id;if(!r)throw new a.DCXError(a.DCXError.INVALID_PARAMS,'Param "component" must have an id.');const s=this._nodeDataOfParentOfComponent(e);if(!s)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Component not found in this branch.");const o=t?this._allNodes[t.id]:this.rootNode;if(!o)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Unknown parent node.");const n=this._normalizedAbsolutePathForItem(e,o);if(this._absolutePaths[n])throw new a.DCXError(a.DCXError.DUPLICATE_VALUE,"Duplicate absolute path: "+n);const i=s.parentNodeData.components.splice(s.index,1)[0],d=o._data.components;return d?d.push(i):o._data.components=[i],0===s.parentNodeData.components.length&&delete s.parentNodeData.components,e=this._allComponents[r],delete this._absolutePaths[this._normalizedAbsolutePathForItem(e)],e._parentPath=o.absolutePath||o._parentPath,this._absolutePaths[n]=e,this._setDirty(),e}copyComponent(e,t,r,s,o){return this._copyComponent(e,t,r,s,!1,o)}replaceComponent(e,t,r,s){return this._copyComponent(e,void 0,t,r||e.id,!0,s)}_getHrefOfComponent(e){let t;const r=this._getBranchOf(e).compositeHref;return r&&void 0!==e.version&&(t=n.appendPathElements(r,e.id),t+=";version="+e.version),t}_setSourceAssetInfoOfComponent(e,t){const r=t.id,s=this._sourceAssetInfoLookup;e?s[r]=e:s[r]&&delete s[r]}_getSourceAssetInfoOfComponent(e){const t=e.id,r=this._sourceAssetInfoLookup;if(r)return r[t]}_copySourceHrefsFrom(e){const t=e._sourceAssetInfoLookup,r=this.allComponents(),s=r.length;if(s&&t){const e=this._sourceAssetInfoLookup;for(let o=0;o<s;o++){const s=r[o].id;e[s]=t[s]}}}_getBranchOf(e){return e._owner?this._getBranchOf(e._owner):e}_isSameComposite(e){const t=this._getBranchOf(this),r=this._getBranchOf(e);return t._data.id===r._data.id&&t.compositeAssetId===r.compositeAssetId&&t.compositeRepositoryId===r.compositeRepositoryId}_stringify(e,t=!1){if(e){const e=this._data.local;let r=null;try{delete this._data.local,r=JSON.stringify(this._data,void 0,t?2:void 0)}finally{e&&(this._data.local=e)}return r}return JSON.stringify(this._data,void 0,t?2:void 0)}_setData(e){const t=new ae(e,this._readOnly,!0);t._owner=this._owner,t._parentPath="";const r=t.id,s={},o={},i={};o[r]=t,i[ae.ROOT_PATH]=t;const d=(e,t)=>{let r,c;const l=e.components;if(Array.isArray(l))for(let o=0;o<l.length;o++){const e=l[o],r=new ie(e,this._readOnly);if(s[r.id])throw new a.DCXError(a.DCXError.INVALID_DATA,"Duplicate component id: "+r.id);if(r._owner=this._owner,r._parentPath=t,c=this._normalizedAbsolutePathForItem(r),i[c])throw new a.DCXError(a.DCXError.INVALID_DATA,"Duplicate absolute path: "+c);if(!n.isValidAbsolutePath(c))throw new a.DCXError(a.DCXError.INVALID_DATA,"Invalid absolute component path: "+c);s[r.id]=r,i[c]=r}const h=e.children;if(Array.isArray(h))for(let s=0;s<h.length;s++){const e=h[s],l=new ae(e,this._readOnly);if(o[l.id])throw new a.DCXError(a.DCXError.INVALID_DATA,"Duplicate node id: "+l.id);if(r=l.path,l._owner=this._owner,l._parentPath=t,r){if(c=this._normalizedAbsolutePathForItem(l),i[c])throw new a.DCXError(a.DCXError.INVALID_DATA,"Duplicate absolute path: "+c);if(!n.isValidAbsolutePath(c))throw new a.DCXError(a.DCXError.INVALID_DATA,"Invalid node absolute path: "+c);i[c]=l}o[l.id]=l,d(e,l.path?n.appendPathElements(t,l.path):t)}};return d(e,ae.ROOT_PATH),this._data=e,this._allComponents=s,this._allNodes=o,this._absolutePaths=i,this._isDirty=!1,this}_removeNodeFromCachesRecursively(e){const t=e.components;if(Array.isArray(t))for(let n=0;n<t.length;n++){const e=t[n].id,r=this._allComponents[e];delete this._allComponents[e],delete this._absolutePaths[this._normalizedAbsolutePathForItem(r)],r._owner=void 0}const r=e.children;if(Array.isArray(r))for(let n=0;n<r.length;n++)this._removeNodeFromCachesRecursively(r[n]);const s=e.id,o=this._allNodes[s];delete this._allNodes[s],o.path&&delete this._absolutePaths[this._normalizedAbsolutePathForItem(o)],o._owner=void 0}_local(){return this._data.local||(this._data.local={version:2}),this._data.local}_recursiveReset(e,t){const r=e.components;if(r)for(let o=r.length-1;o>=0;o--){const e=r[o];e.state===se.committedDelete?(delete r[o],delete this._allComponents[e.id],delete e._owner,this._setSourceAssetInfoOfComponent(void 0,e)):(delete e.etag,delete e.version,delete e.length,delete e.md5,e.state=se.modified,t&&t(e))}const s=e.children;if(s)for(let o=0;o<s.length;o++)this._recursiveReset(s[o],t)}_nodeIdIsDescendantOf(e,t){const r=t.children;if(r)for(let s=0;s<r.length;s++){const t=r[s];if(t.id===e||this._nodeIdIsDescendantOf(e,t))return!0}return!1}_recursivelyGetAllComponentsOfChild(e,t=[]){const r=e._data||e,s=r.components;if(s){const e=s.length;for(let r=0;r<e;r++)t[t.length]=this._allComponents[s[r].id]}const o=r.children;if(o){const e=o.length;for(let r=0;r<e;r++)t=this._recursivelyGetAllComponentsOfChild(o[r],t)}return t}_nodeDataOfParentOfNode(e,t=this._data){const r=e._data.id,s=t.children;if(s)for(let o=0;o<s.length;o++){const n=s[o];if(n.id===r)return{parentNodeData:t,index:o};const i=this._nodeDataOfParentOfNode(e,n);if(i)return i}return null}_nodeDataOfParentOfComponent(e,t=this._data){const r=e._data.id,s=t.components;if(s)for(let n=0;n<s.length;n++)if(s[n].id===r)return{parentNodeData:t,index:n};const o=t.children;if(o)for(let n=0;n<o.length;n++){const t=o[n],r=this._nodeDataOfParentOfComponent(e,t);if(r)return r}return null}_determineAbsolutePathChangesRecursively(e,t,r){const s=e.components;if(s)for(let i=0;i<s.length;i++){const e=s[i],o=this._allComponents[e.id];r.push({item:o,parentPath:t,absPath:n.appendPathElements(t,e.path)})}const o=e.children;if(o)for(let i=0;i<o.length;i++){const e=o[i],s=this._allNodes[e.id],a=e.path,d=a?n.appendPathElements(t,a):t;r.push({item:s,parentPath:t,absPath:a?d:void 0}),this._determineAbsolutePathChangesRecursively(e,d,r)}}_setPathOfNode(e,t){const r=t?n.appendPathElements(e._parentPath,t):e._parentPath,s=[{item:e,absPath:t?r:void 0}];let o;this._determineAbsolutePathChangesRecursively(e._data,r,s);const i=n.flatCopy(this._absolutePaths);for(let n=0;n<s.length;n++){const e=s[n].item;e._data.path&&delete i[this._normalizedAbsolutePathForItem(e)]}for(let d=0;d<s.length;d++)if(o=s[d],o.absPath){const e=o.absPath.toLowerCase();if(i[e])throw new a.DCXError(a.DCXError.DUPLICATE_VALUE,"Duplicate absolute path: "+e);if(!n.isValidAbsolutePath(e))throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Invalid absolute path: "+e);i[e]=o.item}for(let n=0;n<s.length;n++)o=s[n],o.parentPath&&(o.item._parentPath=o.parentPath);e._data.path=t,this._absolutePaths=i}_setPathOfComponent(e,t){if(!this._allComponents[e.id])throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Unknown component.");const r=n.appendPathElements(e._parentPath,t).toLowerCase();if(this._absolutePaths[r])throw new a.DCXError(a.DCXError.DUPLICATE_VALUE,"Duplicate absolute path for component: "+r);if(!n.isValidAbsolutePath(r))throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Invalid absolute path: "+r);delete this._absolutePaths[this._normalizedAbsolutePathForItem(e)],this._absolutePaths[r]=e,e._data.path=t}_setDirty(e=!1){if(!e){if(this._local().archivalState===oe.pending||this._local().archivalState===oe.archived)throw new a.DCXError(a.DCXError.INVALID_STATE,"Cannot modify an archived composite.");this._data.state!==se.pendingDelete&&this._data.state!==se.committedDelete||u.default.warn("Modifying deleted composite")}this._isDirty=!0,this._local().change=this.changeCount+1,e||this._data.state!==se.unmodified&&this._data.state||(this._data.state=se.modified)}_normalizedAbsolutePathForItem(e,t){let r;return r=t?n.appendPathElements(t.absolutePath||t._parentPath,e.path):e.absolutePath,r.toLowerCase()}_hasSameEndpoint(e){return!0}_copyComponent(e,t,r,s,o,i){n.validateParams(["component",e,"object"],["callback",i,"function",!0]);const d=e._owner._core;if(!d)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Cannot copy, undefined component owner");const c=this._isSameComposite(d),l=c||this._hasSameEndpoint(e);if(d._local(),!l)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Cannot copy between two different endpoints.");const h=function(e,t,r){he(e,t,c,l,!s)};if(!i)return this._copyComponentModel(e,t,o,r,s,h);try{i(void 0,this._copyComponentModel(e,t,o,r,s,h))}catch(e){i(e)}}_copyComponentModel(e,t,r,s,o,i){if(this._readOnly)throw new a.DCXError(a.DCXError.READ_ONLY,"This object is read-only.");if(!e)throw new a.DCXError(a.DCXError.INVALID_PARAMS,'Expecting param "component".');const d=e._owner,c=new ie(JSON.parse(JSON.stringify(e._data)));s?(c.path=s,c.id=o||n.generateUuid()):o&&(c.id=o),c._owner=this._owner,e.id===c.id&&this._isSameComposite(d._core)||(c.state=se.modified,c.etag=void 0,c.version=void 0,c.md5=void 0,c.length=void 0);const l=this._allComponents[c.id];if(l&&!r)throw new a.DCXError(a.DCXError.DUPLICATE_VALUE,"Component already exists.");if(r&&!l)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Could not find existing component.");let h,u;if(r){const e=this._nodeDataOfParentOfComponent(l);if(!e)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Parent node of existing component not found in this branch.");const t=e.parentNodeData.id;if(u=this._allNodes[t],!u)throw new a.DCXError(a.DCXError.INVALID_STATE,"Unknown parent node.");h=e.index}else if(u=t?this._allNodes[t.id]:this.rootNode,!u)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Unknown parent node.");c._parentPath=u.absolutePath||u._parentPath;const p=this._normalizedAbsolutePathForItem(c),f=this._absolutePaths[p];if(f&&f!==l)throw new a.DCXError(a.DCXError.DUPLICATE_VALUE,"Duplicate absolute path: "+p);if(!n.isValidAbsolutePath(p))throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Component path must be a valid path for a component.");let _=this._local();i&&(_=n.deepCopy(_),i(e,c,_));const m=u._data.components;return r?m[h]=c.data:m?m.push(c.data):u._data.components=[c.data],this._data.local=_,this._allComponents[c.id]=c,this._absolutePaths[p]=c,this._setDirty(),c}_copyChild(e,t,r,s,o,n,i){if(!e)throw new a.DCXError(a.DCXError.INVALID_PARAMS,'Expecting param "node".');const d=e._owner._core,c=this._isSameComposite(d),l=c||this._hasSameEndpoint(e);if(d._local(),d._recursivelyGetAllComponentsOfChild(e).length>0&&!l)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Cannot copy components between two different endpoints.");const h=(e,t,r)=>{he(e,t,c,l,!0)};if(!i)return this._copyChildModel(e,t,r,n,s,o,h);try{i(void 0,this._copyChildModel(e,t,r,n,s,o,h))}catch(e){i(e)}}_copyChildModel(e,t,r,s,o,i,d){if(this._readOnly)throw new a.DCXError(a.DCXError.READ_ONLY,"This object is read-only.");const c=e._owner,l=new ae(JSON.parse(JSON.stringify(e._data)));o?(l.path=o,l.id=i||n.generateUuid()):i&&(l.id=i),l._owner=this._owner,e.isRoot&&(delete l._data.local,delete l._data.state,delete l._data["manifest-format-version"]);const h=this._allNodes[l.id];if(h&&!s)throw new a.DCXError(a.DCXError.DUPLICATE_VALUE,"Child node already exists.");if(s&&!h)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Could not find existing node to replace.");let u;if(s){const e=this._nodeDataOfParentOfNode(h);if(!e)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Parent of existing node not found in this branch.");const t=e.parentNodeData.id;if(u=this._allNodes[t],!u)throw new a.DCXError(a.DCXError.INVALID_STATE,"Unknown parent node.");r=e.index}else if(u=t?this._allNodes[t.id]:this.rootNode,!u)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Unknown parent node.");if(l._parentPath=u.absolutePath||u._parentPath,l.path){const e=this._normalizedAbsolutePathForItem(l),t=this._absolutePaths[e];if(t&&t!==h)throw new a.DCXError(a.DCXError.DUPLICATE_VALUE,"Duplicate absolute path: "+e);if(!n.isValidAbsolutePath(e))throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Node path must be a valid path for a node.")}const p=n.flatCopy(this._allNodes),f=n.flatCopy(this._allComponents),_=n.flatCopy(this._absolutePaths),m=n.deepCopy(this._local()),g=function(e,t,r,s,o,n){let i,a;delete r[e.id],e.path&&delete o[t._normalizedAbsolutePathForItem(e)];const d=e._data.children;if(d)for(a=d.length,i=0;i<a;i++)g(r[d[i].id],t,r,s,o);const c=e._data.components;if(c)for(a=c.length,i=0;i<a;i++){const e=s[c[i].id];delete s[e.id],delete o[t._normalizedAbsolutePathForItem(e)]}};h&&g(h,this,p,f,_);const E=(e,t,r,s,o,i,l)=>{if(r[e.id])throw new a.DCXError(a.DCXError.DUPLICATE_VALUE,"Duplicate node id: "+e.id);let h;if(r[e.id]=e,e.path){if(h=t._core._normalizedAbsolutePathForItem(e),o[h])throw new a.DCXError(a.DCXError.DUPLICATE_VALUE,"Duplicate absolute path: "+h);o[h]=e}const u=e._data.children;if(u){const a=u.length;for(let d=0;d<a;d++){const a=new ae(u[d]);r[a.id]&&(a.id=n.generateUuid()),a._owner=t,a._parentPath=e.absolutePath||e._parentPath,E(a,t,r,s,o,i)}}const p=e._data.components;if(p){const r=p.length;for(let l=0;l<r;l++){const r=new ie(p[l]),u=r.id;if(s[u]&&(r.id=n.generateUuid(),r.state=se.modified,r.etag=void 0,r.version=void 0,r.md5=void 0,r.length=void 0),r._owner=t,r._parentPath=e.absolutePath||e._parentPath,d&&d(c.getComponentWithId(u),r,i),s[r.id])throw new a.DCXError(a.DCXError.DUPLICATE_VALUE,"Duplicate component id: "+r.id);if(s[r.id]=r,h=t._core._normalizedAbsolutePathForItem(r),o[h])throw new a.DCXError(a.DCXError.DUPLICATE_VALUE,"Duplicate absolute path: "+h);o[h]=r}}};if(E(l,this._owner,p,f,_,m,c._local()),s)u._data.children[r]=l._data;else{const e=u._data.children;e?(r>=0&&r<=e.length||(r=e.length),r===e.length?e[r]=l._data:e.splice(r,0,l._data)):u._data.children=[l._data]}return this._allNodes=p,this._allComponents=f,this._absolutePaths=_,this._data.local=m,this._setDirty(),l}_verifyIntegrity(e,t,r){const s=[];let o=!1;const i=e=>(s.push(new a.DCXError(a.DCXError.INVALID_STATE,e)),t&&(o||(t("Branch for composite "+this.rootNode.id+" has the following errors:"),o=!0),t("   "+e)),!1),d=function(e,t){return!!e||i(t)},c=[],l=function(e){(c.indexOf(e)<0||i("Item "+e.id+" encountered more than once"))&&c.push(e)},h=n.flatCopy(this._allComponents),u=n.flatCopy(this._allNodes),p=n.flatCopy(this._absolutePaths),f=Object.keys(p),_=f.length;for(let n=0;n<_;n++){const e=f[n];d("/"===e.charAt(0),"Absolute path "+e+" does not start with a slash.")}const m=(e,t)=>{let r,s;const o=e.children;if(o)for(r=0;r<o.length;r++){const e=o[r],a=u[e.id];(a||i("Node "+e.id+" is not in cache."))&&(l(a),d(a._data===e,"Node "+a.id+" _data property incorrect."),delete u[a.id],a.path&&a._owner&&(s=this._normalizedAbsolutePathForItem(a),(p[s]||i("Absolute path of node "+a.id+" ("+s+") is not in cache."))&&delete p[s]),d(a._parentPath===t,"Parent path of node "+a.id+" should be "+t+" but is "+a._parentPath),d(a._owner===this._owner,"Node "+a.id+" _owner property is not correct.")),m(e,e.path?n.appendPathElements(t,e.path):t)}const a=e.components;if(a)for(r=0;r<a.length;r++){const e=a[r],o=h[e.id];(o||i("Component "+e.id+" is not in cache."))&&(l(o),d(o._data===e,"Component "+o.id+" _data property incorrect."),delete h[o.id],o._owner&&(s=this._normalizedAbsolutePathForItem(o),(p[s]||i("Absolute path "+s+" is not in cache."))&&delete p[s]),d(o._parentPath===t,"Parent path of component "+o.id+" should be "+t+" but is "+o._parentPath),d(o._owner===this._owner,"Component "+o.id+" _owner property is not correct."))}},g=p[ae.ROOT_PATH];d(g,"Cannot find root node via path")&&(d(g.id===this._data.id,"Root node has correct id"),d(g.path===ae.ROOT_PATH,"Root node has correct path"),d(""===g._parentPath,"Root node has correct parent path"),d(g._owner===this._owner,"Root node has correct owner"),d(g._data===this._data,"Root node has correct data"),d(u[g.id]===g,"Cannot find root node via id")&&delete u[g.id],delete p[ae.ROOT_PATH]),m(this._data,ae.ROOT_PATH);let E=Object.keys(h);for(let n=0;n<E.length;n++)i("Component "+E[n]+" is in cache but could not be found.");E=Object.keys(u);for(let n=0;n<E.length;n++)i("Node "+E[n]+" is in cache but could not be found.");E=Object.keys(p);for(let n=0;n<E.length;n++)i("Absolute path "+E[n]+" is in cache but could not be found.");return s.length?s:null}}function he(e,t,r,s,o,i,d){if(!t._owner||!e._owner)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Failed to update storage for copied component, missing target or source branch core.");const c=t._owner._core,l=e._owner._core,h=r&&e.id===t.id;let u=l._getSourceAssetInfoOfComponent(e);const p=c.getComponentWithId(t.id),f=s&&(!p||!p.etag)&&e.state===se.unmodified,_=!h&&!u,m=_;if(o&&!p&&(u||_)&&e.id===t.id&&(t._data.id=n.generateUuid(),t.state=se.modified,t.etag=void 0,t.version=void 0,t.md5=void 0,t.length=void 0),_){if(f&&e._owner.compositeAssetId)u={compositeAssetId:e._owner.compositeAssetId,componentId:e.id,componentVersion:e.version,componentPath:e.absolutePath,repositoryId:e._owner.compositeRepositoryId},c._setSourceAssetInfoOfComponent(u,t);else if(m)throw new a.DCXError(a.DCXError.INVALID_STATE,"Could not use server-to-server copy for component "+e.id)}else c._setSourceAssetInfoOfComponent(u,t);u&&(t.state=se.modified)}class ue{constructor(e,t,r=!1){this._owner=t,e?this._setData(e,r):(e={id:n.generateUuid()},this._core=new le(e,this,r),this._data=e)}get owner(){return this._owner}get rootNode(){return this._core.rootNode}get name(){return this._core.rootNode.name}set name(e){const t=this._core;if(t._readOnly)throw new a.DCXError(a.DCXError.READ_ONLY,"This object is read-only.");if("string"!=typeof e&&void 0!==e)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Expecting a string or undefined.");t.rootNode.name=e}get type(){return this._core.rootNode.type}set type(e){const t=this._core;if(t._readOnly)throw new a.DCXError(a.DCXError.READ_ONLY,"This object is read-only.");if("string"!=typeof e||""===e)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Expecting a non-empty string.");t.rootNode.type=e}get compositeAssetId(){return this._owner?this._owner.compositeAssetId:void 0}set compositeAssetId(e){throw new a.DCXError(a.DCXError.READ_ONLY,'Property "compositeAssetId" is read-only.')}get compositeRepositoryId(){return this._owner?this._owner.compositeRepositoryId:void 0}set compositeRepositoryId(e){throw new a.DCXError(a.DCXError.READ_ONLY,'Property "compositeRepositoryId" is read-only.')}get _isDirty(){return this._core._isDirty}set _isDirty(e){this._core._isDirty=e}get isDirty(){return this._isDirty}get changeCount(){return this._core.changeCount}getChildWithId(e){return this._core.getChildWithId(e)}getChildWithAbsolutePath(e){return this._core.getChildWithAbsolutePath(e)}getChildrenOf(e){return this._core.getChildrenOf(e)}addChild(e,t,r,s){return this._core.addChild(e,t,r,s)}removeChild(e){return this._core.removeChild(e)}moveChild(e,t,r){return this._core.moveChild(e,t,r)}copyChild(e,t,r,s,o,n){return this._core.copyChild(e,t,r,s,o,n)}allComponents(){return this._core.allComponents()}getComponentWithId(e){return this._core.getComponentWithId(e)}getComponentWithAbsolutePath(e){return this._core.getComponentWithAbsolutePath(e)}getComponentsOf(e){return this._core.getComponentsOf(e)}addComponentWithUploadResults(e,t,r,s,o){return this._core.addComponentWithUploadResults(e,t,r,s,o)}updateComponentWithUploadResults(e,t){return this._core.updateComponentWithUploadResults(e,t)}removeComponent(e){return this._core.removeComponent(e)}moveComponent(e,t){return this._core.moveComponent(e,t)}copyComponent(e,t,r,s,o){return this._core.copyComponent(e,t,r,s,o)}parse(e){if("string"!=typeof e)throw new a.DCXError(a.DCXError.INVALID_PARAMS,'Param "data" must be a string');let t;try{t=JSON.parse(e)}catch(e){throw new a.DCXError(a.DCXError.INVALID_JSON,"Manifest could not be parsed. Underlying error: "+e.message)}return this._setData(t,this._core._readOnly)}copy(){return new ue(JSON.parse(JSON.stringify(this._data)),this._owner)}_verify(e){return"string"!=typeof e.id?new a.DCXError(a.DCXError.INVALID_DATA,"Element is missing an id of type string"):"string"!=typeof e.name?new a.DCXError(a.DCXError.INVALID_DATA,"Element is missing a name of type string"):"string"!=typeof e.type?new a.DCXError(a.DCXError.INVALID_DATA,"Element is missing a type of type string"):null}_setData(e,t){const r=this._verify(e);if(null===r)return this._core=new le(e,this,t),this._data=e,this;throw r}_local(){return this._core._local()}_setDirty(e){this._core._setDirty(e)}_setPathOfNode(e,t){this._core._setPathOfNode(e,t)}_verifyIntegrity(e,t,r){return this._core._verifyIntegrity(e,t,r)}}var pe;!function(e){e[e.NONE=0]="NONE",e[e.COPY=1]="COPY"}(pe||(pe={}));const fe=o.newDebug("dcx:dcxjs:dcxbranch");class _e{constructor(e,t,r,s){this._derivationType=pe.NONE,e?this._setData(e,t,r,s):(e={"manifest-format-version":6,id:n.generateUuid()},this.originalManifestFormatVersion=6,this._core=new le(e,this,t),this._core._compositeAssetId=r,this._core._compositeRepositoryId=s,this._data=e),this._pendingElements=[]}get data(){return this._data}set data(e){this._data=e}get compositeId(){return this._core.rootNode.id}set compositeId(e){const t=this._core;if(t._readOnly)throw new a.DCXError(a.DCXError.READ_ONLY,"This object is read-only.");if("string"!=typeof e||""===e)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Expecting a non-empty string.");if(t.allNodes[e])throw new a.DCXError(a.DCXError.DUPLICATE_VALUE,"There is already a node with the same id.");delete t.allNodes[this._data.id],this._data.id=e,t.allNodes[e]=this._core.rootNode,t._setDirty()}get rootNode(){return this._core.rootNode}set rootNode(e){this._core.rootNode=e}get name(){return this._core.rootNode.name}set name(e){const t=this._core;if(t._readOnly)throw new a.DCXError(a.DCXError.READ_ONLY,"This object is read-only.");if("string"!=typeof e&&void 0!==e)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Expecting a string or undefined.");t.rootNode.name=e}get type(){return this._core.rootNode.type}set type(e){const t=this._core;if(t._readOnly)throw new a.DCXError(a.DCXError.READ_ONLY,"This object is read-only.");if("string"!=typeof e||""===e)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Expecting a non-empty string.");t.rootNode.type=e}get compositeAssetId(){return this._core._compositeAssetId}set compositeAssetId(e){const t=this._core;if(t._readOnly)throw new a.DCXError(a.DCXError.READ_ONLY,"This object is read-only.");if("string"!=typeof e&&void 0!==e)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Expecting a string or undefined.");t._compositeAssetId=e}get compositeRepositoryId(){return this._core._compositeRepositoryId}set compositeRepositoryId(e){const t=this._core;if(t._readOnly)throw new a.DCXError(a.DCXError.READ_ONLY,"This object is read-only.");n.validateParams(["repoId",e,"string",!0]),t._compositeRepositoryId=e}get compositeLinks(){return this._core._compositeLinks}set compositeLinks(e){const t=this._core;if(t._readOnly)throw new a.DCXError(a.DCXError.READ_ONLY,"This object is read-only.");n.validateParams(["links",e,"object",!0]),t._compositeLinks=e}get _isRepoComposite(){return!!this._core._compositeRepositoryId}get _collaborationType(){return this._data.local?this._data.local.collaborationType:void 0}set _collaborationType(e){const t=this._core;if(t._readOnly)throw new a.DCXError(a.DCXError.READ_ONLY,"This object is read-only.");e?t._local().collaborationType=e:delete t._local().collaborationType,t._setDirty(!0)}get _clientDataString(){return this._data.local?this._data.local.clientDataString:void 0}set _clientDataString(e){const t=this._core;if(t._readOnly)throw new a.DCXError(a.DCXError.READ_ONLY,"This object is read-only.");e?t._local().clientDataString=e:delete t._local().clientDataString,t._setDirty(!0)}get manifestEtag(){return this._data.local?this._data.local.manifestEtag:void 0}set manifestEtag(e){const t=this._core;if(t._readOnly)throw new a.DCXError(a.DCXError.READ_ONLY,"This object is read-only.");if("string"!=typeof e&&void 0!==e)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Expecting a string or undefined.");t._local().manifestEtag=e,t._setDirty(!0)}get compositeState(){return this._data.state||se.unmodified}set compositeState(e){const t=this._core;if(t._readOnly)throw new a.DCXError(a.DCXError.READ_ONLY,"This object is read-only.");if("string"!=typeof e)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Expecting a string.");if(!Object.values(se).includes(e))throw new a.DCXError(a.DCXError.INVALID_PARAMS,'State must be "modified", "unmodified", "pendingDelete", or "committedDelete".');if(this._isRepoComposite&&(e===se.pendingDelete||e===se.committedDelete))throw new a.DCXError(a.DCXError.INVALID_STATE,"R-API composites must be deleted in one step using RepoAPISession.");if(!(this._isRepoComposite||e!==se.pendingDelete&&e!==se.committedDelete||this.compositeArchivalState!==oe.pending)||this.compositeArchivalState===oe.archived)throw new a.DCXError(a.DCXError.INVALID_STATE,"Cannot delete an archived composite.");this._data.state=e,t._setDirty(!0)}get compositeArchivalState(){return this._core._local().archivalState||oe.active}set compositeArchivalState(e){const t=this._core;if(t._readOnly)throw new a.DCXError(a.DCXError.READ_ONLY,"This object is read-only.");if("string"!=typeof e)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Expecting a string.");if(!Object.values(oe).includes(e))throw new a.DCXError(a.DCXError.INVALID_PARAMS,'State must be "pending", "archived", or "active".');if(this._isRepoComposite&&e===oe.pending)throw new a.DCXError(a.DCXError.INVALID_STATE,"R-API composites must be discarded in one step using RepoAPISession#discardAsset.");if(this.compositeArchivalState===oe.archived)throw new a.DCXError(a.DCXError.INVALID_STATE,"Composite has already been archived.");if(e!==oe.active&&(this.compositeState===se.pendingDelete||this.compositeState===se.committedDelete))throw new a.DCXError(a.DCXError.INVALID_STATE,"Cannot archive a deleted composite.");e===oe.active?delete this._core._local().archivalState:this._core._local().archivalState=e,t._setDirty(!0)}get isBound(){return!(!this.manifestEtag||!this.compositeAssetId)}set isBound(e){throw new a.DCXError(a.DCXError.READ_ONLY,"Cannot set the property isBound. Use resetIdentity instead.")}get versionId(){return this._versionId}set versionId(e){if(this._core._readOnly)throw new a.DCXError(a.DCXError.READ_ONLY,"This object is read-only.");this._versionId=e}get _isDirty(){return this._core._isDirty}set _isDirty(e){this._core._isDirty=e}get isDirty(){return this._core.isDirty}set isDirty(e){this._core.isDirty=e}get localData(){return this._core._stringify(!1,!0)}set localData(e){throw new a.DCXError(a.DCXError.READ_ONLY,"Cannot set the property localData.")}get remoteData(){return this._core._stringify(!0)}set remoteData(e){throw new a.DCXError(a.DCXError.READ_ONLY,"Cannot set the property remoteData.")}get pendingElements(){return this._pendingElements}set pendingElements(e){throw new a.DCXError(a.DCXError.READ_ONLY,"Cannot set the property pendingElements.")}get changeCount(){return this._core.changeCount}set changeCount(e){this._core.changeCount=e}get readOnly(){return this._core._readOnly}set readOnly(e){this._core._readOnly=e}static _newBranchAsCopyOfCore(e){fe("_newBranchAsCopyOfCore()");const t=JSON.parse(JSON.stringify(e._data)),r=new _e(t),s=r._core;return s._sourceCompositeInfo={links:e._compositeLinks,repositoryId:e._compositeRepositoryId,assetId:e._compositeAssetId},r._resetIdentity((function(t){const r=e.getComponentWithId(t.id);if(!r)throw new a.DCXError(a.DCXError.INVALID_STATE,"Could not find original component.");if(r.state===se.modified||!r.etag)throw new a.DCXError(a.DCXError.INVALID_STATE,"Cannot create a new composite from a branch that contains modified or unbound components.");const o=r._owner.compositeAssetId;if(!o)throw new a.DCXError(a.DCXError.INVALID_STATE,"Cannot make a copy of component of a composite that has not been bound with an asset id. Component id ="+r.id);const n=r._owner.compositeRepositoryId;fe("_nBACOC() origAssetId",o),fe("_nBACOC() origRepositoryId",n),fe("_nBACOC() resetComponent",t),s._setSourceAssetInfoOfComponent({compositeAssetId:o,componentId:r.id,componentVersion:r.version,componentPath:r.absolutePath,repositoryId:n},t)})),r}parse(e){if("string"!=typeof e)throw new a.DCXError(a.DCXError.INVALID_PARAMS,'Param "data" must be a string');let t;try{t=JSON.parse(e)}catch(e){throw new a.DCXError(a.DCXError.INVALID_JSON,"Manifest could not be parsed. Underlying error: "+e.message)}return this._setData(t,this._core._readOnly,this._core._compositeAssetId,this._core._compositeRepositoryId)}getElementWithId(e){return this._createElement(this._core.getChildWithId(e))}getElementWithAbsolutePath(e){return this._createElement(this._core.getChildWithAbsolutePath(e))}addElement(e,t,r,s,o,n){if("string"!=typeof e)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Element must have a name of type string");if("string"!=typeof t)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Element must have a type of type string");if("string"!=typeof r)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Element must have a path of type string");const i=this._core.addChild(e,s,o,n);try{i.path=r}catch(e){throw this._core.removeChild(i),e}return i._data.type=t,this._createElement(i)}updateElement(e){const t=this.getChildWithId(e.rootNode.id);if(!t)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Element does not exist in branch.");const r=this._core.replaceChild(e.rootNode,t.path);return this._deleteElement(e),r}abandonElement(e){this._deleteElement(e)}getChildWithId(e){return this._core.getChildWithId(e)}getChildWithAbsolutePath(e){return this._core.getChildWithAbsolutePath(e)}getChildrenOf(e){return this._core.getChildrenOf(e)}addChild(e,t,r,s){return this._core.addChild(e,t,r,s)}removeChild(e){return this._core.removeChild(e)}moveChild(e,t=null,r=null){return this._core.moveChild(e,t,r)}copyChild(e,t,r,s,o,n){return this._core.copyChild(e,t,r,s,o,n)}replaceChild(e,t,r,s){return this._core.replaceChild(e,t,r,s)}allComponents(){return this._core.allComponents()}getComponentWithId(e){return this._core.getComponentWithId(e)}getComponentWithAbsolutePath(e){return this._core.getComponentWithAbsolutePath(e)}getComponentsOf(e){return this._core.getComponentsOf(e)}addComponentWithUploadResults(e,t,r,s,o){return this._core.addComponentWithUploadResults(e,t,r,s,o)}updateComponentWithUploadResults(e,t){return this._core.updateComponentWithUploadResults(e,t)}removeComponent(e){return this._core.removeComponent(e)}moveComponent(e,t){return this._core.moveComponent(e,t)}copyComponent(e,t,r,s,o){return this._core.copyComponent(e,t,r,s,o)}replaceComponent(e,t,r,s){return this._core.replaceComponent(e,t,r,s)}copy(){const e=new _e(JSON.parse(JSON.stringify(this._data)),!1,this._core._compositeAssetId,this._core._compositeRepositoryId);if(e._derivationType=this._derivationType,e._derivationDatetime=this._derivationDatetime,this._core._sourceAssetInfoLookup){const t=JSON.stringify(this._core._sourceAssetInfoLookup);e._core._sourceAssetInfoLookup=JSON.parse(t)}return e}_isNodeLike(e){return n.isObject(e)}_createElement(e){if(!e)return;const t=JSON.parse(JSON.stringify(e._data));t["manifest-format-version"]=this._data["manifest-format-version"],delete t.path;const r=new ue(t,this,this._core._readOnly);return this._pendingElements.push(r),r}_deleteElement(e){const t=this._pendingElements.indexOf(e);if(t<0)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Unknown element.");this._pendingElements.splice(t,1)}_verify(e){return"string"!=typeof e.id?new a.DCXError(a.DCXError.INVALID_DATA,"Manifest is missing an id of type string"):"string"!=typeof e.name?new a.DCXError(a.DCXError.INVALID_DATA,"Manifest is missing a name of type string"):"string"!=typeof e.type?new a.DCXError(a.DCXError.INVALID_DATA,"Manifest is missing a type of type string"):"number"!=typeof e["manifest-format-version"]?new a.DCXError(a.DCXError.INVALID_DATA,"Manifest is missing a manifest-format-version of type number"):null}_setData(e,t,r,s){this.originalManifestFormatVersion=e["manifest-format-version"],function(e){const t=e["manifest-format-version"];if(t<6){if(t<4)throw new a.DCXError(a.DCXError.INVALID_DATA,"Encountered manifest format version "+e["manifest-format-version"]+". Format version conversion not yet implemented for that version.");t<6&&function e(t,r=!1){r&&t.path&&delete t.path;const s=t.components;if("object"==typeof s)for(let n=0;n<s.length;n++){const e=s[n];"number"==typeof e.version&&(e.version=e.version.toString())}const o=t.children;if("object"==typeof o)for(let n=0;n<o.length;n++)e(o[n])}(e,!0)}}(e),e.local&&(e.local.version=2);const o=this._verify(e);if(null===o)return e["manifest-format-version"]=6,this._core=new le(e,this,t),this._core._compositeAssetId=r,this._core._compositeRepositoryId=s,this._data=e,this;throw o}_reset(e,t){if(this.readOnly)throw new a.DCXError(a.DCXError.READ_ONLY,"This object is read-only.");this._data.local&&(delete this._data.local.manifestEtag,delete this._core._compositeAssetId,delete this._core._compositeRepositoryId),e||(this._data.id=n.generateUuid()),this._data.state=se.modified,this._core._recursiveReset(this._data,t),this._core._setDirty()}_resetBinding(e){this._reset(!0,e)}_resetIdentity(e){this._reset(!1,e)}_local(){return this._core._local()}_setDirty(e){this._core._setDirty(e)}_setPathOfNode(e,t){this._core._setPathOfNode(e,t)}_verifyIntegrity(e,t,r){return this._core._verifyIntegrity(e,t,r)}}const me=o.newDebug("dcx:dcxjs:dcxcomposite"),ge={PRIVATE:void 0,SHARED_BY_USER:"sharedByUser",SHARED_WITH_USER:"sharedWithUser"};class Ee{constructor(e,t,r,s,o,n={}){this._collaborationType=ge.PRIVATE,null!=o&&"object"==typeof o&&(n=o,o=void 0),this._repoId=o,this._options=n,s?(this._assetId=s,(e||""===e)&&(this._name=e),t&&(this._type=t),r&&(this._id=r)):t&&(this._current=new _e,(e||""===e)&&(this._current.data.name=e),this._current.data.type=t,r&&(this._current.compositeId=r),o&&(this._current.compositeRepositoryId=o),this._current.data.state=se.modified,this._current._setDirty(!0)),this._options.xhrBaseBranchSupport&&(this._baseBranchData=void 0,this._pushedBranchData=void 0,this._pulledBranchData=void 0)}get href(){return this._href}set href(e){this._href=e}get links(){return this._links}set links(e){n.validateParams(["links",e,"object"]),this._current&&(this._current.compositeLinks=e),this._links=e}get repositoryId(){return this._current?this._current.compositeRepositoryId:this._repoId}set repositoryId(e){n.validateParams(["repoId",e,"string"]),this._current&&(this._current.compositeRepositoryId=e),this._repoId=e}get id(){return this._current?this._current.compositeId:this._id}set id(e){if("string"!=typeof e)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Expecting a string.");this._current&&(this._current.compositeId=e),this._id=e}get name(){return this._current?this._current.name:this._name}set name(e){if("string"!=typeof e)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Expecting a string.");this._current&&(this._current.name=e),this._name=e}get type(){return this._current?this._current.type:this._type}set type(e){if("string"!=typeof e)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Expecting a string.");this._current&&(this._current.type=e),this._type=e}get assetId(){return this._current?this._current.compositeAssetId:this._assetId}set assetId(e){if("string"!=typeof e)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Expecting a string.");this._current&&(this._current.compositeAssetId=e),this._assetId=e}get collaborationType(){return this._current?this._current._collaborationType:this._collaborationType}set collaborationType(e){if(e!==ge.PRIVATE&&e!==ge.SHARED_BY_USER&&e!==ge.SHARED_WITH_USER)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Invalid value: ."+e);this._current&&(this._current._collaborationType=e),this._collaborationType=e}get clientDataString(){return this._current?this._current._clientDataString:this._clientDataString}set clientDataString(e){if("string"!=typeof e&&void 0!==e)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Invalid clientDataString: must be a string or undefined.");const t=this._options.maxClientDataLength||1024;if(e&&e.length>t)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Invalid clientDataString: cannot be greater than 1KB");this._current&&(this._current._clientDataString=e),this._clientDataString=e}get isBound(){return!!(this._current&&this._current.isBound||!this._current&&this._assetId)}set isBound(e){throw new a.DCXError(a.DCXError.READ_ONLY,"Cannot set the property isBound. Use resetIdentity or resetBinding instead.")}get current(){return this._current}set current(e){throw new a.DCXError(a.DCXError.READ_ONLY,'Property "current" is read-only.')}static newCompositeAsCopyOf(e,t,r,s,o){let i=e._core;if(i||e.current&&(i=e.current._core),!i)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"compositeBranchOrElement must be a branch, an element or a composite with a current branch.");const d=new Ee(void 0,void 0,void 0,void 0,void 0,o);return d._current=_e._newBranchAsCopyOfCore(i),d._current._derivationType=pe.COPY,d._current._derivationDatetime=(new Date).toISOString(),d.id=s||n.generateUuid(),t&&(d.name=t),r&&(d.type=r),d}loadBaseBranch(e){if(!this._baseBranchData)throw new a.DCXError(a.DCXError.NO_BASE_BRANCH_DATA,"No base branch data.");let t,r;try{if(r=new _e(void 0,!0,this.assetId).parse(this._baseBranchData),!e)return _.default.resolve(r)}catch(r){if(!e)return _.default.reject(r);t=r}e(t,r)}resolvePullWithBranch(e,t){const r=e;if(!r)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Need a branch.");if(r===this._current)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Cannot resolve current.");if(this._options.xhrBaseBranchSupport&&(this._baseBranchData=this._pulledBranchData,this._pulledBranchData=void 0),(()=>{r.readOnly=!1,r._collaborationType=this.collaborationType,r._clientDataString=this.clientDataString,this._current=r})(),!t)return this._current;t(void 0,this._current)}acceptPush(e){const t=this._pushJournal;let r;if(t)try{t.applyToBranch(this._current,!0),this._options.xhrBaseBranchSupport&&(this._baseBranchData=this._pushedBranchData,this._pushedBranchData=void 0),this._pushJournal=void 0,e&&e()}catch(e){r=e}else e&&e();if(r){if(!e)throw r;e(r)}if(!e)return this._current}resetBinding(e){delete this._assetId,this._current&&this._current._resetBinding(),this._baseBranchData=void 0,this._pushedBranchData=void 0,this._pulledBranchData=void 0,e&&e()}resetIdentity(e){delete this._assetId,this._current?(this._current._resetIdentity(),this._id=this._current.compositeId):this._id=n.generateUuid(),this._baseBranchData=void 0,this._pushedBranchData=void 0,this._pulledBranchData=void 0,e&&e()}_setPath(e){this._path=e}get _isRepoComposite(){return n.isObject(this._current)&&"boolean"==typeof this._current._isRepoComposite?this._current._isRepoComposite:!!this.repositoryId}}Ee.COLLABORATION=ge;class Ae{constructor(e){this._waitingCallbacks=[],this._commitInProgress=!1,this._needAnotherCommit=!1,this._data={"composite-href":e.href,"uploaded-components":{}}}get compositeHref(){return this._data["composite-href"]}set compositeHref(e){throw new a.DCXError(a.DCXError.READ_ONLY,"This property is read-only.")}get derivationType(){return this._data["derivation-type"]}set derivationType(e){this._data["derivation-type"]=e}get manifestEtag(){return this._data.etag}set manifestEtag(e){e?this._data.etag=e:delete this._data.etag}get versionId(){return this._data.versionId}set versionId(e){e?this._data.versionId=e:delete this._data.versionId}get currentBranchEtag(){return this._data["current-branch-etag"]}set currentBranchEtag(e){e?this._data["current-branch-etag"]=e:delete this._data["current-branch-etag"]}get changeCount(){return this._data.change}set changeCount(e){e?this._data.change=e:delete this._data.change}get compositeHasBeenDeleted(){return!!this._data["composite-deleted"]}set compositeHasBeenDeleted(e){e?this._data["composite-deleted"]=!0:delete this._data["composite-deleted"]}get compositeHasBeenArchived(){return!!this._data["composite-archived"]}set compositeHasBeenArchived(e){e?this._data["composite-archived"]=!0:delete this._data["composite-archived"]}get isEmpty(){return 0===Object.keys(this._data["uploaded-components"]).length&&!this.compositeHasBeenDeleted&&!this.compositeHasBeenArchived&&!this.manifestEtag}set isEmpty(e){throw new a.DCXError(a.DCXError.READ_ONLY,"This property is read-only.")}get isComplete(){return!!(this._data.etag&&this._data.change||this._data["composite-deleted"]||this._data["composite-archived"])}set isComplete(e){throw new a.DCXError(a.DCXError.READ_ONLY,"This property is read-only.")}recordUploadedComponent(e,t,r,s,o,n){const i={etag:t,length:o,version:r,md5:s,timestamp:(new Date).toISOString()};n&&(i["source-asset-info"]=n),this._data["uploaded-components"][e]=i}idsOfAllUploadedComponents(){return Object.keys(this._data["uploaded-components"])}getRecordForUploadedComponent(e){const t=this._data["uploaded-components"][e];if(t&&!this.isComplete){let r=t.timestamp;if(!r)return void this.removeRecordForUploadedComponent(e);if(r=new Date(r),isNaN(r.getTime()))return void this.removeRecordForUploadedComponent(e);if(Date.now()-r.getTime()>=6048e5)return void this.removeRecordForUploadedComponent(e)}return t}removeRecordForUploadedComponent(e){delete this._data["uploaded-components"][e]}applyToBranch(e,t){const r=e;if(!this.isComplete)throw new a.DCXError(a.DCXError.INVALID_STATE,"Journal is not complete.");const s=r.isDirty;if(this.compositeHasBeenDeleted)r._data.state=se.committedDelete,r.manifestEtag=this.manifestEtag;else{this.compositeHasBeenArchived&&(r.compositeArchivalState=oe.archived);const e=r.compositeState!==se.unmodified&&this.changeCount!==r.changeCount,t=this.idsOfAllUploadedComponents(),s=t.length;for(let o=0;o<s;o++){const e=t[o],s=r.getComponentWithId(e);if(s){const e=this.getRecordForUploadedComponent(s.id);if(s._data.etag=e.etag,s._data.length=e.length,s._data.version=e.version,s._data.md5=e.md5,e["source-asset-info"]){const t=r._core._getSourceAssetInfoOfComponent(s),o=e["source-asset-info"];t&&o&&t.compositeAssetId===o.compositeAssetId&&t.componentId===o.componentId&&t.componentVersion===o.componentVersion&&(s._data.state=se.unmodified,r._core._setSourceAssetInfoOfComponent(void 0,s))}else s._data.state=se.unmodified}}r.manifestEtag=this.manifestEtag,"string"==typeof this.versionId&&(r.versionId=this.versionId),void 0!==this.derivationType&&(r._derivationType=this.derivationType),e||(r._data.state=se.unmodified)}t&&(r._isDirty=s)}}class Ce{constructor(e){this.session=e,this.isRepoSession=e instanceof c.AdobeRepoAPISession}createComposite(e,t,r,s){if(this.isRepoSession)throw new a.DCXError(a.DCXError.NOT_IMPLEMENTED);return this.session.createComposite(e,t,r,s)}publishComposite(e,t,r,s,o,n){if(this.isRepoSession)throw new a.DCXError(a.DCXError.NOT_IMPLEMENTED);return this.session.publishComposite(e,t,r,s,o,n)}archiveComposite(e,t){if(this.isRepoSession)throw new a.DCXError(a.DCXError.NOT_IMPLEMENTED);return this.session.archiveComposite(e,t)}remixComposite(e,t,r,s,o,n){if(this.isRepoSession)throw new a.DCXError(a.DCXError.NOT_IMPLEMENTED);return this.session.remixComposite(e,t,r,s,o,n)}copyAssetToComponentId(e,t,r,s,o,n,i,d){if(this.isRepoSession)throw new a.DCXError(a.DCXError.NOT_IMPLEMENTED);return this.session.copyAssetToComponentId(e,t,r,s,o,n,i,d)}uploadDataForComponentId(e,t,r,s,o,n,i,d){if(this.isRepoSession)throw new a.DCXError(a.DCXError.NOT_IMPLEMENTED);return this.session.uploadDataForComponentId(e,t,r,s,o,n,i,d)}headRequest(e,t){if(this.isRepoSession)throw new a.DCXError(a.DCXError.NOT_IMPLEMENTED);return this.session.headRequest(e,t)}getComponentHref(e,t,r){if(this.isRepoSession)throw new a.DCXError(a.DCXError.NOT_IMPLEMENTED);return this.session.getComponentHref(e,t,r)}getCompositeManifestHref(e,t,r){if(this.isRepoSession)throw new a.DCXError(a.DCXError.NOT_IMPLEMENTED);return this.session.getCompositeManifestHref(e,t,r)}_getComponentHref(e,t,r,s){if(this.isRepoSession)throw new a.DCXError(a.DCXError.NOT_IMPLEMENTED);return this.session._getComponentHref(e,t,r,s)}_getAssetManifestHref(e,t,r){if(this.isRepoSession)throw new a.DCXError(a.DCXError.NOT_IMPLEMENTED);return this.session._getAssetManifestHref(e,t,r)}getCompositeManifest(e,t,r,s=(()=>{})){const o=new Ee(e.name,e.format,void 0,e.assetId);if(!this.isRepoSession)return this.session.getCompositeManifest(o,t,r,s);o.repositoryId=e.repositoryId;const n=this.session.getCompositeManifest(o,t,r);return n.then(e=>(s(void 0,e.manifestData,e.manifestEtag),e)).catch(e=>{s(e)}),n}updateManifest(e,t,r,s){if(this.isRepoSession)throw new a.DCXError(a.DCXError.NOT_IMPLEMENTED);return this.session.updateManifest(e,t,r,s)}deleteComposite(e,t){if(this.isRepoSession)throw new a.DCXError(a.DCXError.NOT_IMPLEMENTED);return this.session.deleteComposite(e,t)}registerLinks(e,t,r){return this.isRepoSession?this.session.registerLinks(e,t,r):{assetId:this.session.registerLinks(e),repositoryId:void 0}}}const De=o.newDebug("dcx:dcxjs:ss"),ye=()=>!0,Ie={disableRetry:!0};class ve extends G{constructor(e,t){if(super(e,t),this.name="AdobeStorageSession",this.StreamProvider=G.StreamProvider,!this._endPoint)throw new f.default(f.default.INVALID_PARAMS,"Could not determine endpoint from: "+t);this.authenticationAllowList=["adobe.com","adobe.io","fotolia.net"]}publishComposite(e,t,r,s,o,n){De("publishComposite");const i={};if(e){if(t)return s&&(null!==s.originURL&&(i.originURL=s.originURL),null!==s.manageUIURL&&(i.manageUIURL=s.manageUIURL),null!==s.licenseType&&(i.licenseType=s.licenseType),null!==s.licenseUrl&&(i.licenseUrl=s.licenseUrl),null!==s.attributionURL&&(i.attributionURL=s.attributionURL),null!==s.attributionName&&(i.attributionName=s.attributionName)),r&&(null!==r.artworkComponentId&&(i.artworkComponentId=r.artworkComponentId),null!==r.title&&(i.title=r.title),null!==r.alias&&(i.alias=r.alias),null!==r.tags&&(i.tags=r.tags),null!==r.description&&(i.description=r.description),null!==r.categoryId&&(i.categoryId=r.categoryId),null!==r.subCategoryIds&&(i.subCategoryIds=r.subCategoryIds),null!==r.creatorIds&&(i.creatorIds=r.creatorIds),null!==r.undiscoverable&&(i.undiscoverable=r.undiscoverable),null!==r.isPrivate&&(i.private=r.isPrivate),null!==r.custom&&(i.custom=r.custom)),null!==o&&(i.creatorTool=o),this._invokeOperation("publish",{href:e},{href:t},i,(e,t,r)=>{let s;return r&&(s=r.result),n(e,s)});n(new f.default(f.default.INVALID_PARAMS),"CP Target URI cannot be null.")}else n(new f.default(f.default.INVALID_PARAMS),"Source Href cannot be null.")}getCollection(e,t,r){if(De("getCollection",e,t),!(e=this._resolveUrl(e)))return r(new f.default(f.default.WRONG_ENDPOINT,"Wrong endpoint: "+e));let s;e+="?order=asc&orderby=name";const o={};t&&(o[i.HeaderKeys.IF_NONE_MATCH]=t);const n=(t,d)=>t?r(a.networkError("Error retrieving a collection",t,d)):200===d.statusCode?this._parseAndAppendJSONResponse(d,s,"children",(t,a)=>{if(t)return r(t);const c=d.headers["x-children-next-start"];if(c){s=a;const t=e+"&start="+c;return this._service.invoke(i.HTTPMethods.GET,t,o,void 0,{reuseRequestDesc:void 0,responseType:"text",isStatusValid:ye,retryOptions:Ie,autoParseJson:!1},n)}return r(void 0,a,d.headers.etag,d.headers)}):304===d.statusCode?r(void 0,null,d.headers.etag,d.headers):r(a.unexpectedResponse("Unexpected status code while getting a collection",void 0,d));return this._service.invoke(i.HTTPMethods.GET,e,o,void 0,{responseType:"text",isStatusValid:ye,retryOptions:Ie,autoParseJson:!1},n)}pagedGetCollection(e,t,r,s,o,n,d,c){if(De("pagedGetCollection"),!(e=this._resolveUrl(e)))return c(new f.default(f.default.WRONG_ENDPOINT,"Wrong endpoint: "+e));e+=((e,t,r,s)=>{const o=[];let n="";return t&&o.push("order="+t),e&&o.push("orderBy="+e),r&&o.push("start="+r),s&&o.push("limit="+s),o.length>0&&(n="?"+o.join("&")),n})(r,s,o,n);const l={};return t&&(l[i.HeaderKeys.IF_NONE_MATCH]=t),this._service.invoke(i.HTTPMethods.GET,e,l,void 0,{responseType:"text",isStatusValid:ye,retryOptions:Ie,autoParseJson:!1},(e,t)=>e?c(a.networkError("Error retrieving a collection",e,t)):200===t.statusCode?this._parseAndAppendJSONResponse(t,d,"children",(e,r)=>c(e,r,t.headers.etag,t.headers)):304===t.statusCode?c(void 0,null,t.headers.etag,t.headers):c(a.unexpectedResponse("Unexpected status code while getting a collection",void 0,t)))}getComponent(e,t,r){De("getComponent");const s={};let o;return o=this.getComponentHref(e,e.version,(e,n)=>{if(e)return r(e);const i=this._resolveUrl(n);return i?(o=o||s,this._getAsset(i,void 0,t,o,r)):r(new f.default(f.default.WRONG_ENDPOINT,"Wrong endpoint: "+n))}),o||s}getRenditionOfComponent(e,t,r,s,o){De("getRenditionOfComponent()");const n={};let i;return i=this.getComponentRenditionHref(e,e.version,r,(e,r)=>{if(De("gROC() got href ",e,r),e)return o(e);const a=this._resolveUrl(r);return a?(i=i||n,De("gROC() getting asset ",i),this._getAsset(a,{accept:t},s,i,o)):o(new f.default(f.default.WRONG_ENDPOINT,"Wrong endpoint: "+r))}),i||n}pagedGetCompositeVersions(e,t,r,s,o,n,d=(()=>{})){De("pagedGetCompositeVersions");const c={},l=this._getPagedCompositeVersionsHref(e,t,r,s,o,(e,t)=>{if(e)return d(e);const r=this._resolveUrl(t);if(!r)return d(new f.default(f.default.WRONG_ENDPOINT,"Wrong endpoint: "+t));const s={responseType:"text",reuseRequestDesc:l||c,isStatusValid:ye,retryOptions:Ie,autoParseJson:!1};return this._service.invoke(i.HTTPMethods.GET,r,{},void 0,s,(e,t)=>e?d(a.networkError("Error retrieving version history",e,t)):200===t.statusCode?this._parseAndAppendJSONResponse(t,n,"children",d):d(a.unexpectedResponse("Unexpected status code while getting a version history",void 0,t)))});return l||c}getCompositeManifest(e,t,r,s){De("getCompositeManifest()");const o={};let n;return n=this.getCompositeManifestHref(e,t,(i,a)=>{if(De("gCM() result",i,a),i)return s(i);const d=this._resolveUrl(a);return d?(n=n||o,this._getAssetAsType(d,"text",r,n,e.assetId,t,s)):s(new f.default(f.default.WRONG_ENDPOINT,"Wrong endpoint: "+a))}),n||o}headRequest(e,t){return De("headRequest"),this._service.invoke(i.HTTPMethods.HEAD,e,{},void 0,{isStatusValid:ye,retryOptions:Ie,autoParseJson:!1},(e,r)=>e?t(e):t(void 0,r))}remixComposite(e,t,r,s,o,n){De("remixComposite");const i={compositeId:s};o&&(i.creatorTool=o);const a={href:e};return t&&(a.authorization=t),this._invokeOperation("remix",a,{href:r},i,(e,t,r)=>{let s;return r&&(s=r.result),n(e,s)})}createComposite(e,t,r,s){De("createComposite");const o="+dcx";let d=n.ensureRelativeHrefStartsWithSlash(t);d=n.removeLeadingSlashForPath(d);const c=this._resolveUrl(d);if(!c)return s(new f.default(f.default.WRONG_ENDPOINT,"Wrong endpoint: "+c));if(r.substr(r.length-o.length)!==o)return s(new f.default(f.default.INVALID_PARAMS,'composite type must end in "+dcx"'));const l=((e,t)=>{const s={[i.HeaderKeys.CONTENT_TYPE]:r};return this._service.invoke(i.HTTPMethods.PUT,e,s,void 0,{isStatusValid:ye,retryOptions:Ie,autoParseJson:!1},(e,r)=>e?t(a.networkError("Error creating composite",e,r)):t(void 0,r))})(c,(e,t)=>{if(e)return s(e);const r=t.statusCode;let o=t.headers["x-resource-urn"];if(201===r&&o)return s(void 0,t,o);if(409!==r)return s(a.unexpectedResponse("Unexpected response creating composite",e,t));{const e={reuseRequestDesc:l,isStatusValid:ye,retryOptions:Ie,autoParseJson:!1};this._service.invoke(i.HTTPMethods.HEAD,c,void 0,void 0,e,(e,r)=>{if(e)return s(a.networkError("Error creating composite",e,r));const n=r.headers[i.HeaderKeys.CONTENT_TYPE];return n?"+dcx"!==n.substr(n.length-4,4)?s(new f.default(f.default.FILE_EXISTS_IN_CLOUD,"Cannot overwrite file at "+c)):(o=r.headers["x-resource-urn"],200===r.statusCode&&o?s(new f.default(f.default.ALREADY_EXISTS,"Composite already exists at "+c),t,o):s(a.unexpectedResponse("Unexpected response creating composite",e,r))):s(a.unexpectedResponse("Missing Content-Type header.",e,r))})}});return l}deleteComposite(e,t){if(De("deleteComposite"),!e.assetId)throw De("dC no id"),new f.default(f.default.INVALID_PARAMS,"Component must be part of a branch of a bound composite.");const r={};let s;return s=this.getCachedAssetInfo(e.assetId,(e,o)=>{if(De("dC cached",e,o),e)return e.code===f.default.ASSET_NOT_FOUND&&(e=new f.default(f.default.COMPOSITE_NOT_FOUND,"CompositeNotFound",e)),t(e);if(!o)return t(new f.default(f.default.COMPOSITE_NOT_FOUND,"Source asset info not found."));if(!o.primaryTemplate)return De("dC no pT"),t(new f.default(f.default.UNEXPECTED_RESPONSE,"Primary resource URI is missing."));const d=n.expandURITemplate(o.primaryTemplate);let c=this._resolveUrl(d);if(!c)return De("dC no href"),t(new f.default(f.default.WRONG_ENDPOINT,"Wrong endpoint: "+d));const l={[i.HeaderKeys.IF_MATCH]:"*"};c+="?recursive=true&invocation_mode=sync,async",s=s||r;const h={reuseRequestDesc:s,isStatusValid:ye,retryOptions:Ie,autoParseJson:!1};De("invoking delete"),this._service.invoke(i.HTTPMethods.DELETE,c,l,void 0,h,(e,r)=>{if(e)return De("dC invoke err",e),t(a.networkError("Error deleting composite directory",e,r));const o=r.statusCode;return 200===o||204===o||404===o?t(void 0,r):202===o?this._handle202Response(r,s,this.SYNC_ASYNC_DEFAULT_DELAY,t):t(a.unexpectedResponse("Unexpected response deleting composite directory",e,r))})}),s||r}archiveComposite(e,t){if(De("archiveComposite"),!e.assetId)throw De("aC no id"),new f.default(f.default.INVALID_PARAMS,"Component must be part of a branch of a bound composite.");const r={};let s;return s=this.getCachedAssetInfo(e.assetId,(e,o)=>{if(e)return De("aC err",e),e.code===f.default.ASSET_NOT_FOUND&&(e=new f.default(f.default.COMPOSITE_NOT_FOUND,"CompositeNotFound",e)),t(e);if(!o.primaryTemplate)return De("aC no pT"),t(new f.default(f.default.UNEXPECTED_RESPONSE,"Primary resource URI is missing."));let d=n.expandURITemplate(o.primaryTemplate);if(d=this._resolveUrl(d),!d)return De("aC no pH"),t(new f.default(f.default.WRONG_ENDPOINT,"Wrong endpoint: "+d));s=s||r;const c={reuseRequestDesc:s,isStatusValid:ye,retryOptions:Ie,autoParseJson:!1};this._service.invoke(i.HTTPMethods.HEAD,d,void 0,void 0,c,(r,o)=>{if(r)return De("aC invoke err",r),t(e);let n;if(o.headers&&(n=o.headers["content-location"]),!n)return De("aC no cL"),t(new f.default(f.default.UNEXPECTED_RESPONSE,"Missing content location."));n=this._makeRelativeUrl(n);const d={[i.HeaderKeys.CONTENT_TYPE]:i.DirectoryMediaType,Link:"<"+n+">;rel=self"},l=n.split("/");if(!l||0===l.length)return De("aC bad cL format"),t(new f.default(f.default.UNEXPECTED_RESPONSE,"Invalid content location format."));const h=l[l.length-1],u=this._resolveUrl("/archive/"+h)+"?invocation_mode=sync,async";s=this._service.invoke(i.HTTPMethods.PUT,u,d,void 0,c,(e,r)=>{if(e)return De("aC put invoke err",e),t(a.networkError("Error archiving composite directory",e,r));const o=r.statusCode;return De("aC put status",o),200===o||204===o||404===o?t(void 0,r):202===o?this._handle202Response(r,s,this.SYNC_ASYNC_DEFAULT_DELAY,t):t(a.unexpectedResponse("Unexpected response archiving composite directory",e,r))})})}),s||r}leaveSharedComposite(e,t){if(De("leaveSharedComposite"),e.collaborationType!==ge.SHARED_WITH_USER)throw new f.default(f.default.INVALID_STATE,"Composite's collaboration type must be sharedWithUser.");return this.deleteComposite(e,t)}uploadDataForComponentId(e,t,r,s,o,n,d,c){De("uploadDataForComponentId");const l={};if(r&&!this.isProperAssetId(r))return void c(new f.default(f.default.INVALID_STATE,"Composite asset id has invalid format."));let h;return h=this._getComponentHref(r,e,void 0,(e,r)=>{if(e)return c(e);let u=r;o&&(u+="&intermediates=false"),u=this._resolveUrl(u);const p={[i.HeaderKeys.CONTENT_TYPE]:t},_=(e,t,r)=>{p[i.HeaderKeys.IF_MATCH]=e?void 0:"*",h=h||l;const s={reuseRequestDesc:h,isStatusValid:ye,autoParseJson:!1,retryOptions:Ie};h=this._service.invoke(i.HTTPMethods.PUT,u,p,d,s,(e,s)=>{if(e)return r(a.networkError("Error uploading component",e,s),t);const o=s.statusCode;if(200===o||201===o||204===o){let n;try{n=JSON.parse(s.response)}catch(o){return e=new f.default(f.default.INVALID_DATA,"Invalid JSON returned by server",o),r(e,t,s,n)}return r(void 0,t,s,n)}return 507===o?(e=new f.default(f.default.EXCEEDS_QUOTA,"Exceeds quota",e,s),r(e,t)):(e=a.unexpectedResponse("Unexpected response uploading component",e,s),r(e,t))}),h.token=n},m=(e,t,r,o)=>{if(e){if(!(r=e.response))return c(e);let o=r.statusCode;if(!t)if(s||404!==o){if(409===o||412===o)return this._service.invoke(i.HTTPMethods.HEAD,u,{},void 0,{isStatusValid:ye,retryOptions:Ie,autoParseJson:!1},(e,r)=>{if(e)return c(a.networkError("Error uploading component",e,r),void 0,t);o=r.statusCode,_(200!==o,!0,m)})}else _(!0,!0,m);return c(e)}return c(void 0,r,o)};_(s,!1,m)}),h||l}copyAssetToComponentId(e,t,r,s,o,n,d,c){De("copyAssetToComponentId");const l=this._makeRelativeUrl(d);if(!l)return void c(new f.default(f.default.WRONG_ENDPOINT,"Cannot copy asset: "+d));const h={};if(r&&!this.isProperAssetId(r))return void c(new f.default(f.default.INVALID_STATE,"Composite asset id has invalid format."));let u;return u=this._getComponentHref(r,e,void 0,(e,r)=>{if(e)return c(e);let d=r+"&invocation_mode=sync,async";o&&(d+="&intermediates=false"),d=this._resolveUrl(d),u=u||h;const p={reuseRequestDesc:u,responseType:"text",isStatusValid:ye,retryOptions:Ie,autoParseJson:!1},_={};t&&(_[i.HeaderKeys.CONTENT_TYPE]=t),_.Link="<"+l+">;rel=source";const m=(e,t,r)=>(e?delete _[i.HeaderKeys.IF_MATCH]:_[i.HeaderKeys.IF_MATCH]="*",u=this._service.invoke(i.HTTPMethods.PUT,d,_,void 0,p,(e,s)=>{if(e)return r(a.networkError("Error uploading component",e,s));const o=s.statusCode;return 200===o||201===o||204===o?r(void 0,s,t):202!==o?r(a.unexpectedResponse("Unexpected response copying a component asset",e,s),s,t):void this._handle202Response(s,u,this.SYNC_ASYNC_DEFAULT_DELAY,(e,s)=>r(e,s,t))}),u.token=n,u),g=(e,t,r)=>{let o;if(e){if(!(t=e.response))return c(e);const o=t.statusCode;return r||404!==o&&409!==o&&412!==o?507===o?((e=new f.default(f.default.EXCEEDS_QUOTA,"Exceeds quota",e)).response=t,c(e)):c(e):void m(!s,!0,g)}try{o=JSON.parse(t.responseText||t.response)}catch(r){return(e=new f.default(f.default.INVALID_DATA,"Invalid JSON returned by server",r)).response=t,c(e)}return c(void 0,t,o)};u=m(s,!0,g)}),u||h}updateManifest(e,t,r,s){De("updateManifest");const o={};let n;return n=this.getBranchManifestHref(e,void 0,(d,c)=>{if(d)return s(d);const l={[i.HeaderKeys.CONTENT_TYPE]:i.ManifestMediaType},h=e.manifestEtag,u=(e,r,s)=>{e?l[i.HeaderKeys.IF_MATCH]="*":h&&r&&(l[i.HeaderKeys.IF_MATCH]=h),n=n||o;const d={reuseRequestDesc:n,isStatusValid:ye,retryOptions:Ie,autoParseJson:!1},u=this._resolveUrl(c);this._service.invoke(i.HTTPMethods.PUT,u,l,t,d,(e,t)=>{if(e)return s(a.networkError("Error updating manifest",e,t));const r=t.statusCode;return!t.headers.etag||200!==r&&201!==r&&204!==r?412===r||409===r?(e=new f.default(f.default.UPDATE_CONFLICT,"Manifest has been changed",void 0,t),s(e)):s(a.unexpectedResponse("Unexpected response updating manifest",e,t)):s(void 0,t)})};u(r,!0,(e,t,o)=>e?(t=e.response)&&409===t.statusCode&&r?void u(!r,!1,s):s(e):s(void 0,t,o))}),n||o}getCompositeManifestHref(e,t,r){if(De("getCompositeManifestHref"),!e.assetId)throw new f.default(f.default.INVALID_PARAMS,"Composite must be bound.");if(!this.isProperAssetId(e.assetId))throw new f.default(f.default.INVALID_STATE,"Composite asset id has invalid format.");return this._getAssetManifestHref(e.assetId,t,r)}getBranchManifestHref(e,t,r){if(De("getBranchManifestHref"),!e.compositeAssetId)throw new f.default(f.default.INVALID_PARAMS,"Composite must be bound.");if(!this.isProperAssetId(e.compositeAssetId))throw new f.default(f.default.INVALID_STATE,"Composite asset id has invalid format.");return this._getAssetManifestHref(e.compositeAssetId,t,r)}getComponentHref(e,t,r){const s=e;De("getComponentHref");const o=s._owner;if(!o||!o.compositeAssetId)throw new f.default(f.default.INVALID_STATE,"Component must be part of a branch of a bound composite.");if(!this.isProperAssetId(o.compositeAssetId))throw new f.default(f.default.INVALID_STATE,"Composite asset id has invalid format.");if(o._core){const e=o._core._getSourceAssetInfoOfComponent(s);if(e)return void this._getComponentHref(e.compositeAssetId,e.componentId,e.componentVersion,r)}return this._getComponentHref(o.compositeAssetId,s.id,t,r)}_getComponentHref(e,t,r,s){return De("_getComponentHref"),this.getCachedAssetInfo(e,(e,o)=>{if(e)return e.code===f.default.ASSET_NOT_FOUND&&(e=new f.default(f.default.COMPOSITE_NOT_FOUND,"CompositeNotFound",e)),s(e);if(!o.componentTemplate)return s(new f.default(f.default.UNEXPECTED_RESPONSE,"Component URI template is missing."));const i={component_id:t};void 0!==r&&(i.version=r);const a=n.expandURITemplate(o.componentTemplate,i);return a?s(void 0,a):s(new f.default(f.default.UNEXPECTED_RESPONSE,"An error occurred when attempting expand manifest URI template."))})}getComponentRenditionHref(e,t,r,s){De("getComponentRenditionHref");const o=e._owner;if(!o||!o.compositeAssetId)throw new f.default(f.default.INVALID_STATE,"Component must be part of a branch of a bound composite.");if(!this.isProperAssetId(o.compositeAssetId))throw new f.default(f.default.INVALID_STATE,"Composite asset id has invalid format.");if(o._core&&o._core._getSourceAssetInfoOfComponent(e))throw new f.default(f.default.INVALID_STATE,"Getting a rendition of a source href not implemented.");r||(r="full");const a={version:t,size:r};if(e.assetId)return this.getCachedAssetInfo(e.assetId,(e,t)=>{if(e)return e.code===f.default.ASSET_NOT_FOUND&&(e=new f.default(f.default.COMPOSITE_NOT_FOUND,"CompositeNotFound",e)),s(e);if(t.renditionTemplates&&t.renditionTemplates[0]&&t.renditionTemplates[0].uri){const e=n.expandURITemplate(t.renditionTemplates[0].uri,a);return s(void 0,e)}return s(new f.default(f.default.UNEXPECTED_RESPONSE,"Rendition URI template is missing."))});const d={};let c;return c=this._getComponentHref(o.compositeAssetId,e.id,t,(t,r)=>{if(t)return s(t);c=c||d;const o={reuseRequestDesc:c,isStatusValid:ye,retryOptions:Ie,autoParseJson:!1};return r=this._resolveUrl(r),this._service.invoke(i.HTTPMethods.HEAD,r,{},void 0,o,(t,o)=>{if(t)return s(t);if(200===o.statusCode){const t={},i=o.headers.link;if(i){const e=n.parse(i);let r=e.get("rel","primary");r&&(t.primaryTemplate=r[0].uri),r=e.get("rel","rendition"),r&&(t.renditionTemplates=r)}return e.assetId=t.assetId=o.headers["x-resource-urn"],this._cacheInfoForAssetId(t.assetId,void 0,t),r=n.expandURITemplate(t.renditionTemplates[0].uri,a),s(void 0,r)}})}),c||d}isProperAssetId(e){return e.startsWith("urn:aaid:")}_getAssetManifestHref(e,t,r){return De("_getAssetManifestHref()"),this.getCachedAssetInfo(e,(e,s)=>{if(e)return e.code===f.default.ASSET_NOT_FOUND&&(e=new f.default(f.default.COMPOSITE_NOT_FOUND,"CompositeNotFound",e)),r(e);if(!s.manifestTemplate)return r(new f.default(f.default.UNEXPECTED_RESPONSE,"Manifest URI template is missing."));const o={};t&&(o.version=t);const i=n.expandURITemplate(s.manifestTemplate,o);return i?r(void 0,i):r(new f.default(f.default.UNEXPECTED_RESPONSE,"An error occurred when attempting expand manifest URI template."))})}_invokeOperation(e,t,r,s,d){De("_invokeOperation");let c=this._resolveUrl("/ops");c+="?invocation_mode=sync,async";const l={[i.HeaderKeys.CONTENT_TYPE]:i.OperationDocumentMediaType},h={op:e,id:n.generateUuid(),target:r,source:t};s&&(h.value=s),o.log("[invoke operation]: "+JSON.stringify(h,void 0,2));const u=(e,t)=>{let r;if(e)return(t=e.response)&&507===t.statusCode?(e=new f.default(f.default.EXCEEDS_QUOTA,"Exceeds quota",e,t),d(e)):d(e);try{r=JSON.parse(t.responseText||t.response)}catch(r){return e=new f.default(f.default.INVALID_DATA,"Invalid JSON returned by server",r,t),d(e)}return r.error?(e=new f.default(f.default.UNEXPECTED_RESPONSE,"Error in operation result: "+JSON.stringify(r.error,void 0,2),r.error,t),d(e)):d(void 0,t,r)},p=this._service.invoke(i.HTTPMethods.POST,c,l,JSON.stringify(h),{responseType:"text",isStatusValid:ye,retryOptions:Ie,autoParseJson:!1},(t,r)=>{if(t)return u(a.networkError("Error invoking operation "+e,t,r));const s=r.statusCode;200===s||201===s||204===s?u(void 0,r):202===s?this._handle202Response(r,p,this.SYNC_ASYNC_DEFAULT_DELAY,(e,t)=>{u(e,t)}):u(a.unexpectedResponse("Unexpected response for operation "+e,t,r),r)});return p}_getPagedCompositeVersionsHref(e,t,r,s,o,i){De("_getPagedCompositeVersionsHref");const a=e.assetId;if(!a)throw new f.default(f.default.INVALID_PARAMS,"Composite must be bound.");if(!this.isProperAssetId(a))throw new f.default(f.default.INVALID_STATE,"Composite asset id has invalid format.");return this.getCachedAssetInfo(a,(e,a)=>{if(e)return e.code===f.default.ASSET_NOT_FOUND&&(e=new f.default(f.default.COMPOSITE_NOT_FOUND,"CompositeNotFound",e)),i(e);if(!a.versionHistory)return i(new f.default(f.default.UNEXPECTED_RESPONSE,"Version history URI template is missing."));const d={};s&&(d.order=s),r&&(d.orderby=r),o&&(d.start=o),t&&(d.limit=t);const c=n.expandURITemplate(a.versionHistory,d);return c?i(void 0,c):i(new f.default(f.default.UNEXPECTED_RESPONSE,"An error occurred when attempting expand version history URI template."))})}_parseAndAppendJSONResponse(e,t,r,s){De("_parseAndAppendJSONResponse");const o=e.responseText||e.response;let n;try{n=JSON.parse(o)}catch(t){return s(new f.default(f.default.INVALID_DATA,"Invalid JSON returned by server",t,e))}return t&&(n[r]=t[r].concat(n[r])),s(void 0,n)}}function be(e){let t=0;return(r,s,o)=>{e(r-t,o),t=r}}const Te=o.newDebug("dcx:dcxjs:compositexfer:upload");function Pe(e,t){Te("_uploadComponent()");const{_additionalData:{componentId:r,componentType:s,componentIsNew:o,size:i,md5:a},_composite:d,_session:l}=e;n.validateObject(d,"composite",["id","string"],["repositoryId","string"],["assetId","string"]),n.validateParams(["session",l,"object"],["dataOrSliceCallback",t,["object","function","string"]],["componentType",s,"string"],["componentId",r,"string",!0],["size",i,"+number",!0],["md5",a,"string",!0]);const{id:h,repositoryId:u}=d,p=i||t.length||t.byteLength||t.size;return e._bytesTotal=p,_.default.resolve(void 0,e).then(()=>{const i=l.putCompositeComponent(d,r,t,s,o,p,a);return n.isObject(i.blockUpload)?i.blockUpload.onProgress=be(e._reportProgress.bind(e)):i.progress=be(e._reportProgress.bind(e)),i}).then(({result:t,response:o})=>{e._additionalData.response=o;const n=c.createUploadResults(h,d.assetId,u);return n.records[r]=we(r,p,s,t),n}).catch(e=>{throw e})}function we(e,t,r,s){if("object"!=typeof s)throw new a.DCXError(a.DCXError.UNEXPECTED_RESPONSE,"Invalid upload result, expecting object");const{md5:o,etag:n,revision:i,length:d=t}=s;if(null==d)throw new a.DCXError(a.DCXError.UNEXPECTED_RESPONSE,"No length");if(null==n)throw new a.DCXError(a.DCXError.UNEXPECTED_RESPONSE,"No etag");if(null==i)throw new a.DCXError(a.DCXError.UNEXPECTED_RESPONSE,"No version");if(null==o)throw new a.DCXError(a.DCXError.UNEXPECTED_RESPONSE,"No md5");return c.createUploadRecord(e,n,i,o,d,r)}function Re(e){return _.default.resolve(void 0,e).then(Oe.bind(e)).then(ke.bind(e)).then(Le.bind(e))}function Oe(){const{_session:e,_composite:t,_additionalData:{componentId:r}}=this;return e.getCompositeComponentUrl(t,r)}function ke(e){const{_session:t,_additionalData:{assetHref:r}}=this,s=i.newOperationDocBuilder().copy({href:r},{href:e},!1,!1).getDocument();return t.performOperation(s)}function Le(e){const{_composite:t,_additionalData:{componentId:r,componentType:s}}=this,o=e.response,n=i.deserializeAsset(o&&o.asset?o.asset:{}),a=c.createUploadResults(t.id,t.assetId,t.repositoryId);return a.records[r]=we(r,n.size,s,{revision:n.version,id:r,links:n.links,etag:n.etag,version:n.version,md5:n.md5,length:n.size,type:s}),a}const Se=o.newDebug("dcx:dcxjs:compositexfer:pull");function Ne(e){Se("_pullCompositeManifest()");const{_composite:t,_session:r,_additionalData:{versionId:s,referenceBranch:o}}=e;if(t._links){const{assetId:e,repositoryId:s}=r.registerLinks(t._links,t.repositoryId,t.assetId);t.assetId=e,t.repositoryId=s,delete t._links}if("string"!=typeof t.assetId)throw new a.DCXError(a.DCXError.INVALID_STATE,"Composite must have an asset id.");if("string"!=typeof t.repositoryId)throw new a.DCXError(a.DCXError.INVALID_STATE,"Composite must have a repository id.");let d;return Se("_pCM() pullManifest()",e),o&&!s&&(d=o.manifestEtag),_.default.resolve(void 0,e).then(()=>{const o=r.getCompositeManifest(t,s,d);return o.progress=be(e._reportProgress.bind(e)),o}).then(r=>{const{manifestData:o,manifestEtag:d,response:c}=r;e._additionalData.response=c;try{const e=i.parseLinksFromResponseHeader(c);t.links=e}catch(e){}if(Se("_pCM() pM() getCompositeManifest() cb",d),null===o)return;let l;try{l=n.isObject(o)?new _e(o):(new _e).parse(o),l.compositeAssetId=t.assetId,l.compositeRepositoryId=t.repositoryId,l._collaborationType=t.collaborationType,l._clientDataString=t.clientDataString,l.versionId=null!=c.headers.version?c.headers.version:s,l.manifestEtag=d}catch(e){throw Se("_pCM() pM() gCM() bad manifest"),new a.DCXError(a.DCXError.INVALID_JSON,"Corrupted manifest",e)}if(l.compositeState===se.committedDelete||l.compositeState===se.pendingDelete)throw new a.DCXError(a.DCXError.INVALID_STATE,"R-API composites should be deleted using a single step with RepoAPISession#deleteAsset");const h=l._core.allComponents();for(let e=0;e<h.length;++e){const t=h[e];t.state===se.pendingDelete||t.state===se.committedDelete?l.removeComponent(t):t.state=se.unmodified}return l}).then(e=>{if(null!=e)return e.compositeState=se.unmodified,e.readOnly=!0,t._options.xhrBaseBranchSupport&&!s&&(t._pulledBranchData=e.localData),e}).catch(e=>{if(e.code===a.DCXError.NOT_FOUND)throw new a.DCXError(a.DCXError.NO_COMPOSITE,"Composite missing or deleted",e.underlyingError||e);throw e})}const Me=o.newDebug("dcx:dcxjs:compositexfer:push");var Xe;function xe(e,t){if(Me("_pushComposite()"),!t.assetId||!t.repositoryId)throw new a.DCXError(a.DCXError.INVALID_STATE,"Composite is not bound to a cloud asset. createComposite() must be called to assign an asset ID and repository ID before calling push.");const{owner:r,compositeIsNew:s,shouldPushWithXMP:o}=e._additionalData;return function(e,t){return Me("_isNoOpPush()"),!t&&e.compositeState===se.unmodified}(r,s)?_.default.resolve(r,e):(function(e){if(Me("_assertStateIsValidForPush()"),e.compositeState===se.committedDelete)throw new a.DCXError(a.DCXError.DELETED_COMPOSITE,"Attempt to push a deleted composite");if(e.compositeState===se.pendingDelete)throw new a.DCXError(a.DCXError.INVALID_STATE,"R-API composites should be deleted using a single step with RepoAPISession#deleteAsset");if(e.compositeArchivalState===oe.pending||e.compositeArchivalState===oe.archived)throw new a.DCXError(a.DCXError.INVALID_STATE,"R-API composites cannot be archived")}(r),e._bytesTotal=0,e._indeterminateTotalBytes=!0,$e.call(e).then(Ye.bind(e)).then(o&&!Ue(r)?je.bind(e):void 0).then(Ve.bind(e)).then(Fe.bind(e)).catch(Be.bind(e)))}function Ue(e){return e.getComponentWithAbsolutePath("/META-INF/metadata.xml")}function je(){const{_composite:e,_session:r,_additionalData:{xmpConfig:s,owner:o,compositeIsNew:a}}=this,d=function(e,r,s){if(r.mode===t.XMPModes.CLIENT_MANAGED&&r.initialXMPXML)return r.initialXMPXML;const{creatorTool:o,modifyDate:i}=r,a=n.generateUuid(),d=[];if(e._derivationType===pe.COPY){const t=e._derivationDatetime,r=l.makeHistoryEventXML(o,"copied",a,t);d.push(r)}else if(s){const e=l.makeHistoryEventXML(o,"created",a,i);d.push(e)}if(!s||e._derivationType===pe.COPY){const e=l.makeHistoryEventXML(o,"saved",a,i);d.push(e)}return l.initializeXMPXML(o,a,i,d,void 0)}(o,s,a);return r.putCompositeComponent(e,n.generateUuid(),d,i.EmbeddedMetadataMediaTypes.XML,!0,d.length).then(t=>r.uploadResultsFromAdobeRepoUploadResult(t,e.id)).then(e=>(this._additionalData.xmpPushed=!0,o.addComponentWithUploadResults("xmp-metadata","metadata","META-INF/metadata.xml",void 0,e)))}function Be(e){Me("_handleError()",e);const{_session:t,_composite:r,_additionalData:{compositeIsNew:s}}=this;if(s||0===this.failedComponents.length&&(e.response&&400===e.response.statusCode||e.additionalData&&e.additionalData.bulkResponse))throw e;let o=!1;return t.headCompositeManifest(r).then(()=>{throw o=!0,e}).catch(t=>{if(!o&&404===t.response.statusCode)throw new a.DCXError(a.DCXError.NO_COMPOSITE,"Composite does not exist; may have been deleted",e,e.response,{failedComponents:this.failedComponents});throw e.additionalData={failedComponents:this.failedComponents},e})}function Ve(){Me("_pushManifest()");const e=this._additionalData.owner;if(e.compositeState!==se.modified)return;const{_session:t,_additionalData:{overwriteExisting:r,validationLevel:s,xmpConfig:o,compositeIsNew:n,shouldPushWithXMP:i,xmpPushed:a}}=this;e.compositeState=se.unmodified;const d=e.remoteData,c=d.length;this._bytesTotal+=c,this._indeterminateTotalBytes=!1;const l=function(e,t){return Me("_updateManifestEtag()"),e._journal.manifestEtag&&e._journal.currentBranchEtag===t.manifestEtag&&(Me("_uME() updating etag, previous: ",t.manifestEtag),t.manifestEtag=e._journal.manifestEtag),Me("_uME() using if-match: ",t.manifestEtag),t.manifestEtag}(this,e);let h;return!i||a?(h=t.updateCompositeManifest(e,d,r,s,l),h.progress=be(this._reportProgress.bind(this)),h):He(this,e,d,r,s,l,n,o)}function He(e,r,s,o,d,c,h,u,p=0){const{_session:f,_composite:m}=e,g=function(e,r){if(r.mode===t.XMPModes.CLIENT_MANAGED)return r.xmpPatch;const{creatorTool:s,modifyDate:o}=r,n=[];return e._derivationType===pe.COPY&&l.makeDerivedWithAction.call({patchDocument:n},s,"copied",void 0,o),l.appendHistoryEvent.call({patchDocument:n},"saved",s,o),n}(r,u),E=f.getLinkHrefForAsset(m,i.LinkRelation.EMBEDDED_METADATA),A=n.pruneUndefined({[i.HeaderKeys.IF_MATCH]:"*",[i.HeaderKeys.CONTENT_TYPE]:i.JSONPatchMediaType}),C=f.getLinkHrefForAsset(m,i.LinkRelation.MANIFEST),D=n.pruneUndefined({[i.HeaderKeys.IF_MATCH]:c,[i.HeaderKeys.CONTENT_TYPE]:`${i.ManifestMediaType};validation-level=${d}`});return _.default.allSettled([C,E]).then(([e,t])=>{if("rejected"===t.status||"rejected"===e.status)throw new a.DCXError(a.DCXError.INVALID_STATE,"Could not retrieve required links.");return f.performBulkRequest(m,[{method:i.HTTPMethods.PUT,href:e.value,headers:D,body:s},{method:i.HTTPMethods.PATCH,href:t.value,headers:A,body:JSON.stringify(g)}])}).then(t=>(function(e,t,r,s,o,n,d,c,h,u=0){Me("_handleManifestAndXMPResponse()");const[p,f]=h.result,{statusCode:_}=p,{statusCode:m}=f;if(Me("_hMAXR() manifest, embedded status: ",_,m),u>2&&(_>=400||m>=400))throw Me("_hMAXR() circuit break retries"),new a.DCXError(a.DCXError.INVALID_STATE,"Repairing failed or repeated failures during XMP/manifest push. Check additionalData.",void 0,h[0],{bulkResponse:h});let g=s,E=d,A=n;function C(s=r){return Me("_hMAXR() retry bulk; isNew, etag, overwrite: ",E,A,g),He(e,t,s,g,o,A,E,c,u+1)}if(_>=400){if(404===_)throw new a.DCXError(a.DCXError.NO_COMPOSITE,"Composite not found.",void 0,p,{bulkResponse:h});if(424===_);else{if(s&&409===_)throw new a.DCXError(a.DCXError.UPDATE_CONFLICT,"Manifest has been changed",void 0,p,{bulkResponse:h});if(s&&412===_)throw new a.DCXError(a.DCXError.PRECONDITION_FAILED,"Precondition failed",void 0,p,{bulkResponse:h});if(409===_)g=!1;else{if(412!==_)throw new a.DCXError(a.DCXError.UNEXPECTED_RESPONSE,"Unexpected response from manifest PUT in bulk.",void 0,p,{bulkResponse:h});g=!1,A=void 0}}}if(m>=400){if(424===m);else{if(404!==m){if(400===m){const r=Ue(t);if(r)return function(e,t,r){const{_session:s,_composite:o,_additionalData:{owner:n}}=e;return s.getCompositeComponent(o,t.id,t.version,"text").then(({response:e})=>{const n=l.repairXMPXML(e,r.creatorTool,r.modifyDate);if(e!==n)return s.putCompositeComponent(o,t.id,n,i.EmbeddedMetadataMediaTypes.XML,!1,n.length)}).then(e=>e&&s.uploadResultsFromAdobeRepoUploadResult(e,o.id)).then(e=>{if(e)return n.updateComponentWithUploadResults(t,e),e.records[t.id].etag})}(e,r,c).then(()=>C(t.remoteData));throw new a.DCXError(a.DCXError.INVALID_STATE,"Manifest appears to be corrupted.",void 0,p,{bulkResponse:h})}throw new a.DCXError(a.DCXError.UNEXPECTED_RESPONSE,"Unexpected response from embedded request in bulk.",void 0,p,{bulkResponse:h})}E=!0}return C()}const D=Ue(t);return e._journal.recordUploadedComponent(D.id,"*",`${parseInt(D.version)+1}`,f.headers["content-md5"]||D.md5,D.length),p})(e,r,s,o,d,c,h,u,t,p))}function Fe(e){if(void 0===e)return this._additionalData.owner;this._additionalData.manifestResponse=e;const{_journal:t,_composite:r,_additionalData:{owner:s}}=this,o=e.headers.etag,n=e.headers.version,i=s.changeCount;return t.manifestEtag=o,t.derivationType=pe.NONE,t.currentBranchEtag=s.manifestEtag,t.changeCount=i,t.versionId=n,t.applyToBranch(s),s.compositeState=se.unmodified,r._options.xhrBaseBranchSupport&&(r._pushedBranchData=s.localData),s}function Ye(e){if(Me("_handleFailedComponents()"),0===e.length)return this._additionalData.owner;if(e.filter(e=>e.error&&e.error.code===a.DCXError.EXCEEDS_QUOTA).length>0)throw new a.DCXError(a.DCXError.EXCEEDS_QUOTA,"One or more components failed to upload.",void 0,void 0,{failedComponents:e});throw new a.DCXError(a.DCXError.COMPONENT_UPLOAD_ERROR,"One or more components failed to upload.",void 0,void 0,{failedComponents:e})}function We(e){return Me("_getCurrentCopyOpCollector()"),(0===e.length||e[e.length-1].docBuilder.entryCount>=Je(this))&&(Me("_gCCOC() new copy op collector"),e.push({docBuilder:i.newOperationDocBuilder(),orderedPendingComponents:[]})),e[e.length-1]}function qe(e,t,r){Me("_reduceComponent()");const{_journal:s,_session:o,_composite:n,_additionalData:{owner:i}}=this,{state:d=se.unmodified,etag:c}=r,l=null==c;if(!l&&d===se.unmodified)return Me("_rC() not new, not modified"),s.removeRecordForUploadedComponent(r.id),t;if(!l&&(d===se.committedDelete||d===se.pendingDelete))return Me("_rC() not new, committedDelete or pendingDelete"),i.removeComponent(r),t;const h=i._core._getSourceAssetInfoOfComponent(r);if(Me("_rC() source asset",h),null==h)return this._failedComponents.push({component:r,error:new a.DCXError(a.DCXError.INVALID_STATE,"Component should not be modified or new without local storage")}),t;const u=s.getRecordForUploadedComponent(r.id);if(h&&u){const e=u["source-asset-info"];if(e&&e.compositeAssetId===h.compositeAssetId&&e.componentId===h.componentId&&e.componentVersion===h.componentVersion)return r.etag=u.etag,r.version=u.version,r.md5=u.md5,r.length=u.length,r.state=se.unmodified,t}const p=h.repositoryId,f=o.getCompositeComponentUrl({repositoryId:p,assetId:h.compositeAssetId},h.componentId,h.componentVersion),_=n.repositoryId,m=o.getCompositeComponentUrl({repositoryId:_,assetId:n.assetId},r.id,r.version);return t.push(Promise.all([f,m]).then(([t,s])=>{if(Me("_rC() got sourceHref, targetHref: ",t,s),"string"!=typeof t||"string"!=typeof s)return void this._failedComponents.push({component:r,error:new a.DCXError(a.DCXError.INVALID_STATE,"Could not resolve component href for copy.")});const o=We.call(this,e);o.docBuilder.copy({href:t},{href:s},!1,!0),o.orderedPendingComponents.push([r,h])}).catch(e=>{this._failedComponents.push({component:r,error:new a.DCXError(a.DCXError.UNEXPECTED,"Could not resolve hrefs to copy component.",e)})})),t}function ze(e){Me("_handleBatchResults(): ",e);const{_journal:t,_failedComponents:r}=this;e.map(e=>{if("rejected"===e.status)throw Me("_hBR() error",e.reason),e.reason;const{orderedPendingComponents:s,results:o,response:i}=e.value;o.map((e,o)=>{const[d,c]=s[o];try{const{etag:r,version:s,md5:o,length:l}=function(e,t){if(Me("_validateCopyResponse()"),!n.isObject(e))throw new a.DCXError(a.DCXError.INVALID_DATA,"Invalid result",void 0,t);if(e.error)throw Me("_vCR() error: ",e.error),e.error;if(!n.isObject(e.asset))throw new a.DCXError(a.DCXError.INVALID_DATA,"Invalid result asset",void 0,t);const r={etag:e.asset["repo:etag"],version:e.asset["repo:version"],md5:e.asset.md5,length:e.asset["repo:size"]};for(const s in r)if(null==r[s])throw new a.DCXError(a.DCXError.INVALID_DATA,`No ${s}`,void 0,t);return r}(e,i);d.etag=r,d.version=s,d.md5=o,d.length=l,d.state=se.unmodified,t.recordUploadedComponent(d.id,r,s,o,l,c)}catch(e){r.push({component:d,error:e})}})})}function Ge(e,t){Me("_parallelBatchOperations()");const{value:r,done:s}=t.next();return Me("_pBO() next generator: ",r,s),_.default.resolve(r).then(t=>{const r=t.map(t=>{const r=t.docBuilder.getDocument(),s=JSON.stringify(r);this._bytesTotal+=s.length;const o=e.performBatchOperation(s).then(({result:e,response:r})=>({results:e,response:r,orderedPendingComponents:t.orderedPendingComponents}));return o.progress=be(this._reportProgress.bind(this)),o});return _.default.allSettled(r)}).then(ze.bind(this)).then(()=>s?this.failedComponents:Ge.call(this,e,t))}function*Ke(e){Me("_makeCopyOpGenerator()");let t=[],r=[];for(let s=0;s<e.length;s++){const o=e[s];qe.call(this,t,r,o),r.length===Je(this)*(this._additionalData._test_maxConcurrentBatches||4)&&(yield Promise.all(r).then(()=>t),t=[],r=[])}return Promise.all(r).then(()=>t)}function $e(){Me("_pushComponents()");const{_session:e,_additionalData:{owner:t}}=this,r=t.allComponents();Me("_pC() component count: ",r.length);const s=Ke.call(this,r);return _.default.resolve(void 0,this).then(()=>Ge.call(this,e,s))}function Je(e){return e._additionalData._test_operationsPerBatch||100}t.XMPModes=void 0,(Xe=t.XMPModes||(t.XMPModes={}))[Xe.MANAGED=0]="MANAGED",Xe[Xe.PARTIALLY_MANAGED=1]="PARTIALLY_MANAGED",Xe[Xe.CLIENT_MANAGED=2]="CLIENT_MANAGED",Xe[Xe.UNMANAGED=3]="UNMANAGED";const Ze=o.newDebug("dcx:dcxjs:repocompositexfer:xferctx");class Qe{constructor(e,t,r){this._aborted=!1,this._bytesTransfered=0,this._abortHandlers=[],this._bytesTotal=0,this._additionalData={},this._failedComponents=[],this._session=e,this._composite=t,r&&(this._additionalData=r)}get aborted(){return this._aborted}get bytesTransfered(){return this._bytesTransfered}get bytesTotal(){return this._bytesTotal}get failedComponents(){return this._failedComponents}set onProgress(e){n.isFunction(e)&&(this._progressHandler=e)}get onProgress(){return this._progressHandler}onAbort(e){this._abortHandlers.push(e)}abort(e){this._aborted||(this._abortHandlers.forEach(t=>n.isFunction(t)&&t.call(void 0,e)),this._session._service.abortAllWithToken(this),this._aborted=!0)}_reportProgress(e,t){if(Ze("progress",e),t&&(this._indeterminateTotalBytes=!0),e>0&&(this._bytesTransfered+=e,n.isFunction(this._progressHandler)))try{this._progressHandler(this._bytesTransfered,this._bytesTotal,this._indeterminateTotalBytes)}catch(e){console.error("Error in progress callback",e)}}}const et=o.newDebug("dcx:dcxjs:compositexfer");var tt={pullCompositeManifestOnly:st,pullCompositeVersionManifestOnly:ot,getURLForComponent:nt,pushComposite:lt,uploadComponent:dt,uploadNewComponent:at,copyAssetForNewComponent:ct};function rt(e,t,r,s){const n=e._additionalData.response;if((n||r&&r.response)&&o.emitAnalyticsEvent(t,{composite:e._composite,error:r,response:n||r.response,branch:s}),r)throw r}function st(e,t){const r=new Qe(e,t,{referenceBranch:t.current}),s=(e,t)=>(rt(r,o.AnalyticsEvent.PullComposite,e,t),t);return Ne(r).then(s.bind(void 0,void 0)).catch(s)}function ot(e,t,r){const s=new Qe(e,t,{versionId:r,referenceBranch:t.current}),n=(e,t)=>(rt(s,o.AnalyticsEvent.PullCompositeVersion,e,t),t);return Ne(s).then(n.bind(void 0,void 0)).catch(n)}function nt(e,t,r){return e.getCompositeComponentUrl(t,t.id,void 0!==r?r:t.version)}function it(e,t,r,s,n){const i=e._additionalData.response;if((i||s&&s.response)&&o.emitAnalyticsEvent(o.AnalyticsEvent.UploadComponent,{composite:e._composite,error:s,response:i||s.response,isBlockTransferred:t,component:r}),s)throw s;return n}function at(e,t,r,s,o,i,a){et("uploadNewComponent()");const d=new Qe(e,t,{componentType:s,componentIsNew:!0,componentId:o||n.generateUuid(),size:i,md5:a}),c=(e,t)=>(it(d,!!l.blockUpload,{length:i,type:s},e,t),t),l=Pe(d,r).then(c.bind(void 0,void 0)).catch(c);return l}function dt(e,t,r,s,o,i){et("uploadComponent()"),n.validateObject(r,"component",["id","string"],["type","string"]);const{id:a,type:d}=r,c=new Qe(e,t,{componentType:d,componentIsNew:!1,componentId:a,size:o,md5:i}),l=(e,t)=>(it(c,!!h.blockUpload,r,e,t),t),h=Pe(c,s).then(l.bind(void 0,void 0)).catch(l);return h}function ct(e,t,r,s,o){return et("copyAssetForNewComponent()"),n.validateParams(["session",e,"object"],["composite",t,"object"],["assetHref",r,"string"],["type",s,"string"],["componentId",o,"string",!0]),Re(new Qe(e,t,{componentType:s,componentIsNew:!0,componentId:o||n.generateUuid(),assetHref:r}))}function lt(e,r,s,i=1,d={mode:t.XMPModes.MANAGED}){et("pushComposite()"),n.validateParams(["session",e,"object"],["composite",r,"object"],["overwriteExisting",s,"boolean"],["validationLevel",i,"+number"],["options",d,"object",!0]);const c=function(e){void 0===e.mode&&(e.mode=t.XMPModes.MANAGED);const r=e.modifyDate||(new Date).toISOString(),s=e.creatorTool||"dcx-js";if(e.mode===t.XMPModes.MANAGED||e.mode===t.XMPModes.PARTIALLY_MANAGED)return et("push: using managed XMP mode"),n.validateObject(e,"options",["creatorTool","string",!0],["modifyDate","string",!0]),{mode:e.mode,creatorTool:s,modifyDate:r};if(e.mode===t.XMPModes.CLIENT_MANAGED){et("push: using client managed XMP mode"),n.validateObject(e,"options",["xmpPatch","object[]",!0],["initialXMPXML","string",!0]);const t=e.xmpPatch||[],o=n.validateJSONPatchDocument(t);if(!0!==o)throw new a.DCXError(a.DCXError.INVALID_PARAMS,'Invalid parameter "options.xmpPatch".',void 0,void 0,{issues:o});return Object.assign(Object.assign({},e),{modifyDate:r,creatorTool:s})}if(e.mode===t.XMPModes.UNMANAGED)return et("push: using unmanaged XMP mode"),e;throw new a.DCXError(a.DCXError.INVALID_PARAMS,`Invalid XMP mode '${e.mode}'`)}(d),l=!r.isBound,h=function(e,r){return e.mode===t.XMPModes.PARTIALLY_MANAGED||e.mode===t.XMPModes.MANAGED||e.mode===t.XMPModes.CLIENT_MANAGED&&(r||!r&&!!e.xmpPatch)}(c,l),u=r._current.copy(),p=u._derivationType,f=new Qe(e,r,{owner:u,overwriteExisting:s,compositeIsNew:l,validationLevel:i,xmpConfig:c,shouldPushWithXMP:h,xmpPushed:!1});f._journal=f._composite._pushJournal||new Ae(r);const _=function(e,t){const s=f._additionalData.manifestResponse;(s||t&&t.response)&&o.emitAnalyticsEvent(o.AnalyticsEvent.PushComposite,{composite:r,branch:u,error:t,response:s||t.response,derivationType:p});const n=f._journal;return f._composite._pushJournal=n.isEmpty?void 0:n,e};return xe(f,r).then(_).catch(e=>{throw _(void 0),e})}const ht=o.newDebug("dcx:dcxjs:xfer"),ut=o.newDebug("dcx:dcxjs:xferctx");class pt{constructor(e,t,r){this._usingRepoSession=!1,this._bytesTotal=0,this._aborted=!1,this._abortHandlers=[],this._componentsPending=0,this._bytesTransfered=0,this._onProgress=n.noOp,ut("create",null!=e,null!=t,null!=r),this._session=e,this._callback=t,this._cleanup=r,this._reportProgress=e=>{if(ut("progress",e),e>0){this._bytesTransfered+=e;const t=this.onProgress;t&&t(this._bytesTransfered,this._bytesTotal)}}}get reportProgress(){return this._reportProgress}set reportProgress(e){this._reportProgress=e}get aborted(){return this._aborted}get bytesTransfered(){return this._bytesTransfered}get bytesTotal(){return this._bytesTotal}get onProgress(){return this._onProgress}set onProgress(e){this._onProgress=e}_isPromiseRequest(){return null!=this._reject}_callCallback(e,t){ut("_callCallback()","object"==typeof e?e.message:e,this._isPromiseRequest(),null!=this._callback);const r=this._callback;return this._isPromiseRequest()?(ut("_cC() promise req"),null!=e&&this._reject(e),void this._callback(void 0,t)):r?(this._callback=void 0,r(e,t)):void 0}_xferComplete(e,t){ut("_xferComplete",null!=e,null!=this._cleanup);const r=this._cleanup;r?(this._cleanup=void 0,r(e,t)):this._callCallback(e,t),this._abortHandlers=[]}abort(e){return ut("abort"),this._aborted||(this._aborted=!0,this._session._service.abortAllWithToken(this),this._abortHandlers.forEach(t=>t.call(null,e))),e||(ut("no abort error, rm callback"),this._callback=void 0,e=new Error("Aborted")),this._xferComplete(e)}onAbort(e){this._abortHandlers.push(e)}}const ft={pullCompositeManifestOnly:(e,t,r)=>(ht("pullCompositeManifestOnly()"),mt(t)?_t(e,void 0,t,r):st(t,e)),pullCompositeVersionManifestOnly:(e,t,r,s)=>(ht("pullCompositeVersionManifestOnly"),mt(r)?_t(e,t,r,s):ot(r,e,t)),createComposite(e,t,r,s,o){if(ht("createComposite()"),e.assetId)throw new f.default(f.default.INVALID_STATE,"composite must not already have an assigned asset id.");let n;return n=new pt(s,o,(function(e,t){return n._callCallback(e,t)})),n._composite=e,n._overwriteExisting=r,n._compositeIsNew=!0,n._journal=e._pushJournal||new Ae(e),n._callback=o,function(e,t){ht("_createCompositeAtHref");const r=t._composite,s=t._overwriteExisting;function o(e){t._xferComplete(e,r.assetId)}if(r.assetId)return o();{const n=t.token=t._session.createComposite(r,e,r.type,(function(e,n,i){if(e){if(e.code!==f.default.ALREADY_EXISTS)return e.code===f.default.INVALID_PARAMS?o(e):o(a.unexpectedResponse("Unexpected response creating a composite directory",e,n));if(s)r.assetId=i,o();else{const s=t._session._getAssetManifestHref(i,void 0,(function(s,n){if(s)return o(s);n=t._session._resolveUrl(n);const a=t._session.headRequest(n,(function(t,s){return t?o(t):404!==s.statusCode?o(e):(r.assetId=i,void o())}));a&&(a.token=t)}));s&&(s.token=t)}}else r.assetId=i,o()}));n&&(n.token=t)}}(t,n),n},pushComposite(e,t,r,s){const o=e;if(ht("pushComposite()"),!mt(r))throw new f.default(f.default.NOT_IMPLEMENTED,"Method not yet implemented for RepoAPISession");let n;const i=!o.isBound;return n=new pt(r,s,(function(e,t){const r=n._journal;return o._pushJournal=r.isEmpty?void 0:r,n._callCallback(e,t)})),n._composite=o,n._overwriteExisting=t,n._compositeIsNew=i,n._owner=o._current.copy(),n._journal=o._pushJournal||new Ae(o),function(e,t){ht("_pushComposite()");const r=t._owner,s=t._journal,o=t._compositeIsNew,n=t._overwriteExisting,i=t._session;if(!e.assetId)throw ht("_pC() error: not bound"),new f.default(f.default.INVALID_STATE,"createComposite must be called before pushComposite to create a composite directory and assign an asset id.");const a=r.changeCount,d=r.remoteData.length+50;if(t._bytesTotal=d,r.compositeState===se.committedDelete)return ht("_pC() error: push deleted"),t._xferComplete(new f.default(f.default.DELETED_COMPOSITE,"Attempt to push a deleted composite"));if(r.compositeArchivalState===oe.archived)return ht("_pC() error: push archived"),t._xferComplete(new f.default(f.default.DELETED_COMPOSITE,"Attempt to push an archived composite"));const c=r.compositeArchivalState===oe.pending;if(!o&&!c&&r.compositeState===se.unmodified)return ht("_pC() not new, unmodified, return null"),t._xferComplete();if(r.compositeState===se.pendingDelete)return o&&!n?(ht("_pC() error: delete unbound without overwriteExisting"),t._xferComplete(new f.default(f.default.INVALID_STATE,"Attempt to delete unbound composite without specifying overwriteExisting."))):(ht("_pC() deleting"),function(e,t,r){ht("_deleteComposite");const s=e._composite,o=e._owner,n=e._session;o.compositeState=se.committedDelete;const i=o.remoteData;e._bytesTotal=i.length,e._journal.manifestEtag&&e._journal.currentBranchEtag===o.manifestEtag&&(o.manifestEtag=e._journal.manifestEtag);const a=n.updateManifest(o,i,t,(function(t){if(t)return r(t);const i=n.deleteComposite(s,(function(t){return t?r(t):(e._journal.compositeHasBeenDeleted=!0,r(void 0,o))}));i&&(i.token=e)}));a&&(a.token=e)}(t,n,(function(e,r){return t._xferComplete(e,r)})));function l(r,s){if(!c)return s(void 0,r);{ht("_pC() archiving");const o=i.archiveComposite(e,(function(e){return e?s(e):(r.compositeArchivalState="archived",t._journal.compositeHasBeenArchived=!0,s(void 0,r))}));o&&(o.token=t)}}function h(r){if(o)return t._xferComplete(r);const s=i.getCompositeManifestHref(e,void 0,(function(e,s){if(e)return t._xferComplete(e);s=i._resolveUrl(s);const o=i.headRequest(s,(function(e,s){return e?t._xferComplete(e):404===s.statusCode?t._xferComplete(new f.default(f.default.NO_COMPOSITE,"Composite does not exist; may have been deleted")):t._xferComplete(r)}));o&&(o.token=t)}));s&&(s.token=t)}!function(e,t,r){ht("_pushComponents");const s=t.allComponents(),o=e._composite,n={},i=e._journal;function a(s,o,i){o?n[s.id]=o:delete n[s.id],i&&(e.failedComponents=e.failedComponents||[],e.failedComponents.push({component:s,error:i})),0===Object.keys(n).length&&r(void 0,t)}function d(t,r,s){const n=i.getRecordForUploadedComponent(t.id);if(r&&n){const e=n["source-asset-info"];if(e&&e.compositeAssetId===r.compositeAssetId&&e.componentId===r.componentId&&e.componentVersion===r.componentVersion)return t.etag=n.etag,t.version=n.version,t.md5=n.md5,t.length=n.length,void(t.state=se.unmodified)}a(t,"copying");const d=function(e,s,o){const n=s,d=o;if(!e){const s=n.headers.etag,o=n.headers.version||n.headers["x-latest-version"],a=d.md5,c=d.size;s||(e=new f.default(f.default.UNEXPECTED_RESPONSE,"No etag")),o||(e=new f.default(f.default.UNEXPECTED_RESPONSE,"No version")),a||(e=new f.default(f.default.UNEXPECTED_RESPONSE,"No md5")),c||(e=new f.default(f.default.UNEXPECTED_RESPONSE,"No length")),t.etag=s,t.version=o,t.md5=a,t.length=c,t.state=se.unmodified,i.recordUploadedComponent(t.id,s,o,a,c,r)}a(t,null,e)};let c;if(e._session._getComponentHref(r.compositeAssetId,r.componentId,r.componentVersion,(function(t,r){t||(c=e._session._resolveUrl(r))})),!c)throw new f.default(f.default.INVALID_STATE,"Session missing cached asset info for asset id = "+r.compositeAssetId);e._session._getResourcePathFromHref(c,(function(r,n){if(r)return d(r);c=e._session._resolveUrl(n);const i=e._session.copyAssetToComponentId(t.id,t.type,o.assetId,s,o.collaborationType===ge.SHARED_WITH_USER,e,c,d);i&&(i.progress=e._reportProgress,i.token=e)}))}for(let c=0;c<s.length;++c){const r=s[c];let o=r.state;const n=!r.etag;if(o||(o=se.unmodified),n||o===se.modified){const s=t._core._getSourceAssetInfoOfComponent(r);s?d(r,s,n||e._compositeIsNew):(e.failedComponents=e.failedComponents||[],e.failedComponents.push({component:r,error:new f.default(f.default.INVALID_STATE,"Component should not be modified or new without local storage")}))}else o===se.unmodified?i.removeRecordForUploadedComponent(r.id):o!==se.committedDelete&&o!==se.pendingDelete||t.removeComponent(r)}0===Object.keys(n).length&&r()}(t,r,(function(){if(t.aborted)return;const o=t.failedComponents;if(o){let e=new f.default(f.default.COMPONENT_UPLOAD_ERROR,"One or more components failed to upload.",void 0,void 0,{failedComponents:[]});const t=o.length;for(let r=0;r<t;r++){const t=o[r].error;if(t.code===f.default.EXCEEDS_QUOTA){e=new f.default(t.code,t.message);break}}return e.additionalData.failedComponents=o,h(e)}if(r.compositeState===se.modified){r.compositeState=se.unmodified,s.manifestEtag&&s.currentBranchEtag===r.manifestEtag&&(r.manifestEtag=s.manifestEtag);const o=r.remoteData;t._bytesTotal+=o.length,t._bytesTotal-=d;const c=i.updateManifest(r,o,n,(function(o,n){if(t.aborted)return;if(o)return h(o);const i=n.headers.etag;s.manifestEtag=i,s.currentBranchEtag=r.manifestEtag,s.changeCount=a,s.applyToBranch(r),r.compositeState=se.unmodified,e._options.xhrBaseBranchSupport&&(e._pushedBranchData=r.localData),l(r,(function(e,r){return t._xferComplete(e,r)}))}));c&&(c.progress=t._reportProgress,c.token=t)}else l(r,(function(e,r){return t._xferComplete(e,r)}))}))}(o,n),n},remixComposite(e,t,r,s,o,n,i){if(ht("remixComposite"),!mt(n))throw new f.default(f.default.NOT_IMPLEMENTED,"Method not yet implemented for RepoAPISession");const a=new Ce(n);function d(n){const i=a.remixComposite(e,t,r,s,o,(function(e,t){return n._xferComplete(e,e?void 0:t)}));return i&&(i.token=n),n}return mt(n)?d(new pt(n,i)):gt(a,d)},publishComposite(e,t,r,s,o,n,i){if(ht("publishComposite"),!mt(n))throw new f.default(f.default.NOT_IMPLEMENTED,"Method not yet implemented for RepoAPISession");const a=new Ce(n);function d(n){const i=a.publishComposite(e,t,r,s,o,(function(e,t){return n._xferComplete(e,e?void 0:t)}));return i&&(i.token=n),n}return mt(n)?d(new pt(n,i)):gt(a,d)},uploadNewComponent(e,t,r,s,o,i){if(ht("uploadNewComponent"),!mt(o))throw new f.default(f.default.NOT_IMPLEMENTED,"Method not yet implemented for RepoAPISession");const a=new Ce(o);function d(o){return Et(s||n.generateUuid(),t,!0,r.collaborationType===ge.SHARED_WITH_USER,e,r.id,r.assetId,a,o)}if(mt(o)){if("function"!=typeof i)throw new f.default(f.default.INVALID_PARAMS,'Param "callback" must be a function.');return d(new pt(o,i))}return gt(a,d)},uploadComponent(e,t,r,s,o){if(ht("uploadComponent"),!mt(s))throw new f.default(f.default.NOT_IMPLEMENTED,"Method not yet implemented for RepoAPISession");const n=new Ce(s);function i(s){return Et(e.id,e.type,!1,r.collaborationType===ge.SHARED_WITH_USER,t,r.id,r.assetId,n,s)}if(mt(s)){if("function"!=typeof o)throw new f.default(f.default.INVALID_PARAMS,'Param "callback" must be a function.');return i(new pt(s,o))}return gt(n,i)},copyAssetForNewComponent(e,t,r,s,o,i){if(ht("copyAssetForNewComponent"),!mt(o))throw new f.default(f.default.NOT_IMPLEMENTED,"Method not yet implemented for RepoAPISession");const a=new Ce(o);function d(i){return At(s||n.generateUuid(),t,!0,r.collaborationType===ge.SHARED_WITH_USER,e,r.id,r.assetId,o,i)}if(mt(o)){if("function"!=typeof i)throw new f.default(f.default.INVALID_PARAMS,'Param "callback" must be a function.');return d(new pt(o,i))}return gt(a,d)},getURLForComponent:(e,t,r)=>(ht("getURLForComponent()"),mt(t)?t.getComponentHref(e,e.version,(function(e,s){let o=s;e||(o=t._resolveUrl(o)),r&&r(e,o)})):nt(t,e))};function _t(e,t,r,s){if(ht("_pullCompositeManifest()"),e._links){const t=r.registerLinks(e._links);e.assetId=t,e._links=void 0}if("string"!=typeof e.assetId)throw new f.default(f.default.INVALID_STATE,"Composite must have an asset id.");let o;return o=new pt(r,s,(function(r,s){return ht("_pCM() finalizePull()",r,s),r?o._callCallback(r):null===s?o._callCallback(void 0,null):(s.compositeState=se.unmodified,s.readOnly=!0,e._options.xhrBaseBranchSupport&&!t&&(e._pulledBranchData=s.localData),o._callCallback(void 0,s))})),o._composite=e,function(){if(ht("_pCM() pullManifest()",o),o.aborted)return void ht("_pCM() pM() aborted");let s;e.current&&!t&&(s=e.current.manifestEtag,o._referenceBranch=e.current);const i=r.getCompositeManifest(e,t,s,(function(r,s,a){if(ht("_pCM() pM() getCompositeManifest() cb",r,a),o.aborted)return void ht("_pCM() pM() gCM() aborted: ",i);if(r){const e=r;return e.response&&404===e.response.statusCode?o._xferComplete(new f.default(f.default.NO_COMPOSITE,"Composite missing or deleted",e.underlyingError||r)):o._xferComplete(r)}if(null===s)return o._xferComplete(void 0,null);let d;try{if(d=n.isObject(s)?new _e(s):(new _e).parse(s),d.compositeAssetId=e.assetId,d._collaborationType=e.collaborationType,d._clientDataString=e.clientDataString,d.manifestEtag=a,d.versionId=t,(d.compositeState===se.committedDelete||d.compositeState===se.pendingDelete)&&!t){const t=o._session.deleteComposite(e,(function(e){return ht("_pCM() pM() gCM() deleteComposite() cb",e),e?o._xferComplete(new f.default(f.default.DELETED_COMPOSITE,"Error deleting composite directory",e)):o._xferComplete(new f.default(f.default.DELETED_COMPOSITE,"Composite is deleted"))}));return void(t&&(t.token=o))}}catch(e){return ht("_pCM() pM() gCM() bad manifest"),o._xferComplete(new f.default(f.default.INVALID_JSON,"Corrupted manifest",e))}const c=d.allComponents();for(let e=0;e<c.length;++e){const t=c[e];t.state===se.pendingDelete||t.state===se.committedDelete?d.removeComponent(t):t.state=se.unmodified}return o._xferComplete(void 0,d)}));i&&(i.token=o,i.progress=o._reportProgress,o.onAbort(e=>i.cancel(e))),ht("_pCM() pM() after:",i,o)}(),o}function mt(e){return e instanceof ve||e instanceof ee}function gt(e,t){return ht("createPromiseRequest"),new d.AdobePromise((r,s,o)=>{const n=new pt(e,r);return n._reject=s,o(()=>{n.abort()}),t(n)})}const Et=function(e,t,r,s,o,n,i,a,d){ht("internalUploadComponent");let l,h=o.length||o.byteLength||o.size;return d._bytesTotal=h,l=a.uploadDataForComponentId(e,t,i,r,s,d,o,(function(r,s,o){let a;if(!r)try{a=c.createUploadResults(n,i,void 0),h=h||l.bytesSent,a.records[e]=function(e,t,r,s,o){if("number"!=typeof t)throw new f.default(f.default.UNEXPECTED_RESPONSE,"No length");const n=s.headers.etag,i=s.headers.version||s.headers["x-latest-version"],a=o.md5;if(!n)throw new f.default(f.default.UNEXPECTED_RESPONSE,"No etag");if(!i)throw new f.default(f.default.UNEXPECTED_RESPONSE,"No version");if(!a)throw new f.default(f.default.UNEXPECTED_RESPONSE,"No md5");return c.createUploadRecord(e,n,i,a,t,r)}(e,h,t,s,o)}catch(e){r=e,a=void 0}return d._xferComplete(r,a)})),l&&(l.progress=d.reportProgress,l.token=d),d},At=function(e,t,r,s,o,n,i,a,d){ht("internalCopyComponent");const l=a.copyAssetToComponentId(e,t,i,r,s,d,o,(function(r,s,o){if(d.aborted)return;let a;if(!r)try{a=c.createUploadResults(n,i,void 0),a.records[e]=function(e,t,r,s){const o=s.headers.etag,n=s.headers.version||s.headers["x-latest-version"],i=t.md5,a=t.size;if("number"!=typeof a)throw new f.default(f.default.UNEXPECTED_RESPONSE,"No length");if(!o)throw new f.default(f.default.UNEXPECTED_RESPONSE,"No etag");if(!n)throw new f.default(f.default.UNEXPECTED_RESPONSE,"No version");if(!i)throw new f.default(f.default.UNEXPECTED_RESPONSE,"No md5");return c.createUploadRecord(e,o,n,i,a,r)}(e,o,t,s)}catch(e){r=e,a=void 0}return d._callCallback(r,a)}));return l&&(l.progress=d.reportProgress,l.token=d),d};class Ct{constructor(){this._originURL=null,this._manageUIURL=null,this._licenseType=null,this._licenseUrl=null,this._attributionURL=null,this._attributionName=null}get originURL(){return this._originURL}set originURL(e){this._originURL=e}get manageUIURL(){return this._manageUIURL}set manageUIURL(e){this._manageUIURL=e}get licenseType(){return this._licenseType}set licenseType(e){this._licenseType=e}get licenseUrl(){return this._licenseUrl}set licenseUrl(e){this._licenseUrl=e}get attributionURL(){return this._attributionURL}set attributionURL(e){this._attributionURL=e}get attributionName(){return this._attributionName}set attributionName(e){this._attributionName=e}}class Dt{constructor(e={}){this._compositeOptions=n.merge({},e),this._compositeOptions=e,e.logCallback&&(u.default.logCallback=e.logCallback)}static get COLLABORATION(){return{PRIVATE:Ee.COLLABORATION.PRIVATE,SHARED_BY_USER:Ee.COLLABORATION.SHARED_BY_USER,SHARED_WITH_USER:Ee.COLLABORATION.SHARED_WITH_USER}}static get AdobeDCXError(){return a.DCXError}static get StreamProvider(){return s.StreamProvider}get compositeXfer(){return ft}get communityPlatform(){return re}newEmptyComposite(e,t,r){return new Ee(e,t,r,void 0,this._compositeOptions)}newCompositeWithAssetId(e,t,r,s){return new Ee(t,s,r,e,this._compositeOptions)}newRepoCompositeWithAssetId(e,t,r,s,o){const n=new Ee(r,o,s,e,this._compositeOptions);return n.repositoryId=t,n}newCompositeWithLinks(e,t,r,s){const o=new Ee(t,s,r,void 0,this._compositeOptions);return o.links=e,o}newCompositeAsCopyOf(e,t,r,s){return Ee.newCompositeAsCopyOf(e,t,r,s,this._compositeOptions)}createHTTPService(e,t={}){return s.createHTTPService(e,t)}createStorageSession(e,t){return new ve(e,t)}createCommunitySession(e,t){return new ee(e,t)}createRemixData(){return new Ct}createCommunityPublicationRecord(){return new m}}const yt=(e,t)=>`It looks like you're using a ${e} bundle in a ${t} environment. \r\nThis may lead to unexpected results. \n\nSee https://git.corp.adobe.com/DMA/dcx-js/blob/dev/docs/guides/bundles.md for main field definitions.`,It=s.AdobeNetworkHTTPService,vt=It,bt=tt,Tt=tt;n.isBrowserSDK()&&n.isNode()?u.default.warn(yt("browser","Node")):!n.isBrowserSDK()&&n.isBrowser()&&u.default.warn(yt("Node","browser"));const Pt=o.getGlobalLogger(),wt=p,Rt=Ee.COLLABORATION,Ot=s.StreamProvider,kt=m,Lt=Dt;Object.defineProperty(t,"createHTTPService",{enumerable:!0,get:function(){return s.createHTTPService}}),Object.defineProperty(t,"AdobeDCXLogger",{enumerable:!0,get:function(){return o.AdobeDCXLogger}}),Object.defineProperty(t,"getGlobalLogger",{enumerable:!0,get:function(){return o.getGlobalLogger}}),Object.defineProperty(t,"AdobeDCXError",{enumerable:!0,get:function(){return a.AdobeDCXError}}),Object.defineProperty(t,"DCXError",{enumerable:!0,get:function(){return a.DCXError}}),Object.defineProperty(t,"isAdobeDCXError",{enumerable:!0,get:function(){return a.isAdobeDCXError}}),t.AdobeCommunityPlatform=re,t.AdobeCommunityPublicationRecord=m,t.AdobeCommunitySession=ee,t.AdobeDCX=Lt,t.AdobeDCXBranch=_e,t.AdobeDCXComponent=ie,t.AdobeDCXComposite=Ee,t.AdobeDCXCompositeXfer=ft,t.AdobeDCXElement=ue,t.AdobeDCXNode=ae,t.AdobeDCXPushJournal=Ae,t.AdobeDCXRepoCompositeXfer=bt,t.AdobeDCXUtil=wt,t.AdobeNetworkHTTPService=It,t.AdobeRemixData=Ct,t.AdobeStorageSession=ve,t.COLLABORATION=Rt,t.CommunityPublicationRecord=kt,t.CommunitySession=ee,t.HTTPService=vt,t.RemixData=Ct,t.StorageSession=ve,t.StreamProvider=Ot,t.communityPlatform=re,t.compositeXfer=ft,t.convertToDCXComposite=function(e,t,r){if(me("convertToDCXComposite()"),e.format&&!e.format.endsWith("+dcx"))throw new a.DCXError(a.DCXError.INVALID_PARAMS,'Format must end in "+dcx"');return new Ee(e.name,e.format,t,e.assetId,e.repositoryId,r)},t.copyAssetForNewComponent=ct,t.createCommunityPublicationRecord=()=>new m,t.createCommunitySession=(e,t)=>new ee(e,t),t.createComposite=function(e,t,r,s){if(me("createComposite()"),n.validateParams(["session",e,"object"],["composite",t,"object"],["parentDir",r,"object"],["relPath",s,"string"]),t.assetId)throw new a.DCXError(a.DCXError.INVALID_STATE,"Composite must not already have an assigned asset id.");if("string"!=typeof r.repositoryId&&"string"!=typeof t.repositoryId)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Either composite or parentDir must contain valid repositoryId.");if("string"==typeof r.repositoryId&&"string"==typeof t.repositoryId&&r.repositoryId!==t.repositoryId)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Composite contains a repositoryId that does not match parentDir.");if("string"!=typeof t.type)throw new a.DCXError(a.DCXError.INVALID_STATE,"Composite must contain a valid type.");const o="string"==typeof t.repositoryId?t.repositoryId:r.repositoryId,d=Object.assign(Object.assign({},r),{repositoryId:o});if(!i.isMinimalAdobeAsset(d))throw new a.DCXError(a.DCXError.INVALID_PARAMS,"parentDir must contain links or repositoryId & assetId or path");return function(e,t,r,s,o){const{repositoryId:a}=r;return e.createComposite(r,s,o).then(e=>{const{assetId:r,links:s}=e.result;return t.assetId=r,t.repositoryId=a,t.links=s,t}).catch(r=>{try{if(r.response&&n.isObject(r.response.headers)){const s=r.response.headers["asset-id"]||r.response.headers["x-resource-id"],o=i.parseLinksFromResponseHeader(r.response);t.links=o,"string"==typeof s&&n.isObject(o)&&e.updateCachedAssetLinks({assetId:s,repositoryId:a,links:o})}}catch(e){}throw r})}(e,t,d,s,t.type)},t.createRemixData=()=>new Ct,t.createStorageSession=(e,t)=>new ve(e,t),t.default=Dt,t.getURLForComponent=nt,t.logger=Pt,t.newCompositeAsCopyOf=(e,t,r,s,o={})=>Ee.newCompositeAsCopyOf(e,t,r,s,o),t.newCompositeWithAssetId=function(e,t,r,s,o,n){return o&&"object"==typeof o&&(n=o,o=void 0),new Ee(t,s,r,e,o,n)},t.newCompositeWithLinks=function(e,t,r,s,o,n){o&&"object"==typeof o&&(n=o,o=void 0);const i=new Ee(t,s,r,void 0,o,n);return i.links=e,i},t.newDCXComposite=function(e,t,r,s,o,n,i={}){if(null==e&&null==n){if("string"!=typeof o)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Unbound DCXComposite must have a type.");if("string"!=typeof r)throw new a.DCXError(a.DCXError.INVALID_PARAMS,"Unbound DCXComposite must have a name.")}const d=new Ee(r,o,s,e,t,i);return n&&(d.links=n),d},t.newEmptyComposite=(e,t,r,s={})=>new Ee(e,t,r,void 0,void 0,s),t.newEmptyRepoComposite=(e,t,r,s,o={})=>new Ee(e,t,void 0,s,r,o),t.newRepoCompositeWithAssetId=(e,t,r,s,o,n)=>new Ee(r,o,s,e,t,n),t.newRepoCompositeWithLinks=(e,t,r,s,o,n={})=>{const i=new Ee(r,o,s,void 0,t,n);return i.links=e,i},t.pullCompositeManifestOnly=st,t.pullCompositeVersionManifestOnly=ot,t.pushComposite=lt,t.repoCompositeXfer=Tt,t.uploadComponent=dt,t.uploadNewComponent=at,Object.keys(d).forEach((function(e){"default"===e||t.hasOwnProperty(e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return d[e]}})})),Object.keys(c).forEach((function(e){"default"===e||t.hasOwnProperty(e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return c[e]}})}))}).call(this,r(23))}}]);
//# sourceMappingURL=vendors~m-storage-dee1fe93.js.map