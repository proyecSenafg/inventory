(window.webpackJsonptheoWebApp=window.webpackJsonptheoWebApp||[]).push([[31],{"B/1X":function(e,t,o){},Yzgm:function(e,t,o){var n,r;const{IMAGE_FILE_TYPES:i,VIDEO_FILE_TYPES:s,DEFAULT_FILE_TYPES:a}=o("zfI8");n=[o("YLtl"),o("UFvF"),o("hcqx"),o("7mGH"),o("bgEM"),o("MGCh"),o("bBG2"),o("xOOu"),o("7gWt"),o("O72U")],void 0===(r=function(e,t,n,r,d,u,c,p,l,g){const h=u.channel("theo-publish-impl"),m=c.default,{SparkPerformanceTracker:f}=l,{publishStart:v,publishComplete:P}=g.PERFORMANCE_MARKERS,{getPostController:w}=d;return new function(){this.community=window.marvel.settings.theoc,this.communityCategory="theos";const d=this;let u,c=0;this.doPublish=function(e,o,n){d.sendPublishProgress(5);const r=w(),i=r.getIndicesOfPagesToShare();u=i.length,f.mark(v);const s=i.map(t=>r.getDownloadImageBlobPromise(e,"image/jpeg",1,null,t));return t.all(s).then((async function(e){return d.sendPublishProgress(15),Promise.all(e.map(e=>"function"==typeof e.arrayBuffer?e.arrayBuffer():new t.Promise((t,o)=>{const n=new FileReader;n.addEventListener("load",()=>{t(n.result)}),n.addEventListener("error",()=>{o(n.error)}),n.readAsArrayBuffer(e)})))})).then(t=>{d.sendPublishProgress(20);const o={},n=e.getDCXComposite(),r={"manifest-format-version":6,name:n.name,type:n.type,state:"unmodified",id:n.id,components:[]};return t.forEach((e,t)=>{const n="preview"+(0===t?"":i[t]),s=n+".jpg";d.previewPath=d.previewPath||s,o[s]={content:new Uint8Array(e),contentType:"image/jpeg"},r.components.push({id:n,type:"image/jpeg",rel:"rendition",name:s,path:s,state:"unmodified",length:e.length})}),o.manifest={raw:r,content:JSON.stringify(r),contentType:"application/vnd.adobe.dcx-manifest+json"},d.sendPublishProgress(30),o})},this.resourceUploadReport=function(e,t,o){h.info(`uploaded ${t} version ${o.version}`);if(t.match(/^preview(\d*)(\.jpg)?$/)){const n=e.manifest.raw,r=n.components.find(e=>e.name===t);r?(r.etag=o.etag,r.version=o.version,e.manifest.content=JSON.stringify(n),d.sendPublishProgress(75)):h.error(`missing preview component for ${t} during upload report`)}else if("manifest"===t){var n,r;d.sendPublishProgress(90);const e=null!==(n=null===(r=d.videoProgress)||void 0===r?void 0:r.numPages)&&void 0!==n?n:0;f.measure(P,{start:v,detail:{pageCount:u,animatedPageCount:e,staticPageCount:u-e}})}else h.error("got unexpected upload report for "+t)},this.reviseDoPublishAfterFilesUpdate=function(o,n){const r=o.manifest.raw,i={};return e.each(n,(function(e){e.track_version&&""!==e.version&&(i[e.destination]=e.version)})),e.each(r.components,(function(t){e.isUndefined(i[t.path])||(t.version=i[t.path])})),this.videoPubInfo&&Object.entries(this.videoPubInfo).forEach(([e,t])=>{const o=e+".mp4",n="preview"+e.substring("videoRendition".length);r.components.push({id:e,previewId:n,type:"video/mp4",rel:"rendition",name:e,path:o,state:"unmodified",height:t.height,width:t.width,length:t.videoLength,etag:t.video_resource_data.etag,version:t.video_resource_data.version})}),o.manifest.content=JSON.stringify(r),t.resolve(o)},this.getUseProgressEvents=function(){return!0},this.trigger=function(e,t){"progress"===e&&this.videoProgress?(this.videoProgress.copyPct=t,this.sendVideoAndCopyProgress()):n.Model.prototype.trigger.apply(this,arguments)},this.updateSnapiProgress=function(e,t,o,n){if("progress"===e&&this.videoProgress&&o===this.videoProgress.progressId){this.videoProgress.videoPctByPage[n]=t;const e=Object.values(this.videoProgress.videoPctByPage).reduce((e,t)=>e+t,0);this.videoProgress.videoPct=e/this.videoProgress.numPages,this.sendVideoAndCopyProgress()}},this.sendVideoAndCopyProgress=function(){this.sendPublishProgress(c)},this.sendPublishProgress=function(e){c=e;let t=c;if(this.videoProgress){const e=this.videoProgress.videoPct+this.videoProgress.copyPct;t=Math.ceil((c+e)/2)}n.Model.prototype.trigger.apply(this,["progress",t])},this.getFilesDataToCopyFromServerData=function(e,o,n){const r=o.getDCXComposite().current,i=[],s=e.id;if(this.videoProgress=null,n.showAvatar&&""!==n.authorAvatarUrl){const e=r.getComponentWithAbsolutePath(o.getMyApp().getStorageImpl().avatarComponentPath);e&&i.push({source:s+"/"+e.id,content_type:e.type,destination:e.path})}this.videoPubInfo=null;const a=this.getFilesDataForAnimatedPages(o,n,i);return a||t.resolve(i)},this.getFilesDataForAnimatedPages=function(e,n,r){const i=w();if(!i.webAnimationEnabled())return;const s=i.getIndicesOfPagesToShare(),a=[],d=[];for(let e=0;e<s.length;e++)try{const t=s[e],o=i.getPageAtIndex(t);i.hasAnimationStyleOnPage(o)&&(a.push(i.getPgmGraphForPublish(o)),d.push(t))}catch(e){return void h.error("PGM graph error: "+e)}if(0===a.length)return;const u=o("1geK").default,c=e.getMyApp().getStorageImpl().currentDoc.id,p=e.getMyApp().getCPProjectId(e);var l={files:r,additionalCopyDefer:t.defer()},g=a.length,f=0;return this.videoProgress={videoPct:0,copyPct:0,progressId:c,videoPctByPage:{},numPages:g},a.forEach((e,t)=>{const o=d[t];var r=u.getPublishRequestBody(n);r.pgmGraph=e.encode();var i=e.bounds.aspectRatio,a=i<1?1280:Math.round(1280/i),h=i<1?Math.round(1280*i):1280;r.renderOptions={videoHeight:a,videoWidth:h,scaleType:0};var v={},P=new Date;let w;m.publish("publish:mp4:started",{projectId:c,pageIndex:o}),w=0===t&&s[0]===o?"videoRendition":"videoRendition"+o,u.sendPgmPublishRequestForUpload(c,w+".mp4",p,r,v,this.updateSnapiProgress.bind(this)).then(function(e){m.publish("publish:mp4:succeeded",{projectId:c,pageIndex:o,requestId:v.value,timeSpent:new Date-P+"ms"}),this.videoPubInfo=this.videoPubInfo||{},this.videoPubInfo[w]=e,f++,this.updateSnapiProgress("progress",100,c,v.value),f===g&&l.additionalCopyDefer.resolve(this.videoPubInfo)}.bind(this)).catch((function(e){m.publish("publish:mp4:failed",{projectId:c,pageIndex:o,requestId:v.value,timeSpent:new Date-P+"ms",error:JSON.stringify(e,null,2)}),l.additionalCopyDefer.reject(e)}))}),t.resolve(l)},this.getData=function(e,t){if(!t)return void console.error("no doc for getData");let o=t.getMyApp().getStorageImpl().getData(e,t,"shareData");if(void 0===o){const t=w();"publishTitle"===e?o=t.getCurrentDocumentSynthesizedName():"description"===e&&(o=t.getCurrentDocumentDescription())}return o},this.setData=function(e,t,o){if(!o)return void console.error("no doc for setData");return o.getMyApp().getStorageImpl().setData(e,t,o,"shareData")},this.getDocumentCredits=function(e){return""},this.getDocumentDefaultCredits=function(e){return""},this.getBase64Data=function(e,o,n,r,d){const u=t.defer(),c=w();let p=n;return o===a.DEFAULT?c.hasAnimationStyleOnActivePage()?(o=s.MP4,p=r):(o=i.JPEG,p=n):o===s.MP4&&(p=r),c.getBase64Data(o,p,d).then((function(e){u.resolve(e)})),u.promise},this.getBase64DataForPages=function(e,o,n,r,i,s){const a=t.defer();return w().getBase64DataForPages(o,n,r,i,s).then((function(e){a.resolve(e)})),a.promise},this.getDownloadUrl=function(e){const o=t.defer(),n=this.getPageCount(e),r=this.downloadAsZip(n)?"application/zip":"image/jpeg",i=this.getDownloadFileName(e,n),s=w(),a=[];for(var d=0;d<n;d++)a.push(s.getDownloadImageBlobPromise(e,r,1,null,d));return Promise.all(a).then((async function(t){let n;if(t.length>1){const o=e.getProjectName(),r=new p;t.forEach((e,t)=>{r.file(`${o}-${t+1}.jpg`,e)}),n=await r.generateAsync({type:"blob"})}else n=t[0];o.resolve((function(){if(window.navigator.msSaveBlob)window.navigator.msSaveBlob(n,i);else{const e=window.URL.createObjectURL(n),t=document.createElement("a");document.body.appendChild(t),t.setAttribute("href",e),t.setAttribute("download",i),t.click(),window.URL.revokeObjectURL(e),document.body.removeChild(t)}}))})),o.promise},this.getPageCount=function(e){const t=Number(e.getDCXRoot().getValue("theo#page-count"));return Number.isNaN(t)?1:t},this.downloadAsZip=function(e){return e>1||r.hasFeature("post-download-zip-of-pngs")},this.getDownloadFileName=function(e,t){const o=null!=t?t:this.getPageCount(e);return e.getProjectName()+(this.downloadAsZip(o)?".zip":".jpg")},this.augmentMetaData=function(t){const o=w();t.custom=e.merge(t.custom||{},o.getFirstPageSize()),e.assign(t,{description:o.getCurrentDocumentDescription()}),e.assign(t,{machine_tags:o.getRemixAncestorsIntoMachineTags(t.machine_tags)})},this.getPublishingSetup=function(){return{supportsDownload:!1,publishingSavesData:!1,assetType:"application/vnd.adobe.theo.document+dcx",supportedFields:["publishTitle","authorFull","showAuthor","authorAvatarUrl","isPublic","category"]}}}}.apply(t,n))||(e.exports=r)},etvg:function(e,t,o){var n=o("LboF"),r=o("B/1X");"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[e.i,r,""]]);var i={insert:"head",singleton:!1};n(r,i);e.exports=r.locals||{}},qtK1:function(e,t,o){var n,r;n=[o("UFvF"),o("4pbt")],void 0===(r=function(e,t){var o={getCoreWrapperPromise:function(o){var n,r=e.defer();return isNaN(o)&&(o=1e4),n=window.setTimeout((function(){r.reject(new Error("Timed out waiting for coreWrapper to become available"))}),o),t.getCoreWrapperPromise().then((function(e){clearTimeout(n),r&&r.resolve(e)})).catch((function(e){clearTimeout(n),r.reject(e)})),r},getSelectedFormaPromise:function(t,n){var r=e.defer();return o.getCoreWrapperPromise(t).then((function(e){r.resolve(e.getSelectedForma())})).catch((function(e){r.reject(e)})),r.promise}};return o}.apply(t,n))||(e.exports=r)},zvPW:function(e,t,o){var n,r;n=[o("xeH2"),o("YLtl"),o("hcqx"),o("UFvF"),o("Uwho"),o("2ofD"),o("7mGH"),o("oWUw"),o("bgEM"),o("chD/")],void 0===(r=function(e,t,n,r,i,s,a,d,u,c){return n.View.extend({events:{"click .theo-share-button":"handleShareButton"},initialize(){window.PIXI&&!window.ADOBE_POST_PIXI&&(window.ADOBE_POST_PIXI=window.PIXI),window.PIXI=window.ADOBE_POST_PIXI,e("body").addClass("post-app"),t.bindAll(this,"doRender","adjustRouteFragmentInAppConfig"),this._setupTestHook(),window.marvel.events.on("adjust-route-fragment",this.adjustRouteFragmentInAppConfig)},_setupTestHook(){a.hasFeature("post-expose-model-to-ui-tests")&&(window._TheoBrowserTestUtils=o("qtK1"))},doRender(){const e=t.merge({},this.appConfig,function(){const e=n.history.getFragment().split("?")[1],t={};if(e){const o=e.split("&");for(let e=0;e<o.length;e++){const n=o[e].split("=");n[0]&&n[1]?t[decodeURIComponent(n[0])]=decodeURIComponent(n[1]):n[0]&&(t[decodeURIComponent(n[0])]="")}}return t}());a.hasFeature("post-debug-dump-manifest-on-load")&&console.info(JSON.stringify(s.currentDoc.attributes.compositeObj._current._data)),this.addAnalyticsContextData(e),"remix"===this.appConfig.operation&&"function"==typeof s.currentDoc.triggerProjectCreatedAnalytics&&s.currentDoc.triggerProjectCreatedAnalytics(),u.getPostController().enable(this.el,e)},addAnalyticsContextData(e){e.contextString&&c.addContextData({contextString:e.contextString}),e.remixableAssetId&&c.addContextData({remixableAssetId:e.remixableAssetId})},render(){if("Chrome"===d.name&&d.majorVersion<=45)return window.alert("Sorry, you're using an older version of the Chrome browser that is not supported by Spark Post. Please update your browser to the latest version and try again."),window.marvel.events.trigger("hide-interstitial"),void marvel.navigate("/",{trigger:!0});marvel.events.on("designview-rendersubview-doc-loaded",this.doRender)},handleShareButton(){window.marvel.events.trigger("share-workflow-current-doc")},beforeUnload(){window.zE&&window.zE.hide&&window.zE.hide();const t=r.defer(),o=u.getPostController();if(!o||!1===o.enabled)return t.resolve(),t.promise;var n;(c.removeContextData(["contextString","remixableAssetId"]),window.marvel.isSaving)?(e("body").removeClass("post-app"),o.disable(),(null===(n=this.appConfig.ccEverywhere)||void 0===n?void 0:n.isEmbed)?t.resolve(this.appConfig.routeFragment):t.resolve()):o.handleUnload().then(function(){var n;e("body").removeClass("post-app"),o.disable(),(null===(n=this.appConfig.ccEverywhere)||void 0===n?void 0:n.isEmbed)?t.resolve(this.appConfig.routeFragment):t.resolve()}.bind(this)).catch((function(e){t.reject(e)})).done();return marvel.events.off("designview-rendersubview-doc-loaded",this.doRender),t.promise},adjustRouteFragmentInAppConfig(e){this.appConfig.routeFragment=e}})}.apply(t,n))||(e.exports=r)}}]);
//# sourceMappingURL=theo-web-view-ad1408c8.js.map